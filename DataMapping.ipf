#pragma rtGlobals=1		// Use modern global access method.	Variable/G mat3d_energy_center,mat3d_energy_wide,mat3d_energy_increment	Variable/G mat3d_energy_min,mat3d_energy_max	Variable/G mat3dk_energy_center,mat3dk_energy_wide,mat3dk_energy_increment	Variable/G mat3dk_energy_min,mat3dk_energy_max	Variable/G mat3dkVD_energy_center,mat3dkVD_energy_wide,mat3dkVD_energy_increment	Variable/G mat3dkVD_energy_min,mat3dkVD_energy_max		Variable/G mat3dkHD_energy_center,mat3dkHD_energy_wide,mat3dkHD_energy_increment	Variable/G mat3dkHD_energy_min,mat3dkHD_energy_max		Variable/G mat3dVD_energy_center,mat3dVD_energy_wide,mat3dVD_energy_increment	Variable/G mat3dVD_energy_min,mat3dVD_energy_max				Variable/G mat3dHD_energy_center,mat3dHD_energy_wide,mat3dHD_energy_increment	Variable/G mat3dHD_energy_min,mat3dHD_energy_max		Variable/G theta_zero,phi_zero,rot_zero,KEatEF,lattice_0	Variable/G theta_zero_inc,phi_zero_inc,rot_zero_inc,lattice_0_inc	Variable/G global_mu,global_t,global_tprime	Variable/G global_mu_inc,global_t_inc,global_tprime_inc	Variable/G gloal_x	Variable/G src_vs_bnl=0	Variable/G quality_factor	Variable/G theta1_zero,phi1_zero,rot1_zero,KE1atEF,lattice1_0		Variable/G theta1_zero_inc,phi1_zero_inc,rot1_zero_inc,lattice1_0_inc	Variable/G Hline_slice	Variable/G Hline_slice_min	Variable/G Hline_slice_max	Variable/G Hline_slice_delta	Variable/G Vline_slice	Variable/G Vline_slice_min			Variable/G Vline_slice_max	Variable/G Vline_slice_delta	Variable/G VvsHline	Variable/G numcombslicer		Variable/G whichmat3d	Variable/G sliderH	Variable/G sliderV	Variable/G Slicermode	Variable/G Csrx1forslicer	Variable/G Csry1forslicer	Variable/G Csrx2forslicer	Variable/G Csry2forslicer		Variable/G predictKEatEF,predictlattice_0	Variable/G predictlattice_0_inc	Variable/G predict_mu,global_t,predict_tprime	Variable/G predict_mu_inc,predict_t_inc,predict_tprime_inc		Variable/G predict_x	Variable/G predict_angletheta_from,predict_angletheta_to,predict_angletheta_delta	Variable/G predict_anglephi_from,predict_anglephi_to,predict_anglephi_delta	Variable/G predict_acept,predictwedge_inc	Variable/G predict_rotation,predictrotation_inc	Variable/G predict_VvsHslit	Variable/G predict_orientation	Variable/G whichpnt	String/G predict_VvsHslit_str		Variable/G valuespecialforslicer	Variable/G FS_H_type	Variable/G lattice_hexagon		Variable/G lattice_hexagon_inc	Variable/G aonb,aonb_inc	Variable/G viewFS2f	String/G ViewFS2fstr		Variable/G viewFS2f_1	String/G ViewFS2fstr	_1	Variable/G Mode_ifs4	Variable/G central_ifs4	Variable/G auto_update_ifs4	Variable/G irange_ifs4	Variable/G Mode_mfs4Window predict_cuts() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(369,65,883,677) pBZbondaries_y vs pBZbondaries_x	AppendToGraph pMBZbondaries_y vs pMBZbondaries_x	AppendToGraph pupr_y vs pupr_x	AppendToGraph pupl_y vs pupl_x	AppendToGraph plowr_y vs plowr_x	AppendToGraph plowl_y vs plowl_x	AppendToGraph pfolded1_y vs pfolded1_x	AppendToGraph pfolded2_y vs pfolded2_x	AppendToGraph pfolded3_y vs pfolded3_x	AppendToGraph pfolded4_y vs pfolded4_x	AppendToGraph pfolded5_y vs pfolded5_x	AppendToGraph pfolded6_y vs pfolded6_x	AppendToGraph pfolded7_y vs pfolded7_x	AppendToGraph pfolded8_y vs pfolded8_x	AppendToGraph pfolded9_y vs pfolded9_x	ModifyGraph width=415,height=415,cbRGB=(52191,51917,8872)	ModifyGraph lSize(pMBZbondaries_y)=2	ModifyGraph lStyle(pMBZbondaries_y)=1,lStyle(pfolded1_y)=3,lStyle(pfolded2_y)=3	ModifyGraph lStyle(pfolded3_y)=3,lStyle(pfolded4_y)=3,lStyle(pfolded5_y)=3,lStyle(pfolded6_y)=3	ModifyGraph lStyle(pfolded7_y)=3,lStyle(pfolded8_y)=3,lStyle(pfolded9_y)=3	ModifyGraph rgb(pBZbondaries_y)=(0,0,65535),rgb(pMBZbondaries_y)=(65535,21845,0)	ModifyGraph rgb(pupr_y)=(1,26214,0),rgb(pupl_y)=(1,26214,0),rgb(plowr_y)=(1,26214,0)	ModifyGraph rgb(plowl_y)=(1,26214,0),rgb(pfolded1_y)=(43690,43690,43690),rgb(pfolded2_y)=(43690,43690,43690)	ModifyGraph rgb(pfolded3_y)=(43690,43690,43690),rgb(pfolded4_y)=(43690,43690,43690)	ModifyGraph rgb(pfolded5_y)=(43690,43690,43690),rgb(pfolded6_y)=(43690,43690,43690)	ModifyGraph rgb(pfolded7_y)=(43690,43690,43690),rgb(pfolded8_y)=(43690,43690,43690)	ModifyGraph rgb(pfolded9_y)=(43690,43690,43690)	ModifyGraph tick=2	ModifyGraph mirror=1	ModifyGraph fSize=12	ModifyGraph lblMargin(left)=10	ModifyGraph manTick(left)={0,1,0,1},manMinor(left)={4,0}	ModifyGraph manTick(bottom)={0,1,0,1},manMinor(bottom)={4,0}	Label left "\\Z16k\\By\\M\\Z16 (\\F'symbol'p\\F'arial'/a)"	Label bottom "\\Z16k\\Bx\\M \\Z16(\\F'symbol'p\\F'arial'/a)"	SetAxis left -2,2	SetAxis bottom -2,2	ShowInfo	ControlBar 134	SetVariable varpredictlattice_0_inc,pos={3,63},size={120,15},proc=setvarincrementpredictlattice0,title="Increment"	SetVariable varpredictlattice_0_inc,limits={0,inf,0.002},value= predictlattice_0_inc	SetVariable varpredictlattice_0,pos={3,44},size={120,16},proc=setvarpredictlattice_0,title="p/a"	SetVariable varpredictlattice_0,font="Symbol"	SetVariable varpredictlattice_0,limits={0,inf,0.002},value= predictlattice_0,live= 1	SetVariable varKEatEF,pos={251,2},size={105,15},proc=setpredictKEatEF,title="KE"	SetVariable varKEatEF,limits={-inf,inf,0.001},value= predictKEatEF,live= 1	SetVariable varpredict_mu,pos={3,87},size={120,16},proc=setvarpredict_mu,title="m"	SetVariable varpredict_mu,font="Symbol"	SetVariable varpredict_mu,limits={-inf,inf,0.001},value= predict_mu,live= 1	SetVariable varpredict_mu_inc,pos={3,111},size={120,15},proc=setvarincrement_predict_mu,title="Increment"	SetVariable varpredict_mu_inc,limits={0,inf,0.001},value= predict_mu_inc	SetVariable varpredict_t,pos={132,88},size={120,15},proc=setvarpredict_t,title="t"	SetVariable varpredict_t,limits={-inf,inf,0.001},value= predict_t,live= 1	SetVariable varpredict_t_inc,pos={132,112},size={120,15},proc=setvarincrement_predict_t,title="Increment"	SetVariable varpredict_t_inc,limits={-inf,inf,0.001},value= predict_t_inc	SetVariable varpredict_tprime,pos={257,88},size={120,15},proc=setvarpredict_tprime,title="t'"	SetVariable varpredict_tprime,limits={-inf,inf,0.001},value= predict_tprime,live= 1	SetVariable varpredict_tprime_inc,pos={257,112},size={120,15},proc=setvarincrement_predict_tprime,title="Increment"	SetVariable varpredict_tprime_inc,limits={-inf,inf,0.001},value= predict_tprime_inc	Button button1,pos={367,59},size={85,20},proc=ButtonProc_predictcalc_tbarea,title="Calc. doping"	ValDisplay valpredict_x,pos={455,62},size={53,17},fSize=12	ValDisplay valpredict_x,limits={0,0,0},barmisc={0,1000},value= #"predict_x"	Button button2,pos={438,83},size={70,20},proc=ButtonProc_plot_predicttbGXMG,title="Plot GXMG"	Button for_superlattice,pos={358,2},size={115,20},proc=ButtonProc_put_psuperlattice,title="Superlattices ON"	Button no_superlattice,pos={477,2},size={30,20},proc=ButtonProc_remove_psuperlattice,title="OFF"	Button buttonmain,pos={423,109},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17	SetVariable setvarangletheta_from,pos={1,3},size={105,15},proc=SetVarProcanglethetafrom,title="Theta: From"	SetVariable setvarangletheta_from,limits={-70,0,1},value= predict_angletheta_from,live= 1	SetVariable setvarangletheta_to,pos={108,3},size={60,15},proc=SetVarProcanglethetato,title="To"	SetVariable setvarangletheta_to,limits={0,70,1},value= predict_angletheta_to,live= 1	SetVariable setvaranglephi_from,pos={1,22},size={105,15},proc=SetVarProcanglephifrom,title="Phi: From"	SetVariable setvaranglephi_from,limits={-70,0,2},value= predict_anglephi_from,live= 1	SetVariable setvaranglephi_to,pos={108,21},size={60,15},proc=SetVarProcanglephito,title="To"	SetVariable setvaranglephi_to,limits={0,70,2},value= predict_anglephi_to	SetVariable setvaranglephi_delta,pos={170,21},size={70,15},proc=SetVarProcanglephidelta,title="Delta"	SetVariable setvaranglephi_delta,limits={0,50,1},value= predict_anglephi_delta,live= 1	SetVariable setvarpredict_acept,pos={133,44},size={90,15},proc=setvarpredictacept,title="Acept."	SetVariable setvarpredict_acept,limits={0,60,1},value= predict_acept,live= 1	SetVariable setvarpredict_rotation,pos={245,44},size={100,15},proc=SetVarpredictrotation,title="Rotation"	SetVariable setvarpredict_rotation,limits={-270,270,1},value= predict_rotation,live= 1	SetVariable varpredictrotation_inc,pos={244,62},size={100,15},proc=setvarincrementpredictrotation,title="Increment"	SetVariable varpredictrotation_inc,limits={0,70,1},value= predictrotation_inc	PopupMenu popuppredict_orientation,pos={367,32},size={89,20},proc=PopMenuProcpredictorientation	PopupMenu popuppredict_orientation,mode=1,popvalue="Gamma-M",value= #"\"Gamma-M;Gamma-Y;Gamma-X\""	PopupMenu popup0,pos={276,19},size={70,20},proc=PopMenuProc_predictHV	PopupMenu popup0,mode=2,popvalue="Vertical",value= #"\"Horizontal;Vertical\""	SetVariable setvarangletheta_delta,pos={170,3},size={70,15},proc=SetVarProcanglethetadelta,title="Delta"	SetVariable setvarangletheta_delta,limits={0,50,1},value= predict_angletheta_delta,live= 1EndMacroWindow Graph_imageforslicer() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(260,386,682,745)	AppendImage imageforslicer	ModifyImage imageforslicer ctab= {*,*,Terrain,1}	ModifyGraph mirror=2	ShowInfo	ControlBar 49	ValDisplay displaysH,pos={5,5},size={100,14},title="Horizontal"	ValDisplay displaysH,limits={0,0,0},barmisc={0,1000},value= #"SliderH"	ValDisplay displayV,pos={115,5},size={100,14},title="Vertical"	ValDisplay displayV,limits={0,0,0},barmisc={0,1000},value= #"SliderV"	ValDisplay ttextimageforslicer,pos={225,5},size={95,14},title="Mode"	ValDisplay ttextimageforslicer,labelBack=(65535,54607,32768),fSize=10	ValDisplay ttextimageforslicer,format="Horizontal"	ValDisplay ttextimageforslicer,limits={0,0,0},barmisc={0,1000},mode= 3	ValDisplay ttextimageforslicer,value= #"1"	ListBox list0,pos={307,1},size={50,20},disable=1,proc=ListBoxProc	Button buttonrescalefororientation,pos={4,23},size={205,20},disable=1,proc=B_rescaleforspec_orientations,title="Rescale for special orientations"EndMacro	Window mat3d_fs_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(350,194,748,591)	AppendImage mat3d_energy_plot	ModifyImage mat3d_energy_plot ctab= {*,*,Grays,0}	ModifyGraph wbRGB=(48896,52992,65280),cbRGB=(32768,40704,65280)	ModifyGraph mirror=2	ShowInfo	ControlBar 59	SetVariable center_emat3d,pos={5,3},size={200,19},proc=setvarcenter_emat3d,title="Central energy"	SetVariable center_emat3d,font="Arial",fSize=14	SetVariable center_emat3d,limits={-0.775922,0.274493,0.01},value= mat3d_energy_center,live= 1	SetVariable wide_emat3d,pos={211,3},size={175,19},proc=setvarwide_emat3d,title="Integral range"	SetVariable wide_emat3d,font="Arial",fSize=14	SetVariable wide_emat3d,limits={0,10000,0.001},value= mat3d_energy_wide,live= 1	SetVariable setvar0,pos={39,28},size={166,19},proc=setvarincrement_emat3d,title="Increment"	SetVariable setvar0,font="Arial",fSize=14	SetVariable setvar0,limits={0,inf,0.0005},value= mat3d_energy_increment	Button button0,pos={215,28},size={80,20},proc=ButtonProc_mat3d_makeimage,title="Make image"	Button buttonshowmain,pos={305,28},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonshowmain,fStyle=17EndMacroWindow mat3dVD_fs_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(136,211,539,537)	AppendImage mat3dVD_energy_plot	ModifyImage mat3dVD_energy_plot ctab= {*,0,Terrain,1}	ModifyGraph wbRGB=(32769,65535,32768),cbRGB=(3,52428,1)	ModifyGraph mirror=2	ShowInfo	ControlBar 59	SetVariable center_emat3dVD,pos={5,3},size={200,19},proc=setvarcenter_emat3dVD,title="Central energy"	SetVariable center_emat3dVD,font="Arial",fSize=14	SetVariable center_emat3dVD,limits={95.2,95.904,0.01},value= mat3dVD_energy_center,live= 1	SetVariable wide_emat3dVD,pos={211,3},size={175,19},proc=setvarwide_emat3dVD,title="Integral range"	SetVariable wide_emat3dVD,font="Arial",fSize=14	SetVariable wide_emat3dVD,limits={0,1,0.001},value= mat3dVD_energy_wide,live= 1	SetVariable setvar0,pos={39,28},size={166,19},proc=setvarincrement_emat3dVD,title="Increment"	SetVariable setvar0,font="Arial",fSize=14	SetVariable setvar0,limits={0,inf,0.0005},value= mat3dVD_energy_increment	Button button0,pos={215,28},size={80,20},proc=ButtonProc_mat3dVD_makeimage,title="Make image"	Button buttonmain,pos={305,28},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17EndMacroWindow mat3dHD_fs_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(170,179,572,567)	AppendImage mat3dHD_energy_plot	ModifyImage mat3dHD_energy_plot ctab= {*,0,Terrain,1}	ModifyGraph wbRGB=(51664,44236,58982),cbRGB=(36873,14755,58982)	ModifyGraph mirror=2	ShowInfo	ControlBar 59	SetVariable center_emat3dHD,pos={5,3},size={200,19},proc=setvarcenter_emat3dHD,title="Central energy"	SetVariable center_emat3dHD,font="Arial",fSize=14	SetVariable center_emat3dHD,limits={95.2,95.904,0.01},value= mat3dHD_energy_center,live= 1	SetVariable wide_emat3dHD,pos={211,3},size={175,19},proc=setvarwide_emat3dHD,title="Integral range"	SetVariable wide_emat3dHD,font="Arial",fSize=14	SetVariable wide_emat3dHD,limits={0,1,0.001},value= mat3dHD_energy_wide,live= 1	SetVariable setvar0,pos={39,28},size={166,19},proc=setvarincrement_emat3dHD,title="Increment"	SetVariable setvar0,font="Arial",fSize=14	SetVariable setvar0,limits={0,inf,0.0005},value= mat3dHD_energy_increment	Button button0,pos={215,28},size={80,20},proc=ButtonProc_mat3dHD_makeimage,title="Make image"	Button buttonmain,pos={305,28},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17EndMacroWindow mat3dk_fs_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(439,125,849,517)	AppendImage mat3dk_energy_plot	ModifyImage mat3dk_energy_plot ctab= {*,*,Terrain,1}	ModifyGraph wbRGB=(56797,56797,56797),cbRGB=(32768,40777,65535)	ModifyGraph mirror=2	ShowInfo	ControlBar 59	SetVariable center_emat3dk,pos={5,3},size={200,19},proc=setvarcenter_emat3dk,title="Central energy"	SetVariable center_emat3dk,font="Arial",fSize=14	SetVariable center_emat3dk,limits={95.2,95.904,0.01},value= mat3dk_energy_center,live= 1	SetVariable wide_emat3dk,pos={211,3},size={175,19},proc=setvarwide_emat3dk,title="Integral range"	SetVariable wide_emat3dk,font="Arial",fSize=14	SetVariable wide_emat3dk,limits={0,1,0.001},value= mat3dk_energy_wide,live= 1	SetVariable setvar0,pos={39,28},size={166,19},proc=setvarincrement_emat3dk,title="Increment"	SetVariable setvar0,font="Arial",fSize=14	SetVariable setvar0,limits={0,inf,0.0005},value= mat3dk_energy_increment,live= 1	Button button0,pos={215,28},size={80,20},proc=ButtonProc_mat3dk_makeimage,title="Make image"	Button buttonshowmain,pos={305,28},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonshowmain,fStyle=17EndMacroWindow mat3dkVD_fs_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(486,233,902,515)	AppendImage mat3dkVD_energy_plot	ModifyImage mat3dkVD_energy_plot ctab= {*,0,Terrain,1}	ModifyGraph wbRGB=(56797,56797,56797),cbRGB=(0,52224,0)	ModifyGraph mirror=2	ShowInfo	ControlBar 59	SetVariable center_emat3dkVD,pos={5,3},size={200,19},proc=setvarcenter_emat3dkVD,title="Central energy"	SetVariable center_emat3dkVD,font="Arial",fSize=14	SetVariable center_emat3dkVD,limits={95.2,95.904,0.01},value= mat3dkVD_energy_center,live= 1	SetVariable wide_emat3dkVD,pos={211,3},size={175,19},proc=setvarwide_emat3dkVD,title="Integral range"	SetVariable wide_emat3dkVD,font="Arial",fSize=14	SetVariable wide_emat3dkVD,limits={0,1,0.001},value= mat3dkVD_energy_wide,live= 1	SetVariable setvar0,pos={39,28},size={166,19},proc=setvarincrement_emat3dkVD,title="Increment"	SetVariable setvar0,font="Arial",fSize=14	SetVariable setvar0,limits={0,inf,0.0005},value= mat3dkVD_energy_increment	Button button0,pos={215,28},size={80,20},proc=ButtonProc_mat3dkVD_makeimage,title="Make image"	Button buttonmain,pos={305,28},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17EndMacroWindow mat3dkHD_fs_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(51,127,472,474)	AppendImage mat3dkHD_energy_plot	ModifyImage mat3dkHD_energy_plot ctab= {*,0,Terrain,1}	ModifyGraph wbRGB=(56797,56797,56797),cbRGB=(36873,14755,58982)	ModifyGraph mirror=2	ShowInfo	ControlBar 59	SetVariable center_emat3dkHD,pos={5,3},size={200,19},proc=setvarcenter_emat3dkHD,title="Central energy"	SetVariable center_emat3dkHD,font="Arial",fSize=14	SetVariable center_emat3dkHD,limits={95.2,95.904,0.01},value= mat3dkHD_energy_center,live= 1	SetVariable wide_emat3dkHD,pos={211,3},size={175,19},proc=setvarwide_emat3dkHD,title="Integral range"	SetVariable wide_emat3dkHD,font="Arial",fSize=14	SetVariable wide_emat3dkHD,limits={0,1,0.001},value= mat3dkHD_energy_wide,live= 1	SetVariable setvar0,pos={39,28},size={166,19},proc=setvarincrement_emat3dkHD,title="Increment"	SetVariable setvar0,font="Arial",fSize=14	SetVariable setvar0,limits={0,inf,0.0005},value= mat3dkHD_energy_increment	Button button0,pos={215,28},size={80,20},proc=ButtonProc_mat3dkHD_makeimage,title="Make image"	Button buttonmain,pos={305,28},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17EndMacroWindow making_fs() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(345,44,954,756) BZbondaries_y vs BZbondaries_x	AppendToGraph MBZbondaries_y vs MBZbondaries_x	AppendToGraph upr_y vs upr_x	AppendToGraph upl_y vs upl_x	AppendToGraph lowr_y vs lowr_x	AppendToGraph lowl_y vs lowl_x	AppendToGraph mainb5_y vs mainb5_x	AppendToGraph mainb6_y vs mainb6_x	AppendToGraph mainb7_y vs mainb7_x	AppendToGraph mainb8_y vs mainb8_x	AppendToGraph mainb9_y vs mainb9_x	AppendToGraph mainb10_y vs mainb10_x	AppendToGraph mainb11_y vs mainb11_x	AppendToGraph mainb12_y vs mainb12_x	AppendToGraph mainb13_y vs mainb13_x	AppendToGraph mainb14_y vs mainb14_x	AppendToGraph mainb15_y vs mainb15_x	AppendToGraph mainb16_y vs mainb16_x	AppendToGraph folded1_y vs folded1_x	AppendToGraph folded2_y vs folded2_x	AppendToGraph folded3_y vs folded3_x	AppendToGraph folded4_y vs folded4_x	AppendToGraph folded5_y vs folded5_x	AppendToGraph folded6_y vs folded6_x	AppendToGraph folded7_y vs folded7_x	AppendToGraph folded8_y vs folded8_x	AppendToGraph folded9_y vs folded9_x	AppendToGraph ky_final vs kx_final	AppendToGraph ky_finalrot vs kx_finalrot	ModifyGraph width=515,height=515,cbRGB=(49151,53155,65535)	ModifyGraph mode(ky_final)=3,mode(ky_finalrot)=3	ModifyGraph marker(ky_final)=8,marker(ky_finalrot)=8	ModifyGraph lSize(MBZbondaries_y)=2	ModifyGraph lStyle(MBZbondaries_y)=1,lStyle(folded1_y)=3,lStyle(folded2_y)=3,lStyle(folded3_y)=3	ModifyGraph lStyle(folded4_y)=3,lStyle(folded5_y)=3,lStyle(folded6_y)=3,lStyle(folded7_y)=3	ModifyGraph lStyle(folded8_y)=3,lStyle(folded9_y)=3	ModifyGraph rgb(BZbondaries_y)=(0,0,65535),rgb(MBZbondaries_y)=(65535,21845,0),rgb(upr_y)=(1,26214,0)	ModifyGraph rgb(upl_y)=(1,26214,0),rgb(lowr_y)=(1,26214,0),rgb(lowl_y)=(1,26214,0)	ModifyGraph rgb(mainb5_y)=(1,26214,0),rgb(mainb6_y)=(1,26214,0),rgb(mainb7_y)=(1,26214,0)	ModifyGraph rgb(mainb8_y)=(1,26214,0),rgb(mainb9_y)=(1,26214,0),rgb(mainb10_y)=(1,26214,0)	ModifyGraph rgb(mainb11_y)=(1,26214,0),rgb(mainb12_y)=(1,26214,0),rgb(mainb13_y)=(1,26214,0)	ModifyGraph rgb(mainb14_y)=(1,26214,0),rgb(mainb15_y)=(1,26214,0),rgb(mainb16_y)=(1,26214,0)	ModifyGraph rgb(folded1_y)=(43690,43690,43690),rgb(folded2_y)=(43690,43690,43690)	ModifyGraph rgb(folded3_y)=(43690,43690,43690),rgb(folded4_y)=(43690,43690,43690)	ModifyGraph rgb(folded5_y)=(43690,43690,43690),rgb(folded6_y)=(43690,43690,43690)	ModifyGraph rgb(folded7_y)=(43690,43690,43690),rgb(folded8_y)=(43690,43690,43690)	ModifyGraph rgb(folded9_y)=(43690,43690,43690),rgb(ky_final)=(0,0,0)	ModifyGraph msize(ky_final)=4,msize(ky_finalrot)=4	ModifyGraph tick=2	ModifyGraph mirror=1	ModifyGraph fSize=12	ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0}	ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Label left "\\Z16k\\By\\M\\Z16 (\\F'symbol'p\\F'arial'/a)"	Label bottom "\\Z16k\\Bx\\M \\Z16(\\F'symbol'p\\F'arial'/a)"	SetAxis left -2,2	SetAxis bottom -2,2	Cursor/P A MBZbondaries_y 1	ShowInfo	ControlBar 129	Button button0,pos={134,53},size={100,20},proc=ButtonProc_update_making_fs,title="\\K(65535,65535,65535)Update points"	Button button0,fColor=(26214,0,0)	SetVariable vartheta_zero_inc,pos={6,31},size={120,15},proc=setvarincrement_theta_zero,title="Increment"	SetVariable vartheta_zero_inc,limits={0,inf,0.01},value= theta_zero_inc	SetVariable varphi_zero_inc,pos={136,31},size={120,15},proc=setvarincrement_phi_zero,title="Increment"	SetVariable varphi_zero_inc,limits={0,inf,0.01},value= phi_zero_inc	SetVariable varrot_zero_inc,pos={261,31},size={120,15},proc=setvarincrement_rot_zero,title="Increment"	SetVariable varrot_zero_inc,limits={0,inf,0.01},value= rot_zero_inc	SetVariable varlattice_0_inc,pos={394,31},size={120,15},proc=setvarincrement_lattice_0,title="Increment"	SetVariable varlattice_0_inc,limits={0,inf,0.002},value= lattice_0_inc	SetVariable vartheta_zero,pos={6,7},size={120,16},proc=setvartheta_zero,title="q_0"	SetVariable vartheta_zero,font="Symbol"	SetVariable vartheta_zero,limits={-inf,inf,0.005},value= theta_zero,live= 1	SetVariable varphi_zero,pos={136,7},size={120,16},proc=setvarphi_zero,title="j_0"	SetVariable varphi_zero,font="Symbol"	SetVariable varphi_zero,limits={-inf,inf,0.005},value= phi_zero,live= 1	SetVariable varrot_zero,pos={261,7},size={120,15},proc=setvarrot_zero,title="Rotation"	SetVariable varrot_zero,limits={-360,360,0.2},value= rot_zero,live= 1	SetVariable varlattice_0,pos={394,7},size={120,16},proc=setvarlattice_0,title="p/a"	SetVariable varlattice_0,font="Symbol"	SetVariable varlattice_0,limits={0,inf,0.002},value= lattice_0,live= 1	SetVariable varKEatEF,pos={6,54},size={120,15},proc=setKEatEF,title="Kenetic E"	SetVariable varKEatEF,limits={-inf,inf,0.001},value= KEatEF,live= 1	SetVariable varglobal_mu,pos={7,85},size={120,16},proc=setvarglobal_mu,title="m"	SetVariable varglobal_mu,font="Symbol"	SetVariable varglobal_mu,limits={-inf,inf,0.001},value= global_mu,live= 1	SetVariable varglobal_mu_inc,pos={7,109},size={120,15},proc=setvarincrement_global_mu,title="Increment"	SetVariable varglobal_mu_inc,limits={0,inf,0.001},value= global_mu_inc	SetVariable varglobal_t,pos={136,85},size={120,15},proc=setvarglobal_t,title="t"	SetVariable varglobal_t,limits={-inf,inf,0.001},value= global_t,live= 1	SetVariable varglobal_t_inc,pos={136,109},size={120,15},proc=setvarincrement_global_t,title="Increment"	SetVariable varglobal_t_inc,limits={-inf,inf,0.001},value= global_t_inc	SetVariable varglobal_tprime,pos={261,85},size={120,15},proc=setvarglobal_tprime,title="t'"	SetVariable varglobal_tprime,limits={-inf,inf,0.001},value= global_tprime,live= 1	SetVariable varglobal_tprime_inc,pos={261,109},size={120,15},proc=setvarincrement_global_tprime,title="Increment"	SetVariable varglobal_tprime_inc,limits={-inf,inf,0.001},value= global_tprime_inc	Button button1,pos={518,30},size={85,20},proc=ButtonProc_calc_tbarea,title="Calc. doping"	ValDisplay valglobal_x,pos={501,53},size={99,17},title="Doping",fSize=12	ValDisplay valglobal_x,limits={0,0,0},barmisc={0,1000},value= #"global_x"	Button button2,pos={392,82},size={70,20},proc=ButtonProc_plot_tbGXMG,title="Plot GXMG"	Button for_superlattice,pos={350,53},size={115,20},proc=ButtonProc_put_superlattice,title="Superlattices ON"	Button no_superlattice,pos={466,53},size={30,20},proc=ButtonProc_remove_superlattice,title="OFF"	Button for_phi_theta,pos={261,53},size={85,20},proc=ButtonProc_return_phi_theta,title="Pt at new hv"	Button buttonmain,pos={508,104},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17	Button button3table,pos={519,5},size={80,20},proc=ButtonProc_tableafs,title="Show  table"	Button button3table,fColor=(1,16019,65535)	PopupMenu popupview,pos={394,105},size={68,20},proc=PopMenuProc_viewmaking_fs,title="View"	PopupMenu popupview,fSize=13	PopupMenu popupview,mode=6,popvalue="2",value= #"\"1/4;2/4;3/4;4/4;1;2;3\""	PopupMenu popup_mfs4,pos={484,77},size={109,20},proc=PopMenuProc_mode_mfs4,title="Mode"	PopupMenu popup_mfs4,fSize=13	PopupMenu popup_mfs4,mode=1,popvalue="Approx",value= #"\"Approx;Exact\"\t"	SetDrawLayer UserFront	SetDrawEnv fname= "Arial"	DrawText 0.598,-0.174,"Superlattice"	SetDrawEnv fname= "Arial"	DrawText 0.604,-0.174,"Superlattices"	DrawRect 0.526,-0.182,0.608,-0.144	DrawRect 0.636,-0.198,0.71,-0.152EndMacro//********************************************************************************************************************************Window Mat3d_slicer() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(813,358,1313,717) Vline_slicey1 vs Vline_slicex1	AppendToGraph Vline_slicey2 vs Vline_slicex2	AppendImage mat3d_energy_plot	ModifyImage mat3d_energy_plot ctab= {*,*,Terrain,1}	ModifyGraph margin(left)=120,margin(top)=65	ModifyGraph mirror=2	ShowInfo	ControlBar 53	Slider slider0,pos={4,77},size={53,218},proc=SliderProc	Slider slider0,limits={-6.65635,6.65635,0.131809},value= 0.065904471544715	Slider slider1,pos={97,56},size={218,45},proc=SliderProc_1	Slider slider1,limits={170,224,1},value= 193,vert= 0	PopupMenu buttonVvsH,pos={5,27},size={70,20},proc=PopMenuProc_4	PopupMenu buttonVvsH,mode=2,popvalue="Vertical",value= #"\"Horizontal;Vertical\""	PopupMenu Whichmat3d,pos={5,3},size={64,20},proc=PopMenuProc_5	PopupMenu Whichmat3d,mode=1,popvalue="Mat3d",value= #"\"Mat3d;Mat3dVD;Mat3dHD;Mat3dk;Mat3dkVD;Mat3dkHD\""	Button buttonshowimageslicer,pos={103,4},size={85,20},proc=Buttonshowimageforslicer,title="Show image"	ValDisplay valdispHslider,pos={3,61},size={59,14},frame=2	ValDisplay valdispHslider,limits={0,0,0},barmisc={0,1000},value= #"SliderH"	ValDisplay valdispVslider,pos={319,59},size={57,14},frame=2	ValDisplay valdispVslider,limits={0,0,0},barmisc={0,1000},value= #"SliderV"	PopupMenu popupmode,pos={200,4},size={120,21},proc=PopMenuProc_slicermode,title="Mode: "	PopupMenu popupmode,fSize=14	PopupMenu popupmode,mode=1,popvalue="Normal",value= #"\"Normal;Csr image_fs\""	SetVariable setvarnumcomb,pos={99,29},size={130,19},proc=SetVarProcCmbslicer,title="Combine"	SetVariable setvarnumcomb,fSize=13,limits={1,55,1},value= numcombslicer,live= 1EndMacro//********************************************************************************************************************************Window image_fs_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(393,45,956,732) upr_y vs upr_x	AppendToGraph upl_y vs upl_x	AppendToGraph lowr_y vs lowr_x	AppendToGraph lowl_y vs lowl_x	AppendToGraph BZbondaries_y vs BZbondaries_x	AppendToGraph MBZbondaries_y vs MBZbondaries_x	AppendToGraph mainb5_y vs mainb5_x	AppendToGraph mainb6_y vs mainb6_x	AppendToGraph mainb7_y vs mainb7_x	AppendToGraph mainb8_y vs mainb8_x	AppendToGraph mainb9_y vs mainb9_x	AppendToGraph mainb10_y vs mainb10_x	AppendToGraph mainb11_y vs mainb11_x	AppendToGraph mainb12_y vs mainb12_x	AppendToGraph mainb13_y vs mainb13_x	AppendToGraph mainb14_y vs mainb14_x	AppendToGraph mainb15_y vs mainb15_x	AppendToGraph mainb16_y vs mainb16_x	AppendToGraph folded1_y vs folded1_x	AppendToGraph folded2_y vs folded2_x	AppendToGraph folded3_y vs folded3_x	AppendToGraph folded4_y vs folded4_x	AppendToGraph folded5_y vs folded5_x	AppendToGraph folded6_y vs folded6_x	AppendToGraph folded7_y vs folded7_x	AppendToGraph folded8_y vs folded8_x	AppendToGraph folded9_y vs folded9_x	ModifyGraph width=475,height=475,cbRGB=(1,39321,39321)	ModifyGraph lSize(MBZbondaries_y)=2	ModifyGraph lStyle(MBZbondaries_y)=2,lStyle(folded1_y)=3,lStyle(folded2_y)=3,lStyle(folded3_y)=3	ModifyGraph lStyle(folded4_y)=3,lStyle(folded5_y)=3,lStyle(folded6_y)=3,lStyle(folded7_y)=3	ModifyGraph lStyle(folded8_y)=3,lStyle(folded9_y)=3	ModifyGraph rgb(upr_y)=(1,26214,0),rgb(upl_y)=(1,26214,0),rgb(lowr_y)=(1,26214,0)	ModifyGraph rgb(lowl_y)=(1,26214,0),rgb(BZbondaries_y)=(0,0,65535),rgb(MBZbondaries_y)=(65535,21845,0)	ModifyGraph rgb(mainb5_y)=(1,26214,0),rgb(mainb6_y)=(1,26214,0),rgb(mainb7_y)=(1,26214,0)	ModifyGraph rgb(mainb8_y)=(1,26214,0),rgb(mainb9_y)=(1,26214,0),rgb(mainb10_y)=(1,26214,0)	ModifyGraph rgb(mainb11_y)=(1,26214,0),rgb(mainb12_y)=(1,26214,0),rgb(mainb13_y)=(1,26214,0)	ModifyGraph rgb(mainb14_y)=(1,26214,0),rgb(mainb15_y)=(1,26214,0),rgb(mainb16_y)=(1,26214,0)	ModifyGraph rgb(folded1_y)=(43690,43690,43690),rgb(folded2_y)=(43690,43690,43690)	ModifyGraph rgb(folded3_y)=(43690,43690,43690),rgb(folded4_y)=(43690,43690,43690)	ModifyGraph rgb(folded5_y)=(43690,43690,43690),rgb(folded6_y)=(43690,43690,43690)	ModifyGraph rgb(folded7_y)=(43690,43690,43690),rgb(folded8_y)=(43690,43690,43690)	ModifyGraph rgb(folded9_y)=(43690,43690,43690)	ModifyGraph tick=2	ModifyGraph mirror=1	ModifyGraph fSize=12	ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0}	ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Label left "\\Z16k\\By\\M\\Z16 (\\F'symbol'p\\F'arial'/a)"	Label bottom "\\Z16k\\Bx\\M \\Z16(\\F'symbol'p\\F'arial'/a)"	SetAxis left -2,2	SetAxis bottom -2,2	ShowInfo	ControlBar 147	SetVariable varglobal_mu,pos={10,102},size={115,16},proc=setvarglobal_mu,title="m"	SetVariable varglobal_mu,font="Symbol"	SetVariable varglobal_mu,limits={-inf,inf,0.001},value= global_mu,live= 1	SetVariable varglobal_mu_inc,pos={10,125},size={115,15},proc=setvarincrement_global_mu,title="Increment"	SetVariable varglobal_mu_inc,limits={-inf,inf,0.001},value= global_mu_inc	SetVariable varglobal_t,pos={137,102},size={115,15},proc=setvarglobal_t,title="t"	SetVariable varglobal_t,limits={-inf,inf,0.001},value= global_t,live= 1	SetVariable varglobal_t_inc,pos={137,125},size={115,15},proc=setvarincrement_global_t,title="Increment"	SetVariable varglobal_t_inc,limits={-inf,inf,0.001},value= global_t_inc	SetVariable varglobal_tprime,pos={262,102},size={115,15},proc=setvarglobal_tprime,title="t'"	SetVariable varglobal_tprime,limits={-inf,inf,0.001},value= global_tprime,live= 1	SetVariable varglobal_tprime_inc,pos={262,125},size={115,15},proc=setvarincrement_global_tprime,title="Increment"	SetVariable varglobal_tprime_inc,limits={-inf,inf,0.001},value= global_tprime_inc	Button for_dop,pos={486,75},size={70,20},proc=ButtonProc_calc_tbarea,title="Doping"	ValDisplay valdisp0,pos={495,100},size={50,14},limits={0,0,0},barmisc={0,1000}	ValDisplay valdisp0,value= #"global_x"	Button button0,pos={412,75},size={70,20},proc=ButtonProc_plot_tbGXMG,title="Plot GXMG"	SetVariable vartheta1_zero,pos={11,30},size={120,16},proc=setvartheta1_zero,title="q_0"	SetVariable vartheta1_zero,font="Symbol",value= theta1_zero,live= 1	SetVariable vartheta1_zero_inc,pos={11,48},size={115,15},proc=setvartheta1_zero,title="Increment"	SetVariable vartheta1_zero_inc,limits={0,inf,0.001},value= theta1_zero_inc	SetVariable varphi1_zero,pos={135,31},size={115,16},proc=setvarphi1_zero,title="j_0"	SetVariable varphi1_zero,font="Symbol",value= phi1_zero,live= 1	SetVariable varphi1_zero_inc,pos={135,50},size={115,15},proc=setvarincrement_phi1_zero,title="Increment"	SetVariable varphi1_zero_inc,limits={0,inf,0.01},value= phi1_zero_inc	SetVariable varrot1_zero,pos={257,31},size={115,15},proc=setvarrot1_zero,title="Rotation"	SetVariable varrot1_zero,limits={-360,360,5},value= rot1_zero,live= 1	SetVariable varrot1_zero_inc,pos={259,52},size={115,15},proc=setvarincrement_rot1_zero,title="Increment"	SetVariable varrot1_zero_inc,limits={0,inf,0.01},value= rot1_zero_inc	SetVariable varlattice1_0,pos={382,31},size={115,16},proc=setvarlattice1_0,title="p/a"	SetVariable varlattice1_0,font="Symbol"	SetVariable varlattice1_0,limits={0,inf,0.002},value= lattice1_0,live= 1	SetVariable varlattice1_0_inc,pos={383,52},size={115,15},proc=setvarincrement_lattice1_0,title="Increment"	SetVariable varlattice1_0_inc,limits={0,inf,0.002},value= lattice1_0_inc	Button update_graph,pos={5,73},size={80,20},proc=ButtonProc_update_image_fs,title="\\K(65535,65535,65535)Update"	Button update_graph,fColor=(27085,28,1)	Button super_on,pos={259,73},size={110,20},proc=ButtonProc_put_superlattice1,title="Superlattices ON"	Button super_off,pos={369,73},size={30,20},proc=ButtonProc_remove_superlattice1,title="OFF"	Button for_phi_theta,pos={173,73},size={80,20},proc=ButtonProc_return_phi_theta1,title="Pt at new hv"	SetVariable Varquality_factor,pos={386,102},size={85,15},proc=setquality_factor,title="Quality"	SetVariable Varquality_factor,limits={0.1,inf,1},value= quality_factor	Button buttonshowmain,pos={472,121},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonshowmain,fStyle=17	Button buttontable,pos={503,39},size={50,20},proc=ButtonProc_tableafs,title="Table"	Button buttontable,fColor=(1,16019,65535)	Slider sliderx,pos={80,150},size={219,41},disable=1,proc=SliderProcCsrslicerx	Slider sliderx,fSize=8	Slider sliderx,limits={-2,2,0.01},value= 1,vert= 0,thumbColor= (49151,65535,65535)	Slider slidery,pos={5,186},size={43,233},disable=1,proc=SliderProcCsrslicery	Slider slidery,fSize=8	Slider slidery,limits={-2,2,0.01},value= 0,thumbColor= (65535,65532,16385)	PopupMenu popupwhichpnt,pos={7,160},size={67,20},disable=1,proc=PopMenuProcwhichpnt	PopupMenu popupwhichpnt,mode=2,popvalue="Point 2",value= #"\"Point 1;Point 2\""	ValDisplay valdispCsrx1,pos={312,151},size={65,17},disable=1,title=" X1"	ValDisplay valdispCsrx1,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsrx1,value= #"Csrx1forslicer"	ValDisplay valdispCsrx2,pos={396,151},size={65,17},disable=1,title=" X2"	ValDisplay valdispCsrx2,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsrx2,value= #"Csrx2forslicer"	ValDisplay valdispCsry1,pos={312,168},size={65,17},disable=1,title=" Y1"	ValDisplay valdispCsry1,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsry1,value= #"Csry1forslicer"	ValDisplay valdispCsry2,pos={396,168},size={65,17},disable=1,title=" Y2"	ValDisplay valdispCsry2,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsry2,value= #"Csry2forslicer"	PopupMenu popupspecialorientationslicer,pos={299,188},size={193,21},disable=1,proc=PopMenuProcorientationforslicer,title="Special orientation:"	PopupMenu popupspecialorientationslicer,fSize=14	PopupMenu popupspecialorientationslicer,mode=1,popvalue="None",value= #"\"None;G-Y;G-X;G-M;G-M';M-Y;M'-Y\""	Button buttonshowimageCsrslicer,pos={502,151},size={85,20},disable=1,proc=Buttonshowimageforslicer,title="Show Image"	Button forzoom,pos={516,187},size={50,20},disable=1,proc=Button_zoom_forCsrslicer,title="Zoom"	PopupMenu popupview,pos={387,121},size={68,20},proc=PopMenuProc_viewimage_fs,title="View"	PopupMenu popupview,fSize=13	PopupMenu popupview,mode=8,popvalue="2",value= #"\"1/4;2/4;3/4;4/4;c/2;1;1.5;2;3\""	PopupMenu Mode_old_new,pos={7,4},size={97,20},proc=PopMenuProc_mode_ifs4,title="Mode"	PopupMenu Mode_old_new,fSize=13	PopupMenu Mode_old_new,mode=2,popvalue="Exact",value= #"\"Approx;Exact\""	SetVariable setvar0,pos={126,6},size={140,17},title="Central E"	SetVariable setvar0,labelBack=(65535,65532,16385),fSize=11	SetVariable setvar0,value= central_ifs4,live= 1	SetVariable setvar1,pos={276,6},size={160,17},proc=SetVarProc_irange_ifs4,title="Integral window"	SetVariable setvar1,labelBack=(65535,65532,16385),fSize=11	SetVariable setvar1,limits={0,inf,0.001},value= irange_ifs4,live= 1	PopupMenu popup0,pos={88,73},size={75,20},proc=PopMenuProc_auto_ifs4	PopupMenu popup0,mode=2,popvalue="Auto ON",value= #"\"Auto OFF;Auto ON\""EndMacro//********************************************************************************************************************************Window image_fs_ploter2f() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(338,44,898,588) upr_y vs upr_x	AppendToGraph upl_y vs upl_x	AppendToGraph lowr_y vs lowr_x	AppendToGraph lowl_y vs lowl_x	AppendToGraph BZbondaries_y vs BZbondaries_x	AppendToGraph MBZbondaries_y vs MBZbondaries_x	AppendToGraph mainb5_y vs mainb5_x	AppendToGraph mainb6_y vs mainb6_x	AppendToGraph mainb7_y vs mainb7_x	AppendToGraph mainb8_y vs mainb8_x	AppendToGraph mainb9_y vs mainb9_x	AppendToGraph mainb10_y vs mainb10_x	AppendToGraph mainb11_y vs mainb11_x	AppendToGraph mainb12_y vs mainb12_x	AppendToGraph mainb13_y vs mainb13_x	AppendToGraph mainb14_y vs mainb14_x	AppendToGraph mainb15_y vs mainb15_x	AppendToGraph mainb16_y vs mainb16_x	AppendToGraph folded1_y vs folded1_x	AppendToGraph folded2_y vs folded2_x	AppendToGraph folded3_y vs folded3_x	AppendToGraph folded4_y vs folded4_x	AppendToGraph folded5_y vs folded5_x	AppendToGraph folded6_y vs folded6_x	AppendToGraph folded7_y vs folded7_x	AppendToGraph folded8_y vs folded8_x	AppendToGraph folded9_y vs folded9_x	ModifyGraph width=475,height=359.848,cbRGB=(1,39321,39321)	ModifyGraph lSize(MBZbondaries_y)=2	ModifyGraph lStyle(MBZbondaries_y)=2,lStyle(folded1_y)=3,lStyle(folded2_y)=3,lStyle(folded3_y)=3	ModifyGraph lStyle(folded4_y)=3,lStyle(folded5_y)=3,lStyle(folded6_y)=3,lStyle(folded7_y)=3	ModifyGraph lStyle(folded8_y)=3,lStyle(folded9_y)=3	ModifyGraph rgb(upr_y)=(1,26214,0),rgb(upl_y)=(1,26214,0),rgb(lowr_y)=(1,26214,0)	ModifyGraph rgb(lowl_y)=(1,26214,0),rgb(BZbondaries_y)=(0,0,65535),rgb(MBZbondaries_y)=(65535,21845,0)	ModifyGraph rgb(mainb5_y)=(1,26214,0),rgb(mainb6_y)=(1,26214,0),rgb(mainb7_y)=(1,26214,0)	ModifyGraph rgb(mainb8_y)=(1,26214,0),rgb(mainb9_y)=(1,26214,0),rgb(mainb10_y)=(1,26214,0)	ModifyGraph rgb(mainb11_y)=(1,26214,0),rgb(mainb12_y)=(1,26214,0),rgb(mainb13_y)=(1,26214,0)	ModifyGraph rgb(mainb14_y)=(1,26214,0),rgb(mainb15_y)=(1,26214,0),rgb(mainb16_y)=(1,26214,0)	ModifyGraph rgb(folded1_y)=(43690,43690,43690),rgb(folded2_y)=(43690,43690,43690)	ModifyGraph rgb(folded3_y)=(43690,43690,43690),rgb(folded4_y)=(43690,43690,43690)	ModifyGraph rgb(folded5_y)=(43690,43690,43690),rgb(folded6_y)=(43690,43690,43690)	ModifyGraph rgb(folded7_y)=(43690,43690,43690),rgb(folded8_y)=(43690,43690,43690)	ModifyGraph rgb(folded9_y)=(43690,43690,43690)	ModifyGraph tick=2	ModifyGraph mirror=1	ModifyGraph fSize=12	ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0}	ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Label left "\\Z16k\\By\\M\\Z16 (\\F'symbol'p\\F'arial'/a)"	Label bottom "\\Z16k\\Bx\\M \\Z16(\\F'symbol'p\\F'arial'/a)"	SetAxis left -1.51515151515151,1.51515151515151	SetAxis bottom -2,2	ShowInfo	ControlBar 121	SetVariable varglobal_mu,pos={10,75},size={97,16},proc=setvarglobal_mu2f,title="m"	SetVariable varglobal_mu,font="Symbol"	SetVariable varglobal_mu,limits={-inf,inf,0.001},value= global_mu,live= 1	SetVariable varglobal_mu_inc,pos={10,98},size={97,15},proc=setvarincrement_global_mu,title="Increment"	SetVariable varglobal_mu_inc,limits={-inf,inf,0.001},value= global_mu_inc	SetVariable varglobal_t,pos={110,75},size={97,15},proc=setvarglobal_t2f,title="t"	SetVariable varglobal_t,limits={-inf,inf,0.01},value= global_t,live= 1	SetVariable varglobal_t_inc,pos={110,98},size={97,15},proc=setvarincrement_global_t,title="Increment"	SetVariable varglobal_t_inc,limits={-inf,inf,0.001},value= global_t_inc	SetVariable varglobal_tprime,pos={210,75},size={97,15},proc=setvarglobal_tprime2f,title="t'"	SetVariable varglobal_tprime,limits={-inf,inf,0.001},value= global_tprime,live= 1	SetVariable varglobal_tprime_inc,pos={210,98},size={97,15},proc=setvarincrement_global_tprime,title="Increment"	SetVariable varglobal_tprime_inc,limits={-inf,inf,0.001},value= global_tprime_inc	Button for_dop,pos={312,74},size={70,20},proc=ButtonProc_calc_tbarea,title="Doping"	ValDisplay valdisp0,pos={321,99},size={50,14},limits={0,0,0},barmisc={0,1000}	ValDisplay valdisp0,value= #"global_x"	Button button0,pos={412,48},size={95,20},proc=ButtonProc_plot_tbGXMGMprimeX2f,title="Plot GXMGM'X"	SetVariable vartheta1_zero,pos={2,3},size={97,16},proc=setvartheta1_zero,title="q_0"	SetVariable vartheta1_zero,font="Symbol"	SetVariable vartheta1_zero,limits={-inf,inf,0.005},value= theta1_zero,live= 1	SetVariable vartheta1_zero_inc,pos={2,21},size={97,15},proc=setvartheta1_zero,title="Increment"	SetVariable vartheta1_zero_inc,limits={0,inf,0.001},value= theta1_zero_inc	SetVariable varphi1_zero,pos={102,3},size={97,16},proc=setvarphi1_zero,title="j_0"	SetVariable varphi1_zero,font="Symbol"	SetVariable varphi1_zero,limits={-inf,inf,0.005},value= phi1_zero,live= 1	SetVariable varphi1_zero_inc,pos={102,22},size={97,15},proc=setvarincrement_phi1_zero,title="Increment"	SetVariable varphi1_zero_inc,limits={0,inf,0.01},value= phi1_zero_inc	SetVariable varrot1_zero,pos={202,3},size={97,15},proc=setvarrot1_zero,title="Rotation"	SetVariable varrot1_zero,limits={-360,360,0.2},value= rot1_zero,live= 1	SetVariable varrot1_zero_inc,pos={202,24},size={97,15},proc=setvarincrement_rot1_zero,title="Increment"	SetVariable varrot1_zero_inc,limits={0,inf,0.01},value= rot1_zero_inc	SetVariable varlattice1_0,pos={301,3},size={97,16},proc=setvarlattice1_0,title="p/a"	SetVariable varlattice1_0,font="Symbol"	SetVariable varlattice1_0,limits={0,inf,0.002},value= lattice1_0,live= 1	SetVariable varlattice1_0_inc,pos={301,24},size={97,15},proc=setvarincrement_lattice1_0,title="Increment"	SetVariable varlattice1_0_inc,limits={0,inf,0.002},value= lattice1_0_inc	Button update_graph,pos={5,46},size={150,20},proc=ButtonProc_update_image_fs,title="\\K(65535,65535,65535)Update"	Button update_graph,fColor=(27085,28,1)	Button for_phi_theta,pos={166,46},size={80,20},proc=ButtonProc_return_phi_theta1,title="Pt at new hv"	SetVariable Varquality_factor,pos={386,75},size={85,15},proc=setquality_factor,title="Quality"	SetVariable Varquality_factor,limits={0.1,inf,1},value= quality_factor	Button buttonshowmain,pos={472,94},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonshowmain,fStyle=17	Button buttontable,pos={507,6},size={50,20},proc=ButtonProc_tableafs,title="Table"	Button buttontable,fColor=(1,16019,65535)	Slider sliderx,pos={80,123},size={219,41},disable=1,proc=SliderProcCsrslicerx	Slider sliderx,fSize=8	Slider sliderx,limits={-2,2,0.01},value= 1,vert= 0,thumbColor= (49151,65535,65535)	Slider slidery,pos={5,159},size={43,233},disable=1,proc=SliderProcCsrslicery	Slider slidery,fSize=8	Slider slidery,limits={-2,2,0.01},value= 1,thumbColor= (65535,65532,16385)	PopupMenu popupwhichpnt,pos={7,133},size={67,20},disable=1,proc=PopMenuProcwhichpnt	PopupMenu popupwhichpnt,mode=2,popvalue="Point 2",value= #"\"Point 1;Point 2\""	ValDisplay valdispCsrx1,pos={312,124},size={65,17},disable=1,title=" X1"	ValDisplay valdispCsrx1,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsrx1,value= #"Csrx1forslicer"	ValDisplay valdispCsrx2,pos={396,124},size={65,17},disable=1,title=" X2"	ValDisplay valdispCsrx2,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsrx2,value= #"Csrx2forslicer"	ValDisplay valdispCsry1,pos={312,141},size={65,17},disable=1,title=" Y1"	ValDisplay valdispCsry1,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsry1,value= #"Csry1forslicer"	ValDisplay valdispCsry2,pos={396,141},size={65,17},disable=1,title=" Y2"	ValDisplay valdispCsry2,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsry2,value= #"Csry2forslicer"	PopupMenu popupspecialorientationslicer,pos={299,161},size={186,21},disable=1,proc=PopMenuProcorientationforslicer,title="Special orientation:"	PopupMenu popupspecialorientationslicer,fSize=14	PopupMenu popupspecialorientationslicer,mode=2,popvalue="G-Y",value= #"\"None;G-Y;G-X;G-M;G-M';M-Y;M'-Y\""	Button buttonshowimageCsrslicer,pos={502,124},size={85,20},disable=1,proc=Buttonshowimageforslicer,title="Show Image"	Button forzoom,pos={516,160},size={50,20},disable=1,proc=Button_zoom_forCsrslicer,title="Zoom"	PopupMenu popupview,pos={387,94},size={68,20},proc=PopMenuProc_viewimage_fs2f,title="View"	PopupMenu popupview,fSize=13	PopupMenu popupview,mode=6,popvalue="2",value= #"\"1/4;2/4;3/4;4/4;1;2;3\""	SetVariable varaonb,pos={404,3},size={95,15},proc=setvaraonb2f_1,title="a/b a>b"	SetVariable varaonb,limits={1,inf,0.01},value= aonb,live= 1	SetVariable varaonb_inc,pos={404,22},size={95,15},proc=setvarincrement_aonb,title="Increment"	SetVariable varaonb_inc,limits={0,inf,0.002},value= aonb_incEndMacroFunction findinglengthforCsrslicer(interpntsforCsrslicer)	Wave interpntsforCsrslicer	Variable length	length=sqrt((interpntsforCsrslicer[0][0]-interpntsforCsrslicer[1][0])^2+(interpntsforCsrslicer[0][1]-interpntsforCsrslicer[1][1])^2)	Return lengthEndFunction PopMenuProc_viewmaking_fs(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	String/G ViewFSstr	Variable/G aonb	Variable/G viewFS	ViewFS=popNum	ViewFSstr=popStr	ModifyGraph width=515,height=515	If(popNum==1)		SetAxis left 0,1;DelayUpdate		SetAxis bottom 0,1		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==2)		SetAxis left 0,1;DelayUpdate		SetAxis bottom -1,0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==3)		SetAxis left -1,0;DelayUpdate		SetAxis bottom -1,0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==4)		SetAxis left -1,0;DelayUpdate		SetAxis bottom 0,1		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif					If(popNum==5)		SetAxis left -1,1;DelayUpdate		SetAxis bottom -1,1		ModifyGraph manTick(left)={0,0.5,0,1},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.5,0,1},manMinor(bottom)={4,0}	Endif	If(popNum==6)		SetAxis left -2,2;DelayUpdate		SetAxis bottom -2,2		ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Endif		If(popNum==7)		SetAxis left -2,2;DelayUpdate		SetAxis bottom -2.5,2.5		ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Endif	If(popNum==8)		SetAxis left -3,3;DelayUpdate		SetAxis bottom -3,3		ModifyGraph manTick(left)={0,2,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,2,0,0},manMinor(bottom)={4,0}	EndifEndFunction PopMenuProc_viewimage_fs(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	ModifyGraph width=475,height=475	If(popNum==1)		SetAxis left 0,1;DelayUpdate		SetAxis bottom 0,1		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==2)		SetAxis left 0,1;DelayUpdate		SetAxis bottom -1,0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==3)		SetAxis left -1,0;DelayUpdate		SetAxis bottom -1,0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==4)		SetAxis left -1,0;DelayUpdate		SetAxis bottom 0,1		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==5)		SetAxis left -0.5,0.5;DelayUpdate		SetAxis bottom -0.5,0.5		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif						If(popNum==6)		SetAxis left -1,1;DelayUpdate		SetAxis bottom -1,1		ModifyGraph manTick(left)={0,0.5,0,1},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.5,0,1},manMinor(bottom)={4,0}	Endif	If(popNum==7)		SetAxis left -1.5,1.5;DelayUpdate		SetAxis bottom -1.5,1.5		ModifyGraph manTick(left)={0,1,0,1},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,1,0,1},manMinor(bottom)={4,0}	Endif		If(popNum==8)		SetAxis left -2,2;DelayUpdate		SetAxis bottom -2,2		ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Endif	If(popNum==9)		SetAxis left -3,3;DelayUpdate		SetAxis bottom -3,3		ModifyGraph manTick(left)={0,2,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,2,0,0},manMinor(bottom)={4,0}	EndifEndFunction PopMenuProc_viewimage_fsH(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	ModifyGraph width=475,height=475	If(popNum==1)		SetAxis left 0,sqrt(3/2);DelayUpdate		SetAxis bottom 0,sqrt(3/2)		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==2)		SetAxis left 0,sqrt(3/2);DelayUpdate		SetAxis bottom -sqrt(3/2),0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==3)		SetAxis left -sqrt(3/2),0;DelayUpdate		SetAxis bottom -sqrt(3/2),0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==4)		SetAxis left -sqrt(3/2),0;DelayUpdate		SetAxis bottom 0,sqrt(3/2)		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif					If(popNum==5)		SetAxis left -sqrt(3/2),sqrt(3/2);DelayUpdate		SetAxis bottom -sqrt(3/2),sqrt(3/2)		ModifyGraph manTick(left)={0,0.5,0,1},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.5,0,1},manMinor(bottom)={4,0}	Endif	If(popNum==6)		SetAxis left -2.5*sqrt(3/2),2.5*sqrt(3/2);DelayUpdate		SetAxis bottom -2.5*sqrt(3/2),2.5*sqrt(3/2)		ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Endif	If(popNum==7)		SetAxis left -4*sqrt(3/2),4*sqrt(3/2);DelayUpdate		SetAxis bottom -4*sqrt(3/2),4*sqrt(3/2)		ModifyGraph manTick(left)={0,2,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,2,0,0},manMinor(bottom)={4,0}	EndifEndFunction PopMenuProc_viewmaking_fs2f(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	String/G ViewFS2fstr	Variable/G aonb	Variable/G viewFS2f	ViewFS2f=popNum	ViewFS2fstr=popStr	ModifyGraph width=515,height=515/aonb	If(popNum==1)		SetAxis left 0,1/aonb;DelayUpdate		SetAxis bottom 0,1		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==2)		SetAxis left 0,1/aonb;DelayUpdate		SetAxis bottom -1,0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==3)		SetAxis left -1/aonb,0;DelayUpdate		SetAxis bottom -1,0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==4)		SetAxis left -1/aonb,0;DelayUpdate		SetAxis bottom 0,1		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif					If(popNum==5)		SetAxis left -1/aonb,1/aonb;DelayUpdate		SetAxis bottom -1,1		ModifyGraph manTick(left)={0,0.5,0,1},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.5,0,1},manMinor(bottom)={4,0}	Endif	If(popNum==6)		SetAxis left -2/aonb,2/aonb;DelayUpdate		SetAxis bottom -2,2		ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Endif	If(popNum==7)		SetAxis left -3/aonb,3/aonb;DelayUpdate		SetAxis bottom -3,3		ModifyGraph manTick(left)={0,2,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,2,0,0},manMinor(bottom)={4,0}	EndifEndFunction PopMenuProc_viewimage_fs2f(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	String/G ViewFS2fstr_1	Variable/G aonb	Variable/G viewFS2f_1	ViewFS2f_1=popNum	ViewFS2fstr_1=popStr	ModifyGraph width=475,height=475/aonb	If(popNum==1)		SetAxis left 0,1/aonb;DelayUpdate		SetAxis bottom 0,1		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==2)		SetAxis left 0,1/aonb;DelayUpdate		SetAxis bottom -1,0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==3)		SetAxis left -1/aonb,0;DelayUpdate		SetAxis bottom -1,0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==4)		SetAxis left -1/aonb,0;DelayUpdate		SetAxis bottom 0,1		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif					If(popNum==5)		SetAxis left -1/aonb,1/aonb;DelayUpdate		SetAxis bottom -1,1		ModifyGraph manTick(left)={0,0.5,0,1},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.5,0,1},manMinor(bottom)={4,0}	Endif	If(popNum==6)		SetAxis left -2/aonb,2/aonb;DelayUpdate		SetAxis bottom -2,2		ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Endif	If(popNum==7)		SetAxis left -3/aonb,3/aonb;DelayUpdate		SetAxis bottom -3,3		ModifyGraph manTick(left)={0,2,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,2,0,0},manMinor(bottom)={4,0}	EndifEndFunction PopMenuProc_viewmaking_fsH(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	ModifyGraph width=515,height=515	If(popNum==1)		SetAxis left 0,sqrt(3/2);DelayUpdate		SetAxis bottom 0,sqrt(3/2)		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==2)		SetAxis left 0,sqrt(3/2);DelayUpdate		SetAxis bottom -sqrt(3/2),0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==3)		SetAxis left -sqrt(3/2),0;DelayUpdate		SetAxis bottom -sqrt(3/2),0		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif	If(popNum==4)		SetAxis left -sqrt(3/2),0;DelayUpdate		SetAxis bottom 0,sqrt(3/2)		ModifyGraph manTick(left)={0,0.25,0,2},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.25,0,2},manMinor(bottom)={4,0}	Endif					If(popNum==5)		SetAxis left -sqrt(3/2),sqrt(3/2);DelayUpdate		SetAxis bottom -sqrt(3/2),sqrt(3/2)		ModifyGraph manTick(left)={0,0.5,0,1},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,0.5,0,1},manMinor(bottom)={4,0}	Endif	If(popNum==6)		SetAxis left -2.5*sqrt(3/2),2.5*sqrt(3/2);DelayUpdate		SetAxis bottom -2.5*sqrt(3/2),2.5*sqrt(3/2)		ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Endif	If(popNum==7)		SetAxis left -4*sqrt(3/2),4*sqrt(3/2);DelayUpdate		SetAxis bottom -4*sqrt(3/2),4*sqrt(3/2)		ModifyGraph manTick(left)={0,2,0,0},manMinor(left)={4,0};DelayUpdate		ModifyGraph manTick(bottom)={0,2,0,0},manMinor(bottom)={4,0}	EndifEndFunction B_rescaleforspec_orientations(ctrlName) : ButtonControl	String ctrlName	PauseUpdate; Silent 1	Execute "rescaleforspec_orientations()"EndFunction Button_zoom_forCsrslicer(ctrlName) : ButtonControl	String ctrlName	PauseUpdate; Silent 1	Execute "zoom_forCsrslicer()"EndProc rescaleforspec_orientations()	PauseUpdate; Silent 1	Variable/G valuespecialforslicer	Variable/G lattice1_0	If(valuespecialforslicer==2)		if(Csrslicerinter[0][0]>=0)			Setscale/P x,dimoffset(imageforslicer,0)+sqrt((Csrslicerinter[0][0])^2+(Csrslicerinter[0][1])^2),dimdelta(imageforslicer,0),""imageforslicer				Else				Setscale/P x,dimoffset(imageforslicer,0)-sqrt((Csrslicerinter[0][0])^2+(Csrslicerinter[0][1])^2),dimdelta(imageforslicer,0),""imageforslicer			Endif				Endif	If(valuespecialforslicer==3)		if(Csrslicerinter[0][0]<=0)			Setscale/P x,dimoffset(imageforslicer,0)-sqrt((Csrslicerinter[0][0])^2+(Csrslicerinter[0][1])^2),dimdelta(imageforslicer,0),""imageforslicer				Else				Setscale/P x,dimoffset(imageforslicer,0)+sqrt((Csrslicerinter[0][0])^2+(Csrslicerinter[0][1])^2),dimdelta(imageforslicer,0),""imageforslicer			Endif				Endif	If(valuespecialforslicer==4)		print Csrslicerinter[0][0]		Setscale/P x,dimoffset(imageforslicer,0)+Csrslicerinter[0][0],dimdelta(imageforslicer,0),""imageforslicer		Endif	If(valuespecialforslicer==5)		Setscale/P x,dimoffset(imageforslicer,0)+Csrslicerinter[0][1],dimdelta(imageforslicer,0),""imageforslicer		Endif	If(valuespecialforslicer==6)		Setscale/P x,dimoffset(imageforslicer,0)+Csrslicerinter[0][1],dimdelta(imageforslicer,0),""imageforslicer		Endif	If(valuespecialforslicer==7)		Setscale/P x,dimoffset(imageforslicer,0)+Csrslicerinter[0][0],dimdelta(imageforslicer,0),""imageforslicer		EndifEndProc makeCsrslicerimage()	PauseUpdate; Silent 1	Variable/G whichmat3d	String nameofmat3d	Variable i	Variable lengthofslice	Variable deltaofslice	Variable sizeofslice	If((whichmat3d==1)||(whichmat3d==4))			nameofmat3d="mat3dk"	Endif	If((whichmat3d==2)||(whichmat3d==5))			nameofmat3d="mat3dkVD"	Endif	If((whichmat3d==3)||(whichmat3d==6))			nameofmat3d="mat3dkHD"	Endif		Make/O/N=(2,2) Csrslicerinter	Csrslicerinter[][]=0	Csrslicerinter[][]=intersectionforCsrslider()	lengthofslice=findinglengthforCsrslicer(Csrslicerinter)	deltaofslice=dimdelta(image_fs_plot,0)	sizeofslice=Round(lengthofslice/deltaofslice)+1	deltaofslice=lengthofslice/(sizeofslice-1)	if(sizeofslice>0)		Make/O/N=(sizeofslice,dimsize(mat3dk,2)) imageforslicer		Setscale/P x,0,deltaofslice,""imageforslicer		Setscale/P y,dimoffset(mat3dk,2),dimdelta(mat3dk,2),""imageforslicer		fillCsrslicerimage($nameofmat3d,imageforslicer,Csrslicerinter,lattice1_0,rot1_zero)	EndifEndFunction fillCsrslicerimage(thisma3d,thisimageforslicer,thisCsrslicerinter,thislattice,thisrot)	Wave thisma3d	Wave thisimageforslicer	Wave thisCsrslicerinter	Variable thislattice	Variable thisrot	PauseUpdate; Silent 1	Variable indexalongline	Variable thiskx,thisky	Variable slope,numb	Variable thetaslope	Variable Deltakx,Deltaky	Variable transkx,transky	Variable index_e	If(thisCsrslicerinter[0][0]!=thisCsrslicerinter[1][0])		slope=(thisCsrslicerinter[1][1]-thisCsrslicerinter[0][1])/(thisCsrslicerinter[1][0]-thisCsrslicerinter[0][0])		numb=thisCsrslicerinter[1][1]-slope*thisCsrslicerinter[1][0]		thetaslope=atan(slope)		Deltakx=abs(cos(thetaslope)*dimdelta(thisimageforslicer,0))		Deltaky=Deltakx*slope	Endif	indexalongline=0	Do		If(thisCsrslicerinter[0][0]!=thisCsrslicerinter[1][0])			thiskx=(thisCsrslicerinter[0][0]+Deltakx*indexalongline)*thislattice			thisky=(thisCsrslicerinter[0][1]+Deltaky*indexalongline)*thislattice			Else				thiskx=thisCsrslicerinter[0][0]*thislattice				thisky=(thisCsrslicerinter[0][1]+dimdelta(thisimageforslicer,0)*indexalongline)*thislattice		Endif		transkx=cos(thisrot*pi/180)*thiskx+sin(thisrot*pi/180)*thisky		transky=-sin(thisrot*pi/180)*thiskx+cos(thisrot*pi/180)*thisky			index_e=0		thisimageforslicer[indexalongline][]=Interp3d(thisma3d, transkx, transky, (q*dimdelta(thisma3d,2)+dimoffset(thisma3d,2)))		indexalongline+=1	While(indexalongline<dimsize(thisimageforslicer,0))	EndProc updateCsrforslicer()	PauseUpdate; Silent 1	Csrxforslicer[0]=Csrx1forslicer	Csrxforslicer[1]=Csrx2forslicer	Csryforslicer[0]=Csry1forslicer	Csryforslicer[1]=Csry2forslicer	EndFunction intersectionforCsrslider()	PauseUpdate; Silent 1	Variable/G Csrx1forslicer	Variable/G Csry1forslicer	Variable/G Csrx2forslicer	Variable/G Csry2forslicer	Wave xboundaryforCsrslicer	Wave yboundaryforCsrslicer	Variable slope	Variable interb	Variable interx1,interx2,intery1,intery2	Variable condition,firstfound,secondfound	Make/O/N=(2,2) matinterCsrslider	matinterCsrslider[][]=NaN	firstfound=0	secondfound=0	//check that the two points are different and have different x	condition=0	If((Csrx1forslicer==Csrx2forslicer)&&(Csry1forslicer==Csry2forslicer))		condition=0		Print "Cannot perform the operation. You must have different position"	Endif	If(Csrx1forslicer!=Csrx2forslicer)		condition=1	Endif	If((Csrx1forslicer==Csrx2forslicer)&&(Csry1forslicer!=Csry2forslicer))		condition=2	Endif	//Find the intersection	If(condition==1)		slope=(Csry2forslicer-Csry1forslicer)/(Csrx2forslicer-Csrx1forslicer)		interb=Csry2forslicer-slope*Csrx2forslicer		//check left side		if((slope*xboundaryforCsrslicer[0]+interb>=yboundaryforCsrslicer[0])&&(slope*xboundaryforCsrslicer[0]+interb<=yboundaryforCsrslicer[3]))			firstfound=1			matinterCsrslider[0][0]=xboundaryforCsrslicer[0]			matinterCsrslider[0][1]=slope*xboundaryforCsrslicer[0]+interb		Endif		//chek bottom side		If(((yboundaryforCsrslicer[0]-interb)/slope>=xboundaryforCsrslicer[0])&&((yboundaryforCsrslicer[0]-interb)/slope<=xboundaryforCsrslicer[1]))			If(firstfound==0)				matinterCsrslider[0][0]=(yboundaryforCsrslicer[0]-interb)/slope				matinterCsrslider[0][1]=yboundaryforCsrslicer[0]				firstfound=1			Endif			If((firstfound==1)||(secondfound==0))				If(((yboundaryforCsrslicer[0]-interb)/slope)!=matinterCsrslider[0][0])					matinterCsrslider[1][0]=(yboundaryforCsrslicer[0]-interb)/slope					matinterCsrslider[1][1]=yboundaryforCsrslicer[0]					secondfound=1				Endif			Endif											Endif		//chek top side		If(((yboundaryforCsrslicer[3]-interb)/slope>=xboundaryforCsrslicer[0])&&((yboundaryforCsrslicer[3]-interb)/slope<=xboundaryforCsrslicer[1]))			If(firstfound==0)				matinterCsrslider[0][0]=(yboundaryforCsrslicer[3]-interb)/slope				matinterCsrslider[0][1]=yboundaryforCsrslicer[3]				firstfound=1			Endif			If((firstfound==1)||(secondfound==0))				If(((yboundaryforCsrslicer[3]-interb)/slope)!=matinterCsrslider[0][0])									matinterCsrslider[1][0]=(yboundaryforCsrslicer[3]-interb)/slope					matinterCsrslider[1][1]=yboundaryforCsrslicer[3]					secondfound=1				Endif			Endif											Endif		//chek right side		if((slope*xboundaryforCsrslicer[1]+interb>=yboundaryforCsrslicer[0])&&(slope*xboundaryforCsrslicer[1]+interb<=yboundaryforCsrslicer[3]))			if(firstfound==0)				matinterCsrslider[0][0]=xboundaryforCsrslicer[1]				matinterCsrslider[0][1]=slope*xboundaryforCsrslicer[1]+interb				firstfound=1				Else					matinterCsrslider[1][0]=xboundaryforCsrslicer[1]					matinterCsrslider[1][1]=slope*xboundaryforCsrslicer[1]+interb					secondfound=1			Endif		Endif			Endif	if(condition==2)		matinterCsrslider[0][0]=Csrx1forslicer		matinterCsrslider[0][1]=yboundaryforCsrslicer[0]				matinterCsrslider[1][0]=Csrx1forslicer		matinterCsrslider[1][1]=yboundaryforCsrslicer[3]			Endif	Return matinterCsrsliderEndProc makeboundaryforCsrslicer()	PauseUpdate; Silent 1	Execute "update_image_fs()"	Make/O/N=5 xboundaryforCsrslicer	Make/O/N=5 yboundaryforCsrslicer	xboundaryforCsrslicer[0]=dimoffset(image_fs_plot,0)	xboundaryforCsrslicer[1]=dimoffset(image_fs_plot,0)+(dimsize(image_fs_plot,0)-1)*dimdelta(image_fs_plot,0)	xboundaryforCsrslicer[2]=dimoffset(image_fs_plot,0)+(dimsize(image_fs_plot,0)-1)*dimdelta(image_fs_plot,0)	xboundaryforCsrslicer[3]=dimoffset(image_fs_plot,0)	xboundaryforCsrslicer[4]=dimoffset(image_fs_plot,0)	yboundaryforCsrslicer[0]=dimoffset(image_fs_plot,1)	yboundaryforCsrslicer[1]=dimoffset(image_fs_plot,1)	yboundaryforCsrslicer[2]=dimoffset(image_fs_plot,1)+(dimsize(image_fs_plot,1)-1)*dimdelta(image_fs_plot,1)	yboundaryforCsrslicer[3]=dimoffset(image_fs_plot,1)+(dimsize(image_fs_plot,1)-1)*dimdelta(image_fs_plot,1)	yboundaryforCsrslicer[4]=dimoffset(image_fs_plot,1)		Appendtograph yboundaryforCsrslicer vs xboundaryforCsrslicer	ModifyGraph lstyle(yboundaryforCsrslicer)=3	ModifyGraph rgb(yboundaryforCsrslicer)=(26214,0,0)	EndFunction SliderProcCsrslicerx(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Variable/G Csrx1forslicer	Variable/G Csry1forslicer	Variable/G Csrx2forslicer	Variable/G Csry2forslicer	Variable/G whichpnt//	print event	if(event %& 0x1)	// bit 0, value set	endif	If(whichpnt==2)		Csrx2forslicer=sliderValue		Else			Csrx1forslicer=sliderValue	Endif	Execute "updateCsrforslicer()"	Execute "makeCsrslicerimage()"	return 0EndFunction SliderProcCsrslicery(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Variable/G Csrx1forslicer	Variable/G Csry1forslicer	Variable/G Csrx2forslicer	Variable/G Csry2forslicer	variable/G whichpnt	if(event %& 0x1)	// bit 0, value set	endif	If(whichpnt==2)		Csry2forslicer=sliderValue		Else			Csry1forslicer=sliderValue	Endif	Execute "updateCsrforslicer()"	Execute "makeCsrslicerimage()"		return 0EndFunction PopMenuProc_slicermode(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G Slicermode	Variable/G VvsHline	Variable/G Csrx1forslicer	Variable/G Csry1forslicer	Variable/G Csrx2forslicer	Variable/G Csry2forslicer		Slicermode=popNum	If(Slicermode==1)		If(wintype("Graph_zoomforCsrslicer")==1)			Dowindow/K Graph_zoomforCsrslicer		Endif		Dowindow/F image_fs_ploter		ModifyGraph margin=0				Slider sliderx disable=1		Slider slidery disable=1		PopupMenu popupwhichpnt disable=1		ValDisplay valdispCsrx1 disable=1				ValDisplay valdispCsrx2 disable=1				ValDisplay valdispCsry1 disable=1				ValDisplay valdispCsry2 disable=1			PopupMenu popupspecialorientationslicer disable=1					Button forzoom disable=1								If(waveexists(Csryforslicer)==1)			Removefromgraph Csryforslicer			killwaves Csryforslicer, Csrxforslicer		Endif		If(waveexists(yboundaryforCsrslicer)==1)			Removefromgraph yboundaryforCsrslicer			killwaves yboundaryforCsrslicer, xboundaryforCsrslicer		Endif		Button buttonshowimageCsrslicer disable=1						If(wintype("Graph_imageforslicer")==1)			Dowindow/F Graph_imageforslicer			Button buttonrescalefororientation disable=1					Endif				If(VvsHline==1)			ValDisplay ttextimageforslicer format="Horizontal"			Else				ValDisplay ttextimageforslicer format="Vertical"					Endif		Dowindow/F mat3d_slicer			Endif		If(Slicermode==2)		If(wintype("Graph_imageforslicer")==1)			Dowindow/F Graph_imageforslicer			Else				Execute "Graph_imageforslicer()"		Endif		Button buttonrescalefororientation disable=0					ValDisplay ttextimageforslicer format="Cursor mode"		Dowindow/F image_fs_ploter		ModifyGraph margin(left)=100,margin(top)=75				Slider sliderx disable=0		Slider slidery disable=0		PopupMenu popupwhichpnt disable=0				ValDisplay valdispCsrx1 disable=0				ValDisplay valdispCsrx2 disable=0				ValDisplay valdispCsry1 disable=0				ValDisplay valdispCsry2 disable=0			PopupMenu popupspecialorientationslicer disable=0			PopupMenu popupspecialorientationslicer mode=1				PopMenuProcorientationforslicer("popupspecialorientationslicer",1,"None")		Button forzoom disable=0								If(waveexists(Csrxforslicer)==0)			Make/N=2 Csrxforslicer			Make/N=2 Csryforslicer			Csrxforslicer[0]=Csrx1forslicer			Csrxforslicer[1]=Csrx2forslicer			Csryforslicer[0]=Csry1forslicer			Csryforslicer[1]=Csry2forslicer						Appendtograph Csryforslicer vs Csrxforslicer			ModifyGraph mode(Csryforslicer)=4,marker(Csryforslicer)=18,lsize(Csryforslicer)=2		Endif		Button buttonshowimageCsrslicer disable=0						Execute "makeboundaryforCsrslicer()"	EndifEndFunction PopMenuProcwhichpnt(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G whichpnt	Variable/G Csrx1forslicer	Variable/G Csry1forslicer	Variable/G Csrx2forslicer	Variable/G Csry2forslicer	whichpnt=popNum	If(whichpnt==1)		Slider sliderx Value=Csrx1forslicer		Slider slidery Value=Csry1forslicer		Else			Slider sliderx Value=Csrx2forslicer			Slider slidery Value=Csry2forslicer	Endif		EndFunction PopMenuProcorientationforslicer(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G valuespecialforslicer	If(popNum==2)		PopMenuProcwhichpnt("popupwhichpnt",1,"Point 1")		SliderProcCsrslicerx("sliderx",-1,0)		SliderProcCsrslicery("slidery",-1,0)		Slider sliderx Value=-1		Slider slidery Value=-1							PopMenuProcwhichpnt("popupwhichpnt",2,"Point 2")		SliderProcCsrslicerx("sliderx",1,0)		SliderProcCsrslicery("slidery",1,0)		Slider sliderx Value=1		Slider slidery Value=1		PopupMenu popupwhichpnt mode=2									Endif	If(popNum==3)		PopMenuProcwhichpnt("popupwhichpnt",1,"Point 1")		SliderProcCsrslicerx("sliderx",-1,0)		SliderProcCsrslicery("slidery",1,0)		Slider sliderx Value=-1		Slider slidery Value=1								PopMenuProcwhichpnt("popupwhichpnt",2,"Point 2")		SliderProcCsrslicerx("sliderx",1,0)		SliderProcCsrslicery("slidery",-1,0)		Slider sliderx Value=1		Slider slidery Value=-1									PopupMenu popupwhichpnt mode=2									Endif	If(popNum==4)		PopMenuProcwhichpnt("popupwhichpnt",1,"Point 1")		SliderProcCsrslicerx("sliderx",-1,0)		SliderProcCsrslicery("slidery",0,0)		Slider sliderx Value=-1		Slider slidery Value=0										PopMenuProcwhichpnt("popupwhichpnt",2,"Point 2")		SliderProcCsrslicerx("sliderx",1,0)		SliderProcCsrslicery("slidery",0,0)			Slider sliderx Value=1		Slider slidery Value=0										PopupMenu popupwhichpnt mode=2									Endif	If(popNum==5)		PopMenuProcwhichpnt("popupwhichpnt",1,"Point 1")		SliderProcCsrslicerx("sliderx",0,0)		SliderProcCsrslicery("slidery",-1,0)		Slider sliderx Value=0		Slider slidery Value=-1												PopMenuProcwhichpnt("popupwhichpnt",2,"Point 2")		SliderProcCsrslicerx("sliderx",0,0)		SliderProcCsrslicery("slidery",1,0)			Slider sliderx Value=0			Slider slidery Value=1									PopupMenu popupwhichpnt mode=2									Endif	If(popNum==6)		PopMenuProcwhichpnt("popupwhichpnt",1,"Point 1")		SliderProcCsrslicerx("sliderx",1,0)		SliderProcCsrslicery("slidery",-1,0)						Slider sliderx Value=1		Slider slidery Value=-1						PopMenuProcwhichpnt("popupwhichpnt",2,"Point 2")		SliderProcCsrslicerx("sliderx",1,0)		SliderProcCsrslicery("slidery",1,0)			Slider sliderx Value=1		Slider slidery Value=1											PopupMenu popupwhichpnt mode=2									Endif	If(popNum==7)		PopMenuProcwhichpnt("popupwhichpnt",1,"Point 1")		SliderProcCsrslicerx("sliderx",-1,0)		SliderProcCsrslicery("slidery",1,0)		Slider sliderx Value=-1		Slider slidery Value=1												PopMenuProcwhichpnt("popupwhichpnt",2,"Point 2")		SliderProcCsrslicerx("sliderx",1,0)		SliderProcCsrslicery("slidery",1,0)			Slider sliderx Value=1		Slider slidery Value=1											PopupMenu popupwhichpnt mode=2									Endif		valuespecialforslicer=popNumEndWindow Graph_zoomforCsrSlicer() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(358,58,759,358) upr_y vs upr_x	AppendToGraph upl_y vs upl_x	AppendToGraph lowr_y vs lowr_x	AppendToGraph lowl_y vs lowl_x	AppendToGraph BZbondaries_y vs BZbondaries_x	AppendToGraph MBZbondaries_y vs MBZbondaries_x	AppendToGraph folded1_y vs folded1_x	AppendToGraph folded2_y vs folded2_x	AppendToGraph folded3_y vs folded3_x	AppendToGraph folded4_y vs folded4_x	AppendToGraph folded5_y vs folded5_x	AppendToGraph folded6_y vs folded6_x	AppendToGraph folded7_y vs folded7_x	AppendToGraph folded8_y vs folded8_x	AppendToGraph folded9_y vs folded9_x	AppendToGraph Csryforslicer vs Csrxforslicer	AppendToGraph yboundaryforCsrslicer vs xboundaryforCsrslicer	AppendImage image_fs_plot	ModifyImage image_fs_plot ctab= {*,*,PlanetEarth,0}	ModifyGraph width=300,height=244.138,cbRGB=(1,39321,39321)	ModifyGraph mode(Csryforslicer)=4	ModifyGraph marker(Csryforslicer)=18	ModifyGraph lSize(MBZbondaries_y)=2	ModifyGraph lStyle(MBZbondaries_y)=2,lStyle(folded1_y)=3,lStyle(folded2_y)=3,lStyle(folded3_y)=3	ModifyGraph lStyle(folded4_y)=3,lStyle(folded5_y)=3,lStyle(folded6_y)=3,lStyle(folded7_y)=3	ModifyGraph lStyle(folded8_y)=3,lStyle(folded9_y)=3,lStyle(yboundaryforCsrslicer)=3	ModifyGraph rgb(upr_y)=(2,39321,1),rgb(upl_y)=(2,39321,1),rgb(lowr_y)=(2,39321,1)	ModifyGraph rgb(lowl_y)=(2,39321,1),rgb(BZbondaries_y)=(0,0,65535),rgb(MBZbondaries_y)=(65535,21845,0)	ModifyGraph rgb(folded1_y)=(43690,43690,43690),rgb(folded2_y)=(43690,43690,43690)	ModifyGraph rgb(folded3_y)=(43690,43690,43690),rgb(folded4_y)=(43690,43690,43690)	ModifyGraph rgb(folded5_y)=(43690,43690,43690),rgb(folded6_y)=(43690,43690,43690)	ModifyGraph rgb(folded7_y)=(43690,43690,43690),rgb(folded8_y)=(43690,43690,43690)	ModifyGraph rgb(folded9_y)=(43690,43690,43690),rgb(yboundaryforCsrslicer)=(27085,28,1)	ModifyGraph msize(Csryforslicer)=5	ModifyGraph mirror=0	SetAxis left -0.0779050514101982,0.561762094497681	SetAxis bottom 0.315683871507645,1.10171556472778EndMacroProc zoom_forCsrslicer()	PauseUpdate; Silent 1	Variable zoom_factor	If(Wintype("Graph_zoomforCsrSlicer")==1)		Dowindow/F Graph_zoomforCsrSlicer		Else					Graph_zoomforCsrSlicer()	Endif	If((xboundaryforCsrslicer[1]-xboundaryforCsrslicer[0])>(yboundaryforCsrslicer[3]-yboundaryforCsrslicer[0]))		zoom_factor=450/(xboundaryforCsrslicer[1]-xboundaryforCsrslicer[0])		Else			zoom_factor=450/(yboundaryforCsrslicer[3]-yboundaryforCsrslicer[0])	Endif	ModifyGraph width=zoom_factor*(xboundaryforCsrslicer[1]-xboundaryforCsrslicer[0]),height=zoom_factor*(yboundaryforCsrslicer[3]-yboundaryforCsrslicer[0])	SetAxis left yboundaryforCsrslicer[0],yboundaryforCsrslicer[3]	SetAxis bottom xboundaryforCsrslicer[0],xboundaryforCsrslicer[1]	EndFunction PopMenuProc_3(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G SRC_vs_BNL	SRC_vs_BNL=popNum-1EndFunction ButtonProc_copy_circles(ctrlName) : ButtonControl	String ctrlName	Execute "copy_circles()"EndFunction ButtonProc_copy_circles2f(ctrlName) : ButtonControl	String ctrlName	Variable/G aonb	Execute "copy_circles_2f()"EndFunction ButtonProc_append_circles(ctrlName) : ButtonControl	String ctrlName	Execute "append_circles()"EndFunction ButtonProc_making_fsH(ctrlName) : ButtonControl	String ctrlName	If(Wintype("making_fsHEX")==0)		Execute "Table_Notthesepoints()"			Execute "ini_making_fsH()"		Execute "Honeycomb()"				Execute "making_fsHEX()"		Else			Dowindow/F making_fsHEX	EndifEndFunction ButtonProc_making_fs(ctrlName) : ButtonControl	String ctrlName	If(Wintype("making_fs")==0)		Execute "Table_Notthesepoints()"			Execute "ini_making_fs()"		Execute "prep_bondaries()"				Execute "update_4circles()"		Execute "making_fs()"		popUpMenu popup_mfs4 value="Approx;Exact"			popUpMenu popup_mfs4 mode=1		Else			Dowindow/F making_fs	EndifEndFunction ButtonProc_making_fs2f(ctrlName) : ButtonControl	String ctrlName	If(Wintype("making_fs2f")==0)		Execute "Table_Notthesepoints()"			Execute "ini_making_fs2f()"		Execute "prep_bondaries2f()"				Execute "update_4circles2f()"		Execute "making_fs2f()"		Else			Dowindow/F making_fs2f	EndifEndFunction SetVarProcanglethetato(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G predict_angletheta_from	IF(varNum<predict_angletheta_from)		predict_angletheta_from=varNum	Endif	//	Execute "update_predict_cuts()"	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"	EndFunction SetVarProcanglethetafrom(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName//	Execute "update_predict_cuts()"	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"	EndFunction SetVarProcanglephifrom(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"EndFunction SetVarProcanglephito(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G predict_anglephi_from	IF(varNum<predict_anglephi_from)		predict_anglephi_from=varNum	Endif	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"EndFunction SetVarProcanglephidelta(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "Removepredicted_cuts()"	Execute "predict_anglephi_from_set()"	Execute "predict_anglephi_to_set()"		Execute "makepredicted_cuts()"EndFunction SetVarProcanglethetadelta(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "Removepredicted_cuts()"	Execute "predict_angletheta_from_set()"	Execute "predict_angletheta_to_set()"		Execute "makepredicted_cuts()"EndFunction PopMenuProcpredictorientation(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	PauseUpdate	Silent 1		Variable/G predict_orientation	Variable/G predict_VvsHslit	Variable/G predict_rotation	If((popNum==1)&&(predict_VvsHslit==2))//		predict_orientation=0		predict_rotation=0	Endif	If((popNum==2)&&(predict_VvsHslit==2))		predict_rotation=-45	Endif	If((popNum==3)&&(predict_VvsHslit==2))		predict_rotation=45	Endif		If((popNum==1)&&(predict_VvsHslit==1))		predict_rotation=0	Endif	If((popNum==2)&&(predict_VvsHslit==1))		predict_rotation=45	Endif	If((popNum==3)&&(predict_VvsHslit==1))		predict_rotation=-45	Endif			//	Execute "Update_predict_cuts()"	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"			PopupMenu popup0 disable=1	PopupMenu popup0 disable=0	EndFunction ButtonProc_predict_cuts(ctrlName) : ButtonControl	String ctrlName	PauseUpdate	Silent 1		Variable/G predict_anglephi_delta	Variable/G predict_angletheta_delta		If(Wintype("predict_cuts")==0)		Execute "ini_predict_cuts()"		Execute "predictprep_bondaries()"				Execute "predictupdate_4circles()"		Execute "predict_cuts()"		SetVariable setvarangletheta_delta,limits={0,80,1},value= predict_angletheta_delta				SetVariable setvarangletheta_from,limits={-80,80,predict_angletheta_delta},value= predict_angletheta_from		SetVariable setvarangletheta_to,limits={-80,80,predict_angletheta_delta},value= predict_angletheta_to		SetVariable setvaranglephi_delta,limits={0,80,1},value= predict_anglephi_delta		SetVariable setvaranglephi_from,limits={-80,80,predict_anglephi_delta},value= predict_anglephi_from		SetVariable setvaranglephi_to,limits={-80,80,predict_anglephi_delta},value= predict_anglephi_to		Execute "makepredicted_cuts()"			PopupMenu popup0 disable=1		PopupMenu popup0 disable=0		PopupMenu popuppredict_orientation  disable=1			PopupMenu popuppredict_orientation disable=0									Else			Dowindow/F predict_cuts	EndifEndProc Removepredicted_cuts() : ButtonControl	PauseUpdate	Silent 1	String nameoflist	String thisnameitem	String testname	Variable i	Variable numofitems	nameoflist=TraceNameList("predict_cuts",";",1)	numofitems=ItemsInList(nameoflist,";")	i=0	Do		thisnameitem=StringFromList(i,nameoflist,";")		if(cmpstr(thisnameitem[0,9],"predictcut")==0)			Removefromgraph $thisnameitem		Endif		i+=1	While(i<numofitems)EndProc makepredicted_cuts() : ButtonControl	PauseUpdate	Silent 1	Variable/G	 predict_VvsHslit	String thisnamepara,thisnameperp,thisnamekx,thisnameky	Variable numofphi	Variable numoftheta	Variable thistheta,thisphi		Variable i,j,cutnum	Variable k	Dowindow/F predict_cuts	//Find the good number of cuts	numofphi=Floor((predict_anglephi_to-predict_anglephi_from)/predict_anglephi_delta)+1	if(numofphi<1)		numofphi=1	Endif	predict_anglephi_to=(numofphi-1)*predict_anglephi_delta+predict_anglephi_from	numoftheta=Floor((predict_angletheta_to-predict_angletheta_from)/predict_angletheta_delta)+1	if(numoftheta<1)		numoftheta=1	Endif	predict_angletheta_to=(numoftheta-1)*predict_angletheta_delta+predict_angletheta_from//	thisphi=predict_anglephi_from//	thistheta=predict_angletheta_from	k=0.51231*sqrt(predictKEatEF)	Make/O/N=100 etawave	etawave[]=-(predict_acept/2)+p*predict_acept/99	cutnum=0	i=0	Do		thisphi=predict_anglephi_from+i*predict_anglephi_delta		j=0		Do			thistheta=predict_angletheta_from+j*predict_angletheta_delta			thisnamekx="predictcutkx"+num2str(cutnum)			thisnameky="predictcutky"+num2str(cutnum)			Make/O/N=100 $thisnamekx					Make/O/N=100 $thisnameky			If(predict_VvsHslit==2)				$thisnamekx[]=k*sin(thistheta*pi/180)*cos(etawave[p]*pi/180)/predictlattice_0				$thisnameky[]=k*(cos(thisphi*pi/180)*sin(etawave[p]*pi/180)+sin(thisphi*pi/180)*cos(thistheta*pi/180)*cos(etawave[p]*pi/180))/predictlattice_0				Else					$thisnamekx[]=k*(cos(thistheta*pi/180)*sin(etawave[p]*pi/180)+sin(thistheta*pi/180)*cos(etawave[p]*pi/180))/predictlattice_0					$thisnameky[]=k*(-sin(thisphi*pi/180)*sin(thistheta*pi/180)*sin(etawave[p]*pi/180)+sin(thisphi*pi/180)*cos(thistheta*pi/180)*cos(etawave[p]*pi/180))/predictlattice_0			Endif			Duplicate/O $thisnamekx ttempx			Duplicate/O $thisnamekx ttempy			ttempx[]=0			ttempy[]=0			ttempx[]=$thisnamekx[p]*cos(predict_rotation*pi/180)-$thisnameky[p]*sin(predict_rotation*pi/180)			ttempy[]=$thisnamekx[p]*sin(predict_rotation*pi/180)+$thisnameky[p]*cos(predict_rotation*pi/180)			Duplicate/O ttempx $thisnamekx			Duplicate/O ttempy $thisnameky			Killwaves ttempx,ttempy			 												Appendtograph $thisnameky vs $thisnamekx			ModifyGraph rgb($thisnameky)=(0,0,0)										cutnum+=1					j+=1		While(j<numoftheta)//		thisnamepara="predictcutpara"+num2str(i)//		thisnameperp="predictcutperp"+num2str(i)//		Make/O/N=100 $thisnamepara		//		Make/O/N=100 $thisnameperp//		$thisnamepara[]=p*(predict_angletheta_to-predict_angletheta_from)/99+predict_angletheta_from	//		$thisnameperp[]=i*predict_anglephi_delta+predict_anglephi_from//		Transformpredicted($thisnamepara,$thisnameperp,$thisnamektheta,$thisnamekphi)//		killwaves $thisnamepara,$thisnameperp		i+=1	While(i<numofphi)EndProc update_predict_cuts() : ButtonControl	PauseUpdate	Silent 1	Variable/G	 predict_VvsHslit	String thisnamepara,thisnameperp,thisnamektheta,thisnamekphi	Variable numofcuts	Variable i	Dowindow/F predict_cuts	//Find the good number of cuts	numofcuts=Floor((predict_anglephi_to-predict_anglephi_from)/predict_anglephi_delta)+1	predict_anglephi_to=(numofcuts-1)*predict_anglephi_delta+predict_anglephi_from	i=0	Do		thisnamepara="predictcutpara"+num2str(i)		thisnameperp="predictcutperp"+num2str(i)		thisnamektheta="predictcutktheta"+num2str(i)		thisnamekphi="predictcutphi"+num2str(i)				Make/O/N=100 $thisnamepara				Make/O/N=100 $thisnameperp		Make/O/N=100 $thisnamektheta				Make/O/N=100 $thisnamekphi				$thisnamepara[]=p*(predict_angletheta_to-predict_angletheta_from)/99+predict_angletheta_from			$thisnameperp[]=i*predict_anglephi_delta+predict_anglephi_from		Transformpredicted($thisnamepara,$thisnameperp,$thisnamektheta,$thisnamekphi)		$thisnamektheta[]/=predictlattice_0		$thisnamekphi[]/=predictlattice_0						killwaves $thisnamepara,$thisnameperp		i+=1	While(i<numofcuts)EndFunction Transformpredicted(parawave,perpwave,kthetawave,kphiwave)	Wave parawave	Wave perpwave	Wave kthetawave	Wave kphiwave	PauseUpdate	Silent 1		Variable/G predict_VvsHslit	Variable/G predictKEatEF	Variable/G predict_acept	Variable/G predict_rotation	Variable/G predict_orientation	Variable i	If(predict_VvsHslit==1)		kthetawave[]=(0.51231*sqrt(predictKEatEF)*sin((parawave[p]+predict_acept)*pi/180))*cos((predict_rotation+predict_orientation)*pi/180)-(0.51231*sqrt(predictKEatEF)*cos((parawave[p]+predict_acept)*pi/180)*sin((perpwave[p])*pi/180))*sin((predict_rotation+predict_orientation)*pi/180)		kphiwave[]=(0.51231*sqrt(predictKEatEF)*cos((parawave[p]+predict_acept)*pi/180)*sin((perpwave[p])*pi/180))*cos((predict_rotation+predict_orientation)*pi/180)+(0.51231*sqrt(predictKEatEF)*sin((parawave[p]+predict_acept)*pi/180))*sin((predict_rotation+predict_orientation)*pi/180)			Else			kthetawave[]=(0.51231*sqrt(predictKEatEF)*sin((perpwave[p])*pi/180))*cos((predict_rotation+predict_orientation)*pi/180)-(0.51231*sqrt(predictKEatEF)*cos((perpwave[p])*pi/180)*sin((parawave[p]+predict_acept)*pi/180))*sin((predict_rotation+predict_orientation)*pi/180)			kphiwave[]=(0.51231*sqrt(predictKEatEF)*cos((perpwave[p])*pi/180)*sin((parawave[p]+predict_acept)*pi/180))*cos((predict_rotation+predict_orientation)*pi/180)+(0.51231*sqrt(predictKEatEF)*sin((perpwave[p])*pi/180))*sin((predict_rotation+predict_orientation)*pi/180)	Endif	EndFunction setvarpredictacept(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G predict_acept	predict_acept=varNum//	Execute "Update_predict_cuts()"	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"EndFunction SetVarpredictrotation(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G predict_rotation	predict_rotation=VarNum//	Execute "Update_predict_cuts()"	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"EndFunction PopMenuProc_predictHV(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	PauseUpdate	Silent 1		Variable/G predict_VvsHslit	String/G predict_VvsHslit_str	predict_VvsHslit=popNum	predict_VvsHslit_str=popStr//	Execute "Update_predict_cuts()"	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"	PopupMenu popup0 disable=1	PopupMenu popup0 disable=0EndFunction ButtonProc_image_fs(ctrlName) : ButtonControl	String ctrlName	If(Wintype("image_fs_ploter")==0)			Execute "ini_image_fs()"		Execute "prep_bondaries()"				Execute "update_4circles()"		Execute "image_fs_ploter()"		Else			Dowindow/F image_fs_ploter	EndifEndFunction ButtonProc_image_fs2f(ctrlName) : ButtonControl	String ctrlName	If(Wintype("image_fs_ploter2f")==0)			Execute "ini_image_fs2f()"		Execute "prep_bondaries2f()"				Execute "update_4circles2f()"		Execute "image_fs_ploter2f()"		Else			Dowindow/F image_fs_ploter2f	EndifEndFunction ButtonProc_update_making_fs(ctrlName) : ButtonControl	String ctrlName	Execute "update_making_fs()"EndFunction ButtonProc_update_making_fs2f(ctrlName) : ButtonControl	String ctrlName	Execute "update_making_fs2f()"EndFunction ButtonProc_update_making_fsH(ctrlName) : ButtonControl	String ctrlName	Execute "update_making_fsH()"EndFunction ButtonProc_openmat3dslicer(ctrlName) : ButtonControl	String ctrlName	Execute "ini_mat3dslicer()"	Execute "openmat3dslicer()"	Execute "Set_Hline_slice_control()"	Execute "Set_Vline_slice_control()"			Execute "Set_numcombslicer()"	If(Wintype("Graph_imageforslicer")==0)		Execute "Graph_imageforslicer()"		Else			Dowindow/F Graph_imageforslicer	EndifEndProc ini_Graph_imageforslicer(ctrlName) : ButtonControl	PauseUpdate	Silent 1	String ctrlName	If(Exists(imageforslicer)==0)		Duplicate/O mat3d_energy_plot imageforslicer	Endif	EndFunction ButtonProc_update_image_fs(ctrlName) : ButtonControl	String ctrlName	Execute "update_image_fs()"EndFunction ButtonProc_plot_tbGXMG(ctrlName) : ButtonControl	String ctrlName	Execute "plot_tbGXMG()"EndFunction ButtonProc_plot_tbGXMGMprimeX2f(ctrlName) : ButtonControl	String ctrlName	Execute "plot_tbGXMGMprimeX_2f()"EndFunction ButtonProc_plot_predicttbGXMG(ctrlName) : ButtonControl	String ctrlName	Execute "plot_predicttbGXMG()"EndFunction ButtonProc_calc_tbarea(ctrlName) : ButtonControl	String ctrlName	Execute "calc_tbarea()"EndFunction ButtonProc_predictcalc_tbarea(ctrlName) : ButtonControl	String ctrlName	Execute "predictcalc_tbarea()"EndFunction ButtonProc_put_superlattice(ctrlName) : ButtonControl	String ctrlName	Execute "put_superlattice()"EndFunction ButtonProc_put_psuperlattice(ctrlName) : ButtonControl	String ctrlName	Execute "put_psuperlattice()"EndFunction ButtonProc_remove_superlattice(ctrlName) : ButtonControl	String ctrlName	Execute "remove_superlattice()"EndFunction ButtonProc_remove_psuperlattice(ctrlName) : ButtonControl	String ctrlName	Execute "remove_psuperlattice()"EndFunction ButtonProc_put_superlattice1(ctrlName) : ButtonControl	String ctrlName	Execute "put_superlattice1()"EndFunction ButtonWindow_movie_maker(ctrlName) : ButtonControl	String ctrlName	Execute "Movie_Maker()"EndFunction ButtonProc_remove_superlattice1(ctrlName) : ButtonControl	String ctrlName	Execute "remove_superlattice1()"EndFunction setquality_factor(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "quality_set()"EndFunction setvartheta_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "theta_zero_set()"	Execute "update_making_fs()"EndFunction setvartheta_zero2f(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "theta_zero_set()"	Execute "update_making_fs2f()"EndFunction setvartheta_zeroH(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "theta_zero_setH()"	Execute "update_making_fsH()"EndFunction setvartheta1_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G auto_update_ifs4	Execute "theta1_zero_set()"	If(auto_update_ifs4==2)		Execute "Update_image_fs()"	EndifEndFunction setvarphi_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "phi_zero_set()"	Execute "update_making_fs()"EndFunction setvarphi_zero2f(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "phi_zero_set()"	Execute "update_making_fs2f()"EndFunction setvarphi_zeroH(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "phi_zero_setH()"	Execute "update_making_fsH()"EndFunction setvarphi1_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G auto_update_ifs4	Execute "phi1_zero_set()"	If(auto_update_ifs4==2)		Execute "Update_image_fs()"	EndifEndFunction setvarrot_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "rot_zero_set()"	Execute "update_making_fs()"EndFunction setvarrot_zero2f(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "rot_zero_set()"	Execute "update_making_fs2f()"EndFunction setvarrot_zeroH(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "rot_zero_set()"	Execute "update_making_fsH()"EndFunction setvarrot1_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G auto_update_ifs4	Execute "rot1_zero_set()"	If(auto_update_ifs4==2)		Execute "Update_image_fs()"	EndifEndFunction setvarlattice_0(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "lattice_0_set()"	Execute "update_making_fs()"EndFunction setvarlattice_02f(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "lattice_0_set()"	Execute "update_making_fs2f()"EndFunction setvaraonb2f(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G aonb	Variable/G viewFS2f	String/G viewFS2fstr	Execute "aonb_set()"	Execute "update_making_fs2f()"	Execute "prep_bondaries2f()"	Execute "update_4circles2f()"	PopMenuProc_viewmaking_fs2f("popupview",viewfs2f,viewfs2fstr)EndFunction setvaraonb2f_1(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G aonb	Variable/G viewFS2f_1	String/G viewFS2fstr_1	Execute "aonb_set()"	Execute "update_making_fs2f()"	Execute "prep_bondaries2f()"	Execute "update_4circles2f()"	PopMenuProc_viewimage_fs2f("popupview",viewfs2f_1,viewfs2fstr_1)EndFunction setvarlattice_0H(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "lattice_0_set()"	Execute "update_making_fsH()"EndFunction setvarpredictlattice_0(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "predictlattice_0_set()"//	Execute "update_predict_cuts()"	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"	EndFunction setvarlattice1_0(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G auto_update_ifs4	Execute "lattice1_0_set()"	If(auto_update_ifs4==2)		Execute "Update_image_fs()"	EndifEndFunction setKEatEF(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "KEatEF_set()"	Execute "update_making_fs()"EndFunction setKEatEF2f(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "KEatEF_set()"	Execute "update_making_fs2f()"EndFunction setKEatEFH(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "KEatEF_set()"	Execute "update_making_fsH()"EndFunction setpredictKEatEF(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "predictKEatEF_set()"//	Execute "update_predict_cuts()"	Execute "Removepredicted_cuts()"	Execute "makepredicted_cuts()"	EndFunction setKE1atEF(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "KE1atEF_set()"//	Execute "update_making_fs()"EndFunction setvarincrement_theta_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "theta_zero_incset()"EndFunction setvarincrement_theta_zeroH(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "theta_zero_incsetH()"EndFunction setvarincrement_theta1_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "theta1_zero_incset()"EndFunction setvarincrement_phi_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "phi_zero_incset()"EndFunction setvarincrement_phi_zeroH(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "phi_zero_incsetH()"EndFunction setvarincrement_phi1_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "phi1_zero_incset()"EndFunction setvarincrement_rot_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "rot_zero_incset()"EndFunction setvarincrement_rot1_zero(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "rot1_zero_incset()"EndFunction setvarincrementpredictlattice0(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	PauseUpdate	Silent 1	SetVariable varpredictlattice_0_inc,limits={0,Inf,0.002},value= predictlattice_0_incEndFunction setvarincrementpredictwedge(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	PauseUpdate	Silent 1	Variable/G predictwedge_inc	SetVariable varpredictwedge_inc,limits={0,70,0.1},value= predictwedge_inc	SetVariable varpredictwedge,limits={0,70,predictwedge_inc},value= predict_aceptEndFunction setvarincrementpredictrotation(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	PauseUpdate	Silent 1	SetVariable varpredictrotation_inc,limits={0,Inf,0.1},value= predictrotation_incEndFunction setvarincrement_lattice_0(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "lattice_0_incset()"EndFunction setvarincrement_aonb(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "aonb_incset()"EndFunction setvarincrement_lattice1_0(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "lattice1_0_incset()"EndFunction setvarglobal_mu(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "global_mu_set()"	Execute "update_global_par()"	Execute "update_4circles()"EndFunction setvarglobal_mu2f(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "global_mu_set()"	Execute "update_global_par()"	Execute "update_4circles2f()"EndFunction setvarpredict_mu(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "predict_mu_set()"	Execute "update_predict_par()"	Execute "predictupdate_4circles()"EndFunction setvarglobal_t(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "global_t_set()"	Execute "update_global_par()"	Execute "update_4circles()"EndFunction setvarglobal_t2f(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "global_t_set()"	Execute "update_global_par()"	Execute "update_4circles2f()"EndFunction setvarpredict_t(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "predict_t_set()"	Execute "update_predict_par()"	Execute "predictupdate_4circles()"EndFunction setvarglobal_tprime(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "global_tprime_set()"	Execute "update_global_par()"	Execute "update_4circles()"EndFunction setvarglobal_tprime2f(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "global_tprime_set()"	Execute "update_global_par()"	Execute "update_4circles2f()"EndFunction setvarpredict_tprime(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "predict_tprime_set()"	Execute "update_predict_par()"	Execute "predictupdate_4circles()"EndFunction setvarincrement_global_mu(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "global_mu_incset()"EndFunction setvarincrement_predict_mu(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	PauseUpdate	Silent 1	SetVariable varpredict_mu_inc,limits={-Inf,Inf,0.001},value= predict_mu_inc	EndFunction setvarincrement_global_t(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "global_t_incset()"EndFunction setvarincrement_predict_t(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	PauseUpdate	Silent 1	SetVariable varpredict_t_inc,limits={-Inf,Inf,0.001},value= predict_t_incEndFunction setvarincrement_global_tprime(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "global_tprime_incset()"EndFunction setvarincrement_predict_tprime(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	PauseUpdate	Silent 1	SetVariable varpredict_tprime_inc,limits={-Inf,Inf,0.001},value= predict_tprime_incEndFunction setvarincrement_emat3d(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3d_eplot_setincrement()"EndFunction setvarincrement_emat3dVD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dVD_eplot_setincrement()"EndFunction setvarincrement_emat3dHD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dHD_eplot_setincrement()"EndFunction setvarincrement_emat3dk(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dk_eplot_setincrement()"EndFunction setvarincrement_emat3dkVD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dkVD_eplot_setincrement()"EndFunction setvarincrement_emat3dkHD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dkHD_eplot_setincrement()"EndFunction setvarcenter_emat3d(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3d_eplot()"	Execute "Update_Raman4_3DfromFS()"EndFunction setvarcenter_emat3dVD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dVD_eplot()"EndFunction setvarcenter_emat3dHD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dHD_eplot()"EndFunction setvarcenter_emat3dk(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dk_eplot()"EndFunction setvarcenter_emat3dkVD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dkVD_eplot()"EndFunction setvarcenter_emat3dkHD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dkHD_eplot()"EndFunction setvarwide_emat3dVD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dVD_eplot()"EndFunction setvarwide_emat3dHD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dHD_eplot()"EndFunction setvarwide_emat3dk(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dk_eplot()"EndFunction setvarwide_emat3dkVD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dkVD_eplot()"EndFunction setvarwide_emat3dkHD(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3dkHD_eplot()"EndFunction ButtonProc_MakeCutTable(ctrlName) : ButtonControl	String ctrlName	Execute " MakeCutTable()"EndFunction ButtonProc_make_mat3dk(ctrlName) : ButtonControl	String ctrlName	Execute " make_mat3dk()"EndFunction ButtonProc_make_mat3dkVD(ctrlName) : ButtonControl	String ctrlName	Execute " make_mat3dkVD()"EndFunction ButtonProc_make_mat3dkHD(ctrlName) : ButtonControl	String ctrlName	Execute " make_mat3dkHD()"EndFunction ButtonProc_mat3d_makeimage(ctrlName) : ButtonControl	String ctrlName	Execute " mat3d_makeimage()"EndFunction ButtonProc_mat3dVD_makeimage(ctrlName) : ButtonControl	String ctrlName	Execute " mat3dVD_makeimage()"EndFunction ButtonProc_mat3dHD_makeimage(ctrlName) : ButtonControl	String ctrlName	Execute " mat3dHD_makeimage()"EndFunction ButtonProc_mat3dk_makeimage(ctrlName) : ButtonControl	String ctrlName	Execute " mat3dk_makeimage()"EndFunction ButtonProc_mat3dkVD_makeimage(ctrlName) : ButtonControl	String ctrlName	Execute " mat3dkVD_makeimage()"EndFunction ButtonProc_mat3dkHD_makeimage(ctrlName) : ButtonControl	String ctrlName	Execute " mat3dkHD_makeimage()"EndFunction ButtonProc_MakeImagetable(ctrlName) : ButtonControl	String ctrlName	Execute " MakeImageTable()"End Function ButtonProc_Makecutimage(ctrlName) : ButtonControl	String ctrlName	Execute " Makecutimage_pi()"EndFunction ButtonProc_mat3d_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mat3d_pi()"EndFunction ButtonProc_mat3dVD_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mat3dVD_pi()"EndFunction ButtonProc_mat3dVC_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mat3dVC_pi()"EndFunction ButtonProc_mat3dHD_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mat3dHD_pi()"EndFunction ButtonProc_mat3dHC_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mat3dHC_pi()"EndFunction ButtonProc_mat3dk_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mat3dk_pi()"EndFunction ButtonProc_mat3dkVD_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mat3dkVD_pi()"EndFunction ButtonProc_mat3dkHD_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mat3dkHD_pi()"EndFunction ButtonProc_wave2file(ctrlName) : ButtonControl	String ctrlName	Execute "wave2file()"EndFunction ButtonProc_wave2filenokill(ctrlName) : ButtonControl	String ctrlName	Execute "wave2filenokill()"EndFunction ButtonProc_file2wave(ctrlName) : ButtonControl	String ctrlName	Execute "file2wave()"EndFunction ButtonProc_Get_ledge_kf(ctrlName) : ButtonControl	String ctrlName	Execute "Get_ledge_kf()"EndFunction ButtonProc_selectcut_pi(ctrlName) : ButtonControl	String ctrlName	Execute "selectcut_pi()"EndFunction ButtonProc_phi_cst_pi(ctrlName) : ButtonControl	String ctrlName	Execute "phi_cst_pi()"EndFunction ButtonProc_Make_onechunkcut(ctrlName) : ButtonControl	String ctrlName	Execute "Make_onechunkcut()"EndFunction ButtonProc_Make_allchunkcuts(ctrlName) : ButtonControl	String ctrlName	Execute "Make_allchunkcuts()"EndFunction ButtonProc_Generate_chunklist(ctrlName) : ButtonControl	String ctrlName	Execute "Generate_chunklist()"EndFunction ButtonProc_deriv_1chunkcut(ctrlName) : ButtonControl	String ctrlName	Execute "deriv_1chunkcut()"EndFunction ButtonProc_deriv_allchunkcut(ctrlName) : ButtonControl	String ctrlName	Execute "deriv_allchunkcut()"EndFunction ButtonProc_angmodeconverterfs(ctrlName) : ButtonControl	String ctrlName	Execute "anglemode_converter_fs()"EndProc MakeImageTable()	PauseUpdate	Silent 1	String indexwave="ImageIndex"		if( !WaveExists( $indexwave) )			Make/N=0 $indexwave		endif		String thetawave="Imagetheta"		if( !WaveExists( $thetawave) )			Make/N=0 $thetawave		endif		String phiwave="imagephi"		if( !WaveExists( $phiwave) )			Make/N=0  $phiwave		endif		String startwave="wavest"		if( !WaveExists( $startwave) )			Make/N=0 $startwave		endif	String endwave="waveed"		if( !WaveExists( $endwave) )			Make/N=0 $endwave		endif	String startetawave="waveetast"		if( !WaveExists($startetawave) )			Make/N=0 $startetawave		endif	String endetawave="waveetaed"		if(!WaveExists($endetawave) )			Make/N=0 $endetawave		endif	if(2==winType("image_table"))		DoWindow /F image_table	endif	if(0==wintype("image_table"))		Edit $indexwave,$thetawave,$phiwave,$startwave,$endwave,$startetawave,$endetawave		DoWindow /C Image_table	endif	End//*******************************************************************************************************************************Proc MakeCutTable()	PauseUpdate	Silent 1	String phiwave="phiindex"		if(!WaveExists( $phiwave) )			Make/N=0  $phiwave		endif	String chunkstr="chunkcutlist"	IF(WaveExists($chunkstr)==0)		Make/O/T/N=0 $chunkstr	Endif		String chunk1="chunketafirst"	IF(WaveExists($chunk1)==0)		Make/O/N=0 $chunk1	Endif		String chunk2="chunketalast"	IF(WaveExists($chunk2)==0)		Make/O/N=0 $chunk2	Endif		String fixed="chunkfixedangle"	IF(WaveExists($fixed)==0)		Make/O/N=0 $fixed	Endif		if(2==winType("cut_table"))		DoWindow /F cut_table	endif	if(0==wintype("cut_table"))		Edit $phiwave,$chunkstr,$chunk1,$chunk2,$fixed		DoWindow /C cut_table	endif	End//********************************************************************************************************************************Function Buttonshowimageforslicer(ctrlName) : ButtonControl	String ctrlName	If(Wintype("Graph_imageforslicer")==0)		Execute "Graph_imageforslicer()"		Else			Dowindow/F Graph_imageforslicer	EndifEnd//********************************************************************************************************************************Proc putslicermat3d()	PauseUpdate	Silent 1//	Variable/G Vslider//	Variable/G Hslider	Variable index	String imageongraph	String thisimage	imageongraph=ImageNameList("mat3d_slicer",";")	thisimage=StringFromList(0,imageongraph,";")	Removeimage $thisimage	Set_Hline_slice_control()	Set_Vline_slice_control()		If(wintype("Graph_imageforslicer")==1)		Dowindow/F Graph_imageforslicer			Else				Graph_imageforslicer()	Endif	If(VvsHline==2)		Make/O/N=(dimsize(mat3d,2),dimsize(mat3d,1)) imageforslicer		Setscale/P x,dimoffset(mat3d,2),dimdelta(mat3d,2),""imageforslicer		Setscale/P y,dimoffset(mat3d,1),dimdelta(mat3d,1),""imageforslicer		index=Round((sliderV-dimoffset(mat3d,0))/dimdelta(mat3d,0))				imageforslicer[][]=mat3d[index][q][p]			ModifyImage imageforslicer ctab= {*,*,Terrain,1}		Dowindow/F mat3d_slicer		appendimage mat3d_energy_plot		ModifyImage mat3d_energy_plot ctab= {*,*,Terrain,1}		putVline()			Else			Make/O/N=(dimsize(mat3d,0),dimsize(mat3d,1)) imageforslicer			Setscale/P x,dimoffset(mat3d,0),dimdelta(mat3d,0),""imageforslicer			Setscale/P y,dimoffset(mat3d,1),dimdelta(mat3d,1),""imageforslicer					index=Round((SliderH-dimoffset(mat3d,2))/dimdelta(mat3d,2))					imageforslicer[][]=mat3d[p][q][index]			ModifyImage imageforslicer ctab= {*,*,Terrain,1}			Dowindow/F mat3d_slicer						appendimage mat3d_energy_plot			ModifyImage mat3d_energy_plot ctab= {*,*,Terrain,1}			putHline()		EndifEnd//********************************************************************************************************************************Proc putslicermat3dk()	PauseUpdate	Silent 1//	Variable/G Vslider//	Variable/G Hslider	Variable index	String imageongraph	String thisimage	imageongraph=ImageNameList("mat3d_slicer",";")	thisimage=StringFromList(0,imageongraph,";")	Removeimage $thisimage	Set_Hline_slice_control()	Set_Vline_slice_control()	If(wintype("Graph_imageforslicer")==1)		Dowindow/F Graph_imageforslicer			Else				Graph_imageforslicer()	Endif	If(VvsHline==2)		Make/O/N=(dimsize(mat3dk,1),dimsize(mat3dk,2)) imageforslicer		Setscale/P x,dimoffset(mat3dk,1),dimdelta(mat3dk,1),""imageforslicer		Setscale/P y,dimoffset(mat3dk,2),dimdelta(mat3dk,2),""imageforslicer		index=Round((sliderV-dimoffset(mat3dk,0))/dimdelta(mat3dk,0))				imageforslicer[][]=mat3dk[index][p][q]		ModifyImage imageforslicer ctab= {*,*,Terrain,1}			Dowindow/F mat3d_slicer		appendimage mat3dk_energy_plot		ModifyImage mat3dk_energy_plot ctab= {*,*,Terrain,1}		putVline()			Else			Make/O/N=(dimsize(mat3dk,0),dimsize(mat3dk,2)) imageforslicer			Setscale/P x,dimoffset(mat3dk,0),dimdelta(mat3dk,0),""imageforslicer			Setscale/P y,dimoffset(mat3dk,2),dimdelta(mat3dk,2),""imageforslicer					index=Round((SliderH-dimoffset(mat3dk,1))/dimdelta(mat3dk,1))					imageforslicer[][]=mat3dk[p][index][q]			ModifyImage imageforslicer ctab= {*,*,Terrain,1}				Dowindow/F mat3d_slicer			appendimage mat3dk_energy_plot			ModifyImage mat3dk_energy_plot ctab= {*,*,Terrain,1}			putHline()	EndifEnd//********************************************************************************************************************************Proc putslicermat3dVD()	PauseUpdate	Silent 1	Variable index	String imageongraph	String thisimage	imageongraph=ImageNameList("mat3d_slicer",";")	thisimage=StringFromList(0,imageongraph,";")	Removeimage $thisimage	Set_Hline_slice_control()	Set_Vline_slice_control()		If(wintype("Graph_imageforslicer")==1)		Dowindow/F Graph_imageforslicer			Else				Graph_imageforslicer()	Endif	If(VvsHline==2)		Make/O/N=(dimsize(mat3dVD,2),dimsize(mat3dVD,1)) imageforslicer		Setscale/P x,dimoffset(mat3dVD,2),dimdelta(mat3dVD,2),""imageforslicer		Setscale/P y,dimoffset(mat3dVD,1),dimdelta(mat3dVD,1),""imageforslicer		index=Round((sliderV-dimoffset(mat3dVD,0))/dimdelta(mat3dVD,0))				imageforslicer[][]=mat3dVD[index][q][p]		ModifyImage imageforslicer ctab= {*,0,Terrain,1}			Dowindow/F mat3d_slicer		appendimage mat3dVD_energy_plot		ModifyImage mat3dVD_energy_plot ctab= {*,0,Terrain,1}		putVline()			Else			Make/O/N=(dimsize(mat3dVD,0),dimsize(mat3dVD,1)) imageforslicer			Setscale/P x,dimoffset(mat3dVD,0),dimdelta(mat3dVD,0),""imageforslicer			Setscale/P y,dimoffset(mat3dVD,1),dimdelta(mat3dVD,1),""imageforslicer					index=Round((SliderH-dimoffset(mat3dVD,2))/dimdelta(mat3dVD,2))					imageforslicer[][]=mat3dVD[p][q][index]				ModifyImage imageforslicer ctab= {*,0,Terrain,1}			Dowindow/F mat3d_slicer			appendimage mat3dVD_energy_plot			ModifyImage mat3dVD_energy_plot ctab= {*,0,Terrain,1}			PutHline()	EndifEnd//********************************************************************************************************************************Proc putslicermat3dkVD()	PauseUpdate	Silent 1//	Variable/G Vslider//	Variable/G Hslider	Variable index	String imageongraph	String thisimage	imageongraph=ImageNameList("mat3d_slicer",";")	thisimage=StringFromList(0,imageongraph,";")	Removeimage $thisimage	Set_Hline_slice_control()	Set_Vline_slice_control()	If(wintype("Graph_imageforslicer")==1)		Dowindow/F Graph_imageforslicer			Else				Graph_imageforslicer()	Endif	If(VvsHline==2)		Make/O/N=(dimsize(mat3dkVD,1),dimsize(mat3dkVD,2)) imageforslicer		Setscale/P x,dimoffset(mat3dkVD,1),dimdelta(mat3dkVD,1),""imageforslicer		Setscale/P y,dimoffset(mat3dkVD,2),dimdelta(mat3dkVD,2),""imageforslicer		index=Round((sliderV-dimoffset(mat3dkVD,0))/dimdelta(mat3dkVD,0))				imageforslicer[][]=mat3dkVD[index][p][q]			ModifyImage imageforslicer ctab= {*,0,Terrain,1}		Dowindow/F mat3d_slicer		appendimage mat3dkVD_energy_plot		ModifyImage mat3dkVD_energy_plot ctab= {*,0,Terrain,1}		putVline()			Else			Make/O/N=(dimsize(mat3dkVD,0),dimsize(mat3dkVD,2)) imageforslicer			Setscale/P x,dimoffset(mat3dkVD,0),dimdelta(mat3dkVD,0),""imageforslicer			Setscale/P y,dimoffset(mat3dkVD,2),dimdelta(mat3dkVD,2),""imageforslicer					index=Round((SliderH-dimoffset(mat3dkVD,1))/dimdelta(mat3dkVD,1))					imageforslicer[][]=mat3dkVD[p][index][q]				ModifyImage imageforslicer ctab= {*,0,Terrain,1}			Dowindow/F mat3d_slicer			appendimage mat3dkVD_energy_plot			ModifyImage mat3dkVD_energy_plot ctab= {*,0,Terrain,1}			putHline()	EndifEnd//********************************************************************************************************************************Proc putslicermat3dHD()	PauseUpdate	Silent 1	Variable index	String imageongraph	String thisimage	imageongraph=ImageNameList("mat3d_slicer",";")	thisimage=StringFromList(0,imageongraph,";")	Removeimage $thisimage	Set_Hline_slice_control()	Set_Vline_slice_control()	If(wintype("Graph_imageforslicer")==1)		Dowindow/F Graph_imageforslicer			Else				Graph_imageforslicer()	Endif	If(VvsHline==2)		Make/O/N=(dimsize(mat3dHD,2),dimsize(mat3dHD,1)) imageforslicer		Setscale/P x,dimoffset(mat3dHD,2),dimdelta(mat3dHD,2),""imageforslicer		Setscale/P y,dimoffset(mat3dHD,1),dimdelta(mat3dHD,1),""imageforslicer		index=Round((sliderV-dimoffset(mat3dHD,0))/dimdelta(mat3dHD,0))				imageforslicer[][]=mat3dHD[index][q][p]		ModifyImage imageforslicer ctab= {*,0,Terrain,1}		Dowindow/F mat3d_slicer		appendimage mat3dHD_energy_plot		ModifyImage mat3dHD_energy_plot ctab= {*,0,Terrain,1}		putVline()			Else			Make/O/N=(dimsize(mat3dHD,0),dimsize(mat3dHD,1)) imageforslicer			Setscale/P x,dimoffset(mat3dHD,0),dimdelta(mat3dHD,0),""imageforslicer			Setscale/P y,dimoffset(mat3dHD,1),dimdelta(mat3dHD,1),""imageforslicer					index=Round((SliderH-dimoffset(mat3dHD,2))/dimdelta(mat3dHD,2))					imageforslicer[][]=mat3dHD[p][q][index]				ModifyImage imageforslicer ctab= {*,0,Terrain,1}			Dowindow/F mat3d_slicer			appendimage mat3dHD_energy_plot			ModifyImage mat3dHD_energy_plot ctab= {*,0,Terrain,1}			putHline()	EndifEnd//********************************************************************************************************************************Proc putslicermat3dkHD()	PauseUpdate	Silent 1//	Variable/G Vslider//	Variable/G Hslider	Variable index	String imageongraph	String thisimage	imageongraph=ImageNameList("mat3d_slicer",";")	thisimage=StringFromList(0,imageongraph,";")	Removeimage $thisimage	Set_Hline_slice_control()	Set_Vline_slice_control()	If(wintype("Graph_imageforslicer")==1)		Dowindow/F Graph_imageforslicer			Else				Graph_imageforslicer()	Endif	If(VvsHline==2)		Make/O/N=(dimsize(mat3dkHD,1),dimsize(mat3dkHD,2)) imageforslicer		Setscale/P x,dimoffset(mat3dkHD,1),dimdelta(mat3dkHD,1),""imageforslicer		Setscale/P y,dimoffset(mat3dkHD,2),dimdelta(mat3dkHD,2),""imageforslicer		index=Round((sliderV-dimoffset(mat3dkHD,0))/dimdelta(mat3dkHD,0))				imageforslicer[][]=mat3dkHD[index][p][q]		ModifyImage imageforslicer ctab= {*,0,Terrain,1}			Dowindow/F mat3d_slicer		appendimage mat3dkHD_energy_plot		ModifyImage mat3dkHD_energy_plot ctab= {*,0,Terrain,1}		putVline()			Else			Make/O/N=(dimsize(mat3dkHD,0),dimsize(mat3dkHD,2)) imageforslicer			Setscale/P x,dimoffset(mat3dkHD,0),dimdelta(mat3dkHD,0),""imageforslicer			Setscale/P y,dimoffset(mat3dkHD,2),dimdelta(mat3dkHD,2),""imageforslicer					index=Round((SliderH-dimoffset(mat3dkHD,1))/dimdelta(mat3dkHD,1))					imageforslicer[][]=mat3dkHD[p][index][q]			ModifyImage imageforslicer ctab= {*,0,Terrain,1}				Dowindow/F mat3d_slicer			appendimage mat3dkHD_energy_plot			ModifyImage mat3dkHD_energy_plot ctab= {*,0,Terrain,1}			putHline()	EndifEnd//********************************************************************************************************************************Function PopMenuProc_5(ctrlName,popNum,popStr) : PopupMenuControl  //which matrix 3d for slicer	String ctrlName	Variable popNum	String popStr	Wave imageforslicer	Wave mat3d	Wave mat3dVD	Wave mat3dHD	Wave mat3dk	Wave mat3dkVD	Wave mat3dkHD	Variable/G whichmat3d	whichmat3d=popNum	If(popNum==1)		Execute "putslicermat3d()"		Execute "Set_numcombslicer()"	Endif		If(popNum==2)		Execute "putslicermat3dVD()"		Execute "Set_numcombslicer()"	Endif		If(popNum==3)		Execute "putslicermat3dHD()"		Execute "Set_numcombslicer()"	Endif		If(popNum==4)		Execute "putslicermat3dk()"		Execute "Set_numcombslicer()"	Endif		If(popNum==5)		Execute "putslicermat3dkVD()"		Execute "Set_numcombslicer()"	Endif		If(popNum==6)		Execute "putslicermat3dkHD()"		Execute "Set_numcombslicer()"	Endif	End//********************************************************************************************************************************Function PopMenuProc_4(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	PauseUpdate	Silent 1	Variable/G Slicermode		Variable/G VvsHline	VvsHline=popNum	If(popNum==1)		Execute "Set_Hline_slice_control()"		Execute "Set_numcombslicer()"		Execute "putHline()"	Endif	If(popNum==2)		Execute "Set_Vline_slice_control()"			Execute "Set_numcombslicer()"		Execute "putVline()"	Endif	Execute "Set_numcombslicer()"	If(WIntype("Graph_imageforslicer")==1)		Dowindow/F Graph_imageforslicer		Else			Execute "Graph_imageforslicer()"	Endif	If(Slicermode==1)		ValDisplay ttextimageforslicer format=popStr	Endif		Dowindow/F mat3d_slicer//	set_textimageforslicer(popStr)End//********************************************************************************************************************************Function set_textimageforslicer(textname)	String textname	String ttextimageforslicer	Make/O/T/N=1 textforslicer	textforslicer[0]=textname	print textforslicer[0]	ttextimageforslicer=textforslicer[0]	Dowindow/F Graph_imageforslicer	ValDisplay ttextimageforslicer format=textname  //textforslicer[0]End//********************************************************************************************************************************Proc ChangeHline(matname)	String matname	Prompt matname,"Enter the matrix name"	PauseUpdate	Silent 1	funcChangeHline($matname)End//********************************************************************************************************************************Function funcChangeHline(matname)	Wave matname	PauseUpdate	Silent 1	Wave Hline_slicey1	Wave Hline_slicey2	wave Hline_slicex1	wave Hline_slicex2	wave imageforslicer	Variable/G Hline_slice_min			Variable/G Hline_slice_max	Variable/G Hline_slice_delta	Variable/G HvsHline	Variable/G numcombslicer		Variable/G whichmat3d	Variable/G Hline_slice		Variable i,num	Variable indexposition,indexfirst,indexlast	If(whichmat3d<4)		indexposition=Round((Hline_slice-dimoffset(matname,2))/dimdelta(matname,2))		If(mod(numcombslicer,2)==1)			indexfirst=indexposition-Round((numcombslicer-1)/2)			Else				indexfirst=indexposition-Round(numcombslicer/2)		Endif		If(indexfirst<0)			indexfirst=0		Endif		If(mod(numcombslicer,2)==1)			indexlast=indexposition+Round((numcombslicer-1)/2)			Else				indexlast=indexposition+Round(numcombslicer/2)-1		Endif		If(indexlast>(dimsize(matname,2)-1))			indexlast=dimsize(matname,2)-1		Endif					Hline_slicey1[]=dimoffset(matname,2)+indexfirst*dimdelta(matname,2)		Hline_slicey2[]=dimoffset(matname,2)+indexlast*dimdelta(matname,2)		Hline_slicex1[0]=dimoffset(matname,0)		Hline_slicex1[1]=dimoffset(matname,0)+dimdelta(matname,0)*(dimsize(matname,0)-1)		Hline_slicex2[0]=dimoffset(matname,0)		Hline_slicex2[1]=dimoffset(matname,0)+dimdelta(matname,0)*(dimsize(matname,0)-1)		imageforslicer[][]=0		num=0		i=indexfirst		Do			imageforslicer[][]+=matname[p][q][i]			i+=1			num+=1		While(i<indexlast+1)		imageforslicer[][]/=num		Else			indexposition=Round((Hline_slice-dimoffset(matname,1))/dimdelta(matname,1))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(matname,1)-1))				indexlast=dimsize(matname,1)-1			Endif						Hline_slicey1[]=dimoffset(matname,1)+indexfirst*dimdelta(matname,1)			Hline_slicey2[]=dimoffset(matname,1)+indexlast*dimdelta(matname,1)			Hline_slicex1[0]=dimoffset(matname,0)			Hline_slicex1[1]=dimoffset(matname,0)+dimdelta(matname,0)*(dimsize(matname,0)-1)			Hline_slicex2[0]=dimoffset(matname,0)			Hline_slicex2[1]=dimoffset(matname,0)+dimdelta(matname,0)*(dimsize(matname,0)-1)			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=matname[p][i][q]				i+=1				num+=1			While(i<indexlast+1)			imageforslicer[][]/=num	EndifEnd//********************************************************************************************************************************Proc putHline()	PauseUpdate	Silent 1	Variable/G Hline_slice_min			Variable/G Hline_slice_max	Variable/G Hline_slice_delta	Variable/G HvsHline	Variable/G numcombslicer		String wavesongraph,thistracename	Variable i	Variable indexposition, indexfirst,indexlast	wavesongraph=TraceNameList("mat3d_slicer",";",1)	i=0	Do		thistracename=StringFromList(i,wavesongraph,";")		Removefromgraph $thistracename				i+=1	While(i<Itemsinlist(wavesongraph,";"))	Make/O/N=2 Hline_slicey1	Make/O/N=2 Hline_slicex1	Make/O/N=2 Hline_slicey2	Make/O/N=2 Hline_slicex2	If(whichmat3d<4)		indexposition=Floor(dimsize(mat3d,2)/2)		If(mod(numcombslicer,2)==1)			indexfirst=indexposition-Round((numcombslicer-1)/2)			Else				indexfirst=indexposition-Round(numcombslicer/2)		Endif		If(indexfirst<0)			indexfirst=0		Endif		If(mod(numcombslicer,2)==1)			indexlast=indexposition+Round((numcombslicer-1)/2)			Else				indexlast=indexposition+Round(numcombslicer/2)-1		Endif		If(indexlast>(dimsize(mat3d,2)-1))			indexlast=dimsize(mat3d,2)-1)		Endif					Hline_slicey1[]=dimoffset(mat3d,2)+indexfirst*dimdelta(mat3d,2)		Hline_slicey2[]=dimoffset(mat3d,2)+indexlast*dimdelta(mat3d,2)		Hline_slicex1[0]=dimoffset(mat3d,0)		Hline_slicex1[1]=dimoffset(mat3d,0)+dimdelta(mat3d,0)*(dimsize(mat3d,0)-1)		Hline_slicex2[0]=dimoffset(mat3d,0)		Hline_slicex2[1]=dimoffset(mat3d,0)+dimdelta(mat3d,0)*(dimsize(mat3d,0)-1)		Else			indexposition=Floor(dimsize(mat3dk,1)/2)			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dk,1)-1))				indexlast=dimsize(mat3dk,1)-1			Endif						Hline_slicey1[]=dimoffset(mat3dk,1)+indexfirst*dimdelta(mat3dk,1)			Hline_slicey2[]=dimoffset(mat3dk,1)+indexlast*dimdelta(mat3dk,1)			Hline_slicex1[0]=dimoffset(mat3dk,0)			Hline_slicex1[1]=dimoffset(mat3dk,0)+dimdelta(mat3dk,0)*(dimsize(mat3dk,0)-1)			Hline_slicex2[0]=dimoffset(mat3dk,0)			Hline_slicex2[1]=dimoffset(mat3dk,0)+dimdelta(mat3dk,0)*(dimsize(mat3dk,0)-1)	Endif	Appendtograph Hline_slicey1 vs Hline_slicex1	Appendtograph Hline_slicey2 vs Hline_slicex2			End//********************************************************************************************************************************Function SetVarProcCmbslicer(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	PauseUpdate	Silent 1	Variable/G Hline_slice	Variable/G Vline_slice		Variable/G Slicermode		Variable/G VvsHline	Variable/G whichmat3d		String thename	IF(whichmat3d==1)		thename="mat3d"	Endif	IF(whichmat3d==2)		thename="mat3dVD"	Endif	IF(whichmat3d==3)		thename="mat3dHD"	Endif	IF(whichmat3d==4)		thename="mat3dk"	Endif	IF(whichmat3d==5)		thename="mat3dkVD"	Endif	IF(whichmat3d==6)		thename="mat3dkHD"	Endif	If((Slicermode==1)&&(VvsHline==2))//		Execute "Set_Vline_slice_control()"					Execute "ChangeVline("+"\""+thename+"\""+")"	Endif	If((Slicermode==1)&&(VvsHline==1))//		Execute "Set_Hline_slice_control()"					Execute "ChangeHline("+"\""+thename+"\""+")"	Endif		End//********************************************************************************************************************************Proc ChangeVline(matname)	String matname	Prompt matname,"Enter the matrix name"	PauseUpdate	Silent 1	funcChangeVline($matname)End//********************************************************************************************************************************Function funcChangeVline(matname)	Wave matname	PauseUpdate	Silent 1	Wave Vline_slicey1	Wave Vline_slicey2	wave Vline_slicex1	wave Vline_slicex2	wave imageforslicer		Variable/G Vline_slice_min			Variable/G Vline_slice_max	Variable/G Vline_slice_delta	Variable/G VvsHline	Variable/G numcombslicer	Variable/G whichmat3d	Variable/G Vline_slice		Variable i,num	Variable indexposition,indexfirst,indexlast	If(whichmat3d<4)		indexposition=Round((Vline_slice-dimoffset(matname,0))/dimdelta(matname,0))		If(mod(numcombslicer,2)==1)			indexfirst=indexposition-Round((numcombslicer-1)/2)			Else				indexfirst=indexposition-Round(numcombslicer/2)		Endif		If(indexfirst<0)			indexfirst=0		Endif		If(mod(numcombslicer,2)==1)			indexlast=indexposition+Round((numcombslicer-1)/2)			Else				indexlast=indexposition+Round(numcombslicer/2)-1		Endif		If(indexlast>(dimsize(matname,0)-1))			indexlast=dimsize(matname,0)-1		Endif				Vline_slicex1[]=dimoffset(matname,0)+indexfirst*dimdelta(matname,0)		Vline_slicex2[]=dimoffset(matname,0)+indexlast*dimdelta(matname,0)		Vline_slicey1[0]=dimoffset(matname,2)		Vline_slicey1[1]=dimoffset(matname,2)+dimdelta(matname,2)*dimsize(matname,2)		Vline_slicey2[0]=dimoffset(matname,2)		Vline_slicey2[1]=dimoffset(matname,2)+dimdelta(matname,2)*dimsize(matname,2)		imageforslicer[][]=0		num=0		i=indexfirst		Do			imageforslicer[][]+=matname[i][q][p]			i+=1			num+=1		While(i<indexlast+1)		imageforslicer[][]/=num		Else			indexposition=Round((Vline_slice-dimoffset(matname,0))/dimdelta(matname,0))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(matname,0)-1))				indexlast=dimsize(matname,0)-1			Endif						Vline_slicex1[]=dimoffset(matname,0)+indexfirst*dimdelta(matname,0)			Vline_slicex2[]=dimoffset(matname,0)+indexlast*dimdelta(matname,0)			Vline_slicey1[0]=dimoffset(matname,1)			Vline_slicey1[1]=dimoffset(matname,1)+dimdelta(matname,1)*dimsize(matname,1)			Vline_slicey2[0]=dimoffset(matname,1)			Vline_slicey2[1]=dimoffset(matname,1)+dimdelta(matname,1)*dimsize(matname,1)			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=matname[i][p][q]				i+=1				num+=1			While(i<indexlast+1)			imageforslicer[][]/=num	EndifEnd//********************************************************************************************************************************Proc putVline()	PauseUpdate	Silent 1	Variable/G Vline_slice_min			Variable/G Vline_slice_max	Variable/G Vline_slice_delta	Variable/G VvsHline	Variable/G numcombslicer		String wavesongraph,thistracename	Variable i	Variable indexposition,indexfirst,indexlast	wavesongraph=TraceNameList("mat3d_slicer",";",1)	i=0	Do		thistracename=StringFromList(i,wavesongraph,";")		Removefromgraph $thistracename		i+=1	While(i<Itemsinlist(wavesongraph,";"))	Make/O/N=2 Vline_slicey1	Make/O/N=2 Vline_slicex1	Make/O/N=2 Vline_slicey2	Make/O/N=2 Vline_slicex2	If(whichmat3d<4)		indexposition=Floor(dimsize(mat3d,0)/2)		If(mod(numcombslicer,2)==1)			indexfirst=indexposition-Round((numcombslicer-1)/2)			Else				indexfirst=indexposition-Round(numcombslicer/2)		Endif		If(indexfirst<0)			indexfirst=0		Endif		If(mod(numcombslicer,2)==1)			indexlast=indexposition+Round((numcombslicer-1)/2)			Else				indexlast=indexposition+Round(numcombslicer/2)-1		Endif		If(indexlast>(dimsize(mat3d,0)-1))			indexlast=dimsize(mat3d,0)-1		Endif					Vline_slicex1[]=dimoffset(mat3d,0)+indexfirst*dimdelta(mat3d,0)		Vline_slicex2[]=dimoffset(mat3d,0)+indexlast*dimdelta(mat3d,0)		Vline_slicey1[0]=dimoffset(mat3d,2)		Vline_slicey1[1]=dimoffset(mat3d,2)+dimdelta(mat3d,2)*dimsize(mat3d,2)		Vline_slicey2[0]=dimoffset(mat3d,2)		Vline_slicey2[1]=dimoffset(mat3d,2)+dimdelta(mat3d,2)*dimsize(mat3d,2)		Else			indexposition=Floor(dimsize(mat3dk,0)/2)			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dk,0)-1))				indexlast=dimsize(mat3dk,0)-1			Endif						Vline_slicex1[]=dimoffset(mat3dk,0)+indexfirst*dimdelta(mat3dk,0)			Vline_slicex2[]=dimoffset(mat3dk,0)+indexlast*dimdelta(mat3dk,0)			Vline_slicey1[0]=dimoffset(mat3dk,1)			Vline_slicey1[1]=dimoffset(mat3dk,1)+dimdelta(mat3dk,1)*dimsize(mat3dk,1)			Vline_slicey2[0]=dimoffset(mat3dk,1)			Vline_slicey2[1]=dimoffset(mat3dk,1)+dimdelta(mat3dk,1)*dimsize(mat3dk,1)	Endif	Appendtograph Vline_slicey1 vs Vline_slicex1	Appendtograph Vline_slicey2 vs Vline_slicex2			End//********************************************************************************************************************************Function SliderProc(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Wave Hline_slicey	Wave Hline_slicey1	Wave Hline_slicey2	Wave mat3d	Wave mat3dVD	Wave mat3dHD	Wave mat3dk	Wave mat3dkVD	Wave mat3dkHD	Variable/G Hline_slice	Variable/G SliderH	Variable/G whichmat3d	Variable/G numcombslicer		Variable/G Hline_slice_delta			Variable indexposition,indexfirst,indexlast	variable i,num	If((whichmat3d==1)||(whichmat3d==0))		Make/O/N=(dimsize(mat3d,0),dimsize(mat3d,1)) imageforslicer		Setscale/P x,dimoffset(mat3d,0),dimdelta(mat3d,0),""imageforslicer		Setscale/P y,dimoffset(mat3d,1),dimdelta(mat3d,1),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3d,2))/dimdelta(mat3d,2))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3d,2)-1))				indexlast=dimsize(mat3d,2)-1			Endif						Hline_slicey1[]=dimoffset(mat3d,2)+indexfirst*dimdelta(mat3d,2)			Hline_slicey2[]=dimoffset(mat3d,2)+indexlast*dimdelta(mat3d,2)			Hline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3d[p][q][i]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderH=Slidervalue	Endif	If(whichmat3d==2)		Make/O/N=(dimsize(mat3dVD,0),dimsize(mat3dVD,1)) imageforslicer		Setscale/P x,dimoffset(mat3dVD,0),dimdelta(mat3dVD,0),""imageforslicer		Setscale/P y,dimoffset(mat3dVD,1),dimdelta(mat3dVD,1),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dVD,2))/dimdelta(mat3dVD,2))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dVD,2)-1))				indexlast=dimsize(mat3dVD,2)-1			Endif						Hline_slicey1[]=dimoffset(mat3dVD,2)+indexfirst*dimdelta(mat3dVD,2)			Hline_slicey2[]=dimoffset(mat3dVD,2)+indexlast*dimdelta(mat3dVD,2)			Hline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dVD[p][q][i]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderH=Slidervalue	Endif		If(whichmat3d==3)		Make/O/N=(dimsize(mat3dHD,0),dimsize(mat3dHD,1)) imageforslicer		Setscale/P x,dimoffset(mat3dHD,0),dimdelta(mat3dHD,0),""imageforslicer		Setscale/P y,dimoffset(mat3dHD,1),dimdelta(mat3dHD,1),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dHD,2))/dimdelta(mat3dHD,2))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dHD,2)-1))				indexlast=dimsize(mat3dHD,2)-1			Endif						Hline_slicey1[]=dimoffset(mat3dHD,2)+indexfirst*dimdelta(mat3dHD,2)			Hline_slicey2[]=dimoffset(mat3dHD,2)+indexlast*dimdelta(mat3dHD,2)			Hline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dHD[p][q][i]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderH=Slidervalue	Endif	If(whichmat3d==4)		Make/O/N=(dimsize(mat3dk,0),dimsize(mat3dk,2)) imageforslicer		Setscale/P x,dimoffset(mat3dk,0),dimdelta(mat3dk,0),""imageforslicer		Setscale/P y,dimoffset(mat3dk,2),dimdelta(mat3dk,2),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dk,1))/dimdelta(mat3dk,1))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dk,1)-1))				indexlast=dimsize(mat3dk,1)-1			Endif						Hline_slicey1[]=dimoffset(mat3dk,1)+indexfirst*dimdelta(mat3dk,1)			Hline_slicey2[]=dimoffset(mat3dk,1)+indexlast*dimdelta(mat3dk,1)			Hline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dk[p][i][q]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderH=Slidervalue	Endif		If(whichmat3d==5)		Make/O/N=(dimsize(mat3dkVD,0),dimsize(mat3dkVD,2)) imageforslicer		Setscale/P x,dimoffset(mat3dkVD,0),dimdelta(mat3dkVD,0),""imageforslicer		Setscale/P y,dimoffset(mat3dkVD,2),dimdelta(mat3dkVD,2),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dkVD,1))/dimdelta(mat3dkVD,1))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dkVD,1)-1))				indexlast=dimsize(mat3dkVD,1)-1			Endif						Hline_slicey1[]=dimoffset(mat3dkVD,1)+indexfirst*dimdelta(mat3dkVD,1)			Hline_slicey2[]=dimoffset(mat3dkVD,1)+indexlast*dimdelta(mat3dkVD,1)			Hline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dkVD[p][i][q]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderH=Slidervalue	Endif		If(whichmat3d==6)		Make/O/N=(dimsize(mat3dkHD,0),dimsize(mat3dkHD,2)) imageforslicer		Setscale/P x,dimoffset(mat3dkHD,0),dimdelta(mat3dkHD,0),""imageforslicer		Setscale/P y,dimoffset(mat3dkHD,2),dimdelta(mat3dkHD,2),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dkHD,1))/dimdelta(mat3dkHD,1))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dkHD,1)-1))				indexlast=dimsize(mat3dkHD,1)-1			Endif						Hline_slicey1[]=dimoffset(mat3dkHD,1)+indexfirst*dimdelta(mat3dkHD,1)			Hline_slicey2[]=dimoffset(mat3dkHD,1)+indexlast*dimdelta(mat3dkHD,1)			Hline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dkHD[p][i][q]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderH=Slidervalue	Endif								return 0EndMacro//********************************************************************************************************************************Function SliderProc_1(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Wave Vline_slicex	Wave Vline_slicex1	Wave Vline_slicex2	Wave mat3d	Wave mat3dVD	Wave mat3dHD	Wave mat3dk	Wave mat3dkVD	Wave mat3dkHD	Variable/G Vline_slice	Variable/G SliderV	Variable/G whichmat3d	Variable/G numcombslicer	Variable/G Vline_slice_delta			Variable indexposition,indexfirst,indexlast	variable i,num	If((whichmat3d==1)||(whichmat3d==0))		Make/O/N=(dimsize(mat3d,2),dimsize(mat3d,1)) imageforslicer		Setscale/P x,dimoffset(mat3d,2),dimdelta(mat3d,2),""imageforslicer		Setscale/P y,dimoffset(mat3d,1),dimdelta(mat3d,1),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3d,0))/dimdelta(mat3d,0))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3d,0)-1))				indexlast=dimsize(mat3d,0)-1			Endif						Vline_slicex1[]=dimoffset(mat3d,0)+indexfirst*dimdelta(mat3d,0)			Vline_slicex2[]=dimoffset(mat3d,0)+indexlast*dimdelta(mat3d,0)			Vline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3d[i][q][p]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderV=Slidervalue	Endif	If(whichmat3d==2)		Make/O/N=(dimsize(mat3dVD,2),dimsize(mat3dVD,1)) imageforslicer		Setscale/P x,dimoffset(mat3dVD,2),dimdelta(mat3dVD,2),""imageforslicer		Setscale/P y,dimoffset(mat3dVD,1),dimdelta(mat3dVD,1),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dVD,0))/dimdelta(mat3dVD,0))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dVD,0)-1))				indexlast=dimsize(mat3dVD,0)-1			Endif						Vline_slicex1[]=dimoffset(mat3dVD,0)+indexfirst*dimdelta(mat3dVD,0)			Vline_slicex2[]=dimoffset(mat3dVD,0)+indexlast*dimdelta(mat3dVD,0)			Vline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dVD[i][q][p]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderV=Slidervalue	Endif	If(whichmat3d==3)		Make/O/N=(dimsize(mat3dHD,2),dimsize(mat3dHD,1)) imageforslicer		Setscale/P x,dimoffset(mat3dHD,2),dimdelta(mat3dHD,2),""imageforslicer		Setscale/P y,dimoffset(mat3dHD,1),dimdelta(mat3dHD,1),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dHD,0))/dimdelta(mat3dHD,0))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dHD,0)-1))				indexlast=dimsize(mat3dHD,0)-1			Endif						Vline_slicex1[]=dimoffset(mat3dHD,0)+indexfirst*dimdelta(mat3dHD,0)			Vline_slicex2[]=dimoffset(mat3dHD,0)+indexlast*dimdelta(mat3dHD,0)			Vline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dHD[i][q][p]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderV=Slidervalue	Endif	If(whichmat3d==4)		Make/O/N=(dimsize(mat3dk,1),dimsize(mat3dk,2)) imageforslicer		Setscale/P x,dimoffset(mat3dk,1),dimdelta(mat3dk,1),""imageforslicer		Setscale/P y,dimoffset(mat3dk,2),dimdelta(mat3dk,2),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dk,0))/dimdelta(mat3dk,0))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dk,0)-1))				indexlast=dimsize(mat3dk,0)-1			Endif						Vline_slicex1[]=dimoffset(mat3dk,0)+indexfirst*dimdelta(mat3dk,0)			Vline_slicex2[]=dimoffset(mat3dk,0)+indexlast*dimdelta(mat3dk,0)			Vline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dk[i][p][q]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderV=Slidervalue	Endif	If(whichmat3d==5)		Make/O/N=(dimsize(mat3dkVD,1),dimsize(mat3dkVD,2)) imageforslicer		Setscale/P x,dimoffset(mat3dkVD,1),dimdelta(mat3dkVD,1),""imageforslicer		Setscale/P y,dimoffset(mat3dkVD,2),dimdelta(mat3dkVD,2),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dkVD,0))/dimdelta(mat3dkVD,0))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dkVD,0)-1))				indexlast=dimsize(mat3dkVD,0)-1			Endif						Vline_slicex1[]=dimoffset(mat3dkVD,0)+indexfirst*dimdelta(mat3dkVD,0)			Vline_slicex2[]=dimoffset(mat3dkVD,0)+indexlast*dimdelta(mat3dkVD,0)			Vline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dkVD[i][p][q]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderV=Slidervalue	Endif		If(whichmat3d==6)		Make/O/N=(dimsize(mat3dkHD,1),dimsize(mat3dkHD,2)) imageforslicer		Setscale/P x,dimoffset(mat3dkHD,1),dimdelta(mat3dkHD,1),""imageforslicer		Setscale/P y,dimoffset(mat3dkHD,2),dimdelta(mat3dkHD,2),""imageforslicer			if(event %& 0x1)	// bit 0, value set			indexposition=Round((sliderValue-dimoffset(mat3dkHD,0))/dimdelta(mat3dkHD,0))			If(mod(numcombslicer,2)==1)				indexfirst=indexposition-Round((numcombslicer-1)/2)				Else					indexfirst=indexposition-Round(numcombslicer/2)			Endif			If(indexfirst<0)				indexfirst=0			Endif			If(mod(numcombslicer,2)==1)				indexlast=indexposition+Round((numcombslicer-1)/2)				Else					indexlast=indexposition+Round(numcombslicer/2)-1			Endif			If(indexlast>(dimsize(mat3dkHD,0)-1))				indexlast=dimsize(mat3dkHD,0)-1			Endif						Vline_slicex1[]=dimoffset(mat3dkHD,0)+indexfirst*dimdelta(mat3dkHD,0)			Vline_slicex2[]=dimoffset(mat3dkHD,0)+indexlast*dimdelta(mat3dkHD,0)			Vline_slice=sliderValue			imageforslicer[][]=0			num=0			i=indexfirst			Do				imageforslicer[][]+=mat3dkHD[i][p][q]				num+=1				i+=1			While(i<indexlast+1)			imageforslicer[][]/=num		endif		SliderV=Slidervalue	Endif					return 0End//********************************************************************************************************************************Proc openmat3dslicer()	PauseUpdate	Silent 1	Variable/G Hline_slice_min,Hline_slice_max,Hline_slice_delta	Variable/G Vline_slice_min,Vline_slice_max,Vline_slice_delta	Variable/G Vline_slice	Variable/G SliderV	Variable/G SliderH	Variable/G Hline_slice	Variable/G numcombslicer			If(Wintype("mat3d_slicer")==1)		Dowindow/F mat3d_slicer		Else			Make/O/N=2 Vline_slicey1			Make/O/N=2 Vline_slicex1			Make/O/N=2 Vline_slicey2			Make/O/N=2 Vline_slicex2			Hline_slice=0			Hline_slice_min=dimoffset(mat3d,2)			Hline_slice_max=dimoffset(mat3d,2)+dimdelta(mat3d,2)*(dimsize(mat3d,2)-1)			Hline_slice_delta=dimdelta(mat3d,2)			Vline_slicex1[]=(2*dimoffset(mat3d,0)+dimdelta(mat3d,0)*dimsize(mat3d,0))/2			Vline_slicey1[0]=dimoffset(mat3d,2)			Vline_slicey1[1]=dimoffset(mat3d,2)+dimdelta(mat3d,2)*dimsize(mat3d,2)					Vline_slicex2[]=(2*dimoffset(mat3d,0)+dimdelta(mat3d,0)*dimsize(mat3d,0))/2			Vline_slicey2[0]=dimoffset(mat3d,2)			Vline_slicey2[1]=dimoffset(mat3d,2)+dimdelta(mat3d,2)*dimsize(mat3d,2)					Vline_slice=0			Vline_slice_min=dimoffset(mat3d,0)			Vline_slice_max=dimoffset(mat3d,0)+dimdelta(mat3d,0)*(dimsize(mat3d,0)-1)			SliderV=0			SliderH=0			Vline_slice_delta=dimdelta(mat3d,0)			Mat3d_slicer()			Set_Vline_slice_control()	EndifEnd	//********************************************************************************************************************************Proc Set_numcombslicer()	PauseUpdate	Silent 1	Variable/G numcombslicer		Variable/G whichmat3d	Variable/G VvsHline	string matname	If(whichmat3d==1)		matname="mat3d"	Endif		If(whichmat3d==2)		matname="mat3dVD"	Endif		If(whichmat3d==3)		matname="mat3dHd"	Endif		If(whichmat3d==4)		matname="mat3dk"	Endif		If(whichmat3d==5)		matname="mat3dkVD"	Endif		If(whichmat3d==6)		matname="mat3dkHD"	Endif	IF(VvsHline==2)		Setvariable setvarnumcomb,limits={1,dimsize($matname,0),1},value=numcombslicer	Endif	IF((whichmat3d>3)&&(VvsHline==1))		Setvariable setvarnumcomb,limits={1,dimsize($matname,1),1},value=numcombslicer	Endif	IF((whichmat3d<4)&&(VvsHline==1))		Setvariable setvarnumcomb,limits={1,dimsize($matname,2),1},value=numcombslicer	Endif	End	//********************************************************************************************************************************Proc Set_Hline_slice_control()	PauseUpdate	Silent 1	Variable central_index	If(whichmat3d<4)		Hline_slice_max=dimoffset(mat3d,2)+dimdelta(mat3d,2)*(dimsize(mat3d,2)-1)		Hline_slice_min=dimoffset(mat3d,2)		Hline_slice_delta=dimdelta(mat3d,2)		Else			Hline_slice_max=dimoffset(mat3dk,1)+dimdelta(mat3dk,1)*(dimsize(mat3dk,1)-1)			Hline_slice_min=dimoffset(mat3dk,1)			Hline_slice_delta=dimdelta(mat3dk,1)	Endif	central_index=Round((Hline_slice_max-Hline_slice_min)/(2*Hline_slice_delta))	Slider slider0,limits={Hline_slice_min,Hline_slice_max,Hline_slice_delta},value= Hline_slice_min+central_index*Hline_slice_deltaEnd	//********************************************************************************************************************************Proc Set_Vline_slice_control()	PauseUpdate	Silent 1	Variable central_index	If(whichmat3d<4)		Vline_slice_max=dimoffset(mat3d,0)+dimdelta(mat3d,0)*(dimsize(mat3d,0)-1)		Vline_slice_min=dimoffset(mat3d,0)		Vline_slice_delta=dimdelta(mat3d,0)		Else			Vline_slice_max=dimoffset(mat3dk,0)+dimdelta(mat3dk,0)*(dimsize(mat3dk,0)-1)			Vline_slice_min=dimoffset(mat3dk,0)			Vline_slice_delta=dimdelta(mat3dk,0)	Endif	central_index=Round((Vline_slice_max-Vline_slice_min)/(2*Vline_slice_delta))	Slider slider1,limits={Vline_slice_min,Vline_slice_max,Vline_slice_delta},value= Vline_slice_min+central_index*Vline_slice_deltaEnd	//********************************************************************************************************************************	proc AppendtoCutFromMat(oldmat,newmat,startp,endp)		string oldmat,newmat	variable startp,endp//	String oldmat,newmat	PauseUpdate	Silent 1	Variable i,num,mm	mm=Dimsize($newmat,0)	num=endp-startp+1	InsertPoints mm,num, $newmat	$newmat[mm,mm+num][]=$oldmat[p-mm+startp][q]	EndFunction PopMenuProc_MatrixName(ctrlName,popNum,popStr) //: PopopMenuControl	String ctrlName	Variable popNum	String  popStr	SVAR gv_MatName	gv_MatName=popStrEndProc MakeCutImage(phi)	variable phi	prompt phi,"input the phi angle"		pauseupdate	silent 1	 variable i,j,totalnum,p,newstart,kj	 totalnum=dimsize(imagephi,0)	 make/o/n=0 tempindex	 i=0	p=0		variable dim		dim=dimsize(imagephi,0)	 	 	Make/O/N=0 Posi		i=0		p=0		Do			If(imagephi[i]==phi)				InsertPoints p,1,Posi			//	InsertPoints [/M=dim ] beforeElement, numElements, waveName [, waveName ]...				Posi[p]=i				p+=1			Endif			i+=1		While(i<dim)	Variable ystart,ydelta,ysize,xstart,xdelta,xsize	string matname,newmat	matname="data"+num2str(imageindex[posi[0]])	newmat="cut"+num2str(phi)	ystart=dimoffset($matname,1)	ysize=dimsize($matname,1)	ydelta=dimdelta($matname,1)	xstart=dimoffset($matname,0)	xsize=dimsize($matname,0)	xdelta=dimdelta($matname,0)	i=posi[0]	print xstart	newstart=xstart+imagetheta[i]+xdelta*wavest[i]	print newstart	make/o/n=(0,ysize) $newmat	setscale/p y,ystart,ydelta,""$newmat	setscale/p x,newstart,xdelta,"",$newmat	dim=dimsize(posi,0)	i=0	do		p=posi[i]		matname="data"+num2str(imageindex[posi[i]])		appendtocutfrommat(matname,newmat,wavest[p],waveed[p])		i+=1	while(i<dim)//	 show2dimage(newmat)End///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Begining of Pierre's macros//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////********************************************************************************************************************************Proc mat3d_pi()//scaling)//	Variable scaling//        Prompt scaling,"Did you already rescaled the energy?",popup "Yes;No"		PauseUpdate	Silent 1	Variable/G SRC_vs_BNL	Variable num_of_phi,delta_phi,first_phi,temp_delta_phi,last_phi,total_phi	Variable total_theta,delta_theta,first_theta,last_theta,first_temp,last_temp	Variable energy_0,delta_energy,total_energy,last_energy	Variable i,j,k,j_index,i_start	Variable phi	String cutname//	If(scalling==1)//		Execute energy_ajust_pi()//	Endif	//Find the smallest separation in Phi, the first and the last phi		first_phi=Phiindex[0]	num_of_phi=dimsize(Phiindex,0)	last_phi=Phiindex[num_of_phi-1]	delta_phi=9999	i=1	Do		temp_delta_phi=Phiindex[i]-Phiindex[i-1]		If(temp_delta_phi<delta_phi)			delta_phi=temp_delta_phi		Endif		i+=1	While(i<num_of_phi)	total_phi=floor((last_phi-first_phi)/delta_phi+1)	//Find the smallest separation in theta, the first and the last theta	last_theta=-9999	i=0	cutname="cut"+num2str(phiindex[0])		first_theta=dimoffset($cutname,0)	delta_theta=dimdelta($cutname,0)	Do		cutname="cut"+num2str(phiindex[i])		first_temp=dimoffset($cutname,0)		last_temp=first_temp+(dimsize($cutname,0)-1)*delta_theta		If(first_temp<first_theta)			first_theta=first_temp		Endif		If(last_temp>last_theta)			last_theta=last_temp		Endif		i+=1		While(i<num_of_phi)	total_theta=floor((last_theta-first_theta)/delta_theta+1)	//Find the scalling for the energy	delta_energy=dimdelta($cutname,1)	i=0	cutname="cut"+num2str(phiindex[0])	energy_0=dimoffset($cutname,1)	last_energy=-9999	Do		cutname="cut"+num2str(phiindex[i])		first_temp=dimoffset($cutname,1)		last_temp=first_temp+(dimsize($cutname,1)-1)*delta_energy		If(first_temp<energy_0)			energy_0=first_temp		Endif		If(last_temp>last_energy)			last_energy=last_temp		Endif		i+=1		While(i<dimoffset($cutname,1))	total_energy=floor((last_energy-energy_0)/delta_energy+1)	//	energy_0=dimoffset($cutname,1)//	total_energy=dimsize($cutname,1)//	delta_energy=dimdelta($cutname,1)	//Copying the matrix elements	If(SRC_vs_BNL==0)		Make/O/N=(total_theta,total_energy,total_phi) mat3d		setscale/p x,first_theta,delta_theta,"", mat3d		setscale/p z,first_phi,delta_phi,"",mat3d		setscale/p y,energy_0,delta_energy,"",mat3d		mat3d[][][]=0		j=0		j_index=0		Do			phi=first_phi+j*delta_phi			If(phi==phiindex[j_index])				cutname="cut"+num2str(phiindex[j_index])				first_temp=floor((dimoffset($cutname,1)-energy_0)/delta_energy)				i_start=floor((dimoffset($cutname,0)-first_theta)/delta_theta)				Make/O/N=(dimsize($cutname,0),total_energy) cut_temp				cut_temp[][]=0				i=0				Do					cut_temp[][i+first_temp]=$cutname[p][i]					i+=1				While(i<dimsize($cutname,1))				i=0				Do					mat3d[i+i_start][][j]=cut_temp[i][q]					i+=1				While(i<dimsize($cutname,0))				j_index+=1			Endif		j+=1		While(j<total_phi)	Endif	If(SRC_vs_BNL==1)		Make/O/N=(total_phi,total_energy,total_theta) mat3d		setscale/p z,first_theta,delta_theta,"", mat3d		setscale/p x,first_phi,delta_phi,"",mat3d		setscale/p y,energy_0,delta_energy,"",mat3d		mat3d[][][]=0		j=0		j_index=0		Do			phi=first_phi+j*delta_phi			If(phi==phiindex[j_index])				cutname="cut"+num2str(phiindex[j_index])				first_temp=floor((dimoffset($cutname,1)-energy_0)/delta_energy)				i_start=floor((dimoffset($cutname,0)-first_theta)/delta_theta)				Make/O/N=(dimsize($cutname,0),total_energy) cut_temp				cut_temp[][]=0				i=0				Do					cut_temp[][i+first_temp]=$cutname[p][i]					i+=1				While(i<dimsize($cutname,1))				i=0				Do					mat3d[j][][i+i_start]=cut_temp[i][q]					i+=1				While(i<dimsize($cutname,0))				j_index+=1			Endif		j+=1		While(j<total_phi)	Endif			Killwaves cut_tempEnd//********************************************************************************************************************************Proc mat3dVD_pi(num,box)//Use mat3d	variable num,box	prompt num,"How many times to be smoothed"	prompt box,"Input the box width"	PauseUpdate	Silent 1	Variable i,j	Duplicate/O Mat3d Mat3dVD	Mat3dVD[][][]=0	func_mat3dVD_pi(mat3d,mat3dVD,num,box)End//********************************************************************************************************************************Function func_mat3dVD_pi(mat3d,mat3dVD,num,box)	Wave mat3d	Wave mat3dVD	variable num,box	Variable i,j	j=0	Do		i=0		Do			Make/O/N=(dimsize(mat3d,1)) tempwave			Setscale/P x,dimoffset(mat3d,1),dimdelta(mat3d,1),""tempwave			tempwave[]=mat3d[i][p][j]			Smooth/E=3/B=(num) box,tempwave						differentiate tempwave			Smooth/E=3/B=(num) box,tempwave				differentiate tempwave			mat3dVD[i][][j]=tempwave[q]									i+=1		While(i<dimsize(mat3d,0))		j+=1	While(j<dimsize(mat3d,2))End//********************************************************************************************************************************Proc mat3dVC_pi(num,box,factor)//Use mat3d	variable num=7	Variable box=7	Variable factor=0.1	prompt num,"How many times to be smoothed"	prompt box,"Input the box width"	prompt factor,"Curvature factor"	PauseUpdate	Silent 1	Variable i,j	Duplicate/O Mat3d Mat3dVD	Mat3dVD[][][]=0	func_mat3dVC_pi(mat3d,mat3dVD,num,box,factor)End//********************************************************************************************************************************Function func_mat3dVC_pi(mat3d,mat3dVD,num,box,factor)	Wave mat3d	Wave mat3dVD	variable num,box,factor	PauseUpdate	Silent 1	Variable j	j=0	Do		Make/O/N=(dimsize(mat3d,0),dimsize(mat3d,1)) sectionmat		Setscale/P x,dimoffset(mat3d,0),dimdelta(mat3d,0),""sectionmat		Setscale/P y,dimoffset(mat3d,1),dimdelta(mat3d,1),""sectionmat		sectionmat[][]=mat3d[p][q][j]		duplicate/O sectionmat returnmat		curvature4mat3d(sectionmat,returnmat,num,box,1,factor)		mat3dVD[][][j]=returnmat[p][q]				j+=1	While(j<dimsize(mat3d,2))	killwaves sectionmat,returnmatEnd//********************************************************************************************************************************Proc mat3dHC_pi(num,box,factor)//Use mat3d	variable num=7	Variable box=7	Variable factor=0.1	prompt num,"How many times to be smoothed"	prompt box,"Input the box width"	prompt factor,"Curvature factor"	PauseUpdate	Silent 1	Variable/G SRC_vs_BNL	Variable slitorientation 	Duplicate/O Mat3d Mat3dHD	Mat3dHD[][][]=0	slitorientation=SRC_vs_BNL	func_mat3dHC_pi(mat3d,mat3dHD,num,box,factor,slitorientation)End//********************************************************************************************************************************Function func_mat3dHC_pi(mat3d,mat3dHD,num,box,factor,slitorientation)	Wave mat3d	Wave mat3dHD	variable num,box,factor,slitorientation	PauseUpdate	Silent 1	Variable j	IF(slitorientation==1)  //Vertical slit		j=0		Do			Make/O/N=(dimsize(mat3d,2),dimsize(mat3d,1)) sectionmat			Setscale/P x,dimoffset(mat3d,2),dimdelta(mat3d,2),""sectionmat			Setscale/P y,dimoffset(mat3d,1),dimdelta(mat3d,1),""sectionmat			sectionmat[][]=mat3d[j][q][p]			duplicate/O sectionmat returnmat			curvature4mat3d(sectionmat,returnmat,num,box,2,factor)			mat3dHD[j][][]=returnmat[r][q]					j+=1		While(j<dimsize(mat3d,0))		killwaves sectionmat,returnmat	Endif	IF(slitorientation==0)// Horizontal slit		j=0		Do			Make/O/N=(dimsize(mat3d,0),dimsize(mat3d,1)) sectionmat			Setscale/P x,dimoffset(mat3d,0),dimdelta(mat3d,0),""sectionmat			Setscale/P y,dimoffset(mat3d,1),dimdelta(mat3d,1),""sectionmat			sectionmat[][]=mat3d[p][q][j]			duplicate/O sectionmat returnmat			curvature4mat3d(sectionmat,returnmat,num,box,2,factor)			mat3dHD[][][j]=returnmat[p][q]					j+=1		While(j<dimsize(mat3d,2))		killwaves sectionmat,returnmat	EndifEnd//********************************************************************************************************************************Function curvature4mat3d(mat,matcurv,num,box,choice,factor) //curvature. 1 is EDC, 2 is MDC	wave mat	wave matcurv	variable num,box,choice,factor	variable avg,avgv,avgh	if(choice==1)		duplicate/o mat diff1maty,diff2maty		DM1(mat,diff1maty,num,box,1)		DM1(diff1maty,diff2maty,num,box,1)		avg=abs(wavemin(diff1maty))		matcurv=diff2maty/(avg*avg*factor+diff1maty*diff1maty)^1.5		killwaves diff1maty,diff2maty	endif	if(choice==2)		duplicate/o mat diff1matx,diff2matx		DM1(mat,diff1matx,num,box,2)		DM1(diff1matx,diff2matx,num,box,2)		avg=abs(wavemin(diff1matx))		matcurv=diff2matx/(avg*avg*factor+diff1matx*diff1matx)^1.5		killwaves diff1matx,diff2matx			endifend//********************************************************************************************************************************Proc Get_ledge_kf(numedc,fermi_level,search_halfwindow,method,smoothlevel,backgnd_type,num_back,neworold)	Variable numedc=5	Variable fermi_level=0	Variable search_halfwindow=0.1	variable method	VAriable smoothlevel=-1	Variable backgnd_type	Variable num_back	Variable neworold	Prompt numedc,"Number of EDC to combine (odd):"	Prompt fermi_level,"Fermi level:"	Prompt search_halfwindow,"Enter the half window size:"	Prompt method,"Method",popup "Simple;Lorenztian;Gaussian"	Prompt smoothlevel,"Smoothlevel (-1=no smoothing):"	Prompt backgnd_type,"Type of background",popup "Linear;None"	Prompt num_back,"Points for background fitting"	Prompt neworold,"",popup "EXACT;APPROX"					PauseUpdate	Silent 1	String list_of_the_traces,thistrace,thiscut	String thisNTPwave	Variable Condition_NTP	Variable i,j,index	Variable angle_position	//calculates the angle vector	update_making_fs()	PutonsameXcorner(kx_final,ky_final)	Make/O/N=(dimsize(waveforXcorner,0),0) vecx	Make/O/N=(dimsize(waveforXcorner,0),0) vecy	vecx[]=waveforXcorner[p][0]	vecy[]=waveforXcorner[p][1]	Killwaves waveforXcorner	Putkfin1zone(vecx,vecy)	vecx[]=wavein1zone[p][0]	vecy[]=wavein1zone[p][1]	Killwaves wavein1zone	Putinsameoctant(vecx,vecy)	vecx[]=waveinoctant[p][0]	vecy[]=waveinoctant[p][1]	Killwaves waveinoctant	Duplicate/O vecx angleinoctant	angleinoctant=Calcangleinoctant(vecx,vecy)	//Check if the window is there and creates it	IF(wintype("leading_edge_atkf")==0)		Display		Dowindow/C leading_edge_atkf		Else			Dowindow/F leading_edge_atkf			list_of_the_traces=TraceNameList("leading_edge_atkf",";", 1 )			i=0			Do				thistrace=stringfromlist(i,list_of_the_traces,";")				removefromgraph $thistrace				i+=1			While(i<ItemsInList(list_of_the_traces,";"))	Endif	//Calculates the leading edge	thisNTPwave="NTP"+num2str(NTP_num)	If(neworold==2)		If(NTP_num>0)			Make/O/N=(dimsize(original_theta,0)-dimsize($thisNTPwave,0)) leading_edge_gap_kf			Make/O/N=(dimsize(original_theta,0)-dimsize($thisNTPwave,0)) leading_edge_gap_error				Make/O/N=(dimsize(original_theta,0)-dimsize($thisNTPwave,0)) angle_leading_edge_gap_kf			Else				Make/O/N=(dimsize(original_theta,0)) leading_edge_gap_kf				Make/O/N=(dimsize(original_theta,0)) leading_edge_gap_error					Make/O/N=(dimsize(original_theta,0)) angle_leading_edge_gap_kf		Endif	Endif	If(neworold==1)		If(NTP_num>0)			Make/O/N=(dimsize(original_rtheta,0)-dimsize($thisNTPwave,0)) leading_edge_gap_kf			Make/O/N=(dimsize(original_rtheta,0)-dimsize($thisNTPwave,0)) leading_edge_gap_error				Make/O/N=(dimsize(original_rtheta,0)-dimsize($thisNTPwave,0)) angle_leading_edge_gap_kf			Else				Make/O/N=(dimsize(original_rtheta,0)) leading_edge_gap_kf				Make/O/N=(dimsize(original_rtheta,0)) leading_edge_gap_error					Make/O/N=(dimsize(original_rtheta,0)) angle_leading_edge_gap_kf		Endif	Endif		leading_edge_gap_kf[]=0	leading_edge_gap_error[]=0	angle_leading_edge_gap_kf[]=0		index=0	j=0	Do		If(NTP_num>0)				Condition_NTP=checkNTP($thisNTPwave,j)			Else				Condition_NTP=1		Endif		If(Condition_NTP==1)				If(src_vs_bnl==1)				IF(neworold==2)					thiscut="cut"+num2str(original_theta[j])					angle_position=Round((original_phi[j]-dimoffset($thiscut,0))/dimdelta($thiscut,0))				Endif				IF(neworold==1)					thiscut="data"+num2str(original_data[j])					angle_position=original_slice[j]				Endif									Else					IF(neworold==2)						thiscut="cut"+num2str(original_phi[j])						angle_position=Round((original_theta[j]-dimoffset($thiscut,0))/dimdelta($thiscut,0))						Endif					IF(neworold==1)						thiscut="data"+num2str(original_data[j])						angle_position=original_slice[j]					Endif																	Endif			Make/O/N=(dimsize($thiscut,1)) tempwave1			Setscale/P x,dimoffset($thiscut,1),dimdelta($thiscut,1),""tempwave1			i=angle_position-Round((numedc-1)/2)			tempwave1[]=0			Do				tempwave1[]+=$thiscut[i][p]				i+=1			While(	i<angle_position+Round((numedc-1)/2)+1)			tempwave1[]/=numedc			If(backgnd_type==1)				Remove_simplebgnd_edc("tempwave1",2,num_back)					Endif					leading_edge_gap_kf[index]=1000*Func_Get_ledge_edc(tempwave1,fermi_level,search_halfwindow,method,smoothlevel)			angle_leading_edge_gap_kf[index]=angleinoctant[j]			IF(method==0)				leading_edge_gap_error[index]=1000*dimdelta(tempwave1,0)				Else						leading_edge_gap_error[index]=1000*W_sigma[2]			Endif			index+=1		Endif		j+=1	While(j<dimsize(original_theta,0))	Appendtograph leading_edge_gap_kf	vs angle_leading_edge_gap_kf	ErrorBars leading_edge_gap_kf Y,wave=(leading_edge_gap_error,leading_edge_gap_error)	ModifyGraph mode=3,marker=19		Label left "\\Z16\\F'arial'Leading Edge Gap (meV)"	Label bottom "\\Z16\\F'arial'Angle (degrees)"	ModifyGraph tick=2,mirror=1,manTick(bottom)={0,10,0,0},manMinor(bottom)={4,0};DelayUpdate	SetAxis bottom 0,45		Killwaves tempwave1,angleinoctantEnd//********************************************************************************************************************************Function Func_Get_ledge_edc(edcname,fermi_level,search_halfwindow,which_way,smoothlevel)	Wave edcname	Variable fermi_level	Variable search_halfwindow	Variable which_way	Variable smoothlevel	PauseUpdate	Silent 1	variable leading_edge_value	Duplicate/O edcname tempwave	IF(smoothlevel>0)		Smooth/E=3/B=(smoothlevel) smoothlevel, tempwave	Endif	Differentiate tempwave	IF(smoothlevel>0)		Smooth/E=3/B=(smoothlevel) smoothlevel, tempwave	Endif	If(fermi_level+search_halfwindow>((dimsize(edcname,0)-1)*dimdelta(edcname,0)+dimoffset(edcname,0)))		Wavestats/Q/R=(fermi_level-search_halfwindow,(dimsize(edcname,0)-1)*dimdelta(edcname,0)+dimoffset(edcname,0)) tempwave		Else			Wavestats/Q/R=(fermi_level-search_halfwindow,fermi_level+search_halfwindow) tempwave	Endif	If(which_way==1)				leading_edge_value=(fermi_level-V_minloc)	Endif	If(which_way==2)		Make/O/N=4 namecoeff		namecoeff[1]=(V_min-V_max)/sqrt(search_halfwindow/4)		namecoeff[3]=sqrt(search_halfwindow/4)		namecoeff[2]=V_minloc		namecoeff[0]=V_max		CurveFit/Q/NTHR=0 lor kwCWave=namecoeff  tempwave[x2pnt(tempwave,V_minloc-search_halfwindow/2),x2pnt(tempwave,V_minloc+search_halfwindow/2)] /D //TBOX=0 		leading_edge_value=fermi_level-namecoeff[2]	Endif	If(which_way==3)		Make/O/N=4 namecoeff		namecoeff[1]=(V_min-V_max)		namecoeff[3]=sqrt(search_halfwindow/4)		namecoeff[2]=V_minloc		namecoeff[0]=V_max		CurveFit/Q/NTHR=0 gauss kwCWave=namecoeff  tempwave[x2pnt(tempwave,V_minloc-search_halfwindow/2),x2pnt(tempwave,V_minloc+search_halfwindow/2)] /D //TBOX=0 		leading_edge_value=fermi_level-namecoeff[2]	Endif										Killwaves tempwave	Return leading_edge_valueEnd//********************************************************************************************************************************Function Calcangleinoctant(waveforx,wavefory)//Calculate the angle along FS with respect to M-X (antinode line)  Note: in degrees	Wave waveforx	Wave wavefory	PauseUpdate	Silent 1	variable i	Make/O/N=(dimsize(waveforx,0),1) resultingwave	resultingwave[]=0	i=0	Do		resultingwave[i]=(atan2(1-wavefory[i],1-waveforx[i]))*180/pi		i+=1	While(i<dimsize(waveforx,0))	return resultingwaveEnd//********************************************************************************************************************************Function Putinsameoctant(waveforx,wavefory)//moves all the points of the 1st zone of the same X-Centered Fermi surface in the same octant	Wave waveforx	Wave wavefory	PauseUpdate	Silent 1	variable i	Make/O/N=(dimsize(waveforx,0),2) waveinoctant	waveinoctant[][]=0	i=0	Do		If(waveforx[i]<=wavefory[i])			waveinoctant[i][0]=waveforx[i]			waveinoctant[i][1]=wavefory[i]			Else				waveinoctant[i][0]=wavefory[i]				waveinoctant[i][1]=waveforx[i]													Endif			i+=1	While(i<dimsize(waveforx,0))	return waveinoctantEnd//********************************************************************************************************************************Function Putkfin1zone(waveforx,wavefory)//moves all the points of the same X-Centered Fermi surface inside the first zone	Wave waveforx	Wave wavefory	PauseUpdate	Silent 1	variable i	Make/O/N=(dimsize(waveforx,0),2) wavein1zone	wavein1zone[][]=0	i=0	Do		If((waveforx[i]>=0)&&(waveforx[i]<=1)&&(wavefory[i]>=0)&&(wavefory[i]<=1))			wavein1zone[i][0]=waveforx[i]			wavein1zone[i][1]=wavefory[i]					Endif			If((waveforx[i]>=1)&&(waveforx[i]<=2)&&(wavefory[i]>=0)&&(wavefory[i]<=1))			wavein1zone[i][0]=2-waveforx[i]			wavein1zone[i][1]=wavefory[i]								Endif		If((waveforx[i]>=1)&&(waveforx[i]<=2)&&(wavefory[i]>=1)&&(wavefory[i]<=2))			wavein1zone[i][0]=2-waveforx[i]			wavein1zone[i][1]=2-wavefory[i]								Endif		If((waveforx[i]>=0)&&(waveforx[i]<=1)&&(wavefory[i]>=1)&&(wavefory[i]<=2))   			wavein1zone[i][0]=waveforx[i]			wavein1zone[i][1]=2-wavefory[i]											Endif		i+=1	While(i<dimsize(waveforx,0))	return wavein1zoneEnd//********************************************************************************************************************************Function PutonsameXcorner(waveforx,wavefory)//translates all the points to the same X-Centered Fermi surface	Wave waveforx	Wave wavefory	PauseUpdate	Silent 1	variable i	Make/O/N=(dimsize(waveforx,0),2) waveforXcorner	waveforXcorner[][]=0	i=0	Do		If((waveforx[i]>=0)&&(waveforx[i]<=2)&&(wavefory[i]>=0)&&(wavefory[i]<=2))			waveforXcorner[i][0]=waveforx[i]			waveforXcorner[i][1]=wavefory[i]					Endif			If((waveforx[i]>=-2)&&(waveforx[i]<=0)&&(wavefory[i]>=0)&&(wavefory[i]<=2))			waveforXcorner[i][0]=waveforx[i]+2			waveforXcorner[i][1]=wavefory[i]								Endif		If((waveforx[i]>=-2)&&(waveforx[i]<=0)&&(wavefory[i]>=-2)&&(wavefory[i]<=0))			waveforXcorner[i][0]=waveforx[i]+2			waveforXcorner[i][1]=wavefory[i]+2								Endif		If((waveforx[i]>=0)&&(waveforx[i]<=2)&&(wavefory[i]>=-2)&&(wavefory[i]<=0))      //zone 4			waveforXcorner[i][0]=waveforx[i]			waveforXcorner[i][1]=wavefory[i]+2											Endif		If((waveforx[i]>=2)&&(waveforx[i]<=4)&&(wavefory[i]>=-2)&&(wavefory[i]<=0))  //zone5			waveforXcorner[i][0]=waveforx[i]-2			waveforXcorner[i][1]=wavefory[i]+2					Endif			If((waveforx[i]>=2)&&(waveforx[i]<=4)&&(wavefory[i]>=0)&&(wavefory[i]<=2)) //zone6			waveforXcorner[i][0]=waveforx[i]-2			waveforXcorner[i][1]=wavefory[i]					Endif			If((waveforx[i]>=2)&&(waveforx[i]<=4)&&(wavefory[i]>=2)&&(wavefory[i]<=4)) //zone7			waveforXcorner[i][0]=waveforx[i]-2			waveforXcorner[i][1]=wavefory[i]-2					Endif			If((waveforx[i]>=0)&&(waveforx[i]<=2)&&(wavefory[i]>=2)&&(wavefory[i]<=4)) //zone8			waveforXcorner[i][0]=waveforx[i]			waveforXcorner[i][1]=wavefory[i]-2					Endif			If((waveforx[i]>=-2)&&(waveforx[i]<=0)&&(wavefory[i]>=2)&&(wavefory[i]<=4)) //zone9			waveforXcorner[i][0]=waveforx[i]+2			waveforXcorner[i][1]=wavefory[i]-2					Endif						If((waveforx[i]>=-4)&&(waveforx[i]<=-2)&&(wavefory[i]>=2)&&(wavefory[i]<=4)) //zone10			waveforXcorner[i][0]=waveforx[i]+4			waveforXcorner[i][1]=wavefory[i]-2					Endif						If((waveforx[i]>=-4)&&(waveforx[i]<=-2)&&(wavefory[i]>=0)&&(wavefory[i]<=2)) //zone11			waveforXcorner[i][0]=waveforx[i]+4			waveforXcorner[i][1]=wavefory[i]				Endif						If((waveforx[i]>=-4)&&(waveforx[i]<=-2)&&(wavefory[i]>=-2)&&(wavefory[i]<=0)) //zone12			waveforXcorner[i][0]=waveforx[i]+4			waveforXcorner[i][1]=wavefory[i]+2				Endif						If((waveforx[i]>=-4)&&(waveforx[i]<=-2)&&(wavefory[i]>=-4)&&(wavefory[i]<=-2)) //zone13			waveforXcorner[i][0]=waveforx[i]+4			waveforXcorner[i][1]=wavefory[i]+4				Endif						If((waveforx[i]>=-2)&&(waveforx[i]<=0)&&(wavefory[i]>=-4)&&(wavefory[i]<=-2)) //zone14			waveforXcorner[i][0]=waveforx[i]+2			waveforXcorner[i][1]=wavefory[i]+4				Endif						If((waveforx[i]>=0)&&(waveforx[i]<=2)&&(wavefory[i]>=-4)&&(wavefory[i]<=-2)) //zone15			waveforXcorner[i][0]=waveforx[i]			waveforXcorner[i][1]=wavefory[i]+4				Endif						If((waveforx[i]>=2)&&(waveforx[i]<=4)&&(wavefory[i]>=-4)&&(wavefory[i]<=-2)) //zone16			waveforXcorner[i][0]=waveforx[i]-2			waveforXcorner[i][1]=wavefory[i]+4				Endif						i+=1	While(i<dimsize(waveforx,0))	return waveforXcornerEnd//********************************************************************************************************************************Proc mat3dk_pi(offset_theta,offset_phi,fermi_level)//Use mat3d	Variable offset_theta	Variable offset_phi	Variable fermi_level	Prompt offset_theta,"Enter the theta value to add:"	Prompt offset_theta,"Enter the theta value to add:"	Prompt fermi_level,"Enter the Fermi level:"	PauseUpdate	Silent 1	Variable ktheta_min,ktheta_max,delta_ktheta,number_of_ktheta	Variable kphi_min,kphi_max,delta_kphi,number_of_kphi	Variable iktheta,ikphi	Variable KE,sqrtKE,ktheta,kphi	Variable theta,phi,phi_min,phi_max,theta_min,theta_max	Variable i,j	Variable factor_src_bnl1,factor_src_bnl2	Variable/G SRC_vs_BNL	If(SRC_vs_BNL==0)		factor_src_bnl1=1.2		factor_src_bnl2=1.6		Else		factor_src_bnl1=1.6		factor_src_bnl2=1.2				Endif	//Find the k-limits of the new matrix and creating mat3dk	ktheta_min=0.51231*sqrt(dimoffset(mat3d,1)+(dimsize(mat3d,1)-1)*dimdelta(mat3d,1))*sin((dimoffset(mat3d,0)+offset_theta)*Pi/180)	ktheta_max=0.51231*sqrt(dimoffset(mat3d,1)+(dimsize(mat3d,1)-1)*dimdelta(mat3d,1))*sin((dimoffset(mat3d,0)+(dimsize(mat3d,0)-1)*dimdelta(mat3d,0)+offset_theta)*Pi/180)	number_of_ktheta=Round(dimsize(mat3d,0)*factor_src_bnl1)	delta_ktheta=(ktheta_max-ktheta_min)/(number_of_ktheta-1)	Make/O/N=(dimsize(mat3d,0)) tempwavephi	tempwavephi[]=0.51231*sqrt(dimoffset(mat3d,1)+(dimsize(mat3d,1)-1)*dimdelta(mat3d,1))*cos((dimoffset(mat3d,0)+offset_theta+p*dimdelta(mat3d,0))*pi/180)*sin((dimoffset(mat3d,2)+offset_phi)*Pi/180)		wavestats/Q tempwavephi	Duplicate/O tempwavephi banane1	kphi_min=V_min	Make/O/N=(dimsize(mat3d,0)) tempwavephi	tempwavephi[]=0.51231*sqrt(dimoffset(mat3d,1)+(dimsize(mat3d,1)-1)*dimdelta(mat3d,1))*cos((dimoffset(mat3d,0)+offset_theta+p*dimdelta(mat3d,0))*pi/180)*sin((dimoffset(mat3d,2)+offset_phi+(dimsize(mat3d,2)-1)*dimdelta(mat3d,2))*Pi/180)		wavestats/Q tempwavephi	kphi_max=V_max		killwaves tempwavephi	//	kphi_min=0.51231*sqrt(dimoffset(mat3d,1)+(dimsize(mat3d,1)-1)*dimdelta(mat3d,1))*sin((dimoffset(mat3d,2)+offset_phi)*Pi/180)//	kphi_max=0.51231*sqrt(dimoffset(mat3d,1)+(dimsize(mat3d,1)-1)*dimdelta(mat3d,1))*sin((dimoffset(mat3d,2)+(dimsize(mat3d,2)-1)*dimdelta(mat3d,2)+offset_phi)*Pi/180)	number_of_kphi=Round(dimsize(mat3d,2)*factor_src_bnl2)	delta_kphi=(kphi_max-kphi_min)/(number_of_kphi-1)	Make/O/N=(number_of_ktheta,number_of_kphi,dimsize(mat3d,1)) mat3dk	Setscale/P x,ktheta_min,delta_ktheta,""mat3dk	Setscale/P y,kphi_min,delta_kphi,""mat3dk	Setscale/P z,dimoffset(mat3d,1)-fermi_level,dimdelta(mat3d,1),""mat3dk	phi_min=dimoffset(mat3d,2)+offset_phi	phi_max=dimoffset(mat3d,2)+offset_phi+dimdelta(mat3d,2)*(dimsize(mat3d,2)-1)	theta_min=dimoffset(mat3d,0)+offset_theta	theta_max=dimoffset(mat3d,0)+offset_theta+dimdelta(mat3d,0)*(dimsize(mat3d,0)-1)		//Calculating the matrix elements	i=0	j=0	func_mat3dk_pi(mat3d,mat3dk,offset_theta,offset_phi,fermi_level,ktheta_min,delta_ktheta,ktheta_max,number_of_ktheta,kphi_min,kphi_max,delta_kphi,number_of_kphi,theta_min,theta_max,phi_min,phi_max,ktheta,kphi,iktheta,ikphi,i,j,theta,phi,KE,sqrtKE)End	//********************************************************************************************************************************	function func_mat3dk_pi1(mat3d,mat3dk,offset_theta,offset_phi,fermi_level,ktheta_min,delta_ktheta,ktheta_max,number_of_ktheta,kphi_min,kphi_max,delta_kphi,number_of_kphi,theta_min,theta_max,phi_min,phi_max,ktheta,kphi,iktheta,ikphi,i,j,theta,phi,KE,sqrtKE)//Use mat3d	Wave mat3d,mat3dk		Variable offset_theta	Variable offset_phi	Variable fermi_level	Variable ktheta_min,ktheta_max,delta_ktheta,number_of_ktheta	Variable kphi_min,kphi_max,delta_kphi,number_of_kphi	Variable phi_min,phi_max,theta_min,theta_max	Variable ktheta,kphi,iktheta,ikphi,i,j,theta,phi,KE,sqrtKE	Variable ie	ie=0	Do		if(mod(ie,20)==0)			print "Filling mat3d_k:",ie,"/",dimsize(mat3dk,2)-1		Endif		KE=dimoffset(mat3d,1)+ie*dimdelta(mat3d,1)		sqrtKE=sqrt(KE)		iktheta=0		Do			ktheta=ktheta_min+delta_ktheta*iktheta			theta=asin(ktheta/(0.51231*sqrtKE))*180/Pi //not an integer.			//creating a vecteur with theta fixed. Note: ktheta depends only on theta			Make/O/N=(dimsize(mat3d,0)) htempwave_x			Make/O/N=(dimsize(mat3d,0)) htempwave_y						Make/O/N=(dimsize(mat3d,2)) vtempwave			Make/O/N=(dimsize(mat3d,2)) vtempwave_x			htempwave_x[]=dimoffset(mat3d,0)+p*dimdelta(mat3d,0)+offset_theta						vtempwave_x[]=dimoffset(mat3d,2)+p*dimdelta(mat3d,2)+offset_phi			Setscale/P x,dimoffset(mat3d,2)+offset_phi,dimdelta(mat3d,2),""vtempwave			i=0			Do				htempwave_y[]=mat3d[p][ie][i]				vtempwave[i]=interp(theta,htempwave_x,htempwave_y)				i+=1			While(i<dimsize(mat3d,2))//			mat3dk[iktheta][][ie]=interp((asin((kphi_min+delta_kphi*q)/(0.51231*sqrtKE*cos(theta*PI/180))))*180/Pi,vtempwave_x,vtempwave)			ikphi=0			Do				kphi=dimoffset(mat3dk,1)+delta_kphi*ikphi				phi=asin(kphi/(0.51231*sqrtKE*cos(theta*Pi/180)))*180/Pi				if((phi>=phi_min)&&(phi<=phi_max)&&(theta>=theta_min)&&(theta<=theta_max))					mat3dk[iktheta][ikphi][ie]=interp(phi,vtempwave_x,vtempwave)					Else						mat3dk[iktheta][ikphi][ie]=0				Endif				ikphi+=1			While(ikphi<number_of_kphi)			iktheta+=1		While(iktheta<number_of_ktheta)		ie+=1	While(ie<dimsize(mat3dk,2))	Killwaves htempwave_x,htempwave_y,vtempwave,vtempwave_xEnd	//********************************************************************************************************************************	function func_mat3dk_pi(mat3d,mat3dk,offset_theta,offset_phi,fermi_level,ktheta_min,delta_ktheta,ktheta_max,number_of_ktheta,kphi_min,kphi_max,delta_kphi,number_of_kphi,theta_min,theta_max,phi_min,phi_max,ktheta,kphi,iktheta,ikphi,i,j,theta,phi,KE,sqrtKE)//Use mat3d	Wave mat3d,mat3dk		Variable offset_theta	Variable offset_phi	Variable fermi_level	Variable ktheta_min,ktheta_max,delta_ktheta,number_of_ktheta	Variable kphi_min,kphi_max,delta_kphi,number_of_kphi	Variable phi_min,phi_max,theta_min,theta_max	Variable ktheta,kphi,iktheta,ikphi,i,j,theta,phi,KE,sqrtKE	Variable ie	ie=0	Do		if(mod(ie,20)==0)			print "Filling mat3d_k:",ie,"/",dimsize(mat3dk,2)-1		Endif		KE=dimoffset(mat3d,1)+ie*dimdelta(mat3d,1)		sqrtKE=sqrt(KE)		Make/O/N=(dimsize(mat3d,0),dimsize(mat3d,2)) wave2d		Setscale/P x,dimoffset(mat3d,0)+offset_theta,dimdelta(mat3d,0),""wave2d		Setscale/P y,dimoffset(mat3d,2)+offset_phi,dimdelta(mat3d,2),""wave2d		wave2d[][]=mat3d[p][ie][q]				iktheta=0		Do			ktheta=ktheta_min+delta_ktheta*iktheta			theta=asin(ktheta/(0.51231*sqrtKE))*180/Pi //not an integer.			ikphi=0			Do				kphi=dimoffset(mat3dk,1)+delta_kphi*ikphi				phi=asin(kphi/(0.51231*sqrtKE*cos(theta*Pi/180)))*180/Pi				mat3dk[iktheta][ikphi][ie]=interp2d(wave2d,theta,phi)				ikphi+=1			While(ikphi<number_of_kphi)			iktheta+=1		While(iktheta<number_of_ktheta)		ie+=1	While(ie<dimsize(mat3dk,2))	Killwaves wave2dEnd			//********************************************************************************************************************************Proc mat3dkVD_pi(offset_theta,offset_phi,fermi_level)//Use mat3d	Variable offset_theta	Variable offset_phi	Variable fermi_level	Prompt offset_theta,"Enter the theta value to add:"	Prompt offset_theta,"Enter the theta value to add:"	Prompt fermi_level,"Enter the Fermi level:"	PauseUpdate	Silent 1	Variable ktheta_min,ktheta_max,delta_ktheta,number_of_ktheta	Variable kphi_min,kphi_max,delta_kphi,number_of_kphi	Variable iktheta,ikphi,ie	Variable KE,sqrtKE,ktheta,kphi	Variable theta,phi,phi_min,phi_max,theta_min,theta_max	Variable i,j	Variable factor_src_bnl1,factor_src_bnl2	Variable/G SRC_vs_BNL	If(SRC_vs_BNL==0)		factor_src_bnl1=1.2		factor_src_bnl2=1.6		Else		factor_src_bnl1=1.6		factor_src_bnl2=1.2				Endif		//Find the k-limits of the new matrix and creating mat3dkVD	ktheta_min=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,0)+offset_theta)*Pi/180)	ktheta_max=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,0)+(dimsize(mat3dVD,0)-1)*dimdelta(mat3dVD,0)+offset_theta)*Pi/180)	number_of_ktheta=Round(dimsize(mat3dVD,0)*factor_src_bnl1)	delta_ktheta=(ktheta_max-ktheta_min)/(number_of_ktheta-1)	ktheta_min=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,0)+offset_theta)*Pi/180)	ktheta_max=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,0)+(dimsize(mat3dVD,0)-1)*dimdelta(mat3dVD,0)+offset_theta)*Pi/180)	number_of_ktheta=Round(dimsize(mat3dVD,0)*factor_src_bnl1)	delta_ktheta=(ktheta_max-ktheta_min)/(number_of_ktheta-1)	Make/O/N=(dimsize(mat3dVD,0)) tempwavephi	tempwavephi[]=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*cos((dimoffset(mat3dVD,0)+offset_theta+p*dimdelta(mat3dVD,0))*pi/180)*sin((dimoffset(mat3dVD,2)+offset_phi)*Pi/180)		wavestats/Q tempwavephi	kphi_min=V_min	Make/O/N=(dimsize(mat3dVD,0)) tempwavephi	tempwavephi[]=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*cos((dimoffset(mat3dVD,0)+offset_theta+p*dimdelta(mat3dVD,0))*pi/180)*sin((dimoffset(mat3dVD,2)+offset_phi+(dimsize(mat3dVD,2)-1)*dimdelta(mat3dVD,2))*Pi/180)		wavestats/Q tempwavephi	kphi_max=V_max		killwaves tempwavephi	//	kphi_min=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,2)+offset_phi)*Pi/180)//	kphi_max=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,2)+(dimsize(mat3dVD,2)-1)*dimdelta(mat3dVD,2)+offset_phi)*Pi/180)	number_of_kphi=Round(dimsize(mat3dVD,2)*factor_src_bnl2)	delta_kphi=(kphi_max-kphi_min)/(number_of_kphi-1)	Make/O/N=(number_of_ktheta,number_of_kphi,dimsize(mat3dVD,1)) mat3dkVD	Setscale/P x,ktheta_min,delta_ktheta,""mat3dkVD	Setscale/P y,kphi_min,delta_kphi,""mat3dkVD	Setscale/P z,dimoffset(mat3dVD,1)-fermi_level,dimdelta(mat3dVD,1),""mat3dkVD	phi_min=dimoffset(mat3dVD,2)+offset_phi	phi_max=dimoffset(mat3dVD,2)+offset_phi+dimdelta(mat3dVD,2)*(dimsize(mat3dVD,2)-1)	theta_min=dimoffset(mat3dVD,0)+offset_theta	theta_max=dimoffset(mat3dVD,0)+offset_theta+dimdelta(mat3dVD,0)*(dimsize(mat3dVD,0)-1)		//Setting NAN points in mat3d to 0	//Calculating the matrix elements	i=0	j=0	func_mat3dk_pi(mat3dVD,mat3dkVD,offset_theta,offset_phi,fermi_level,ktheta_min,delta_ktheta,ktheta_max,number_of_ktheta,kphi_min,kphi_max,delta_kphi,number_of_kphi,theta_min,theta_max,phi_min,phi_max,ktheta,kphi,iktheta,ikphi,i,j,theta,phi,KE,sqrtKE)End	//********************************************************************************************************************************Proc mat3dkHD_pi(offset_theta,offset_phi,fermi_level)//Use mat3d	Variable offset_theta	Variable offset_phi	Variable fermi_level	Prompt offset_theta,"Enter the theta value to add:"	Prompt offset_theta,"Enter the theta value to add:"	Prompt fermi_level,"Enter the Fermi level:"	PauseUpdate	Silent 1	Variable ktheta_min,ktheta_max,delta_ktheta,number_of_ktheta	Variable kphi_min,kphi_max,delta_kphi,number_of_kphi	Variable iktheta,ikphi,ie	Variable KE,sqrtKE,ktheta,kphi	Variable theta,phi,phi_min,phi_max,theta_min,theta_max	Variable i,j	Variable factor_src_bnl1,factor_src_bnl2	Variable/G SRC_vs_BNL	If(SRC_vs_BNL==0)		factor_src_bnl1=1.2		factor_src_bnl2=1.6		Else		factor_src_bnl1=1.6		factor_src_bnl2=1.2				Endif		//Find the k-limits of the new matrix and creating mat3dkHD	ktheta_min=0.51231*sqrt(dimoffset(mat3dHD,1)+(dimsize(mat3dHD,1)-1)*dimdelta(mat3dHD,1))*sin((dimoffset(mat3dHD,0)+offset_theta)*Pi/180)	ktheta_max=0.51231*sqrt(dimoffset(mat3dHD,1)+(dimsize(mat3dHD,1)-1)*dimdelta(mat3dHD,1))*sin((dimoffset(mat3dHD,0)+(dimsize(mat3dHD,0)-1)*dimdelta(mat3dHD,0)+offset_theta)*Pi/180)	number_of_ktheta=Round(dimsize(mat3dHD,0)*factor_src_bnl1)	delta_ktheta=(ktheta_max-ktheta_min)/(number_of_ktheta-1)	ktheta_min=0.51231*sqrt(dimoffset(mat3dHD,1)+(dimsize(mat3dHD,1)-1)*dimdelta(mat3dHD,1))*sin((dimoffset(mat3dHD,0)+offset_theta)*Pi/180)	ktheta_max=0.51231*sqrt(dimoffset(mat3dHD,1)+(dimsize(mat3dHD,1)-1)*dimdelta(mat3dHD,1))*sin((dimoffset(mat3dHD,0)+(dimsize(mat3dHD,0)-1)*dimdelta(mat3dHD,0)+offset_theta)*Pi/180)	number_of_ktheta=Round(dimsize(mat3dHD,0)*factor_src_bnl1)	delta_ktheta=(ktheta_max-ktheta_min)/(number_of_ktheta-1)	Make/O/N=(dimsize(mat3dHD,0)) tempwavephi	tempwavephi[]=0.51231*sqrt(dimoffset(mat3dHD,1)+(dimsize(mat3dHD,1)-1)*dimdelta(mat3dHD,1))*cos((dimoffset(mat3dHD,0)+offset_theta+p*dimdelta(mat3dHD,0))*pi/180)*sin((dimoffset(mat3dHD,2)+offset_phi)*Pi/180)		wavestats/Q tempwavephi	kphi_min=V_min	Make/O/N=(dimsize(mat3dHD,0)) tempwavephi	tempwavephi[]=0.51231*sqrt(dimoffset(mat3dHD,1)+(dimsize(mat3dHD,1)-1)*dimdelta(mat3dHD,1))*cos((dimoffset(mat3dHD,0)+offset_theta+p*dimdelta(mat3dHD,0))*pi/180)*sin((dimoffset(mat3dHD,2)+offset_phi+(dimsize(mat3dHD,2)-1)*dimdelta(mat3dHD,2))*Pi/180)		wavestats/Q tempwavephi	kphi_max=V_max		killwaves tempwavephi	//	kphi_min=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,2)+offset_phi)*Pi/180)//	kphi_max=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,2)+(dimsize(mat3dVD,2)-1)*dimdelta(mat3dVD,2)+offset_phi)*Pi/180)	number_of_kphi=Round(dimsize(mat3dHD,2)*factor_src_bnl2)	delta_kphi=(kphi_max-kphi_min)/(number_of_kphi-1)	Make/O/N=(number_of_ktheta,number_of_kphi,dimsize(mat3dHD,1)) mat3dkHD	Setscale/P x,ktheta_min,delta_ktheta,""mat3dkHD	Setscale/P y,kphi_min,delta_kphi,""mat3dkHD	Setscale/P z,dimoffset(mat3dHD,1)-fermi_level,dimdelta(mat3dHD,1),""mat3dkHD	phi_min=dimoffset(mat3dHD,2)+offset_phi	phi_max=dimoffset(mat3dHD,2)+offset_phi+dimdelta(mat3dHD,2)*(dimsize(mat3dHD,2)-1)	theta_min=dimoffset(mat3dHD,0)+offset_theta	theta_max=dimoffset(mat3dHD,0)+offset_theta+dimdelta(mat3dHD,0)*(dimsize(mat3dHD,0)-1)		//Setting NAN points in mat3d to 0	//Calculating the matrix elements	i=0	j=0	func_mat3dk_pi(mat3dHD,mat3dkHD,offset_theta,offset_phi,fermi_level,ktheta_min,delta_ktheta,ktheta_max,number_of_ktheta,kphi_min,kphi_max,delta_kphi,number_of_kphi,theta_min,theta_max,phi_min,phi_max,ktheta,kphi,iktheta,ikphi,i,j,theta,phi,KE,sqrtKE)End		//********************************************************************************************************************************Proc mat3dkVD_pi1(offset_theta,offset_phi,fermi_level)//Use mat3d	Variable offset_theta	Variable offset_phi	Variable fermi_level	Prompt offset_theta,"Enter the theta value to add:"	Prompt offset_theta,"Enter the theta value to add:"	Prompt fermi_level,"Enter the Fermi level:"	PauseUpdate	Silent 1	Variable ktheta_min,ktheta_max,delta_ktheta,number_of_ktheta	Variable kphi_min,kphi_max,delta_kphi,number_of_kphi	Variable iktheta,ikphi,ie	Variable KE,sqrtKE,ktheta,kphi	Variable theta,phi,phi_min,phi_max,theta_min,theta_max	Variable i,j	Variable factor_src_bnl1,factor_src_bnl2	Variable/G SRC_vs_BNL	If(SRC_vs_BNL==0)		factor_src_bnl1=1.2		factor_src_bnl2=1.6		Else		factor_src_bnl1=1.6		factor_src_bnl2=1.2				Endif		//Find the k-limits of the new matrix and creating mat3dkVD	ktheta_min=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,0)+offset_theta)*Pi/180)	ktheta_max=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,0)+(dimsize(mat3dVD,0)-1)*dimdelta(mat3dVD,0)+offset_theta)*Pi/180)	number_of_ktheta=Round(dimsize(mat3dVD,0)*factor_src_bnl1)	delta_ktheta=(ktheta_max-ktheta_min)/(number_of_ktheta-1)	Make/O/N=(dimsize(mat3dVD,0)) tempwavephi	tempwavephi[]=0.51231*sqrt((dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*cos((dimoffset(mat3dVD,0)+offset_theta+p*dimdelta(mat3dVD,0))*pi/180))*sin((dimoffset(mat3dVD,2)+offset_phi)*Pi/180)		wavestats/Q tempwavephi	kphi_min=V_min	Make/O/N=(dimsize(mat3dVD,0)) tempwavephi	tempwavephi[]=0.51231*sqrt((dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*cos((dimoffset(mat3dVD,0)+offset_theta+p*dimdelta(mat3dVD,0))*pi/180))*sin((dimoffset(mat3dVD,2)+offset_phi+(dimsize(mat3dVD,2)-1)*dimdelta(mat3dVD,2))*Pi/180)		wavestats/Q tempwavephi	kphi_max=V_max		killwaves tempwavephi	//	kphi_min=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,2)+offset_phi)*Pi/180)//	kphi_max=0.51231*sqrt(dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1))*sin((dimoffset(mat3dVD,2)+(dimsize(mat3dVD,2)-1)*dimdelta(mat3dVD,2)+offset_phi)*Pi/180)	number_of_kphi=Round(dimsize(mat3dVD,2)*factor_src_bnl2)	delta_kphi=(kphi_max-kphi_min)/(number_of_kphi-1)	Make/O/N=(number_of_ktheta,number_of_kphi,dimsize(mat3dVD,1)) mat3dkVD	Setscale/P x,ktheta_min,delta_ktheta,""mat3dkVD	Setscale/P y,kphi_min,delta_kphi,""mat3dkVD	Setscale/P z,dimoffset(mat3dVD,1)-fermi_level,dimdelta(mat3dVD,1),""mat3dkVD	phi_min=dimoffset(mat3dVD,2)+offset_phi	phi_max=dimoffset(mat3dVD,2)+offset_phi+dimdelta(mat3dVD,2)*(dimsize(mat3dVD,2)-1)	theta_min=dimoffset(mat3dVD,0)+offset_theta	theta_max=dimoffset(mat3dVD,0)+offset_theta+dimdelta(mat3dVD,0)*(dimsize(mat3dVD,0)-1)		//Setting NAN points in mat3d to 0	//Calculating the matrix elements	ie=0	Do		print "Filling mat3d_kVD:",ie,"/",dimsize(mat3dkVD,2)-1		KE=dimoffset(mat3dVD,1)+ie*dimdelta(mat3dVD,1)		sqrtKE=sqrt(KE)		iktheta=0		Do			ktheta=ktheta_min+delta_ktheta*iktheta			theta=asin(ktheta/(0.51231*sqrtKE))*180/Pi //not an integer.			//creating a vecteur with theta fixed. Note: ktheta depends only on theta			Make/O/N=(dimsize(mat3dVD,0)) htempwave_x			Make/O/N=(dimsize(mat3dVD,0)) htempwave_y						Make/O/N=(dimsize(mat3dVD,2)) vtempwave			Make/O/N=(dimsize(mat3dVD,2)) vtempwave_x			htempwave_x[]=dimoffset(mat3dVD,0)+p*dimdelta(mat3dVD,0)+offset_theta						vtempwave_x[]=dimoffset(mat3dVD,2)+p*dimdelta(mat3dVD,2)+offset_phi			Setscale/P x,dimoffset(mat3dVD,2)+offset_phi,dimdelta(mat3dVD,2),""vtempwave			i=0			Do				htempwave_y[]=mat3dVD[p][ie][i]				vtempwave[i]=interp(theta,htempwave_x,htempwave_y)				i+=1			While(i<dimsize(mat3dVD,2))			ikphi=0			Do				kphi=kphi_min+delta_kphi*ikphi				phi=asin(kphi/(0.51231*sqrtKE*cos(theta*Pi/180)))*180/Pi				if((phi>=phi_min)&&(phi<=phi_max)&&(theta>=theta_min)&&(theta<=theta_max))					mat3dkVD[iktheta][ikphi][ie]=interp(phi,vtempwave_x,vtempwave)					Else						mat3dkVD[iktheta][ikphi][ie]=0				Endif				ikphi+=1			While(ikphi<number_of_kphi)			iktheta+=1		While(iktheta<number_of_ktheta)		ie+=1	While(ie<dimsize(mat3dkVD,2))	Killwaves htempwave_x,htempwave_y,vtempwave,vtempwave_xEnd		//********************************************************************************************************************************Proc selectcut_pi(ky1,ky2)	Variable ky1	Variable ky2	Prompt ky1,"Enter k_phi1"	Prompt ky2,"Enter k_phi2"	PauseUpdate	Silent 1	Variable energy,energy_0,delta_energy,en,total_energy	Variable k_phi_0,delta_k_phi,total_phi,k_phi,k_phi_last	Variable k_theta,k_theta_0,delta_k_theta,total_theta,k_theta_last	Variable i,j	Variable slope	Variable distance	Variable delta	String newcut	energy_0=dimoffset(super3d,2)	delta_energy=dimdelta(super3d,2)	total_energy=dimsize(super3d,2)	k_theta_0=dimoffset(super3d,0)	delta_k_theta=dimdelta(super3d,0)	total_theta=dimsize(super3d,0)	k_phi_0=dimoffset(super3d,1)	delta_k_phi=dimdelta(super3d,1)	total_phi=dimsize(super3d,1)	k_phi_last=k_phi_0+(total_phi-1)*delta_k_phi	k_theta_last=k_theta_0+(total_theta-1)*delta_k_theta		slope=(ky2-ky1)/((total_theta-1)*delta_k_theta)	newcut="cuts_"+num2str(ky1)+"_"+num2str(ky2)	Make/O/N=(total_theta,total_energy) $newcut	$newcut[][]=0	Make/O/N=(total_phi) kphi_int	kphi_int[]=0	Make/O/N=(total_phi) k_phi_vector	i=0	Do		k_phi_vector[i]=k_phi_0+i*delta_k_phi		i+=1	While(i<total_phi)	en=0	Do		i=0		Do			kphi_int[]=super3d[i][p][en]			k_phi=ky1+slope*(k_theta_0+i*delta_k_theta)			If((k_phi<k_phi_last)&&(k_phi>k_phi_0))				$newcut[i][en]=interp(k_phi,k_phi_vector,kphi_int)			Endif			i+=1		While(i<total_theta)		en+=1	While(en<total_energy)		distance=sqrt(((total_theta-1)*delta_k_theta)*((total_theta-1)*delta_k_theta)+(ky2-ky1)*(ky2-ky1))	delta=distance/(total_theta-1)	Killwaves k_phi_vector,kphi_int	setscale/p x,0,delta,"", $newcut	setscale/p y,energy_0,delta_energy,"",$newcut		Display	Appendimage $newcut		ModifyImage $newcut ctab= {*,*,Rainbow,1}	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0	TextBox/C/N=text0/F=0/S=3/H={0,1,10}/A=MC "("+num2str(k_theta_0)+","+num2str(ky1)+")--->("+num2str(k_theta_last)+","+num2str(ky2)+")"			Showinfo	End//********************************************************************************************************************************Proc phi_cst_pi(k_phi)	Variable k_phi=0	Prompt k_phi,"Enter k_phi"	PauseUpdate	Silent 1	Variable energy,energy_0,delta_energy,en,total_energy	Variable k_theta,k_theta_0,delta_k_theta,total_theta	Variable k_phi_0,delta_k_phi,total_phi		Variable index1,index2	Variable i,j	Variable weight1,weight2	String newcut	energy_0=dimoffset(super3d,2)	delta_energy=dimdelta(super3d,2)	total_energy=dimsize(super3d,2)	k_theta_0=dimoffset(super3d,0)	delta_k_theta=dimdelta(super3d,0)	total_theta=dimsize(super3d,0)	k_phi_0=dimoffset(super3d,1)	delta_k_phi=dimdelta(super3d,1)	total_phi=dimsize(super3d,1)		newcut="cutphi_"+num2str(k_phi)	index1=floor((k_phi-k_phi_0)/delta_k_phi)	index2=ceil((k_phi-k_phi_0)/delta_k_phi)	weight1=(k_phi-(index1*delta_k_phi+k_phi_0))/delta_k_phi	weight2=((index2*delta_k_phi+k_phi_0)-k_phi)/delta_k_phi	Make/O/N=(total_theta,total_energy) $newcut	$newcut[][]=0	en=0	i=0	$newcut[][]=super3d[p][index1][q]*weight1+super3d[p][index2][q]*weight2	setscale/p x,k_theta_0,delta_k_theta,"", $newcut	setscale/p y,energy_0,delta_energy,"",$newcut		Display	Appendimage $newcut		ModifyImage $newcut ctab= {*,*,Rainbow,1}	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0	Showinfo	End//********************************************************************************************************************************Proc auto2d_pi(energy)	Variable energy	Prompt energy,"Enter the energy at which you want to map"	PauseUpdate	Silent 1	Variable energy_0,delta_energy,en,total_energy	Variable delta_kx,delta_ky,total_kx,total_ky,kx,ky,kx_0,ky_0	Variable i,j	Variable qx,qy,kqx,kqy	Variable intensity	energy_0=dimoffset(sym_ortho3d,2)	delta_energy=dimdelta(sym_ortho3d,2)	total_energy=dimsize(sym_ortho3d,2)	kx_0=dimoffset(sym_ortho3d,0)	delta_kx=dimdelta(sym_ortho3d,0)	total_kx=dimsize(sym_ortho3d,0)	ky_0=dimoffset(sym_ortho3d,1)	delta_ky=dimdelta(sym_ortho3d,1)	total_ky=dimsize(sym_ortho3d,1)	Make/O/N=(total_kx,total_ky,total_energy) auto2d	setscale/p x,kx_0,delta_kx,"", auto2d	setscale/p y,ky_0,delta_ky,"",auto2d	setscale/p z,energy_0,delta_energy,"",auto2d	en=Round((energy-energy_0)/delta_energy+1)	qx=0	Do			Print qx,"/",total_kx-1		qy=0		Do			kx=0			intensity=0			Do				kqx=kx+qx				If(kqx<0)//Folding back the wavevector					kqx+=(total_kx-1)				Endif				If(kqx>(total_kx-1))					kqx-=(total_kx-1)				Endif				ky=0				Do					kqy=ky+qy					If(kqy<0)						kqy+=(total_ky-1)					Endif					If(kqy>(total_ky-1))						kqy-=(total_ky-1)					Endif					intensity=intensity+sym_ortho3d[kx][ky][en]*sym_ortho3d[kqx][kqy][en]					ky+=1				While(ky<(total_ky-1))//boundarie conditions				kx+=1			While(kx<(total_kx-1))//boundarie conditions			auto2d[qx][qy]=intensity			qy+=1		While(qy<total_ky)		qx+=1	While(qx<total_kx)		Display	Appendimage auto2d	ModifyImage auto2d ctab= {*,*,Rainbow,1}	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0	Showinfo		End//********************************************************************************************************************************Proc ES_polar_pi(energy,energy_add)	Variable energy=16.96	Variable energy_add=0	Prompt energy,"Enter the energy at which you want to make a 2D surface image"	Prompt energy_add,"Enter the number of curves you want to add below and above this energy"	PauseUpdate	Silent 1	String mat,newmat//,old_k_phi,old_k_theta//	Variable new_k_theta,new_k_phi	Variable total_energy,energy_0,delta_energy	Variable total_polar,polar_0,delta_polar	Variable total_theta,theta_0,delta_theta	Variable energy_point	Variable polar,theta	Variable theta_x_0,theta_x_end,theta_y_0,theta_y_end	Variable temp_x,temp_y	Variable total_theta_x,total_theta_y,ratio_x_y,delta_theta_x,delta_theta_y	Variable theta_x,theta_y//	Variable k_theta_0,delta_k_theta,k_polar_0,delta_k_polar	Variable i,j,k,i_x,i_y	mat="mat3d"	newmat="ESpolar"+num2str(energy)+"_"+num2str(energy_add)	total_energy=dimsize($mat,1)	energy_0=dimoffset($mat,1)	delta_energy=dimdelta($mat,1)	total_polar=dimsize($mat,2)	polar_0=dimoffset($mat,2)	delta_polar=dimdelta($mat,2)		total_theta=dimsize($mat,0)	theta_0=dimoffset($mat,0)	delta_theta=dimdelta($mat,0)			Make/O/N=(total_theta,total_polar) $newmat	$newmat[][]=0	energy_point=round((energy-energy_0)/delta_energy)	i=energy_point-energy_add	Do		$newmat[][]+=$mat[p][i][q]		i+=1	While(i<(energy_point+energy_add+1))	//Find the limiting theta_x and theta_y values	theta_x_0=9999	theta_x_end=-9999	theta_y_0=9999	theta_y_end=-9999	temp_x=0	temp_y=0	i=0	Do		theta=theta_0+i*delta_theta		j=0		Do			polar=polar_0+j*delta_polar			temp_x=theta*cos(polar*Pi/180)			temp_y=theta*sin(polar*Pi/180)			If((temp_x<theta_x_0)&&($newmat[i][j]!=0))				theta_x_0=temp_x			Endif			If((temp_x>theta_x_end)&&($newmat[i][j]!=0))				theta_x_end=temp_x			Endif			If((temp_y<theta_y_0)&&($newmat[i][j]!=0))				theta_y_0=temp_y			Endif			If((temp_y>theta_y_end)&&($newmat[i][j]!=0))				theta_y_end=temp_y			Endif			j+=1		While(j<total_polar)		i+=1	While(i<total_theta)	print theta_x_0,theta_x_end,theta_y_0,theta_y_end	ratio_x_y=(theta_x_0-theta_x_end)/(theta_y_0-theta_y_end)	//Construct the empty thet_x-theta_y array	total_theta_x=floor(sqrt(total_theta*total_polar*ratio_x_y))	total_theta_y=floor(total_theta*total_polar/total_theta_x)	delta_theta_x=(theta_x_end-theta_x_0)/(total_theta_x-1)	delta_theta_y=(theta_y_end-theta_y_0)/(total_theta_y-1)	Make/O/N=(total_theta_x,total_theta_y) mat_k	mat_k[][]=0	//Associate the (theta_x,theta_y) points with (theta,polar) ones	i=0	DO		theta=theta_0+i*delta_theta		j=0		DO			polar=polar_0+j*delta_polar			theta_x=theta*cos(polar*Pi/180)			theta_y=theta*sin(polar*Pi/180)			i_x=round((theta_x-theta_x_0)/delta_theta_x)			i_y=round((theta_y-theta_y_0)/delta_theta_y)			If(mat_k[i_x][i_y]==0)				mat_k[i_x][i_y]=$newmat[i][j]			Endif				j+=1		While(j<total_polar)		i+=1	While(i<total_theta)	setscale/p x,theta_x_0,delta_theta_x,"", mat_k	setscale/p y,theta_y_0,delta_theta_y,"",mat_k		Display	Appendimage mat_k	ModifyImage mat_k ctab= {*,*,Rainbow,1}		modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0		End//********************************************************************************************************************************Proc MakeCutImage_pi(phi,overlap,display_or_not)	Variable phi	Variable overlap	Variable display_or_not	Prompt phi,"input the phi angle"	Prompt overlap,"input the wave overlap"	Prompt display_or_not,"Do you want to display the image?",popup "No;Yes"		pauseupdate	silent 1	String matname,newmat	String matname_a,mat_temp	String name_empty	Variable ystart,ydelta,ysize,xstart,xdelta,xsize	Variable i,j,totalnum,p,newstart,kj,mm,num,k	Variable factor_plus,after_overlap_a,after_overlap_b	Variable make_image	Variable dim	Variable dim_posi	Variable avg_before,avg_after	totalnum=dimsize(imagephi,0)	make/o/n=0 tempindex	i=0	p=0	dim=dimsize(imagephi,0)	  	Make/O/N=0 Posi	i=0	p=0	Do		If(imagephi[i]==phi)			InsertPoints p,1,Posi			Posi[p]=i			p+=1		Endif		i+=1	While(i<dim)		matname="data"+num2str(imageindex[posi[0]])	matname_a="data"+num2str(imageindex[posi[0]])	name_empty="data"+num2str(-1)	Duplicate/O $matname $name_empty	$name_empty[][]=NaN	newmat="cut"+num2str(phi)	make_image=WaveExists($newmat)	ystart=dimoffset($matname,1)	ysize=dimsize($matname,1)	ydelta=dimdelta($matname,1)	xstart=dimoffset($matname,0)	xsize=dimsize($matname,0)	xdelta=dimdelta($matname,0)	i=posi[0]	newstart=xstart+imagetheta[i]+xdelta*wavest[i]	make/o/n=(0,ysize) $newmat	setscale/p y,ystart,ydelta,""$newmat	setscale/p x,newstart,xdelta,"",$newmat	dim=dimsize(posi,0)	i=0	do		p=posi[i]		matname="data"+num2str(imageindex[posi[i]])		appendtocutfrommat(matname,newmat,wavest[p],waveed[p])		after_overlap_a=wavest[p]-overlap		after_overlap_b=waveed[p]+overlap		If((i!=0)&&(imageindex[posi[i-1]]!=-1)&&(imageindex[posi[i]]!=-1))			matname_a="data"+num2str(imageindex[posi[i-1]])			mm=Dimsize($newmat,0)			j=0			k=0			Do				factor_plus=k/(wavest[p]-after_overlap_a+1)				Do					$newmat[mm-1+wavest[p]-waveed[p]+k][j]=0.5*(1+factor_plus)*$matname[wavest[p]+k][j]+0.5*(1-factor_plus)*$matname_a[waveed[p-1]+k+1][j]					j+=1				While(j<ysize)				j=0				k+=1			While(k<(wavest[p])-after_overlap_a)		Endif		If((i!=(dim-1))&&(imageindex[posi[i+1]]!=-1)&&(imageindex[posi[i]]!=-1))			matname_a="data"+num2str(imageindex[posi[i+1]])			mm=Dimsize($newmat,0)			j=0			k=0			Do				factor_plus=k/(after_overlap_b-waveed[p]+1)				Do					$newmat[mm-1-k][j]=0.5*(1+factor_plus)*$matname[waveed[p]-k][j]+0.5*(1-factor_plus)*$matname_a[wavest[p+1]-k-1][j]					j+=1				While(j<ysize)				j=0				k+=1			While(k<(after_overlap_b-waveed[p]))		Endif		i+=1	while(i<dim)	i=0	If((make_image==0)&&(display_or_not==2))		Display		Appendimage $newmat		ModifyImage $newmat ctab= {*,*,Terrain,1}			modifygraph width=150, height=150		Showinfo		ResumeUpdate		modifygraph width=0, height=0		Endif	Killwaves posi//	Killwaves tempvectorEnd//*******************************************************************************************************************Proc CVT2EK_exacttab(name)	String name	Prompt name, "Enter the name to give to the cut"	PauseUpdate;Silent 1	String thisname,nameindex,nametheta,namephi,nameeta1,nameeta2,nametheta_t,namephi_t,	thisname="table_"+name	nameindex="dataindex_"+name	nametheta="theta_"+name	namephi="phi_"+name	nameeta1="eta1_"+name	nameeta2="eta2_"+name	nametheta_t="theta_t_"+name	namephi_t="phi_t_"+name	If(Wintype(thisname)==0)		If(Exists(nameindex)==0)			Make/O/N=0 $nameindex			Make/O/N=0 $nametheta			Make/O/N=0 $namephi			Make/O/N=0 $nameeta1			Make/O/N=0 $nameeta2			Make/O/N=0 $nametheta_t			Make/O/N=0 $namephi_t					Edit $nameindex,$nametheta,$namephi,$nameeta1,$nameeta2,$nametheta_t,$namephi_t			Dowindow/C $thisname			Else				Edit $nameindex,$nametheta,$namephi,$nameeta1,$nameeta2,$nametheta_t,$namephi_t				Dowindow/C $thisname		Endif		Else		Dowindow/F $thisname	Endif			End//*******************************************************************************************************************Proc CVT2EK_exact1cut(oldmat,Slit_orientation,fe,theta,phi,V0ornot,V0value,Showornot)	string oldmat	Variable Slit_orientation	Variable fe=16.8241	Variable theta	Variable phi	Variable V0ornot	Variable V0value=0	Variable Showornot	Prompt oldmat,"Name of the matrix to transform"	Prompt Slit_orientation,"Slit orientation",popup "V;H"	Prompt fe,"Enter the Fermi energy"	Prompt theta,"Enter the real theta (with Gamma at 0)"// what is the meaning of theat?	Prompt phi,"Enter the real phi (with Gamma at 0)"// what is the meaning of phi?	Prompt V0ornot,"Do you want to calculate kz?",popup "NO;YES"	Prompt V0value,"If you want to calculate kz, enter V0"// Kz?		Prompt Showornot,"Do you want to display the result",popup "YES;NO"		      PauseUpdate	Silent 1	String newname,kznewname	Variable Emax,Emin,etamin,etamax	Variable mink,maxk,thisk	Emax=dimoffset($oldmat,1)+(dimsize($oldmat,1)-1)*dimdelta($oldmat,1)	Emin=dimoffset($oldmat,1)	etamin=dimoffset($oldmat,0)	etamax=dimoffset($oldmat,0)+(dimsize($oldmat,0)-1)*dimdelta($oldmat,0)	newname=oldmat+"_k"	IF(Slit_orientation==1)//we keep the ky component only		mink=0.51231*sqrt(dimoffset($oldmat,1))*(cos(phi*pi/180)*sin(dimoffset($oldmat,0)*pi/180)+sin(phi*pi/180)*cos(theta*pi/180)*cos(dimoffset($oldmat,0)*pi/180))		maxk=mink		thisk=0.51231*sqrt(Emin)*(cos(phi*pi/180)*sin(etamax*pi/180)+sin(phi*pi/180)*cos(theta*pi/180)*cos(etamax*pi/180))		If(thisk<mink)			mink=thisk		Endif		IF(thisk>maxk)			maxk=thisk		Endif		thisk=0.51231*sqrt(Emax)*(cos(phi*pi/180)*sin(etamin*pi/180)+sin(phi*pi/180)*cos(theta*pi/180)*cos(etamin*pi/180))		If(thisk<mink)			mink=thisk		Endif		IF(thisk>maxk)			maxk=thisk		Endif		thisk=0.51231*sqrt(Emax)*(cos(phi*pi/180)*sin(etamax*pi/180)+sin(phi*pi/180)*cos(theta*pi/180)*cos(etamax*pi/180))		If(thisk<mink)			mink=thisk		Endif		IF(thisk>maxk)			maxk=thisk		Endif		Make/O/N=(Round(dimsize($oldmat,0)*1.2),dimsize($oldmat,1)) $newname		Setscale/P y,dimoffset($oldmat,1)-fe,dimdelta($oldmat,1),""$newname		Setscale/I x,mink,maxk,""$newname		$newname[][]=NaN	//	print mink,maxk,"bananas"		funcCVT2EK_exact1cutV($oldmat,$newname,theta,phi)							Endif	IF(Slit_orientation==2)//we keep the kx component only		mink=0.51231*sqrt(Emin)*(cos(theta*pi/180)*sin(etamin*pi/180)+sin(theta*pi/180)*cos(etamin*pi/180))		maxk=mink		thisk=0.51231*sqrt(Emax)*(cos(theta*pi/180)*sin(etamin*pi/180)+sin(theta*pi/180)*cos(etamin*pi/180))		If(thisk<mink)			mink=thisk		Endif		IF(thisk>maxk)			maxk=thisk		Endif		thisk=0.51231*sqrt(Emin)*(cos(theta*pi/180)*sin(etamax*pi/180)+sin(theta*pi/180)*cos(etamax*pi/180))		If(thisk<mink)			mink=thisk		Endif		IF(thisk>maxk)			maxk=thisk		Endif		thisk=0.51231*sqrt(Emax)*(cos(theta*pi/180)*sin(etamax*pi/180)+sin(theta*pi/180)*cos(etamax*pi/180))		If(thisk<mink)			mink=thisk		Endif		IF(thisk>maxk)			maxk=thisk		Endif		Make/O/N=(Round(dimsize($oldmat,0)*1.2),dimsize($oldmat,1)) $newname		Setscale/P y,dimoffset($oldmat,1)-fe,dimdelta($oldmat,1),""$newname		Setscale/I x,mink,maxk,""$newname		$newname[][]=NaN		funcCVT2EK_exact1cutH($oldmat,$newname,theta,phi)							Endif	if(Showornot==1)				Display 		Appendimage $newname		ModifyImage $newname ctab= {*,*,Terrain,1}	      ModifyGraph width=113.386,height=127.559		ResumeUpdate			modifygraph width=0, height=0			Showinfo	Endif	if(V0ornot==2)		kznewname=oldmat+"_kz"		Duplicate/O $newname $kznewname		func_associate_kz($newname,$kznewname,fe,V0value)	EndifEnd//*******************************************************************************************************************Function func_associate_kz(oldname,newname,fe,V0value)	Wave oldname	Wave newname	Variable fe	Variable V0value	PauseUpdate;Silent 1	Variable i	Variable indexmin,indexmax	Variable thissqrtKE	newname[][]=0.51231*sqrt(dimoffset(oldname,1)+q*dimdelta(oldname,1)+fe+V0value-((dimoffset(oldname,0)+p*dimdelta(oldname,0))/0.51231)^2)	End//*******************************************************************************************************************Function funcCVT2EK_exact1cutV(oldname,newname,theta,phi)	Wave oldname	Wave newname	Variable theta	Variable phi	PauseUpdate;Silent 1	Variable i	Variable indexmin,indexmax	Variable thissqrtKE	i=0	Do		thissqrtKE=sqrt(dimoffset(oldname,1)+i*dimdelta(oldname,1))		Make/O/N=(dimsize(oldname,0)) wavek		Make/O/N=(dimsize(oldname,0)) waveI				wavek[]=0.51231*thissqrtKE*(cos(phi*pi/180)*sin((dimoffset(oldname,0)+p*dimdelta(oldname,0))*pi/180)+sin(phi*pi/180)*cos(theta*pi/180)*cos((dimoffset(oldname,0)+p*dimdelta(oldname,0))*pi/180))		waveI[]=oldname[p][i]		Wavestats/Q wavek		indexmin=Round((V_min-dimoffset(newname,0))/(dimdelta(newname,0)))		indexmax=Round((V_max-dimoffset(newname,0))/(dimdelta(newname,0)))				newname[indexmin,indexmax][i]=interp(dimoffset(newname,0)+p*dimdelta(newname,0),wavek,waveI)			i+=1	While(i<dimsize(oldname,1))					End//*******************************************************************************************************************Function funcCVT2EK_exact1cutH(oldname,newname,theta,phi)	Wave oldname	Wave newname	Variable theta	Variable phi	PauseUpdate;Silent 1	Variable i	Variable indexmin,indexmax	Variable thissqrtKE	i=0	Do		thissqrtKE=sqrt(dimoffset(oldname,1)+i*dimdelta(oldname,1))		Make/O/N=(dimsize(oldname,0)) wavek		Make/O/N=(dimsize(oldname,0)) waveI				wavek[]=0.51231*thissqrtKE*(cos(theta*pi/180)*sin((dimoffset(oldname,0)+p*dimdelta(oldname,0))*pi/180)+sin(theta*pi/180)*cos((dimoffset(oldname,0)+p*dimdelta(oldname,0))*pi/180))		waveI[]=oldname[p][i]		Wavestats/Q wavek		indexmin=Round((V_min-dimoffset(newname,0))/(dimdelta(newname,0)))		indexmax=Round((V_max-dimoffset(newname,0))/(dimdelta(newname,0)))				newname[indexmin,indexmax][i]=interp(dimoffset(newname,0)+p*dimdelta(newname,0),wavek,waveI)			i+=1	While(i<dimsize(oldname,1))					End//*******************************************************************************************************************Proc CVT2EK_pi(oldmat,answ,fe,phi)       string oldmat       Variable answ       Variable fe=16.96       Variable phi       Prompt oldmat,"Enter the matrix to transform"	Prompt answ,"Do you want also to convert the energy?",popup "Yes;No"	Prompt fe,"Enter the Fermi energy"	Prompt phi,"Enter the manipulator angle (for V polarization only)"	       PauseUpdate	Silent 1	String/G colordefault	Variable/G colordefaultinv	     	string newwavex,newwavez	string lastwave	string newmat	variable/G SRC_vs_BNL     		variable x0,dx,delta,y0,dy	variable i,j,KE	variable oldx	variable k0,kend,dk,k	variable num_edc,num_mdc	x0=dimoffset($oldmat,0)	dx=dimdelta($oldmat,0)	y0=dimoffset($oldmat,1)	dy=dimdelta($oldmat,1)	setscale/p x,x0,dx,"",$oldmat	setscale/p y,y0,dy,"",$oldmat	i=0	num_edc=dimsize($oldmat,0)	num_mdc=dimsize($oldmat,1)	// We find the k values of the corresponding angles at various energies	Do		KE=y0+i*dy		newwavex=oldmat+"_x"+Num2Str(i)		newwavez=oldmat+"_z"+Num2Str(i)		Make/O/N=(num_edc) $newwavex		Make/O/N=(num_edc) $newwavez		If(SRC_vs_BNL==0)			$newwavex[]=Sqrt(KE)*0.51231*sin((x0+p*dx)*Pi/180)//*cos(phi*Pi/180)			Else				$newwavex[]=Sqrt(KE)*0.51231*sin((x0+p*dx)*Pi/180)*cos(phi*Pi/180)		Endif				$newwavez[]=$oldmat[p][i]		i+=1	While(i<dimsize($oldmat,1))	//Now we find the appropriate dk and k values for an even spacing	lastwave=oldmat+"_x"+Num2Str(dimsize($oldmat,1)-1)	k0=$lastwave[0]	kend=$lastwave[dimsize($oldmat,0)-1]	dk=(kend-k0)/(dimsize($oldmat,0)-1)	//Make the xwave evenly spaced and define a new matrix to image	newmat=oldmat+"_k"	Make/O/N=((dimsize($oldmat,0)),(dimsize($oldmat,1))) $newmat	If(answ==1)		y0-=fe	Endif	setscale/p x,k0,dk,"",$newmat	setscale/p y,y0,dy,"",$newmat	Print "Making the final matrix"	i=0	Do		If(mod(i,200)==0)			Print i,"/",dimsize($oldmat,1)-1		Endif		newwavex=oldmat+"_x"+Num2Str(i)		newwavez=oldmat+"_z"+Num2Str(i)		func_CVT2EK_pi($newmat,$oldmat,$newwavex,$newwavez,k0,dk,i)		i+=1	While(i<dimsize($oldmat,1))	Display 	Appendimage $newmat	ModifyImage $newmat ctab= {*,*,$colordefault,colordefaultinv}//	ModifyImage $newmat ctab= {*,*,Terrain,1}	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0		Showinfo	i=0	Do		newwavex=oldmat+"_x"+Num2Str(i)		newwavez=oldmat+"_z"+Num2Str(i)		KillWaves $newwavex,$newwavez		i+=1	While(i<dimsize($oldmat,1))End//********************************************************************************************************************************Function func_CVT2EK_pi(newmat,oldmat,newwavex,newwavez,k0,dk,i)       Wave newmat       Wave oldmat         Wave newwavex       Wave newwavez        Variable k0,dk       Variable i	Variable k,j	j=0	Do		k=k0+j*dk		If((k<newwavex[0])||(k>newwavex[dimsize(oldmat,0)-1]))			newmat[j][i]=NaN		Else			newmat[j][i]=interp(k,newwavex,newwavez)		Endif		j+=1	While(j<dimsize(oldmat,0))End//********************************************************************************************************************************Proc allcuts(overlap,display_or_not)	Variable overlap	Variable display_or_not	Prompt overlap,"Enter the number of overlapping slices"	Prompt display_or_not,"Do you want to show the display the cuts?",popup "No;Yes"	PauseUpdate	Silent 1	String thisdata	Variable i	i=0	Do		makecutimage_pi(phiindex[i],overlap,display_or_not)		i+=1	While(i<dimsize(phiindex,0))	End	//********************************************************************************************************************************Proc allHD()	PauseUpdate	Silent 1	String thisname,newname,tempname	Variable i	i=0	Do		thisname="cut"+num2str(phiindex[i])		tempname="t"+thisname		newname=thisname+"HD"		derivmat(thisname,5,5,2)		Duplicate/O $newname $thisname			i+=1	While(i<dimsize(phiindex,0))	End	//********************************************************************************************************************************	Proc put_superlattice()	PauseUpdate	Silent 1	String wave_list	String old_wave	wave_list=TraceNameList("making_fs",";",1)	If(strsearch(wave_list,"supr1_y",0)==-1)			Appendtograph supr1_y vs supr1_x		Appendtograph supr2_y vs supr2_x		Appendtograph supr3_y vs supr3_x		Appendtograph supl1_y vs supl1_x		Appendtograph supl2_y vs supl2_x		Appendtograph supl3_y vs supl3_x		Appendtograph slowr1_y vs slowr1_x		Appendtograph slowr2_y vs slowr2_x		Appendtograph slowr3_y vs slowr3_x		Appendtograph slowl1_y vs slowl1_x		Appendtograph slowl2_y vs slowl2_x		Appendtograph slowl3_y vs slowl3_x	EndifEnd	//********************************************************************************************************************************	Proc put_psuperlattice()	PauseUpdate	Silent 1	String wave_list	String old_wave	wave_list=TraceNameList("predict_cuts",";",1)	If(strsearch(wave_list,"psupr1_y",0)==-1)			Appendtograph psupr1_y vs psupr1_x		ModifyGraph lstyle(psupr1_y )=2				Appendtograph psupr2_y vs psupr2_x		ModifyGraph lstyle(psupr2_y )=2				Appendtograph psupr3_y vs psupr3_x		ModifyGraph lstyle(psupr3_y )=2				Appendtograph psupl1_y vs psupl1_x		ModifyGraph lstyle(psupl1_y )=2				Appendtograph psupl2_y vs psupl2_x		ModifyGraph lstyle(psupl2_y )=2				Appendtograph psupl3_y vs psupl3_x		ModifyGraph lstyle(psupl3_y )=2				Appendtograph pslowr1_y vs pslowr1_x		ModifyGraph lstyle(pslowr1_y )=2				Appendtograph pslowr2_y vs pslowr2_x		ModifyGraph lstyle(pslowr2_y )=2				Appendtograph pslowr3_y vs pslowr3_x		ModifyGraph lstyle(pslowr3_y )=2				Appendtograph pslowl1_y vs pslowl1_x		ModifyGraph lstyle(pslowl1_y )=2				Appendtograph pslowl2_y vs pslowl2_x		ModifyGraph lstyle(pslowl2_y )=2				Appendtograph pslowl3_y vs pslowl3_x		ModifyGraph lstyle(pslowl3_y )=2			EndifEnd	//********************************************************************************************************************************	Proc remove_superlattice()	PauseUpdate	Silent 1	String wave_list	String old_wave	wave_list=TraceNameList("making_fs",";",1)	If(strsearch(wave_list,"supr1_y",0)!=-1)		Removefromgraph supr1_y		Removefromgraph supr2_y		Removefromgraph supr3_y		Removefromgraph supl1_y		Removefromgraph supl2_y		Removefromgraph supl3_y		Removefromgraph slowr1_y		Removefromgraph slowr2_y		Removefromgraph slowr3_y		Removefromgraph slowl1_y		Removefromgraph slowl2_y		Removefromgraph slowl3_y	EndifEnd//********************************************************************************************************************************	Proc remove_psuperlattice()	PauseUpdate	Silent 1	String wave_list	String old_wave	wave_list=TraceNameList("predict_cuts",";",1)	If(strsearch(wave_list,"psupr1_y",0)!=-1)		Removefromgraph psupr1_y		Removefromgraph psupr2_y		Removefromgraph psupr3_y		Removefromgraph psupl1_y		Removefromgraph psupl2_y		Removefromgraph psupl3_y		Removefromgraph pslowr1_y		Removefromgraph pslowr2_y		Removefromgraph pslowr3_y		Removefromgraph pslowl1_y		Removefromgraph pslowl2_y		Removefromgraph pslowl3_y	EndifEnd//********************************************************************************************************************************	Proc put_superlattice1()	PauseUpdate	Silent 1	String wave_list	String old_wave	wave_list=TraceNameList("image_fs_ploter",";",1)	If(strsearch(wave_list,"supr1_y",0)==-1)			Appendtograph supr1_y vs supr1_x		Appendtograph supr2_y vs supr2_x		Appendtograph supr3_y vs supr3_x		Appendtograph supl1_y vs supl1_x		Appendtograph supl2_y vs supl2_x		Appendtograph supl3_y vs supl3_x		Appendtograph slowr1_y vs slowr1_x		Appendtograph slowr2_y vs slowr2_x		Appendtograph slowr3_y vs slowr3_x		Appendtograph slowl1_y vs slowl1_x		Appendtograph slowl2_y vs slowl2_x		Appendtograph slowl3_y vs slowl3_x	EndifEnd	//********************************************************************************************************************************	Proc remove_superlattice1()	PauseUpdate	Silent 1	String wave_list	String old_wave	wave_list=TraceNameList("image_fs_ploter",";",1)	If(strsearch(wave_list,"supr1_y",0)!=-1)		Removefromgraph supr1_y		Removefromgraph supr2_y		Removefromgraph supr3_y		Removefromgraph supl1_y		Removefromgraph supl2_y		Removefromgraph supl3_y		Removefromgraph slowr1_y		Removefromgraph slowr2_y		Removefromgraph slowr3_y		Removefromgraph slowl1_y		Removefromgraph slowl2_y		Removefromgraph slowl3_y	EndifEnd							//********************************************************************************************************************************Proc plotBZ_pi(lattice,orientation)//,second)	Variable lattice,orientation//,second	Prompt lattice,"Enter the lattice parameter a"	Prompt orientation,"Enter the orientation",popup"G-X(Y);G-M"	//	Prompt second,"Do you want to go to the second zone?",popup"No;Yes"	PauseUpdate	Silent 1	Variable i,lattice_k	String thename	lattice_k=pi/lattice	If(orientation==2)		Make/O/N=2 BZ1		Make/O/N=2 BZ2		Make/O/N=2 BZ3		Make/O/N=2 BZ4		BZ1[0]=-lattice_k		BZ1[1]=-lattice_k		BZ2[0]=lattice_k		BZ2[1]=lattice_k		BZ3[0]=-lattice_k			BZ3[1]=lattice_k		BZ4[0]=0		BZ4[1]=0		Appendtograph BZ3 vs BZ1		Appendtograph BZ3 vs BZ2		Appendtograph BZ1 vs BZ3		Appendtograph BZ2 vs BZ3		Appendtograph BZ4 vs BZ3		Appendtograph BZ3 vs BZ4	Endif//	If(second==1)//		Make/O/N=2 BZ5//		BZ5[0]=-2*lattice_k//		BZ5[1]=2*lattice_k//		Appendtograph BZ4 vs BZ5//		Appendtograph BZ5 vs BZ4//		print "banane"//	EndifEnd//********************************************************************************************************************************	Proc mat3d_eplot_setincrement()	PauseUpdate	Silent 1	SetVariable center_emat3d,limits={mat3d_energy_min,mat3d_energy_max,mat3d_energy_increment},value= mat3d_energy_center	End	//********************************************************************************************************************************	Proc mat3dVD_eplot_setincrement()	PauseUpdate	Silent 1	SetVariable center_emat3dVD,limits={mat3dVD_energy_min,mat3dVD_energy_max,mat3dVD_energy_increment},value= mat3dVD_energy_center	End	//********************************************************************************************************************************	Proc mat3dHD_eplot_setincrement()	PauseUpdate	Silent 1	SetVariable center_emat3dHD,limits={mat3dHD_energy_min,mat3dHD_energy_max,mat3dHD_energy_increment},value= mat3dHD_energy_center	End	//********************************************************************************************************************************	Proc mat3dk_eplot_setincrement()	PauseUpdate	Silent 1	SetVariable center_emat3dk,limits={mat3dk_energy_min,mat3dk_energy_max,mat3dk_energy_increment},value= mat3dk_energy_center	End	//********************************************************************************************************************************	Proc mat3dkVD_eplot_setincrement()	PauseUpdate	Silent 1	SetVariable center_emat3dkVD,limits={mat3dkVD_energy_min,mat3dkVD_energy_max,mat3dkVD_energy_increment},value= mat3dkVD_energy_center	End	//********************************************************************************************************************************	Proc mat3dkHD_eplot_setincrement()	PauseUpdate	Silent 1	SetVariable center_emat3dkHD,limits={mat3dkHD_energy_min,mat3dkHD_energy_max,mat3dkHD_energy_increment},value= mat3dkHD_energy_center	End	//********************************************************************************************************************************	Proc mat3d_makeimage()	PauseUpdate	Silent 1	String matname	Variable e_low,e_high	Variable n_low,n_high	e_low=mat3d_energy_center-mat3d_energy_wide/2	e_high=mat3d_energy_center+mat3d_energy_wide/2		n_low=Round((e_low-dimoffset(mat3d,1))/dimdelta(mat3d,1))	n_high=Round((e_high-dimoffset(mat3d,1))/dimdelta(mat3d,1))	matname="ES"+num2str(n_low)+"_"+num2str(n_high)	Duplicate/O mat3d_energy_plot $matname	Display	Appendimage $matname	ModifyImage $matname ctab= {*,*,Terrain,1}		End	//********************************************************************************************************************************	Proc mat3dVD_makeimage()	PauseUpdate	Silent 1	String matname	Variable e_low,e_high	Variable n_low,n_high	e_low=mat3dVD_energy_center-mat3dVD_energy_wide/2	e_high=mat3dVD_energy_center+mat3dVD_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dVD,1))/dimdelta(mat3dVD,1))	n_high=Round((e_high-dimoffset(mat3dVD,1))/dimdelta(mat3dVD,1))	matname="ESVD"+num2str(n_low)+"_"+num2str(n_high)	Duplicate/O mat3dVD_energy_plot $matname	Display	Appendimage $matname	ModifyImage $matname ctab= {*,0,Terrain,1}		End	//********************************************************************************************************************************	Proc mat3dHD_makeimage()	PauseUpdate	Silent 1	String matname	Variable e_low,e_high	Variable n_low,n_high	e_low=mat3dHD_energy_center-mat3dHD_energy_wide/2	e_high=mat3dHD_energy_center+mat3dHD_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dHD,1))/dimdelta(mat3dHD,1))	n_high=Round((e_high-dimoffset(mat3dHD,1))/dimdelta(mat3dHD,1))	matname="ESHD"+num2str(n_low)+"_"+num2str(n_high)	Duplicate/O mat3dHD_energy_plot $matname	Display	Appendimage $matname	ModifyImage $matname ctab= {*,0,Terrain,1}		End	//********************************************************************************************************************************	Proc mat3dk_makeimage()	PauseUpdate	Silent 1	String matname	Variable e_low,e_high	Variable n_low,n_high	e_low=mat3dk_energy_center-mat3dk_energy_wide/2	e_high=mat3dk_energy_center+mat3dk_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dk,2))/dimdelta(mat3dk,2))	n_high=Round((e_high-dimoffset(mat3dk,2))/dimdelta(mat3dk,2))	matname="ESk"+num2str(n_low)+"_"+num2str(n_high)	Duplicate/O mat3dk_energy_plot $matname	Display	Appendimage $matname	ModifyImage $matname ctab= {*,*,Terrain,1}		End		//********************************************************************************************************************************	Proc mat3dkVD_makeimage()	PauseUpdate	Silent 1	String matname	Variable e_low,e_high	Variable n_low,n_high	e_low=mat3dkVD_energy_center-mat3dkVD_energy_wide/2	e_high=mat3dkVD_energy_center+mat3dkVD_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dkVD,2))/dimdelta(mat3dkVD,2))	n_high=Round((e_high-dimoffset(mat3dkVD,2))/dimdelta(mat3dkVD,2))	matname="ESkVD"+num2str(n_low)+"_"+num2str(n_high)	Duplicate/O mat3dkVD_energy_plot $matname	Display	Appendimage $matname	ModifyImage $matname ctab= {*,0,Terrain,1}		End		//********************************************************************************************************************************	Proc mat3dkHD_makeimage()	PauseUpdate	Silent 1	String matname	Variable e_low,e_high	Variable n_low,n_high	e_low=mat3dkHD_energy_center-mat3dkHD_energy_wide/2	e_high=mat3dkHD_energy_center+mat3dkHD_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dkHD,2))/dimdelta(mat3dkHD,2))	n_high=Round((e_high-dimoffset(mat3dkHD,2))/dimdelta(mat3dkHD,2))	matname="ESkHD"+num2str(n_low)+"_"+num2str(n_high)	Duplicate/O mat3dkHD_energy_plot $matname	Display	Appendimage $matname	ModifyImage $matname ctab= {*,0,Terrain,1}		End				//********************************************************************************************************************************	Proc mat3d_eplot()	PauseUpdate	Silent 1	SetVariable center_emat3d,limits={mat3d_energy_min,mat3d_energy_max,mat3d_energy_increment},value= mat3d_energy_center		String/G colordefault	String newname,old_image_list,old_image	Variable/G colordefaultinv	Variable i	Variable e_low,e_high	Variable n_low,n_high	old_image_list=ImageNameList("mat3d_fs_ploter",";")	old_image=StringFromList(0,old_image_list)	e_low=mat3d_energy_center-mat3d_energy_wide/2	e_high=mat3d_energy_center+mat3d_energy_wide/2		n_low=Round((e_low-dimoffset(mat3d,1))/dimdelta(mat3d,1))	n_high=Round((e_high-dimoffset(mat3d,1))/dimdelta(mat3d,1))		newname="mat3d_energy_plot"	Make/O/N=(dimsize(mat3d,0),dimsize(mat3d,2)) $newname	setscale/p x,dimoffset(mat3d,0),dimdelta(mat3d,0),"", $newname	setscale/p y,dimoffset(mat3d,2),dimdelta(mat3d,2),"",$newname	$newname[][]=0	i=n_low	Do		$newname[][]+=mat3d[p][i][q]		i+=1	While(i<n_high)//	Display	If(WaveExists($old_image)!=1)		Appendimage $newname	Endif	ModifyImage mat3d_energy_plot ctab= {*,*,Terrain,0}End	//********************************************************************************************************************************	Proc mat3dVD_eplot()	PauseUpdate	Silent 1	SetVariable center_emat3dVD,limits={mat3dVD_energy_min,mat3dVD_energy_max,mat3dVD_energy_increment},value= mat3dVD_energy_center		String newname,old_image_list,old_image	Variable i	Variable e_low,e_high	Variable n_low,n_high	old_image_list=ImageNameList("mat3dVD_fs_ploter",";")	old_image=StringFromList(0,old_image_list)	If(WaveExists($old_image)==1)		Removeimage $old_image	Endif	e_low=mat3dVD_energy_center-mat3dVD_energy_wide/2	e_high=mat3dVD_energy_center+mat3dVD_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dVD,1))/dimdelta(mat3dVD,1))	n_high=Round((e_high-dimoffset(mat3dVD,1))/dimdelta(mat3dVD,1))		newname="mat3dVD_energy_plot"	Make/O/N=(dimsize(mat3dVD,0),dimsize(mat3dVD,2)) $newname	setscale/p x,dimoffset(mat3dVD,0),dimdelta(mat3dVD,0),"", $newname	setscale/p y,dimoffset(mat3dVD,2),dimdelta(mat3dVD,2),"",$newname	$newname[][]=0	i=n_low	Do		$newname[][]+=mat3dVD[p][i][q]		i+=1	While(i<n_high)//	Display	Appendimage $newname	ModifyImage $newname ctab= {*,0,Terrain,1}End	//********************************************************************************************************************************	Proc mat3dHD_eplot()	PauseUpdate	Silent 1	SetVariable center_emat3dHD,limits={mat3dHD_energy_min,mat3dHD_energy_max,mat3dHD_energy_increment},value= mat3dHD_energy_center		String newname,old_image_list,old_image	Variable i	Variable e_low,e_high	Variable n_low,n_high	old_image_list=ImageNameList("mat3dHD_fs_ploter",";")	old_image=StringFromList(0,old_image_list)	If(WaveExists($old_image)==1)		Removeimage $old_image	Endif	e_low=mat3dHD_energy_center-mat3dHD_energy_wide/2	e_high=mat3dHD_energy_center+mat3dHD_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dHD,1))/dimdelta(mat3dHD,1))	n_high=Round((e_high-dimoffset(mat3dHD,1))/dimdelta(mat3dHD,1))		newname="mat3dHD_energy_plot"	Make/O/N=(dimsize(mat3dHD,0),dimsize(mat3dHD,2)) $newname	setscale/p x,dimoffset(mat3dHD,0),dimdelta(mat3dHD,0),"", $newname	setscale/p y,dimoffset(mat3dHD,2),dimdelta(mat3dHD,2),"",$newname	$newname[][]=0	i=n_low	Do		$newname[][]+=mat3dHD[p][i][q]		i+=1	While(i<n_high)//	Display	Appendimage $newname	ModifyImage $newname ctab= {*,0,Terrain,1}End		//********************************************************************************************************************************	Proc mat3dk_eplot()	PauseUpdate	Silent 1	SetVariable center_emat3dk,limits={mat3dk_energy_min,mat3dk_energy_max,mat3dk_energy_increment},value= mat3dk_energy_center		String newname,old_image_list,old_image	Variable i	Variable e_low,e_high	Variable n_low,n_high	old_image_list=ImageNameList("mat3dk_fs_ploter",";")	old_image=StringFromList(0,old_image_list)	If(WaveExists($old_image)==1)		Removeimage $old_image	Endif	e_low=mat3dk_energy_center-mat3dk_energy_wide/2	e_high=mat3dk_energy_center+mat3dk_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dk,2))/dimdelta(mat3dk,2))	n_high=Round((e_high-dimoffset(mat3dk,2))/dimdelta(mat3dk,2))		newname="mat3dk_energy_plot"	Make/O/N=(dimsize(mat3dk,0),dimsize(mat3dk,1)) $newname	setscale/p x,dimoffset(mat3dk,0),dimdelta(mat3dk,0),"", $newname	setscale/p y,dimoffset(mat3dk,1),dimdelta(mat3dk,1),"",$newname	$newname[][]=0	i=n_low	Do		$newname[][]+=mat3dk[p][q][i]		i+=1	While(i<n_high)//	Display	Appendimage $newname	ModifyImage $newname ctab= {*,*,Terrain,1}	End	//********************************************************************************************************************************	Proc mat3dkVD_eplot()	PauseUpdate	Silent 1	SetVariable center_emat3dkVD,limits={mat3dkVD_energy_min,mat3dkVD_energy_max,mat3dkVD_energy_increment},value= mat3dkVD_energy_center		String newname,old_image_list,old_image	Variable i	Variable e_low,e_high	Variable n_low,n_high	old_image_list=ImageNameList("mat3dkVD_fs_ploter",";")	old_image=StringFromList(0,old_image_list)	If(WaveExists($old_image)==1)		Removeimage $old_image	Endif	e_low=mat3dkVD_energy_center-mat3dkVD_energy_wide/2	e_high=mat3dkVD_energy_center+mat3dkVD_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dkVD,2))/dimdelta(mat3dkVD,2))	n_high=Round((e_high-dimoffset(mat3dkVD,2))/dimdelta(mat3dkVD,2))		newname="mat3dkVD_energy_plot"	Make/O/N=(dimsize(mat3dkVD,0),dimsize(mat3dkVD,1)) $newname	setscale/p x,dimoffset(mat3dkVD,0),dimdelta(mat3dkVD,0),"", $newname	setscale/p y,dimoffset(mat3dkVD,1),dimdelta(mat3dkVD,1),"",$newname	$newname[][]=0	i=n_low	Do		$newname[][]+=mat3dkVD[p][q][i]		i+=1	While(i<n_high)//	Display	Appendimage $newname	ModifyImage $newname ctab= {*,0,Terrain,1}	End		//********************************************************************************************************************************	Proc mat3dkHD_eplot()	PauseUpdate	Silent 1	SetVariable center_emat3dkHD,limits={mat3dkHD_energy_min,mat3dkHD_energy_max,mat3dkHD_energy_increment},value= mat3dkHD_energy_center		String newname,old_image_list,old_image	Variable i	Variable e_low,e_high	Variable n_low,n_high	old_image_list=ImageNameList("mat3dkHD_fs_ploter",";")	old_image=StringFromList(0,old_image_list)	If(WaveExists($old_image)==1)		Removeimage $old_image	Endif	e_low=mat3dkHD_energy_center-mat3dkHD_energy_wide/2	e_high=mat3dkHD_energy_center+mat3dkHD_energy_wide/2		n_low=Round((e_low-dimoffset(mat3dkHD,2))/dimdelta(mat3dkHD,2))	n_high=Round((e_high-dimoffset(mat3dkHD,2))/dimdelta(mat3dkHD,2))		newname="mat3dkHD_energy_plot"	Make/O/N=(dimsize(mat3dkHD,0),dimsize(mat3dkHD,1)) $newname	setscale/p x,dimoffset(mat3dkHD,0),dimdelta(mat3dkHD,0),"", $newname	setscale/p y,dimoffset(mat3dkHD,1),dimdelta(mat3dkHD,1),"",$newname	$newname[][]=0	i=n_low	Do		$newname[][]+=mat3dkHD[p][q][i]		i+=1	While(i<n_high)//	Display	Appendimage $newname	ModifyImage $newname ctab= {*,0,Terrain,1}	End					//********************************************************************************************************************************Proc mat3dk_slice(e_low,e_high)	Variable e_low	Variable e_high	Prompt e_low,"integrate from:"	Prompt e_high,"to:"	PauseUpdate	Silent 1	String newname	Variable i	Variable n_low,n_high	n_low=Round((e_low-dimoffset(mat3dk,2))/dimdelta(mat3dk,2))	n_high=Round((e_high-dimoffset(mat3dk,2))/dimdelta(mat3dk,2))		newname="ESk"+num2str(n_low)+"_"+num2str(n_high)	Make/O/N=(dimsize(mat3dk,0),dimsize(mat3dk,1)) $newname	setscale/p x,dimoffset(mat3dk,0),dimdelta(mat3dk,0),"", $newname	setscale/p y,dimoffset(mat3dk,1),dimdelta(mat3dk,1),"",$newname	n_low=Round((e_low-dimoffset(mat3dk,2))/dimdelta(mat3dk,2))	n_high=Round((e_high-dimoffset(mat3dk,2))/dimdelta(mat3dk,2))	i=n_low	Do		$newname[][]+=mat3dk[p][q][i]		i+=1	While(i<n_high)	Display 	Appendimage $newname	ModifyImage $newname ctab= {*,*,Terrain,1}	End	//********************************************************************************************************************************Proc mat3dkvd_slice(e_low,e_high)	Variable e_low	Variable e_high	Prompt e_low,"integrate from:"	Prompt e_high,"to:"	PauseUpdate	Silent 1	String newname	Variable i	Variable n_low,n_high	n_low=Round((e_low-dimoffset(mat3dkvd,2))/dimdelta(mat3dkvd,2))	n_high=Round((e_high-dimoffset(mat3dkvd,2))/dimdelta(mat3dkvd,2))		newname="ESkVD"+num2str(n_low)+"_"+num2str(n_high)	Make/O/N=(dimsize(mat3dkvd,0),dimsize(mat3dkvd,1)) $newname	setscale/p x,dimoffset(mat3dkvd,0),dimdelta(mat3dkvd,0),"", $newname	setscale/p y,dimoffset(mat3dkvd,1),dimdelta(mat3dkvd,1),"",$newname	n_low=Round((e_low-dimoffset(mat3dkvd,2))/dimdelta(mat3dkvd,2))	n_high=Round((e_high-dimoffset(mat3dkvd,2))/dimdelta(mat3dkvd,2))	i=n_low	Do		$newname[][]+=mat3dkvd[p][q][i]		i+=1	While(i<n_high)	Display 	Appendimage $newname	ModifyImage $newname ctab= {*,0,Terrain,1}	End		//********************************************************************************************************************************Proc mat3dkHd_slice(e_low,e_high)	Variable e_low	Variable e_high	Prompt e_low,"integrate from:"	Prompt e_high,"to:"	PauseUpdate	Silent 1	String newname	Variable i	Variable n_low,n_high	n_low=Round((e_low-dimoffset(mat3dkHd,2))/dimdelta(mat3dkHd,2))	n_high=Round((e_high-dimoffset(mat3dkHd,2))/dimdelta(mat3dkHd,2))		newname="ESkHD"+num2str(n_low)+"_"+num2str(n_high)	Make/O/N=(dimsize(mat3dkHd,0),dimsize(mat3dkHd,1)) $newname	setscale/p x,dimoffset(mat3dkHd,0),dimdelta(mat3dkHd,0),"", $newname	setscale/p y,dimoffset(mat3dkHd,1),dimdelta(mat3dkHd,1),"",$newname	n_low=Round((e_low-dimoffset(mat3dkHd,2))/dimdelta(mat3dkHd,2))	n_high=Round((e_high-dimoffset(mat3dkHd,2))/dimdelta(mat3dkHd,2))	i=n_low	Do		$newname[][]+=mat3dkHd[p][q][i]		i+=1	While(i<n_high)	Display 	Appendimage $newname	ModifyImage $newname ctab= {*,0,Terrain,1}	End	//********************************************************************************************************************************Window Raman4_3Dspectra_plotter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(65,44,537,525) Raman4_3Dspectra	AppendToGraph leftRaman4_3Dspectra_y vs leftRaman4_3Dspectra_x	AppendToGraph rightRaman4_3Dspectra_y vs rightRaman4_3Dspectra_x	ModifyGraph gbRGB=(62965,64250,65535)	ModifyGraph lStyle(leftRaman4_3Dspectra_y)=7,lStyle(rightRaman4_3Dspectra_y)=7	ModifyGraph rgb(leftRaman4_3Dspectra_y)=(0,0,65535),rgb(rightRaman4_3Dspectra_y)=(0,26214,13293)	ModifyGraph tick=2	ModifyGraph mirror=1	ControlBar 179	Slider sliderleftRaman4_3D,pos={19,83},size={200,45},proc=SliderProc_sliderleftRaman4_3D	Slider sliderleftRaman4_3D,limits={26,32.2,0.008},value= 31.49,vert= 0	Slider sliderrightRaman4_3D,pos={19,132},size={200,45},proc=SliderProc_sliderrightRaman4_3D	Slider sliderrightRaman4_3D,limits={26,32.2,0.008},value= 31.51,vert= 0,thumbColor= (0,26214,13293)	Slider slider_sqleft,pos={15,26},size={100,45},proc=SliderProc_sqleft	Slider slider_sqleft,limits={0,84,1},value= 0,vert= 0	Slider slider_sqright,pos={127,26},size={100,45},proc=SliderProc_sqright	Slider slider_sqright,limits={0,84,1},value= 0,vert= 0	Slider slider_sqbottom,pos={256,24},size={53,100},proc=SliderProc_sqbottom	Slider slider_sqbottom,limits={0,338,1},value= 0	Slider slider_sqtop,pos={327,25},size={53,100},proc=SliderProc_sqtop	Slider slider_sqtop,limits={0,338,1},value= 0	GroupBox group0,pos={9,4},size={230,74},title="Left-Right",fSize=14,fStyle=1	GroupBox group0,fColor=(16385,16388,65535)	GroupBox group1,pos={249,4},size={132,128},title="Bottom-Top",fSize=14,fStyle=1	GroupBox group1,fColor=(16385,16388,65535)	CheckBox checksq4Raman_3D,pos={248,138},size={129,17},proc=CheckProcshowsq,title="Activate square"	CheckBox checksq4Raman_3D,fSize=14,value= 0	SetDrawLayer UserFront	DrawRect -0.0909090909090909,-0.432835820895522,0.425837320574163,-0.870646766169154	DrawRect -0.0933014354066986,-0.388059701492537,0.440191387559809,-0.945273631840796EndMacro//********************************************************************************************************************************	Proc Update_Raman4_3DfromFS()	PauseUpdate; Silent 1		Variable/G mat3d_energy_center	Variable/G mat3d_energy_wide	Variable minvalue,maxvalue	If(Wintype("Raman4_3Dspectra_plotter")!=0)		Dowindow/F Raman4_3Dspectra_plotter		minvalue=mat3d_energy_center-mat3d_energy_wide/2		maxvalue=mat3d_energy_center+mat3d_energy_wide/2		if(minvalue<dimoffset(mat3d,1))			minvalue=dimoffset(mat3d,1)		Endif		if(maxvalue>dimoffset(mat3d,1)+dimsize(mat3d,1)*dimdelta(mat3d,1))			maxvalue=dimoffset(mat3d,1)+dimsize(mat3d,1)*dimdelta(mat3d,1)		Endif		leftRaman4_3Dspectra_value=minvalue		leftRaman4_3Dspectra_x[]=minvalue		rightRaman4_3Dspectra_value=maxvalue		rightRaman4_3Dspectra_x[]=maxvalue		Slider sliderleftRaman4_3D, value=minvalue		Slider sliderrightRaman4_3D, value=maxvalue		Dowindow/F mat3d_fs_ploter	EndifEnd	//********************************************************************************************************************************	Function SliderProc_sliderleftRaman4_3D(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Pauseupdate;Silent 1	Variable/G mat3d_energy_wide	Variable/G mat3d_energy_center	Variable/G leftRaman4_3Dspectra_value		Variable/G rightRaman4_3Dspectra_value		Wave leftRaman4_3Dspectra_x	Wave mat3d	Wave mat3d_energy_plot	Variable n_low,n_high,i	Variable e_low,e_high	if(event %& 0x1)	// bit 0, value set		endif	leftRaman4_3Dspectra_value=sliderValue	leftRaman4_3Dspectra_x[]=sliderValue	mat3d_energy_center=(leftRaman4_3Dspectra_value+rightRaman4_3Dspectra_value)/2	mat3d_energy_wide=abs(leftRaman4_3Dspectra_value-rightRaman4_3Dspectra_value)	e_low=mat3d_energy_center-mat3d_energy_wide/2	e_high=mat3d_energy_center+mat3d_energy_wide/2		n_low=Round((e_low-dimoffset(mat3d,1))/dimdelta(mat3d,1))	n_high=Round((e_high-dimoffset(mat3d,1))/dimdelta(mat3d,1))		mat3d_energy_plot[][]=0	//	mat3d_eplot_Raman(n_low,n_high)	i=n_low	Do		mat3d_energy_plot[][]+=mat3d[p][i][q]		i+=1	While(i<n_high)	return 0End//********************************************************************************************************************************Function mat3d_eplot_Raman(n_low,n_high)	Variable n_low	Variable n_high	Pauseupdate; Silent 1	Wave mat3d	Wave mat3d_energy_plot	Variable i	i=n_low	Do		mat3d_energy_plot[][]+=mat3d[p][i][q]		i+=1	While(i<n_high)End//********************************************************************************************************************************Function SliderProc_sliderrightRaman4_3D(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Pauseupdate;Silent 1	Variable/G mat3d_energy_wide	Variable/G mat3d_energy_center		Variable/G leftRaman4_3Dspectra_value		Variable/G rightRaman4_3Dspectra_value		Wave rightRaman4_3Dspectra_x	Wave mat3d	Wave mat3d_energy_plot	Variable n_low,n_high,i	Variable e_low,e_high	if(event %& 0x1)	// bit 0, value set		endif	rightRaman4_3Dspectra_value=sliderValue	rightRaman4_3Dspectra_x[]=sliderValue	mat3d_energy_center=(leftRaman4_3Dspectra_value+rightRaman4_3Dspectra_value)/2	mat3d_energy_wide=abs(leftRaman4_3Dspectra_value-rightRaman4_3Dspectra_value)	e_low=mat3d_energy_center-mat3d_energy_wide/2	e_high=mat3d_energy_center+mat3d_energy_wide/2		n_low=Round((e_low-dimoffset(mat3d,1))/dimdelta(mat3d,1))	n_high=Round((e_high-dimoffset(mat3d,1))/dimdelta(mat3d,1))		mat3d_energy_plot[][]=0		i=n_low	Do		mat3d_energy_plot[][]+=mat3d[p][i][q]		i+=1	While(i<n_high)	return 0End//********************************************************************************************************************************Proc doallcvt2k()	PauseUpdate	Silent 1	String name	Variable i	i=0	Do		name="cut"+num2str(phiindex[i])		rescale_pi(name,1,+1.2)		cvt2ek_pi(name,1,69.2,phiindex[i]+11)//		rescale_pi(name,1,-6.9)//		cvt2ek_pi(name,1,17.658,phiindex[i]-7)//		rescale_pi(name,1,-11)//		cvt2ek_pi(name,1,17.658,phiindex[i]-13)		i+=1	While(i<dimsize(phiindex,0))End	//********************************************************************************************************************************Proc ini1Raman4_3D()	pauseupdate	silent 1	Variable/G mat3d_energy_center,mat3d_energy_wide,mat3d_energy_increment	Variable/G mat3d_energy_min,mat3d_energy_max	Variable/G showsq_Raman4_3D	Make/O/N=(dimsize(mat3d,1)) Raman4_3Dspectra	Setscale/P x,dimoffset(mat3d,1),dimdelta(mat3d,1),"" Raman4_3Dspectra	Raman4_3Dspectra[]=mat3d[0][p][0]	wavestats/Q Raman4_3Dspectra	Make/O/N=2 leftRaman4_3Dspectra_x	Make/O/N=2 rightRaman4_3Dspectra_x	Make/O/N=2 leftRaman4_3Dspectra_y	Make/O/N=2 rightRaman4_3Dspectra_y	showsq_Raman4_3D=0		leftRaman4_3Dspectra_x[]=mat3d_energy_center-mat3d_energy_wide/2	rightRaman4_3Dspectra_x[]=mat3d_energy_center+mat3d_energy_wide/2	leftRaman4_3Dspectra_y[0]=V_min	rightRaman4_3Dspectra_y[0]=V_min	leftRaman4_3Dspectra_y[1]=V_max	rightRaman4_3Dspectra_y[1]=V_max	Make/O/N=5 sq4Raman_3D_y		Make/O/N=5 sq4Raman_3D_x	sq4Raman_3D_y[]=dimoffset(mat3d,2)	sq4Raman_3D_x[]=dimoffset(mat3d,0)		End	//********************************************************************************************************************************Proc ini2Raman4_3D()	pauseupdate	silent 1	Variable/G mat3d_energy_center,mat3d_energy_wide,mat3d_energy_increment	Variable/G mat3d_energy_min,mat3d_energy_max	Variable/G leftRaman4_3Dspectra_value	Variable/G rightRaman4_3Dspectra_value	//	Slider sliderleftRaman4_3D,pos={21,40},size={200,45},proc=SliderProc_sliderleftRaman4_3D	Slider sliderleftRaman4_3D,limits={dimoffset(mat3d,1),dimoffset(mat3d,1)+(dimsize(mat3d,1)-1)*dimdelta(mat3d,1),dimdelta(mat3d,1)},value= mat3d_energy_center-mat3d_energy_wide/2,vert= 0//	Slider sliderrightRaman4_04,pos={250,40},size={200,45},proc=SliderProc_sliderrightRaman4_3D	Slider sliderrightRaman4_3D,limits={dimoffset(mat3d,1),dimoffset(mat3d,1)+(dimsize(mat3d,1)-1)*dimdelta(mat3d,1),dimdelta(mat3d,1)},value= mat3d_energy_center+mat3d_energy_wide/2,vert= 0,thumbColor= (0,26214,13293)	Slider sliderleftRaman4_3D, ticks=1	Slider sliderrightRaman4_3D, ticks=1		Slider slider_sqleft,limits={0,dimsize(mat3d,0)-1,1},value= 0,vert= 0	Slider slider_sqright,limits={0,dimsize(mat3d,0)-1,1},value= 0,vert= 0	Slider slider_sqbottom,limits={0,dimsize(mat3d,2)-1,1},value= 0,vert= 1	Slider slider_sqtop,limits={0,dimsize(mat3d,2)-1,1},value= 0,vert= 1		Make/O/N=(dimsize(mat3d,1)) Raman4_3Dspectra	Setscale/P x,dimoffset(mat3d,1),dimdelta(mat3d,1),"" Raman4_3Dspectra	Raman4_3Dspectra[]=mat3d[0][p][0]	wavestats/Q Raman4_3Dspectra	Make/O/N=2 leftRaman4_3Dspectra_x	Make/O/N=2 rightRaman4_3Dspectra_x	Make/O/N=2 leftRaman4_3Dspectra_y	Make/O/N=2 rightRaman4_3Dspectra_y	leftRaman4_3Dspectra_value=dimoffset(mat3d,1)	rightRaman4_3Dspectra_value=dimoffset(mat3d,1)			leftRaman4_3Dspectra_x[]=mat3d_energy_center-mat3d_energy_wide/2	rightRaman4_3Dspectra_x[]=mat3d_energy_center+mat3d_energy_wide/2	leftRaman4_3Dspectra_y[0]=V_min	rightRaman4_3Dspectra_y[0]=V_min	leftRaman4_3Dspectra_y[1]=V_max	rightRaman4_3Dspectra_y[1]=V_max	End	//********************************************************************************************************************************Proc initmat3d()	pauseupdate	silent 1	Variable/G mat3d_energy_center,mat3d_energy_wide,mat3d_energy_increment	Variable/G mat3d_energy_min,mat3d_energy_max	mat3d_energy_min=dimoffset(mat3d,1)	mat3d_energy_max=dimoffset(mat3d,1)+(dimsize(mat3d,1)-1)*dimdelta(mat3d,1)	mat3d_energy_center=mat3d_energy_min	mat3d_energy_wide=0.04	mat3d_energy_increment=0.01	Make/O/N=(dimsize(mat3d,0),dimsize(mat3d,2)) mat3d_energy_plot	Setscale/P x,dimoffset(mat3d,0),dimdelta(mat3d,0),""mat3d_energy_plot	Setscale/P y,dimoffset(mat3d,2),dimdelta(mat3d,2),""mat3d_energy_plot			mat3d_energy_plot[][]=0			End//********************************************************************************************************************************Proc initmat3dVD()	pauseupdate	silent 1	Variable/G mat3dVD_energy_center,mat3dVD_energy_wide,mat3dVD_energy_increment	Variable/G mat3dVD_energy_min,mat3dVD_energy_max	mat3dVD_energy_min=dimoffset(mat3dVD,1)	mat3dVD_energy_max=dimoffset(mat3dVD,1)+(dimsize(mat3dVD,1)-1)*dimdelta(mat3dVD,1)	mat3dVD_energy_center=mat3dVD_energy_min	mat3dVD_energy_wide=0.04	mat3dVD_energy_increment=0.01	Make/O/N=(dimsize(mat3dVD,0),dimsize(mat3d,2)) mat3dVD_energy_plot	Setscale/P x,dimoffset(mat3dVD,0),dimdelta(mat3d,0),""mat3dVD_energy_plot	Setscale/P y,dimoffset(mat3dVD,2),dimdelta(mat3d,2),""mat3dVD_energy_plot			mat3dVD_energy_plot[][]=0			End//********************************************************************************************************************************Proc initmat3dHD()	pauseupdate	silent 1	Variable/G mat3dHD_energy_center,mat3dHD_energy_wide,mat3dHD_energy_increment	Variable/G mat3dHD_energy_min,mat3dHD_energy_max	mat3dHD_energy_min=dimoffset(mat3dHD,1)	mat3dHD_energy_max=dimoffset(mat3dHD,1)+(dimsize(mat3dHD,1)-1)*dimdelta(mat3dHD,1)	mat3dHD_energy_center=mat3dHD_energy_min	mat3dHD_energy_wide=0.04	mat3dHD_energy_increment=0.01	Make/O/N=(dimsize(mat3dHD,0),dimsize(mat3d,2)) mat3dHD_energy_plot	Setscale/P x,dimoffset(mat3dHD,0),dimdelta(mat3d,0),""mat3dHD_energy_plot	Setscale/P y,dimoffset(mat3dHD,2),dimdelta(mat3d,2),""mat3dHD_energy_plot			mat3dHD_energy_plot[][]=0			End//********************************************************************************************************************************Proc initmat3dk()	pauseupdate	silent 1	Variable/G mat3dk_energy_center,mat3dk_energy_wide,mat3dk_energy_increment	Variable/G mat3dk_energy_min,mat3dk_energy_max	mat3dk_energy_min=dimoffset(mat3dk,2)	mat3dk_energy_max=dimoffset(mat3dk,2)+(dimsize(mat3dk,2)-1)*dimdelta(mat3dk,2)	mat3dk_energy_center=mat3dk_energy_min	mat3dk_energy_wide=0.04	mat3dk_energy_increment=0.01	Make/O/N=(dimsize(mat3dk,0),dimsize(mat3dk,1)) mat3dk_energy_plot	Setscale/P x,dimoffset(mat3dk,0),dimdelta(mat3dk,0),""mat3dk_energy_plot	Setscale/P y,dimoffset(mat3dk,1),dimdelta(mat3dk,1),""mat3dk_energy_plot		mat3dk_energy_plot[][]=0				End//********************************************************************************************************************************Proc initmat3dkVD()	pauseupdate	silent 1	Variable/G mat3dkVD_energy_center,mat3dkVD_energy_wide,mat3dkVD_energy_increment	Variable/G mat3dkVD_energy_min,mat3dkVD_energy_max	mat3dkVD_energy_min=dimoffset(mat3dkVD,2)	mat3dkVD_energy_max=dimoffset(mat3dkVD,2)+(dimsize(mat3dkVD,2)-1)*dimdelta(mat3dkVD,2)	mat3dkVD_energy_center=mat3dkVD_energy_min	mat3dkVD_energy_wide=0.04	mat3dkVD_energy_increment=0.01	Make/O/N=(dimsize(mat3dkVD,0),dimsize(mat3dkVD,1)) mat3dkVD_energy_plot	Setscale/P x,dimoffset(mat3dkVD,0),dimdelta(mat3dkVD,0),""mat3dkVD_energy_plot	Setscale/P y,dimoffset(mat3dkVD,1),dimdelta(mat3dkVD,1),""mat3dkVD_energy_plot		mat3dkVD_energy_plot[][]=0				End//********************************************************************************************************************************Proc initmat3dkHD()	pauseupdate	silent 1	Variable/G mat3dkHD_energy_center,mat3dkHD_energy_wide,mat3dkHD_energy_increment	Variable/G mat3dkHD_energy_min,mat3dkHD_energy_max	mat3dkHD_energy_min=dimoffset(mat3dkHD,2)	mat3dkHD_energy_max=dimoffset(mat3dkHD,2)+(dimsize(mat3dkHD,2)-1)*dimdelta(mat3dkHD,2)	mat3dkHD_energy_center=mat3dkHD_energy_min	mat3dkHD_energy_wide=0.04	mat3dkHD_energy_increment=0.01	Make/O/N=(dimsize(mat3dkHD,0),dimsize(mat3dkHD,1)) mat3dkHD_energy_plot	Setscale/P x,dimoffset(mat3dkHD,0),dimdelta(mat3dkHD,0),""mat3dkHD_energy_plot	Setscale/P y,dimoffset(mat3dkHD,1),dimdelta(mat3dkHD,1),""mat3dkHD_energy_plot		mat3dkHD_energy_plot[][]=0				End//********************************************************************************************************************************Proc ini_making_fs()	pauseupdate	silent 1	Variable/G theta_zero,phi_zero,rot_zero,KEatEF,lattice_0	Variable/G theta_zero_inc,phi_zero_inc,rot_zero_inc,lattice_0_inc	Variable/G global_mu,global_t,global_tprime	Variable/G global_mu_inc,global_t_inc,global_tprime_inc		Variable/G global_x	Variable/G Mode_mfs4						if(Exists("original_theta")==0)		Make/O/N=0 original_theta		Make/O/N=0 theta_shifted		Make/O/N=0 original_phi		Make/O/N=0 phi_shifted		Make/O/N=0 kx_norot		Make/O/N=0 ky_norot		Make/O/N=0 kx_final		Make/O/N=0 ky_final		Make/O/N=0 kx_finalrot		Make/O/N=0 ky_finalrot		Make/O/N=0 original_eta		Make/O/N=0 original_data		Make/O/N=0 original_rtheta		Make/O/N=0 original_rphi		Make/O/N=0 original_slice				Edit original_theta,original_phi,original_rtheta,original_rphi,original_eta,original_data,original_slice,theta_shifted,phi_shifted,kx_norot,ky_norot,kx_final,ky_final,kx_finalrot,ky_finalrot		Dowindow/C table_making_fs	Endif	Make/O/N=3 global_parameters	global_parameters[]=0	theta_zero=0	phi_zero=0	rot_zero=0	KEatEF=16.8244	lattice_0=0.84	theta_zero_inc=0.005	phi_zero_inc=0.005	rot_zero_inc=0.2	lattice_0_inc=0.002	global_mu=	0.035	global_t=-0.3958	global_tprime=0.1642	global_mu_inc=0.001	global_t_inc=0.001	global_tprime_inc=0.001	global_parameters[0]=global_mu	global_parameters[1]=global_t	global_parameters[2]=global_tprime	global_x=0						Mode_mfs4=1	Dowindow/F making_fs	Dowindow/F table_making_fsEnd//********************************************************************************************************************************Proc ini_making_fs2f()	pauseupdate	silent 1	Variable/G theta_zero,phi_zero,rot_zero,KEatEF,lattice_0	Variable/G theta_zero_inc,phi_zero_inc,rot_zero_inc,lattice_0_inc	Variable/G global_mu,global_t,global_tprime	Variable/G global_mu_inc,global_t_inc,global_tprime_inc		Variable/G global_x	Variable/G aonb,aonb_inc					Variable/G viewFS2f	String/G ViewFS2fstr	if(Exists("original_theta")==0)		Make/O/N=0 original_theta		Make/O/N=0 theta_shifted		Make/O/N=0 original_phi		Make/O/N=0 phi_shifted		Make/O/N=0 kx_norot		Make/O/N=0 ky_norot		Make/O/N=0 kx_final		Make/O/N=0 ky_final		Make/O/N=0 kx_finalrot		Make/O/N=0 ky_finalrot		Edit original_theta,original_phi,theta_shifted,phi_shifted,kx_norot,ky_norot,kx_final,ky_final,kx_finalrot,ky_finalrot		Dowindow/C table_making_fs	Endif	Make/O/N=3 global_parameters	global_parameters[]=0	theta_zero=0	phi_zero=0	rot_zero=0	KEatEF=21.2182	lattice_0=0.84	theta_zero_inc=0.005	phi_zero_inc=0.005	rot_zero_inc=0.2	lattice_0_inc=0.002	global_mu=	0.035	global_t=-0.3958	global_tprime=0.1642	global_mu_inc=0.001	global_t_inc=0.001	global_tprime_inc=0.001	global_parameters[0]=global_mu	global_parameters[1]=global_t	global_parameters[2]=global_tprime	global_x=0						aonb=1.2	aonb_inc=0.01	ViewFS2f=6	ViewFS2fstr="2"End//********************************************************************************************************************************Proc ini_making_fsH()	pauseupdate	silent 1	Variable/G theta_zero,phi_zero,rot_zero,KEatEF,lattice_0	Variable/G theta_zero_inc,phi_zero_inc,rot_zero_inc,lattice_0_inc	Variable/G FS_H_type	Variable/G lattice_hexagon			Variable/G lattice_hexagon_inc	Variable/G global_x					if(Exists("original_theta")==0)		Make/O/N=0 original_theta		Make/O/N=0 theta_shifted		Make/O/N=0 original_phi		Make/O/N=0 phi_shifted		Make/O/N=0 kx_norot		Make/O/N=0 ky_norot		Make/O/N=0 kx_final		Make/O/N=0 ky_final		Make/O/N=0 kx_finalrot		Make/O/N=0 ky_finalrot		Edit original_theta,original_phi,theta_shifted,phi_shifted,kx_norot,ky_norot,kx_final,ky_final,kx_finalrot,ky_finalrot		Dowindow/C table_making_fs	Endif	theta_zero=0	phi_zero=0	rot_zero=0	KEatEF=21.2182	lattice_0=1.12	theta_zero_inc=0.005	phi_zero_inc=0.005	rot_zero_inc=0.2	lattice_0_inc=0.002	FS_H_type=1	lattice_hexagon=0.5	lattice_hexagon_inc=0.01		global_x=0						End//********************************************************************************************************************************Proc ini_predict_cuts()	pauseupdate	silent 1	Variable/G predictKEatEF,predictlattice_0	Variable/G predictlattice_0_inc	Variable/G predict_mu,global_t,predict_tprime	Variable/G predict_t	Variable/G predict_mu_inc,predict_t_inc,predict_tprime_inc		Variable/G predict_x		Variable/G predict_angletheta_from,predict_angletheta_to, predict_angletheta_delta	Variable/G predict_anglephi_from,predict_anglephi_to,predict_anglephi_delta	Variable/G predict_acept	Variable/G predict_rotation		Variable/G predict_VvsHslit		Variable/G predictwedge_inc	Variable/G predictrotation_inc	Variable/G predict_orientation			Make/O/N=3 predict_parameters	predict_parameters[]=0	predictKEatEF=16.8	predictlattice_0=0.83	predictlattice_0_inc=0.002	predict_mu=0.173	predict_t=-0.646	predict_tprime=0.181	predict_mu_inc=0.001	predict_t_inc=0.001	predict_tprime_inc=0.001	predict_parameters[0]=predict_mu	predict_parameters[1]=predict_t	predict_parameters[2]=predict_tprime	predict_x=0		predict_acept=30	predict_anglephi_from=0	predict_anglephi_to=0	predict_anglephi_delta=12	predict_angletheta_delta=2		predict_angletheta_from=-15	predict_angletheta_to=15	predict_rotation=0	predict_VvsHslit=2	predict_orientation=2		predictwedge_inc=1	predictrotation_inc=1End//********************************************************************************************************************************Function SetVarProc_central_ifs4(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G auto_update_ifs4	If(auto_update_ifs4==2)		Execute "Update_image_fs()"	EndifEnd//********************************************************************************************************************************Function SetVarProc_irange_ifs4(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G auto_update_ifs4	If(auto_update_ifs4==2)		Execute "Update_image_fs()"	EndifEnd//********************************************************************************************************************************Proc ini_image_fs()	pauseupdate	silent 1	Variable/G theta1_zero,phi1_zero,rot1_zero,KEatEF,lattice1_0	Variable/G theta1_zero_inc,phi1_zero_inc,rot1_zero_inc,lattice1_0_inc	Variable/G global_mu,global_t,global_tprime	Variable/G global_mu_inc,global_t_inc,global_tprime_inc		Variable/G global_x		Variable/G quality_factor	Variable/G mode_ifs4	Variable/G central_ifs4	Variable/G irange_ifs4	Variable/G auto_update_ifs4			// Vrifier si making_fs est ouvert ou non	If(Exists("global_parameters")==0)		Make/O/N=3 global_parameters		global_parameters[]=0		global_mu=	0.035		global_t=-0.3958		global_tprime=0.1642		global_mu_inc=0.001		global_t_inc=0.001		global_tprime_inc=0.001		global_parameters[0]=global_mu		global_parameters[1]=global_t		global_parameters[2]=global_tprime		global_x=0				KEatEF=69.106						Endif	auto_update_ifs4=1	mode_ifs4=1	central_ifs4=16.8244	irange_ifs4=0.01	quality_factor=2	theta1_zero=0	phi1_zero=0	rot1_zero=0	lattice1_0=0.82	theta1_zero_inc=0.005	phi1_zero_inc=0.005	rot1_zero_inc=0.2	lattice1_0_inc=0.002End//********************************************************************************************************************************Proc ini_image_fs2f()	pauseupdate	silent 1	Variable/G theta1_zero,phi1_zero,rot1_zero,KEatEF,lattice1_0	Variable/G theta1_zero_inc,phi1_zero_inc,rot1_zero_inc,lattice1_0_inc	Variable/G global_mu,global_t,global_tprime	Variable/G global_mu_inc,global_t_inc,global_tprime_inc		Variable/G global_x		Variable/G quality_factor	Variable/G aonb,aonb_inc	Variable/G viewFS2f_1	String/G ViewFS2fstr_1// Vrifier si making_fs est ouvert ou non	If(Exists("global_parameters")==0)		Make/O/N=3 global_parameters		global_parameters[]=0		global_mu=	0.035		global_t=-0.3958		global_tprime=0.1642		global_mu_inc=0.001		global_t_inc=0.001		global_tprime_inc=0.001		global_parameters[0]=global_mu		global_parameters[1]=global_t		global_parameters[2]=global_tprime		global_x=0				KEatEF=21.2182						Endif	quality_factor=2	theta1_zero=0	phi1_zero=0	rot1_zero=0	lattice1_0=0.82	theta1_zero_inc=0.01	phi1_zero_inc=0.01	rot1_zero_inc=0.2	lattice1_0_inc=0.002	aonb=1.2	aonb_inc=0.01	viewFS2f_1=6	ViewFS2fstr_1="2"End//********************************************************************************************************************************Proc ini_mat3dslicer()	pauseupdate	silent 1	Variable/G Hline_slice	Variable/G Hline_slice_min	Variable/G Hline_slice_max	Variable/G Hline_slice_delta	Variable/G Vline_slice	Variable/G Vline_slice_min			Variable/G Vline_slice_max	Variable/G Vline_slice_delta	Variable/G VvsHline	Variable/G whichmat3d	Variable/G sliderH	Variable/G sliderV	Variable/G Slicermode	Variable/G Csrx1forslicer	Variable/G Csry1forslicer	Variable/G Csrx2forslicer	Variable/G Csry2forslicer	Variable/G whichpnt	Variable/G valuespecialforslicer		Variable/G numcombslicer	valuespecialforslicer=1	whichpnt=1	Csrx1forslicer=0	Csry1forslicer=0		Csrx2forslicer=0	Csry2forslicer=0						Hline_slice=0	Hline_slice_min=0	Hline_slice_max=0	Hline_slice_delta=0	Vline_slice=0	Vline_slice_min=0	Vline_slice_max=0	Vline_slice_delta=0	numcombslicer=1		whichmat3d=1	VvsHline=2	Slicermode=1	Make/O/N=2 Hline_slicey	Make/O/N=2 Hline_slicex	Hline_slicey[]=(2*dimoffset(mat3d,2)+dimdelta(mat3d,2)*dimsize(mat3d,2))/2	Hline_slicex[0]=dimoffset(mat3d,0)	Hline_slicex[1]=dimoffset(mat3d,0)+dimdelta(mat3d,0)*(dimsize(mat3d,0)-1)		If(Exists("imageforslicer")==0)		Duplicate/O mat3d_energy_plot imageforslicer			EndifEnd//********************************************************************************************************************************Proc update_making_fs()	pauseupdate	silent 1	Variable/G mode_mfs4	If(mode_mfs4==1)		update_making_fs_approx()	Endif	if(mode_mfs4==2)		update_making_fs_exact()	EndifEnd//********************************************************************************************************************************Proc update_making_fs_approx()	pauseupdate	silent 1	Variable i,size_final	Duplicate/O original_theta theta_shifted	Duplicate/O original_phi phi_shifted		theta_shifted[]=original_theta[p]+theta_zero		phi_shifted[]=original_phi[p]+phi_zero		Duplicate/O original_theta kx_norot	Duplicate/O original_theta ky_norot		kx_norot[]=0.51231*sqrt(KEatEF)*sin(theta_shifted[p]*pi/180)	ky_norot[]=0.51231*sqrt(KEatEF)*cos(theta_shifted[p]*pi/180)*sin(phi_shifted[p]*pi/180)	Duplicate/O original_theta kx_final	Duplicate/O original_theta ky_final	kx_final[]=(kx_norot[p]*cos(rot_zero*pi/180)-ky_norot[p]*sin(rot_zero*pi/180))/lattice_0	ky_final[]=(kx_norot[p]*sin(rot_zero*pi/180)+ky_norot[p]*cos(rot_zero*pi/180))/lattice_0	Make/O/N=(5*dimsize(original_theta,0)) kx_finalrot				Make/O/N=(5*dimsize(original_theta,0)) ky_finalrot	kx_finalrot[]=0	ky_finalrot[]=0	size_final=dimsize(original_theta,0)	i=0	Do		kx_finalrot[i]=-ky_final[i]		ky_finalrot[i]=kx_final[i]		kx_finalrot[i+size_final]=-kx_final[i]		ky_finalrot[i+size_final]=-ky_final[i]		kx_finalrot[i+2*size_final]=ky_final[i]		ky_finalrot[i+2*size_final]=-kx_final[i]		kx_finalrot[i+3*size_final]=kx_final[i]		ky_finalrot[i+3*size_final]=-ky_final[i]		kx_finalrot[i+4*size_final]=-kx_final[i]		ky_finalrot[i+4*size_final]=ky_final[i]				i+=1	While(i<size_final)End//********************************************************************************************************************************Proc update_making_fs_exact()	pauseupdate	silent 1	Variable/G SRC_vs_BNL	Variable i,size_final	Duplicate/O original_rtheta theta_shifted	Duplicate/O original_rphi phi_shifted		theta_shifted[]=original_rtheta[p]+theta_zero		phi_shifted[]=original_rphi[p]+phi_zero		Duplicate/O original_rtheta kx_norot	Duplicate/O original_rtheta ky_norot		If(SRC_vs_BNL==1)		kx_norot[]=0.51231*sqrt(KEatEF)*sin(theta_shifted[p]*pi/180)*cos(original_eta[p]*pi/180)		ky_norot[]=0.51231*sqrt(KEatEF)*(cos(theta_shifted[p]*pi/180)*sin(phi_shifted[p]*pi/180)*cos(original_eta[p]*pi/180)+cos(phi_shifted[p]*pi/180)*sin(original_eta[p]*pi/180))				Else			kx_norot[]=0.51231*sqrt(KEatEF)*(sin(theta_shifted[p]*pi/180)*cos(original_eta[p]*pi/180)+cos(theta_shifted[p]*pi/180)*sin(original_eta[p]*pi/180))			ky_norot[]=0.51231*sqrt(KEatEF)*(cos(theta_shifted[p]*pi/180)*sin(phi_shifted[p]*pi/180)*cos(original_eta[p]*pi/180)+sin(phi_shifted[p]*pi/180)*sin(phi_shifted[p]*pi/180)*sin(original_eta[p]*pi/180))				Endif	Duplicate/O original_theta kx_final	Duplicate/O original_theta ky_final	kx_final[]=(kx_norot[p]*cos(rot_zero*pi/180)-ky_norot[p]*sin(rot_zero*pi/180))/lattice_0	ky_final[]=(kx_norot[p]*sin(rot_zero*pi/180)+ky_norot[p]*cos(rot_zero*pi/180))/lattice_0	Make/O/N=(5*dimsize(original_theta,0)) kx_finalrot				Make/O/N=(5*dimsize(original_theta,0)) ky_finalrot	kx_finalrot[]=0	ky_finalrot[]=0	size_final=dimsize(original_theta,0)	i=0	Do		kx_finalrot[i]=-ky_final[i]		ky_finalrot[i]=kx_final[i]		kx_finalrot[i+size_final]=-kx_final[i]		ky_finalrot[i+size_final]=-ky_final[i]		kx_finalrot[i+2*size_final]=ky_final[i]		ky_finalrot[i+2*size_final]=-kx_final[i]		kx_finalrot[i+3*size_final]=kx_final[i]		ky_finalrot[i+3*size_final]=-ky_final[i]		kx_finalrot[i+4*size_final]=-kx_final[i]		ky_finalrot[i+4*size_final]=ky_final[i]				i+=1	While(i<size_final)End//********************************************************************************************************************************Proc update_image_fs()	pauseupdate	silent 1	Variable/G mode_ifs4	If(mode_ifs4==1)		update_image_fs_approx()	Endif	If(mode_ifs4==2)		update_image_fs_exact()	EndifEnd	//********************************************************************************************************************************Proc update_image_fs_approx()	pauseupdate	silent 1	String/G colordefault	Variable/G colordefaultinv	Variable/G theta1_zero,phi1_zero,KEatEF,quality_factor			String newname,old_image_list,old_image	Variable i	old_image_list=ImageNameList("image_fs_ploter",";")	old_image=StringFromList(0,old_image_list)	If(WaveExists($old_image)==1)		Removeimage $old_image	Endif	Duplicate/O mat3d_energy_plot image_fs_plot	mat2dk_pi("image_fs_plot",theta1_zero,phi1_zero,KEatEF)	Duplicate/O image_fs_plot_k image_fs_plot	Killwaves image_fs_plot_k	rot2dimage_pi("image_fs_plot",rot1_zero,0,0,quality_factor)	Setscale/P x,dimoffset(image_fs_plot,0)/lattice1_0,dimdelta(image_fs_plot,0)/lattice1_0,""image_fs_plot	Setscale/P y,dimoffset(image_fs_plot,1)/lattice1_0,dimdelta(image_fs_plot,1)/lattice1_0,""image_fs_plot				Appendimage image_fs_plot	ModifyImage image_fs_plot ctab= {-0.034676,1.4611,Terrain,0}	End//********************************************************************************************************************************Proc mat2dk_pi(mat2d,offset_theta,offset_phi,Kenergy)	String mat2d	Variable offset_theta	Variable offset_phi	Variable Kenergy	Prompt mat2d,"Enter the name of the matrix"	Prompt offset_theta,"Enter the theta value to add:"	Prompt offset_theta,"Enter the theta value to add:"	Prompt Kenergy,"Enter kenetic energy"	PauseUpdate	Silent 1	String mat2dk	Variable ktheta_min,ktheta_max,delta_ktheta,number_of_ktheta	Variable kphi_min,kphi_max,delta_kphi,number_of_kphi	Variable iktheta,ikphi	Variable sqrtKE,ktheta,kphi	Variable theta,phi,phi_min,phi_max,theta_min,theta_max	Variable i,j	Variable factor_src_bnl1,factor_src_bnl2	Variable/G SRC_vs_BNL	If(SRC_vs_BNL==0)		factor_src_bnl1=1.2		factor_src_bnl2=1.6		Else		factor_src_bnl1=1.6		factor_src_bnl2=1.2				Endif	mat2dk=mat2d+"_k"	//Find the k-limits of the new matrix and creating mat2dk	ktheta_min=0.51231*sqrt(Kenergy)*sin((dimoffset($mat2d,0)+offset_theta)*Pi/180)	ktheta_max=0.51231*sqrt(Kenergy)*sin((dimoffset($mat2d,0)+(dimsize($mat2d,0)-1)*dimdelta($mat2d,0)+offset_theta)*Pi/180)	number_of_ktheta=Round(dimsize($mat2d,0)*factor_src_bnl1)	delta_ktheta=(ktheta_max-ktheta_min)/(number_of_ktheta-1)	Make/O/N=(dimsize(mat3d,0)) tempwavephi	tempwavephi[]=0.51231*sqrt(Kenergy)*cos((dimoffset($mat2d,0)+offset_theta+p*dimdelta($mat2d,0))*pi/180)*sin((dimoffset($mat2d,1)+offset_phi)*Pi/180)		wavestats/Q tempwavephi	kphi_min=V_min	Make/O/N=(dimsize(mat3d,0)) tempwavephi	tempwavephi[]=0.51231*sqrt(Kenergy)*cos((dimoffset($mat2d,0)+offset_theta+p*dimdelta($mat2d,0))*pi/180)*sin((dimoffset($mat2d,1)+offset_phi+(dimsize($mat2d,1)-1)*dimdelta($mat2d,1))*Pi/180)		wavestats/Q tempwavephi	kphi_max=V_max		killwaves tempwavephi		number_of_kphi=Round(dimsize($mat2d,1)*factor_src_bnl2)	delta_kphi=(kphi_max-kphi_min)/(number_of_kphi-1)	Make/O/N=(number_of_ktheta,number_of_kphi) $mat2dk	Setscale/P x,ktheta_min,delta_ktheta,""$mat2dk	Setscale/P y,kphi_min,delta_kphi,""$mat2dk//	Setscale/P z,dimoffset($mat2d,1)-fermi_level,dimdelta($mat2d,1),""$mat2dk	phi_min=dimoffset($mat2d,1)+offset_phi	phi_max=dimoffset($mat2d,1)+offset_phi+dimdelta($mat2d,1)*(dimsize($mat2d,1)-1)	theta_min=dimoffset($mat2d,0)+offset_theta	theta_max=dimoffset($mat2d,0)+offset_theta+dimdelta($mat2d,0)*(dimsize($mat2d,0)-1)		i=0	j=0	func_mat2dk_pi($mat2d,$mat2dk,offset_theta,offset_phi,ktheta_min,delta_ktheta,ktheta_max,number_of_ktheta,kphi_min,kphi_max,delta_kphi,number_of_kphi,theta_min,theta_max,phi_min,phi_max,ktheta,kphi,iktheta,ikphi,i,theta,phi,Kenergy)End	//********************************************************************************************************************************	function func_mat2dk_pi(mat2d,matrix2dk,offset_theta,offset_phi,ktheta_min,delta_ktheta,ktheta_max,number_of_ktheta,kphi_min,kphi_max,delta_kphi,number_of_kphi,theta_min,theta_max,phi_min,phi_max,ktheta,kphi,iktheta,ikphi,i,theta,phi,Kenergy)	Wave mat2d,matrix2dk		Variable offset_theta	Variable offset_phi	Variable ktheta_min,ktheta_max,delta_ktheta,number_of_ktheta	Variable kphi_min,kphi_max,delta_kphi,number_of_kphi	Variable phi_min,phi_max,theta_min,theta_max	Variable ktheta,kphi,iktheta,ikphi,i,theta,phi,Kenergy	Variable sqrtKE	sqrtKE=sqrt(Kenergy)	Duplicate/O mat2d wave2d	Setscale/P x,dimoffset(mat2d,0)+offset_theta,dimdelta(mat2d,0),""wave2d	Setscale/P y,dimoffset(mat2d,1)+offset_phi,dimdelta(mat2d,1),""wave2d	iktheta=0	Do		ktheta=ktheta_min+delta_ktheta*iktheta		theta=asin(ktheta/(0.51231*sqrtKE))*180/Pi //not an integer.		ikphi=0		Do			kphi=kphi_min+delta_kphi*ikphi			phi=asin(kphi/(0.51231*sqrtKE*cos(theta*Pi/180)))*180/Pi			matrix2dk[iktheta][ikphi]=interp2d(wave2d,theta,phi)			ikphi+=1		While(ikphi<number_of_kphi)		iktheta+=1	While(iktheta<number_of_ktheta)	Killwaves wave2dEnd		//********************************************************************************************************************************Proc rot2dimage_pi(mat,angle,px,py,quality_fact)	String mat	Variable angle	Variable px=0	Variable py=0	Variable quality_fact	Prompt mat,"Enter the name of the matrix"	Prompt angle,"Enter the rotation angle (degrees, counterclockwise)"	Prompt px,"Enter the x value of the pivot point"	Prompt py,"Enter the y value of the pivot point"		Prompt Quality_fact,"Enter the quality factor"			Pauseupdate; silent 1	Variable x_0,x_last,delta_x,y_0,y_last,delta_y,total_x,total_y	Variable new_xoffset,new_xlast,new_yoffset,new_ylast	Variable top,bottom,left,right	Variable newsize_x,newsize_y	Variable new_delta	Variable valuex,valuey	Variable oldx,oldy	Variable i,j	String nnewmat,c_mat	nnewmat=mat+"_"+"rot"+num2str(angle)	x_0=dimoffset($mat,0)	y_0=dimoffset($mat,1)	delta_x=dimdelta($mat,0)	delta_y=dimdelta($mat,1)	total_x=dimsize($mat,0)	total_y=dimsize($mat,1)	x_last=x_0+delta_x*(total_x-1)	y_last=y_0+delta_y*(total_y-1)	angle*=-1	//Find the borders of the new matrix	i=0	Do		c_mat="cmat"+num2str(i)		Make/O/N=2 $c_mat		i+=1	While(i<4)		cmat2[0]=(x_last-px)*cos(angle*Pi/180)+(y_last-py)*sin(angle*Pi/180)+px		//upper right	cmat2[1]=-(x_last-px)*sin(angle*Pi/180)+(y_last-py)*cos(angle*Pi/180)+py	cmat1[0]=(x_last-px)*cos(angle*Pi/180)+(y_0-py)*sin(angle*Pi/180)+px		//bottom right	cmat1[1]=-(x_last-px)*sin(angle*Pi/180)+(y_0-py)*cos(angle*Pi/180)+py	cmat3[0]=(x_0-px)*cos(angle*Pi/180)+(y_last-py)*sin(angle*Pi/180)+px		//upper left	cmat3[1]=-(x_0-px)*sin(angle*Pi/180)+(y_last-py)*cos(angle*Pi/180)+py	cmat0[0]=(x_0-px)*cos(angle*Pi/180)+(y_0-py)*sin(angle*Pi/180)+px			//bottom left	cmat0[1]=-(x_0-px)*sin(angle*Pi/180)+(y_0-py)*cos(angle*Pi/180)+py	new_xoffset=cmat0[0]	new_xlast=cmat0[0]	new_yoffset=cmat0[1]	new_ylast=cmat0[1]	i=1	Do		c_mat="cmat"+num2str(i)		If($c_mat[0]<new_xoffset)			new_xoffset=$c_mat[0]		Endif		If($c_mat[0]>new_xlast)			new_xlast=$c_mat[0]		Endif		If($c_mat[1]<new_yoffset)			new_yoffset=$c_mat[1]		Endif		If($c_mat[1]>new_ylast)			new_ylast=$c_mat[1]		Endif					i+=1	While(i<4)	//Set the scaling of the new matrix	new_delta=sqrt((new_xlast-new_xoffset)*(new_ylast-new_yoffset)/(total_x*total_y))/quality_fact      //  /10	newsize_x=Round((new_xlast-new_xoffset)/new_delta)	newsize_y=Round((new_ylast-new_yoffset)/new_delta)	Make/O/N=(newsize_x,newsize_y) $nnewmat	Setscale/P x,new_xoffset,new_delta,"",$nnewmat	Setscale/P y,new_yoffset,new_delta,"",$nnewmat	//Filling the new matrix	func_rot2d_pi($mat,$nnewmat,angle,px,py,new_delta,delta_x,delta_y,newsize_x,newsize_y,new_xoffset,new_yoffset,x_0,x_last,y_0,y_last)	Killwaves cmat0	Killwaves cmat1	Killwaves cmat2	Killwaves cmat3	Duplicate/O $nnewmat image_fs_plot	Killwaves $nnewmatEnd//*******************************************************************************************************************************Function ButtonProc_mat3dkrot(ctrlName) : ButtonControl//"fit MDC"	String ctrlName	Execute "mat3dkrot()"End//*******************************************************************************************************************************Proc mat3dkrot(angle,quality_fact)	Variable angle	Variable quality_fact	Prompt angle,"Enter the rotation angle (degrees, counterclockwise)"	Prompt Quality_fact,"Enter the quality factor"		Pauseupdate; silent 1	rotmat3dk_pi("mat3dk",angle,0,0,quality_fact,1)End//*******************************************************************************************************************************Function ButtonProc_mat3dkVDrot(ctrlName) : ButtonControl//"fit MDC"	String ctrlName	Execute "mat3dkVDrot()"End//*******************************************************************************************************************************Proc mat3dkVDrot(angle,quality_fact)	Variable angle	Variable quality_fact	Prompt angle,"Enter the rotation angle (degrees, counterclockwise)"	Prompt Quality_fact,"Enter the quality factor"		Pauseupdate; silent 1	rotmat3dk_pi("mat3dkVD",angle,0,0,quality_fact,1)End//*******************************************************************************************************************************Function ButtonProc_mat3dkHDrot(ctrlName) : ButtonControl//"fit MDC"	String ctrlName	Execute "mat3dkHDrot()"End//*******************************************************************************************************************************Proc mat3dkHDrot(angle,quality_fact)	Variable angle	Variable quality_fact	Prompt angle,"Enter the rotation angle (degrees, counterclockwise)"	Prompt Quality_fact,"Enter the quality factor"		Pauseupdate; silent 1	rotmat3dk_pi("mat3dkHD",angle,0,0,quality_fact,1)End//********************************************************************************************************************************Proc rotmat3dk_pi(matof3dform,angle,px,py,quality_fact,overwriteornot)	String matof3dform	Variable angle	Variable px=0	Variable py=0	Variable quality_fact	Variable overwriteornot	Prompt matof3dform,"Enter the name of the matrix"	Prompt angle,"Enter the rotation angle (degrees, counterclockwise)"	Prompt px,"Enter the x value of the pivot point"	Prompt py,"Enter the y value of the pivot point"		Prompt Quality_fact,"Enter the quality factor"		Prompt overwriteornot,"Do you want to overwrite?",popup,"YES;NO"		Pauseupdate; silent 1	Variable x_0,x_last,delta_x,y_0,y_last,delta_y,total_x,total_y	Variable new_xoffset,new_xlast,new_yoffset,new_ylast	Variable top,bottom,left,right	Variable newsize_x,newsize_y	Variable new_delta	Variable valuex,valuey	Variable oldx,oldy	Variable i,j	String newmatof3dform,c_mat,mat	mat="thislayer0"	Make/O/N=(dimsize($matof3dform,0),dimsize($matof3dform,1)) $mat	Setscale/P x,dimoffset($matof3dform,0),dimdelta($matof3dform,0),""$mat	Setscale/P y,dimoffset($matof3dform,1),dimdelta($matof3dform,1),""$mat	newmatof3dform=matof3dform+"_"+"rot"+num2str(angle)	print newmatof3dform	x_0=dimoffset($mat,0)	y_0=dimoffset($mat,1)	delta_x=dimdelta($mat,0)	delta_y=dimdelta($mat,1)	total_x=dimsize($mat,0)	total_y=dimsize($mat,1)	x_last=x_0+delta_x*(total_x-1)	y_last=y_0+delta_y*(total_y-1)	angle*=-1	//Find the borders of the new matrix	i=0	Do		c_mat="cmat"+num2str(i)		Make/O/N=2 $c_mat		i+=1	While(i<4)		cmat2[0]=(x_last-px)*cos(angle*Pi/180)+(y_last-py)*sin(angle*Pi/180)+px		//upper right	cmat2[1]=-(x_last-px)*sin(angle*Pi/180)+(y_last-py)*cos(angle*Pi/180)+py	cmat1[0]=(x_last-px)*cos(angle*Pi/180)+(y_0-py)*sin(angle*Pi/180)+px		//bottom right	cmat1[1]=-(x_last-px)*sin(angle*Pi/180)+(y_0-py)*cos(angle*Pi/180)+py	cmat3[0]=(x_0-px)*cos(angle*Pi/180)+(y_last-py)*sin(angle*Pi/180)+px		//upper left	cmat3[1]=-(x_0-px)*sin(angle*Pi/180)+(y_last-py)*cos(angle*Pi/180)+py	cmat0[0]=(x_0-px)*cos(angle*Pi/180)+(y_0-py)*sin(angle*Pi/180)+px			//bottom left	cmat0[1]=-(x_0-px)*sin(angle*Pi/180)+(y_0-py)*cos(angle*Pi/180)+py	new_xoffset=cmat0[0]	new_xlast=cmat0[0]	new_yoffset=cmat0[1]	new_ylast=cmat0[1]	i=1	Do		c_mat="cmat"+num2str(i)		If($c_mat[0]<new_xoffset)			new_xoffset=$c_mat[0]		Endif		If($c_mat[0]>new_xlast)			new_xlast=$c_mat[0]		Endif		If($c_mat[1]<new_yoffset)			new_yoffset=$c_mat[1]		Endif		If($c_mat[1]>new_ylast)			new_ylast=$c_mat[1]		Endif					i+=1	While(i<4)	//Set the scaling of the new matrix	new_delta=sqrt((new_xlast-new_xoffset)*(new_ylast-new_yoffset)/(total_x*total_y))/quality_fact      //  /10	newsize_x=Round((new_xlast-new_xoffset)/new_delta)	newsize_y=Round((new_ylast-new_yoffset)/new_delta)	Make/O/N=(newsize_x,newsize_y,dimsize($matof3dform,2)) $newmatof3dform	Setscale/P x,new_xoffset,new_delta,"",$newmatof3dform	Setscale/P y,new_yoffset,new_delta,"",$newmatof3dform	Setscale/P z,dimoffset($matof3dform,2),dimdelta($matof3dform,2),"",$newmatof3dform		//Filling the new matrix	func_rot3d_pi($matof3dform,$newmatof3dform,angle,px,py,new_delta,delta_x,delta_y,newsize_x,newsize_y,new_xoffset,new_yoffset,x_0,x_last,y_0,y_last)	IF(overwriteornot==1)		Duplicate/O $newmatof3dform $matof3dform		Killwaves $newmatof3dform	Endif	Killwaves cmat0	Killwaves cmat1	Killwaves cmat2	Killwaves cmat3	Killwaves $matEnd//********************************************************************************************************************************Proc prep_bondaries()	pauseupdate	silent 1	Make/O/N=5 BZbondaries_x	Make/O/N=5 BZbondaries_y	Make/O/N=5 MBZbondaries_x	Make/O/N=5 MBZbondaries_y	BZbondaries_x[0]=1	BZbondaries_y[0]=1	BZbondaries_x[1]=-1	BZbondaries_y[1]=1	BZbondaries_x[2]=-1	BZbondaries_y[2]=-1	BZbondaries_x[3]=1	BZbondaries_y[3]=-1	BZbondaries_x[4]=1	BZbondaries_y[4]=1	MBZbondaries_x[0]=0	MBZbondaries_y[0]=1	MBZbondaries_x[1]=-1	MBZbondaries_y[1]=0	MBZbondaries_x[2]=0	MBZbondaries_y[2]=-1	MBZbondaries_x[3]=1	MBZbondaries_y[3]=0		MBZbondaries_x[4]=0	MBZbondaries_y[4]=1End//********************************************************************************************************************************Proc prep_bondaries2f()	pauseupdate	silent 1	Variable/G aonb	Make/O/N=5 BZbondaries_x	Make/O/N=5 BZbondaries_y	Make/O/N=5 MBZbondaries_x	Make/O/N=5 MBZbondaries_y	BZbondaries_x[0]=1	BZbondaries_y[0]=1/aonb	BZbondaries_x[1]=-1	BZbondaries_y[1]=1/aonb	BZbondaries_x[2]=-1	BZbondaries_y[2]=-1/aonb	BZbondaries_x[3]=1	BZbondaries_y[3]=-1/aonb	BZbondaries_x[4]=1	BZbondaries_y[4]=1/aonb	MBZbondaries_x[0]=0	MBZbondaries_y[0]=1/aonb	MBZbondaries_x[1]=-1	MBZbondaries_y[1]=0	MBZbondaries_x[2]=0	MBZbondaries_y[2]=-1/aonb	MBZbondaries_x[3]=1	MBZbondaries_y[3]=0/aonb		MBZbondaries_x[4]=0	MBZbondaries_y[4]=1/aonbEnd//********************************************************************************************************************************Proc predictprep_bondaries()	pauseupdate	silent 1	Make/O/N=5 pBZbondaries_x	Make/O/N=5 pBZbondaries_y	Make/O/N=5 pMBZbondaries_x	Make/O/N=5 pMBZbondaries_y	pBZbondaries_x[0]=1	pBZbondaries_y[0]=1	pBZbondaries_x[1]=-1	pBZbondaries_y[1]=1	pBZbondaries_x[2]=-1	pBZbondaries_y[2]=-1	pBZbondaries_x[3]=1	pBZbondaries_y[3]=-1	pBZbondaries_x[4]=1	pBZbondaries_y[4]=1	pMBZbondaries_x[0]=0	pMBZbondaries_y[0]=1	pMBZbondaries_x[1]=-1	pMBZbondaries_y[1]=0	pMBZbondaries_x[2]=0	pMBZbondaries_y[2]=-1	pMBZbondaries_x[3]=1	pMBZbondaries_y[3]=0		pMBZbondaries_x[4]=0	pMBZbondaries_y[4]=1End//********************************************************************************************************************************Proc update_global_par()	pauseupdate	silent 1	global_parameters[0]=global_mu	global_parameters[1]=global_t	global_parameters[2]=global_tprimeEnd//********************************************************************************************************************************Proc update_predict_par()	pauseupdate	silent 1	predict_parameters[0]=predict_mu	predict_parameters[1]=predict_t	predict_parameters[2]=predict_tprimeEnd//********************************************************************************************************************************Proc update_4circles()	pauseupdate	silent 1	String thisname	thisname="global"	calc4circles(thisname)End//********************************************************************************************************************************Proc update_4circles2f()	pauseupdate	silent 1	String thisname	thisname="global"	calc4circles2f(thisname)End//********************************************************************************************************************************Proc predictupdate_4circles()	pauseupdate	silent 1	String thisname	thisname="predict"	predictcalc4circles(thisname)End//********************************************************************************************************************************Proc theta_zero_incset()	PauseUpdate	Silent 1	SetVariable vartheta_zero_inc,limits={0,Inf,0.01},value= theta_zero_incEnd	//********************************************************************************************************************************Proc theta_zero_incsetH()	PauseUpdate	Silent 1	SetVariable vartheta_zero_inc,limits={0,Inf,0.01},value= theta_zero_incEnd	//********************************************************************************************************************************Proc theta1_zero_incset()	PauseUpdate	Silent 1	SetVariable vartheta1_zero_inc,limits={0,Inf,0.01},value= theta1_zero_incEnd	//********************************************************************************************************************************	Proc theta_zero_set()	PauseUpdate	Silent 1	SetVariable vartheta_zero,limits={-Inf,inf,theta_zero_inc},value= theta_zero	End	//********************************************************************************************************************************	Proc theta_zero_setH()	PauseUpdate	Silent 1	SetVariable vartheta_zero,limits={-Inf,inf,theta_zero_inc},value= theta_zero	End	//********************************************************************************************************************************	Proc theta1_zero_set()	PauseUpdate	Silent 1	SetVariable vartheta1_zero,limits={-Inf,inf,theta1_zero_inc},value= theta1_zero	End	//********************************************************************************************************************************Proc phi_zero_incset()	PauseUpdate	Silent 1	SetVariable varphi_zero_inc,limits={0,Inf,0.01},value= phi_zero_incEnd//********************************************************************************************************************************Proc phi_zero_incsetH()	PauseUpdate	Silent 1	SetVariable varphi_zero_inc,limits={0,Inf,0.01},value= phi_zero_incEnd//********************************************************************************************************************************Proc phi1_zero_incset()	PauseUpdate	Silent 1	SetVariable varphi1_zero_inc,limits={0,Inf,0.01},value= phi1_zero_incEnd//********************************************************************************************************************************	Proc phi_zero_set()	PauseUpdate	Silent 1	SetVariable varphi_zero,limits={-Inf,inf,phi_zero_inc},value= phi_zero	End		//********************************************************************************************************************************	Proc phi_zero_setH()	PauseUpdate	Silent 1	SetVariable varphi_zero,limits={-Inf,inf,phi_zero_inc},value= phi_zero	End		//********************************************************************************************************************************	Proc phi1_zero_set()	PauseUpdate	Silent 1	SetVariable varphi1_zero,limits={-Inf,inf,phi1_zero_inc},value= phi1_zero	End		//********************************************************************************************************************************Proc lattice_0_incset()	PauseUpdate	Silent 1	SetVariable varlattice_0_inc,limits={0,Inf,0.002},value= lattice_0_incEnd//********************************************************************************************************************************Proc aonb_incset()	PauseUpdate	Silent 1	SetVariable varaonb_inc,limits={0,Inf,0.002},value= aonb_incEnd		//********************************************************************************************************************************Proc lattice1_0_incset()	PauseUpdate	Silent 1	SetVariable varlattice1_0_inc,limits={0,Inf,0.002},value= lattice1_0_incEnd	//********************************************************************************************************************************	Proc lattice_0_set()	PauseUpdate	Silent 1	SetVariable varlattice_0,limits={0,inf,lattice_0_inc},value= lattice_0	End	//********************************************************************************************************************************	Proc aonb_set()	PauseUpdate	Silent 1	SetVariable varaonb,limits={1,inf,aonb_inc},value= aonb	End	//********************************************************************************************************************************	Proc predictlattice_0_set()	PauseUpdate	Silent 1	SetVariable varpredictlattice_0,limits={0,inf,predictlattice_0_inc},value= predictlattice_0	End	//********************************************************************************************************************************	Proc lattice1_0_set()	PauseUpdate	Silent 1	SetVariable varlattice1_0,limits={0,inf,lattice1_0_inc},value= lattice1_0	End	//********************************************************************************************************************************Proc rot_zero_incset()	PauseUpdate	Silent 1	SetVariable varrot_zero_inc,limits={0,Inf,0.01},value= rot_zero_incEnd	//********************************************************************************************************************************Proc rot1_zero_incset()	PauseUpdate	Silent 1	SetVariable varrot1_zero_inc,limits={0,Inf,0.01},value= rot1_zero_incEnd	//********************************************************************************************************************************	Proc rot_zero_set()	PauseUpdate	Silent 1	SetVariable varrot_zero,limits={-360,360,rot_zero_inc},value= rot_zero	End//********************************************************************************************************************************	Proc rot1_zero_set()	PauseUpdate	Silent 1	SetVariable varrot1_zero,limits={-360,360,rot1_zero_inc},value= rot1_zero	End//********************************************************************************************************************************	Proc predictKEatEF_set()	PauseUpdate	Silent 1	SetVariable varKEatEF,limits={-Inf,inf,0.001},value=predictKEatEF	End	//********************************************************************************************************************************	Proc KEatEF_set()	PauseUpdate	Silent 1	SetVariable varKEatEF,limits={-Inf,inf,0.001},value=KEatEF	End	//********************************************************************************************************************************	Proc KE1atEF_set()	PauseUpdate	Silent 1	SetVariable varKE1atEF,limits={-Inf,inf,0.001},value=KE1atEF	End	//********************************************************************************************************************************	Proc quality_set()	PauseUpdate	Silent 1	SetVariable varquality_factor,limits={0.1,Inf,1},value= quality_factorEnd	//********************************************************************************************************************************Proc global_mu_incset()	PauseUpdate	Silent 1	SetVariable varglobal_mu_inc,limits={-Inf,Inf,0.001},value= global_mu_incEnd	//********************************************************************************************************************************	Proc global_mu_set()	PauseUpdate	Silent 1	SetVariable varglobal_mu,limits={-Inf,Inf,global_mu_inc},value= global_mu	End	//********************************************************************************************************************************	Proc predict_mu_set()	PauseUpdate	Silent 1	SetVariable varpredict_mu,limits={-Inf,Inf,predict_mu_inc},value= predict_mu	End	//********************************************************************************************************************************Proc global_t_incset()	PauseUpdate	Silent 1	SetVariable varglobal_t_inc,limits={-Inf,Inf,0.001},value= global_t_incEnd	//********************************************************************************************************************************	Proc global_t_set()	PauseUpdate	Silent 1	SetVariable varglobal_t,limits={-Inf,Inf,global_t_inc},value= global_t	End	//********************************************************************************************************************************	Proc predict_t_set()	PauseUpdate	Silent 1	SetVariable varpredict_t,limits={-Inf,Inf,predict_t_inc},value= predict_t	End	//********************************************************************************************************************************Proc global_tprime_incset()	PauseUpdate	Silent 1	SetVariable varglobal_tprime_inc,limits={-Inf,Inf,0.001},value= global_tprime_incEnd	//********************************************************************************************************************************	Proc global_tprime_set()	PauseUpdate	Silent 1	SetVariable varglobal_tprime,limits={-Inf,Inf,global_tprime_inc},value= global_tprime	End	//********************************************************************************************************************************	Proc predict_tprime_set()	PauseUpdate	Silent 1	SetVariable varpredict_tprime,limits={-Inf,Inf,predict_tprime_inc},value= predict_tprime	End	//********************************************************************************************************************************	Proc predict_angletheta_from_set()	PauseUpdate	Silent 1	SetVariable setvarangletheta_from,limits={-80,80,predict_angletheta_delta},value= predict_angletheta_from	End	//********************************************************************************************************************************	Proc predict_anglephi_from_set()	PauseUpdate	Silent 1	SetVariable setvaranglephi_from,limits={-80,80,predict_anglephi_delta},value= predict_anglephi_from	End	//********************************************************************************************************************************	Proc predict_angletheta_to_set()	PauseUpdate	Silent 1	SetVariable setvarangletheta_to,limits={-80,80,predict_angletheta_delta},value= predict_angletheta_to	End	//********************************************************************************************************************************	Proc predict_anglephi_to_set()	PauseUpdate	Silent 1	SetVariable setvaranglephi_to,limits={-80,80,predict_anglephi_delta},value= predict_anglephi_to	End	//********************************************************************************************************************************	Proc predict_angleprepfrom_set()	PauseUpdate	Silent 1	SetVariable varpredict_tprime,limits={-Inf,Inf,predict_tprime_inc},value= predict_tprime	End	//********************************************************************************************************************************Proc calc4circles(name)	String name	Prompt name,"Enter the name of the sample"	PauseUpdate	Silent 1	String parameters	Variable i,j	Variable this_e,this_x,this_y	Variable numerator,denominator	parameters=name+"_parameters"	Make/O/N=0 quadrant1_x	Make/O/N=0 quadrant1_y	func_calc4circles($parameters,quadrant1_x,quadrant1_y)End//********************************************************************************************************************************Proc calc4circles2f(name)	String name	Prompt name,"Enter the name of the sample"	PauseUpdate	Silent 1	Variable/G aonb	String parameters	Variable i,j	Variable this_e,this_x,this_y	Variable numerator,denominator	parameters=name+"_parameters"	Make/O/N=0 quadrant1_x	Make/O/N=0 quadrant1_y	func_calc4circles($parameters,quadrant1_x,quadrant1_y)	upr_y[]/=aonb	upl_y[]/=aonb	lowr_y[]/=aonb	lowl_y[]/=aonb	folded1_y[]/=aonb	folded2_y[]/=aonb	folded3_y[]/=aonb	folded4_y[]/=aonb	folded5_y[]/=aonb	folded6_y[]/=aonb	folded7_y[]/=aonb	folded8_y[]/=aonb	folded9_y[]/=aonb	mainb5_y[]/=aonb	mainb6_y[]/=aonb	mainb7_y[]/=aonb	mainb8_y[]/=aonb	mainb9_y[]/=aonb	mainb10_y[]/=aonb	mainb11_y[]/=aonb	mainb12_y[]/=aonb	mainb13_y[]/=aonb	mainb14_y[]/=aonb	mainb15_y[]/=aonb	mainb16_y[]/=aonb			End		//********************************************************************************************************************************Proc predictcalc4circles(name)	String name	Prompt name,"Enter the name of the sample"	PauseUpdate	Silent 1	String parameters	Variable i,j	Variable this_e,this_x,this_y	Variable numerator,denominator	parameters=name+"_parameters"	Make/O/N=0 quadrant1_x	Make/O/N=0 quadrant1_y	func_predictcalc4circles($parameters,quadrant1_x,quadrant1_y)End	//********************************************************************************************************************************Function func_calc4circles(parameters,quadrant1_x,quadrant1_y)	Wave parameters	Wave quadrant1_x	Wave quadrant1_y	PauseUpdate	Silent 1	Variable i,j	Variable this_e,this_x,this_y	Variable numerator,denominator	//Finding the M-X crossing	i=0	Do			this_x=i*0.005		this_y=1		this_e=tbfunc(parameters,this_x,this_y)		i+=1	While((i<200)&&(this_e)<0)	//Filling the first quadrant	Insertpoints dimsize(quadrant1_x,0),1,quadrant1_x	quadrant1_x[dimsize(quadrant1_x,0)-1]=this_x	Insertpoints dimsize(quadrant1_y,0),1,quadrant1_y	quadrant1_y[dimsize(quadrant1_y,0)-1]=1	Do		this_x=i*0.005		Insertpoints dimsize(quadrant1_x,0),1,quadrant1_x		quadrant1_x[dimsize(quadrant1_x,0)-1]=this_x		Insertpoints dimsize(quadrant1_y,0),1,quadrant1_y		numerator=-parameters[0]-0.5*parameters[1]*cos(pi*this_x)		denominator=0.5*parameters[1]+parameters[2]*cos(pi*this_x)		quadrant1_y[dimsize(quadrant1_y,0)-1]=(acos(numerator/denominator))/pi		i+=1									While(i<200)	//Filling the first circle	Duplicate/O quadrant1_x quadrant2_x	Duplicate/O quadrant1_y quadrant2_y	Duplicate/O quadrant1_x quadrant3_x	Duplicate/O quadrant1_y quadrant3_y	Duplicate/O quadrant1_x quadrant4_x	Duplicate/O quadrant1_y quadrant4_y	quadrant2_x[]=(quadrant1_x[p]-1)*cos(pi/2)-(quadrant1_y[p]-1)*sin(pi/2)+1	quadrant2_y[]=(quadrant1_x[p]-1)*sin(pi/2)+(quadrant1_y[p]-1)*cos(pi/2)+1		quadrant3_x[]=(quadrant1_x[p]-1)*cos(pi)-(quadrant1_y[p]-1)*sin(pi)+1	quadrant3_y[]=(quadrant1_x[p]-1)*sin(pi)+(quadrant1_y[p]-1)*cos(pi)+1		quadrant4_x[]=(quadrant1_x[p]-1)*cos(3*pi/2)-(quadrant1_y[p]-1)*sin(3*pi/2)+1	quadrant4_y[]=(quadrant1_x[p]-1)*sin(3*pi/2)+(quadrant1_y[p]-1)*cos(3*pi/2)+1	Make/O/N=(4*dimsize(quadrant1_x,0)) upr_x		Make/O/N=(4*dimsize(quadrant1_x,0)) upr_y	i=0	Do		upr_x[i]=quadrant1_x[i]		upr_x[i+dimsize(quadrant1_x,0)]=quadrant2_x[i]		upr_x[i+2*dimsize(quadrant1_x,0)]=quadrant3_x[i]		upr_x[i+3*dimsize(quadrant1_x,0)]=quadrant4_x[i]		upr_y[i]=quadrant1_y[i]		upr_y[i+dimsize(quadrant1_y,0)]=quadrant2_y[i]		upr_y[i+2*dimsize(quadrant1_y,0)]=quadrant3_y[i]		upr_y[i+3*dimsize(quadrant1_y,0)]=quadrant4_y[i]								i+=1	While(i<dimsize(quadrant1_x,0))	Killwaves quadrant1_x,quadrant1_y,quadrant2_x,quadrant2_y,quadrant3_x,quadrant3_y,quadrant4_x,quadrant4_y	Duplicate/O upr_x upl_x	Duplicate/O upr_x lowl_x	Duplicate/O upr_x lowr_x	Duplicate/O upr_y upl_y	Duplicate/O upr_y lowl_y	Duplicate/O upr_y lowr_y	upl_x[]=-upr_x[p]	lowr_y[]=-upr_y[p]	lowl_x[]=-upr_x[p]	lowl_y[]=-upr_y[p]	Duplicate/O upr_x mainb5_x	Duplicate/O upr_y mainb5_y	mainb5_x[]+=2	Duplicate/O upr_x mainb6_x	Duplicate/O upr_y mainb6_y	mainb6_x[]+=2	mainb6_y[]+=2	Duplicate/O upr_x mainb7_x	Duplicate/O upr_y mainb7_y	mainb7_y[]+=2	Duplicate/O upr_x mainb8_x	Duplicate/O upr_y mainb8_y	mainb8_x[]-=2	mainb8_y[]+=2	Duplicate/O upr_x mainb9_x	Duplicate/O upr_y mainb9_y	mainb9_x[]-=4	mainb9_y[]+=2	Duplicate/O upr_x mainb10_x	Duplicate/O upr_y mainb10_y	mainb10_x[]-=4	Duplicate/O upr_x mainb11_x	Duplicate/O upr_y mainb11_y	mainb11_x[]-=4	mainb11_y[]-=2	Duplicate/O upr_x mainb12_x	Duplicate/O upr_y mainb12_y	mainb12_x[]-=4	mainb12_y[]-=4	Duplicate/O upr_x mainb13_x	Duplicate/O upr_y mainb13_y	mainb13_x[]-=2	mainb13_y[]-=4	Duplicate/O upr_x mainb14_x	Duplicate/O upr_y mainb14_y	mainb14_y[]-=4	Duplicate/O upr_x mainb15_x	Duplicate/O upr_y mainb15_y	mainb15_x[]+=2	mainb15_y[]-=4	Duplicate/O upr_x mainb16_x	Duplicate/O upr_y mainb16_y	mainb16_x[]+=2	mainb16_y[]-=2						Duplicate/O upr_x folded1_x	Duplicate/O upr_y folded1_y	Duplicate/O upr_x folded2_x	Duplicate/O upr_y folded2_y		Duplicate/O upr_x folded3_x	Duplicate/O upr_y folded3_y	Duplicate/O upr_x folded4_x	Duplicate/O upr_y folded4_y	Duplicate/O upr_x folded5_x	Duplicate/O upr_y folded5_y	Duplicate/O upr_x folded6_x	Duplicate/O upr_y folded6_y		Duplicate/O upr_x folded7_x	Duplicate/O upr_y folded7_y	Duplicate/O upr_x folded8_x	Duplicate/O upr_y folded8_y	Duplicate/O upr_x folded9_x	Duplicate/O upr_y folded9_y												folded1_x[]=upr_x[p]-1	folded1_y[]=upr_y[p]-1	folded2_x[]=upr_x[p]+1	folded2_y[]=upr_y[p]-1	folded3_x[]=upr_x[p]+1	folded3_y[]=upr_y[p]+1		folded4_x[]=upr_x[p]-1	folded4_y[]=upr_y[p]+1	folded5_x[]=upr_x[p]-3	folded5_y[]=upr_y[p]+1	folded6_x[]=upr_x[p]-3	folded6_y[]=upr_y[p]-1	folded7_x[]=upr_x[p]-3	folded7_y[]=upr_y[p]-3		folded8_x[]=upr_x[p]-1	folded8_y[]=upr_y[p]-3	folded9_x[]=upr_x[p]+1	folded9_y[]=upr_y[p]-3	Duplicate/O upr_x supr1_x	Duplicate/O upr_x supr2_x	Duplicate/O upr_x supr3_x	Duplicate/O upr_y supr1_y	Duplicate/O upr_y supr2_y	Duplicate/O upr_y supr3_y		Duplicate/O upl_x supl1_x	Duplicate/O upl_x supl2_x	Duplicate/O upl_x supl3_x	Duplicate/O upl_y supl1_y	Duplicate/O upl_y supl2_y	Duplicate/O upl_y supl3_y		Duplicate/O lowr_x slowr1_x	Duplicate/O lowr_x slowr2_x	Duplicate/O lowr_x slowr3_x	Duplicate/O lowr_y slowr1_y	Duplicate/O lowr_y slowr2_y	Duplicate/O lowr_y slowr3_y		Duplicate/O lowl_x slowl1_x	Duplicate/O lowl_x slowl2_x	Duplicate/O lowl_x slowl3_x	Duplicate/O lowl_y slowl1_y	Duplicate/O lowl_y slowl2_y	Duplicate/O lowl_y slowl3_y	supr1_x[]=upr_x[p]+0.21	supr1_y[]=upr_y[p]+0.21		supr2_x[]=upr_x[p]+2*0.21	supr2_y[]=upr_y[p]+2*0.21		supr3_x[]=upr_x[p]-0.21	supr3_y[]=upr_y[p]-0.21		supl1_x[]=upl_x[p]+0.21	supl1_y[]=upl_y[p]+0.21		supl2_x[]=upl_x[p]+2*0.21	supl2_y[]=upl_y[p]+2*0.21		supl3_x[]=upl_x[p]-0.21	supl3_y[]=upl_y[p]-0.21		slowr1_x[]=lowr_x[p]+0.21	slowr1_y[]=lowr_y[p]+0.21		slowr2_x[]=lowr_x[p]+2*0.21	slowr2_y[]=lowr_y[p]+2*0.21		slowr3_x[]=lowr_x[p]-0.21	slowr3_y[]=lowr_y[p]-0.21		slowl1_x[]=lowl_x[p]+0.21	slowl1_y[]=lowl_y[p]+0.21		slowl2_x[]=lowl_x[p]-2*0.21	slowl2_y[]=lowl_y[p]-2*0.21		slowl3_x[]=lowl_x[p]-0.21	slowl3_y[]=lowl_y[p]-0.21									End	//********************************************************************************************************************************Function func_predictcalc4circles(parameters,quadrant1_x,quadrant1_y)	Wave parameters	Wave quadrant1_x	Wave quadrant1_y	PauseUpdate	Silent 1	Variable i,j	Variable this_e,this_x,this_y	Variable numerator,denominator	//Finding the M-X crossing	i=0	Do			this_x=i*0.005		this_y=1		this_e=tbfunc(parameters,this_x,this_y)		i+=1	While((i<200)&&(this_e)<0)	//Filling the first quadrant	Insertpoints dimsize(quadrant1_x,0),1,quadrant1_x	quadrant1_x[dimsize(quadrant1_x,0)-1]=this_x	Insertpoints dimsize(quadrant1_y,0),1,quadrant1_y	quadrant1_y[dimsize(quadrant1_y,0)-1]=1	Do		this_x=i*0.005		Insertpoints dimsize(quadrant1_x,0),1,quadrant1_x		quadrant1_x[dimsize(quadrant1_x,0)-1]=this_x		Insertpoints dimsize(quadrant1_y,0),1,quadrant1_y		numerator=-parameters[0]-0.5*parameters[1]*cos(pi*this_x)		denominator=0.5*parameters[1]+parameters[2]*cos(pi*this_x)		quadrant1_y[dimsize(quadrant1_y,0)-1]=(acos(numerator/denominator))/pi		i+=1									While(i<200)	//Filling the first circle	Duplicate/O quadrant1_x quadrant2_x	Duplicate/O quadrant1_y quadrant2_y	Duplicate/O quadrant1_x quadrant3_x	Duplicate/O quadrant1_y quadrant3_y	Duplicate/O quadrant1_x quadrant4_x	Duplicate/O quadrant1_y quadrant4_y	quadrant2_x[]=(quadrant1_x[p]-1)*cos(pi/2)-(quadrant1_y[p]-1)*sin(pi/2)+1	quadrant2_y[]=(quadrant1_x[p]-1)*sin(pi/2)+(quadrant1_y[p]-1)*cos(pi/2)+1		quadrant3_x[]=(quadrant1_x[p]-1)*cos(pi)-(quadrant1_y[p]-1)*sin(pi)+1	quadrant3_y[]=(quadrant1_x[p]-1)*sin(pi)+(quadrant1_y[p]-1)*cos(pi)+1		quadrant4_x[]=(quadrant1_x[p]-1)*cos(3*pi/2)-(quadrant1_y[p]-1)*sin(3*pi/2)+1	quadrant4_y[]=(quadrant1_x[p]-1)*sin(3*pi/2)+(quadrant1_y[p]-1)*cos(3*pi/2)+1	Make/O/N=(4*dimsize(quadrant1_x,0)) pupr_x		Make/O/N=(4*dimsize(quadrant1_x,0)) pupr_y	i=0	Do		pupr_x[i]=quadrant1_x[i]		pupr_x[i+dimsize(quadrant1_x,0)]=quadrant2_x[i]		pupr_x[i+2*dimsize(quadrant1_x,0)]=quadrant3_x[i]		pupr_x[i+3*dimsize(quadrant1_x,0)]=quadrant4_x[i]		pupr_y[i]=quadrant1_y[i]		pupr_y[i+dimsize(quadrant1_y,0)]=quadrant2_y[i]		pupr_y[i+2*dimsize(quadrant1_y,0)]=quadrant3_y[i]		pupr_y[i+3*dimsize(quadrant1_y,0)]=quadrant4_y[i]								i+=1	While(i<dimsize(quadrant1_x,0))	Killwaves quadrant1_x,quadrant1_y,quadrant2_x,quadrant2_y,quadrant3_x,quadrant3_y,quadrant4_x,quadrant4_y	Duplicate/O pupr_x pupl_x	Duplicate/O pupr_x plowl_x	Duplicate/O pupr_x plowr_x	Duplicate/O pupr_y pupl_y	Duplicate/O pupr_y plowl_y	Duplicate/O pupr_y plowr_y	pupl_x[]=-pupr_x[p]	plowr_y[]=-pupr_y[p]	plowl_x[]=-pupr_x[p]	plowl_y[]=-pupr_y[p]					Duplicate/O pupr_x pfolded1_x	Duplicate/O pupr_y pfolded1_y	Duplicate/O pupr_x pfolded2_x	Duplicate/O pupr_y pfolded2_y		Duplicate/O pupr_x pfolded3_x	Duplicate/O pupr_y pfolded3_y	Duplicate/O pupr_x pfolded4_x	Duplicate/O pupr_y pfolded4_y	Duplicate/O pupr_x pfolded5_x	Duplicate/O pupr_y pfolded5_y	Duplicate/O pupr_x pfolded6_x	Duplicate/O pupr_y pfolded6_y		Duplicate/O pupr_x pfolded7_x	Duplicate/O pupr_y pfolded7_y	Duplicate/O pupr_x pfolded8_x	Duplicate/O pupr_y pfolded8_y	Duplicate/O pupr_x pfolded9_x	Duplicate/O pupr_y pfolded9_y												pfolded1_x[]=pupr_x[p]-1	pfolded1_y[]=pupr_y[p]-1	pfolded2_x[]=pupr_x[p]+1	pfolded2_y[]=pupr_y[p]-1	pfolded3_x[]=pupr_x[p]+1	pfolded3_y[]=pupr_y[p]+1		pfolded4_x[]=pupr_x[p]-1	pfolded4_y[]=pupr_y[p]+1	pfolded5_x[]=pupr_x[p]-3	pfolded5_y[]=pupr_y[p]+1	pfolded6_x[]=pupr_x[p]-3	pfolded6_y[]=pupr_y[p]-1	pfolded7_x[]=pupr_x[p]-3	pfolded7_y[]=pupr_y[p]-3		pfolded8_x[]=pupr_x[p]-1	pfolded8_y[]=pupr_y[p]-3	pfolded9_x[]=pupr_x[p]+1	pfolded9_y[]=pupr_y[p]-3	Duplicate/O pupr_x psupr1_x	Duplicate/O pupr_x psupr2_x	Duplicate/O pupr_x psupr3_x	Duplicate/O pupr_y psupr1_y	Duplicate/O pupr_y psupr2_y	Duplicate/O pupr_y psupr3_y		Duplicate/O pupl_x psupl1_x	Duplicate/O pupl_x psupl2_x	Duplicate/O pupl_x psupl3_x	Duplicate/O pupl_y psupl1_y	Duplicate/O pupl_y psupl2_y	Duplicate/O pupl_y psupl3_y		Duplicate/O plowr_x pslowr1_x	Duplicate/O plowr_x pslowr2_x	Duplicate/O plowr_x pslowr3_x	Duplicate/O plowr_y pslowr1_y	Duplicate/O plowr_y pslowr2_y	Duplicate/O plowr_y pslowr3_y		Duplicate/O plowl_x pslowl1_x	Duplicate/O plowl_x pslowl2_x	Duplicate/O plowl_x pslowl3_x	Duplicate/O plowl_y pslowl1_y	Duplicate/O plowl_y pslowl2_y	Duplicate/O plowl_y pslowl3_y	psupr1_x[]=pupr_x[p]+0.21	psupr1_y[]=pupr_y[p]+0.21		psupr2_x[]=pupr_x[p]+2*0.21	psupr2_y[]=pupr_y[p]+2*0.21		psupr3_x[]=pupr_x[p]-0.21	psupr3_y[]=pupr_y[p]-0.21		psupl1_x[]=pupl_x[p]+0.21	psupl1_y[]=pupl_y[p]+0.21		psupl2_x[]=pupl_x[p]+2*0.21	psupl2_y[]=pupl_y[p]+2*0.21		psupl3_x[]=pupl_x[p]-0.21	psupl3_y[]=pupl_y[p]-0.21		pslowr1_x[]=plowr_x[p]+0.21	pslowr1_y[]=plowr_y[p]+0.21		pslowr2_x[]=plowr_x[p]+2*0.21	pslowr2_y[]=plowr_y[p]+2*0.21		pslowr3_x[]=plowr_x[p]-0.21	pslowr3_y[]=plowr_y[p]-0.21		pslowl1_x[]=plowl_x[p]+0.21	pslowl1_y[]=plowl_y[p]+0.21		pslowl2_x[]=plowl_x[p]-2*0.21	pslowl2_y[]=plowl_y[p]-2*0.21		pslowl3_x[]=plowl_x[p]-0.21	pslowl3_y[]=plowl_y[p]-0.21									End	//*******************************************************************************************************************************		Proc calc_tbarea()	PauseUpdate	Silent 1	Variable i,j	Variable this_e,this_x,this_y	Variable numerator,denominator	Variable thisarea	Make/O/N=0 quadrant1_x	Make/O/N=0 quadrant1_y	//Finding the M-X crossing	i=0	Do			this_x=i*0.002		this_y=1		this_e=tbfunc(global_parameters,this_x,this_y)		i+=1	While((i<501)&&(this_e)<0))	//calculating	thisarea=0	Do		this_x=i*0.002		numerator=-global_parameters[0]-0.5*global_parameters[1]*cos(pi*this_x)		denominator=0.5*global_parameters[1]+global_parameters[2]*cos(pi*this_x)		thisarea+=0.002*(1-(acos(numerator/denominator))/pi)		i+=1									While(i<501)	global_x=2*thisarea-1		End	//*******************************************************************************************************************************		Proc predictcalc_tbarea()	PauseUpdate	Silent 1	Variable i,j	Variable this_e,this_x,this_y	Variable numerator,denominator	Variable thisarea	Make/O/N=0 quadrant1_x	Make/O/N=0 quadrant1_y	//Finding the M-X crossing	i=0	Do			this_x=i*0.002		this_y=1		this_e=tbfunc(predict_parameters,this_x,this_y)		i+=1	While((i<501)&&(this_e)<0))	//calculating	thisarea=0	Do		this_x=i*0.002		numerator=-predict_parameters[0]-0.5*predict_parameters[1]*cos(pi*this_x)		denominator=0.5*predict_parameters[1]+predict_parameters[2]*cos(pi*this_x)		thisarea+=0.002*(1-(acos(numerator/denominator))/pi)		i+=1									While(i<501)	predict_x=2*thisarea-1		End	//*******************************************************************************************************************************		Proc plot_tbGXMG()	PauseUpdate	Silent 1	Variable i,j	Variable thisx,thisy	make/O/N=1000 tbGXMG	Setscale/I x,0,2+sqrt(2),""tbGXMG	i=0	Do		thisx=i*dimdelta(tbGXMG,0)/sqrt(2)		thisy=thisx		tbGXMG[i]=tbfunc(global_parameters,thisx,thisy)		i+=1									While(thisx<=1)	j=0	Do		thisx=1-(j*dimdelta(tbGXMG,0))		thisy=1		tbGXMG[i]=tbfunc(global_parameters,thisx,thisy)		j+=1		i+=1									While(thisx>=0)	j=0	Do		thisx=0		thisy=1-(j*dimdelta(tbGXMG,0))		tbGXMG[i]=tbfunc(global_parameters,thisx,thisy)		j+=1		i+=1									While(i<dimsize(tbGXMG,0))	If(winType("tbGXMG_plot")==1)		DoWindow/F tbGXMG_plot		Else			Display tbGXMG			DoWindow/C tbGXMG_plot				Endif			End//*******************************************************************************************************************************		Proc plot_tbGXMGMprimeX_2f()	PauseUpdate	Silent 1	Variable/G aonb	Variable i,j	Variable thisx,thisy	make/O/N=1500 tbGXMGMprimeX_2f	make/O/N=1500 tbGXMGMprimeX_2f_along//	Setscale/I x,0,2+2/aonb+sqrt(1+1/aonb),""tbGXMGMprimeX_2f		Setscale/I x,0,4+sqrt(2),""tbGXMGMprimeX_2f   //we first fake that a and b are equivalent	i=0   //From G to X	Do		thisx=i*dimdelta(tbGXMGMprimeX_2f,0)/sqrt(2)		thisy=thisx		tbGXMGMprimeX_2f[i]=tbfunc(global_parameters,thisx,thisy)		If(i==0)			tbGXMGMprimeX_2f_along[i]=0			Else				tbGXMGMprimeX_2f_along[i]=tbGXMGMprimeX_2f_along[i-1]+dimdelta(tbGXMGMprimeX_2f,0)/sqrt(2/(1+1/aonb))		Endif		i+=1									While(thisx<=1)	j=0  //from X to M	Do		thisx=1-(j*dimdelta(tbGXMGMprimeX_2f,0))		thisy=1		tbGXMGMprimeX_2f[i]=tbfunc(global_parameters,thisx,thisy)		tbGXMGMprimeX_2f_along[i]=tbGXMGMprimeX_2f_along[i-1]+dimdelta(tbGXMGMprimeX_2f,0)		j+=1		i+=1									While(thisx>=0)	j=0  //from M to G	Do		thisx=0		thisy=1-(j*dimdelta(tbGXMGMprimeX_2f,0))		tbGXMGMprimeX_2f[i]=tbfunc(global_parameters,thisx,thisy)		tbGXMGMprimeX_2f_along[i]=tbGXMGMprimeX_2f_along[i-1]+dimdelta(tbGXMGMprimeX_2f,0)/aonb				j+=1		i+=1			While(thisy>=0)	j=0   //From G to M'	Do		thisx=-(j*dimdelta(tbGXMGMprimeX_2f,0))		thisy=0		tbGXMGMprimeX_2f[i]=tbfunc(global_parameters,thisx,thisy)		tbGXMGMprimeX_2f_along[i]=tbGXMGMprimeX_2f_along[i-1]+dimdelta(tbGXMGMprimeX_2f,0)		j+=1		i+=1									While(thisx>=-1)	j=0  //from M' to X	Do		thisx=-1		thisy=-(j*dimdelta(tbGXMGMprimeX_2f,0))		tbGXMGMprimeX_2f[i]=tbfunc(global_parameters,thisx,thisy)		tbGXMGMprimeX_2f_along[i]=tbGXMGMprimeX_2f_along[i-1]+dimdelta(tbGXMGMprimeX_2f,0)/aonb				j+=1		i+=1			While(i<dimsize(tbGXMGMprimeX_2f,0))	If(winType("tbGXMGMprimeX_2f_plot")==1)		DoWindow/F tbGXMGMprimeX_2f_plot		Else			Display tbGXMGMprimeX_2f vs tbGXMGMprimeX_2f_along			DoWindow/C tbGXMGMprimeX_2f_plot				Endif			End		//*******************************************************************************************************************************		Proc plot_predicttbGXMG()	PauseUpdate	Silent 1	Variable i,j	Variable thisx,thisy	make/O/N=1000 predicttbGXMG	Setscale/I x,0,2+sqrt(2),""predicttbGXMG	i=0	Do		thisx=i*dimdelta(tbGXMG,0)/sqrt(2)		thisy=thisx		predicttbGXMG[i]=tbfunc(predict_parameters,thisx,thisy)		i+=1									While(thisx<=1)	j=0	Do		thisx=1-(j*dimdelta(predicttbGXMG,0))		thisy=1		predicttbGXMG[i]=tbfunc(predict_parameters,thisx,thisy)		j+=1		i+=1									While(thisx>=0)	j=0	Do		thisx=0		thisy=1-(j*dimdelta(predicttbGXMG,0))		predicttbGXMG[i]=tbfunc(predict_parameters,thisx,thisy)		j+=1		i+=1									While(i<dimsize(predicttbGXMG,0))	If(winType("predicttbGXMG_plot")==1)		DoWindow/F predicttbGXMG_plot		Else			Display predicttbGXMG			DoWindow/C predicttbGXMG_plot				Endif			End				//*******************************************************************************************************************************		Function Tab4vs6(ctrlName,tabNum) : TabControl	String ctrlName	Variable tabNum	IF(tabNum==0)		Button button29 disable=1		Button for_image_fs disable=1		Button for_copy_TB disable=1		Button for_append_TB disable=0		Button buttonDOSatkf disable=1		Button buttonGet_ledge_kf disable=1				Button button33 disable=1		Button for_image_FSH disable=1				Button button35 disable=0		Button for_copy_TB2f disable=0				Button for_image_FS2f disable=0					Endif		IF(tabNum==1)		Button button29 disable=0		Button for_image_fs disable=0		Button for_copy_TB disable=0		Button for_append_TB disable=0		Button buttonDOSatkf disable=0		Button buttonGet_ledge_kf disable=0		Button button33 disable=1				Button for_image_FSH disable=1				Button button35 disable=1				Button for_copy_TB2f disable=1				Button for_image_FS2f disable=1					Endif	IF(tabNum==2)		Button button29 disable=1		Button for_image_fs disable=1		Button for_copy_TB disable=1		Button for_append_TB disable=1		Button buttonDOSatkf disable=1		Button buttonGet_ledge_kf disable=1				Button button33 disable=0		Button for_image_FSH disable=0				Button button35 disable=1				Button for_copy_TB2f disable=1			Button for_image_FS2f disable=1					Endif	return 0	End//********************************************************************************************************************************Window making_fsHEX() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(66,186,675,872) ky_final vs kx_final	AppendToGraph ky_finalrot vs kx_finalrot	AppendToGraph Honeyy2 vs Honeyx2	AppendToGraph Honeyy3 vs Honeyx3	AppendToGraph Honeyy4 vs Honeyx4	AppendToGraph Honeyy5 vs Honeyx5	AppendToGraph Honeyy6 vs Honeyx6	AppendToGraph Honeyy7 vs Honeyx7	AppendToGraph Honeyy8 vs Honeyx8	AppendToGraph Honeyy9 vs Honeyx9	AppendToGraph Honeyy10 vs Honeyx10	AppendToGraph Honeyy11 vs Honeyx11	AppendToGraph Honeyy12 vs Honeyx12	AppendToGraph Honeyy13 vs Honeyx13	AppendToGraph Honeyy14 vs Honeyx14	AppendToGraph Honeyy15 vs Honeyx15	AppendToGraph Honeyy16 vs Honeyx16	AppendToGraph Honeyy17 vs Honeyx17	AppendToGraph Honeyy18 vs Honeyx18	AppendToGraph Honeyy19 vs Honeyx19	AppendToGraph Honeyy20 vs Honeyx20	AppendToGraph Honeyy21 vs Honeyx21	AppendToGraph Honeyy22 vs Honeyx22	AppendToGraph Honeyy23 vs Honeyx23	AppendToGraph Honeyy24 vs Honeyx24	AppendToGraph Honeyy25 vs Honeyx25	AppendToGraph Honeyy26 vs Honeyx26	AppendToGraph Honeyy27 vs Honeyx27	AppendToGraph Honeyy28 vs Honeyx28	AppendToGraph Honeyy29 vs Honeyx29	AppendToGraph Honeyy30 vs Honeyx30	AppendToGraph Honeyy31 vs Honeyx31	AppendToGraph Honeyy32 vs Honeyx32	AppendToGraph Honeyy33 vs Honeyx33	AppendToGraph Honeyy34 vs Honeyx34	AppendToGraph Honeyy35 vs Honeyx35	AppendToGraph Honeyy36 vs Honeyx36	AppendToGraph Honeyy37 vs Honeyx37	AppendToGraph Honeyy1 vs Honeyx1	ModifyGraph width=515,height=515,cbRGB=(49151,53155,65535)	ModifyGraph mode(ky_final)=3,mode(ky_finalrot)=3	ModifyGraph marker(ky_final)=8,marker(ky_finalrot)=8	ModifyGraph lStyle(Honeyy2)=3,lStyle(Honeyy3)=3,lStyle(Honeyy4)=3,lStyle(Honeyy5)=3	ModifyGraph lStyle(Honeyy6)=3,lStyle(Honeyy7)=3,lStyle(Honeyy8)=3,lStyle(Honeyy9)=3	ModifyGraph lStyle(Honeyy10)=3,lStyle(Honeyy11)=3,lStyle(Honeyy12)=3,lStyle(Honeyy13)=3	ModifyGraph lStyle(Honeyy14)=3,lStyle(Honeyy15)=3,lStyle(Honeyy16)=3,lStyle(Honeyy17)=3	ModifyGraph lStyle(Honeyy18)=3,lStyle(Honeyy19)=3,lStyle(Honeyy20)=3,lStyle(Honeyy21)=3	ModifyGraph lStyle(Honeyy22)=3,lStyle(Honeyy23)=3,lStyle(Honeyy24)=3,lStyle(Honeyy25)=3	ModifyGraph lStyle(Honeyy26)=3,lStyle(Honeyy27)=3,lStyle(Honeyy28)=3,lStyle(Honeyy29)=3	ModifyGraph lStyle(Honeyy30)=3,lStyle(Honeyy31)=3,lStyle(Honeyy32)=3,lStyle(Honeyy33)=3	ModifyGraph lStyle(Honeyy34)=3,lStyle(Honeyy35)=3,lStyle(Honeyy36)=3,lStyle(Honeyy37)=3	ModifyGraph rgb(ky_final)=(0,0,0),rgb(Honeyy2)=(32768,40777,65535),rgb(Honeyy3)=(32768,40777,65535)	ModifyGraph rgb(Honeyy4)=(32768,40777,65535),rgb(Honeyy5)=(32768,40777,65535),rgb(Honeyy6)=(32768,40777,65535)	ModifyGraph rgb(Honeyy7)=(32768,40777,65535),rgb(Honeyy8)=(32768,40777,65535),rgb(Honeyy9)=(32768,40777,65535)	ModifyGraph rgb(Honeyy10)=(32768,40777,65535),rgb(Honeyy11)=(32768,40777,65535)	ModifyGraph rgb(Honeyy12)=(32768,40777,65535),rgb(Honeyy13)=(32768,40777,65535)	ModifyGraph rgb(Honeyy14)=(32768,40777,65535),rgb(Honeyy15)=(32768,40777,65535)	ModifyGraph rgb(Honeyy16)=(32768,40777,65535),rgb(Honeyy17)=(32768,40777,65535)	ModifyGraph rgb(Honeyy18)=(32768,40777,65535),rgb(Honeyy19)=(32768,40777,65535)	ModifyGraph rgb(Honeyy20)=(32768,40777,65535),rgb(Honeyy21)=(32768,40777,65535)	ModifyGraph rgb(Honeyy22)=(32768,40777,65535),rgb(Honeyy23)=(32768,40777,65535)	ModifyGraph rgb(Honeyy24)=(32768,40777,65535),rgb(Honeyy25)=(32768,40777,65535)	ModifyGraph rgb(Honeyy26)=(32768,40777,65535),rgb(Honeyy27)=(32768,40777,65535)	ModifyGraph rgb(Honeyy28)=(32768,40777,65535),rgb(Honeyy29)=(32768,40777,65535)	ModifyGraph rgb(Honeyy30)=(32768,40777,65535),rgb(Honeyy31)=(32768,40777,65535)	ModifyGraph rgb(Honeyy32)=(32768,40777,65535),rgb(Honeyy33)=(32768,40777,65535)	ModifyGraph rgb(Honeyy34)=(32768,40777,65535),rgb(Honeyy35)=(32768,40777,65535)	ModifyGraph rgb(Honeyy36)=(32768,40777,65535),rgb(Honeyy37)=(32768,40777,65535)	ModifyGraph rgb(Honeyy1)=(0,0,65535)	ModifyGraph msize(ky_final)=4,msize(ky_finalrot)=4	ModifyGraph tick=2	ModifyGraph mirror=1	ModifyGraph fSize=12	ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0}	ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Label left "\\Z16k\\By\\M\\Z16 (\\F'symbol'p\\F'arial'/a)"	Label bottom "\\Z16k\\Bx\\M \\Z16(\\F'symbol'p\\F'arial'/a)"	SetAxis left -3.06186217847897,3.06186217847897	SetAxis bottom -3.06186217847897,3.06186217847897	Cursor/P A Honeyy1 2	ShowInfo	ControlBar 103	Button button0,pos={7,74},size={100,20},proc=ButtonProc_update_making_fsH,title="\\K(65535,65535,65535)Update points"	Button button0,fColor=(26214,0,0)	SetVariable vartheta_zero_inc,pos={6,31},size={120,15},proc=setvarincrement_theta_zeroH,title="Increment"	SetVariable vartheta_zero_inc,limits={0,inf,0.01},value= theta_zero_inc	SetVariable varphi_zero_inc,pos={136,31},size={120,15},proc=setvarincrement_phi_zeroH,title="Increment"	SetVariable varphi_zero_inc,limits={0,inf,0.01},value= phi_zero_inc	SetVariable varrot_zero_inc,pos={261,31},size={120,15},proc=setvarincrement_rot_zero,title="Increment"	SetVariable varrot_zero_inc,limits={0,inf,0.01},value= rot_zero_inc	SetVariable varlattice_0_inc,pos={394,31},size={120,15},proc=setvarincrement_lattice_0,title="Increment"	SetVariable varlattice_0_inc,limits={0,inf,0.002},value= lattice_0_inc	SetVariable vartheta_zero,pos={6,7},size={120,16},proc=setvartheta_zeroH,title="q_0"	SetVariable vartheta_zero,font="Symbol"	SetVariable vartheta_zero,limits={-inf,inf,0.1},value= theta_zero,live= 1	SetVariable varphi_zero,pos={136,7},size={120,16},proc=setvarphi_zeroH,title="j_0"	SetVariable varphi_zero,font="Symbol"	SetVariable varphi_zero,limits={-inf,inf,0.1},value= phi_zero,live= 1	SetVariable varrot_zero,pos={261,7},size={120,15},proc=setvarrot_zeroH,title="Rotation"	SetVariable varrot_zero,limits={-360,360,1.48},value= rot_zero,live= 1	SetVariable varlattice_0,pos={394,7},size={120,16},proc=setvarlattice_0H,title="p/a"	SetVariable varlattice_0,font="Symbol"	SetVariable varlattice_0,limits={0,inf,0.002},value= lattice_0,live= 1	SetVariable varKEatEF,pos={6,54},size={120,15},proc=setKEatEFH,title="Kenetic E"	SetVariable varKEatEF,limits={-inf,inf,0.001},value= KEatEF,live= 1	Button button1,pos={518,30},size={85,20},disable=2,proc=ButtonProc_doping_hexagon,title="Calc. doping"	ValDisplay valglobal_x,pos={501,53},size={99,17},title="Doping",fSize=12	ValDisplay valglobal_x,limits={0,0,0},barmisc={0,1000},value= #"global_x"	Button for_phi_theta,pos={415,75},size={85,20},proc=ButtonProc_return_phi_theta,title="Pt at new hv"	Button buttonmain,pos={514,76},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17	Button button3table,pos={519,5},size={80,20},proc=ButtonProc_tableafs,title="Show  table"	Button button3table,fColor=(1,16019,65535)	PopupMenu popupview,pos={426,52},size={68,20},proc=PopMenuProc_viewmaking_fsH,title="View"	PopupMenu popupview,fSize=13	PopupMenu popupview,mode=6,popvalue="2",value= #"\"1/4;2/4;3/4;4/4;1;2;3\""	PopupMenu popupFS_H_type,pos={269,51},size={113,20},proc=PopMenuProc_FS_Htype,title="FS type:"	PopupMenu popupFS_H_type,fSize=13	PopupMenu popupFS_H_type,mode=1,popvalue="None",value= #"\"None;Hexagon1;Hexagon2\""	SetVariable setvarlattice_hexagon,pos={136,53},size={120,15},disable=2,proc=SetVarProclattice_hexagon,title="Hexagon size"	SetVariable setvarlattice_hexagon,limits={0,1.06066,0.01},value= lattice_hexagon,live= 1	SetVariable setvarlattice_hexagon_inc,pos={136,76},size={120,15},disable=2,proc=setvarincrement_lattice_hexagon,title="Increment"	SetVariable setvarlattice_hexagon_inc,limits={0,1,0.01},value= lattice_hexagon_inc,live= 1	SetDrawLayer UserFront	SetDrawEnv fname= "Arial"	DrawText 0.598,-0.174,"Superlattice"	SetDrawEnv fname= "Arial"	DrawText 0.604,-0.174,"Superlattices"	DrawRect 0.526,-0.182,0.608,-0.144	DrawRect 0.636,-0.198,0.71,-0.152EndMacro//********************************************************************************************************************************Proc MakeHexagon(sizeofhexagon,angle,name)	Variable sizeofhexagon=sqrt(3/2)	Variable angle	String name	Prompt sizeofhexagon,"Enter the parameter a"	Prompt angle,"Enter the angle (conterclockwise)"	Prompt name,"Enter the name of the hexagon"	Silent 1;PauseUpdate	String namex,namey	namex=name+"_x"	namey=name+"_y"	Make/O/N=7 $namex	Make/O/N=7 $namey	funcMakeHexagon(sizeofhexagon,angle,$namex,$namey)End//********************************************************************************************************************************Function funcMakeHexagon(size_a,angle,namex,namey)	Variable size_a	Variable angle	Wave namex	Wave namey	Silent 1;PauseUpdate	namex[0]=size_a*cos(angle*pi/180)//sqrt(3/2),0	namey[0]=size_a*sin(angle*pi/180)	namex[1]=size_a*cos((angle+60)*pi/180)	namey[1]=size_a*sin((angle+60)*pi/180)	namex[2]=size_a*cos((angle+120)*pi/180)	namey[2]=size_a*sin((angle+120)*pi/180)	namex[3]=size_a*cos((angle+180)*pi/180)	namey[3]=size_a*sin((angle+180)*pi/180)	namex[4]=size_a*cos((angle+240)*pi/180)	namey[4]=size_a*sin((angle+240)*pi/180)	namex[5]=size_a*cos((angle+300)*pi/180)	namey[5]=size_a*sin((angle+300)*pi/180)	namex[6]=namex[0]	namey[6]=namey[0]End//********************************************************************************************************************************Proc Honeycomb()	Silent 1;PauseUpdate	String thisnamex,thisnamey	Variable angle=30	Variable i	Variable v1,v2	Variable vec_ax	Variable vec_ay	Variable vec_bx	Variable vec_by	Variable distance	Vec_ax=3/(sqrt(2))	Vec_ay=0	Vec_bx=Vec_ax*cos(60*pi/180)	Vec_by=Vec_ax*sin(60*pi/180)	Make/O/N=7 Honeyx1	Make/O/N=7 Honeyy1		Honeyx1[0]=sqrt(3/2)*cos(angle*pi/180)//sqrt(3/2),0	Honeyy1[0]=sqrt(3/2)*sin(angle*pi/180)	Honeyx1[1]=sqrt(3/2)*cos((angle+60)*pi/180)	Honeyy1[1]=sqrt(3/2)*sin((angle+60)*pi/180)	Honeyx1[2]=sqrt(3/2)*cos((angle+120)*pi/180)	Honeyy1[2]=sqrt(3/2)*sin((angle+120)*pi/180)	Honeyx1[3]=sqrt(3/2)*cos((angle+180)*pi/180)	Honeyy1[3]=sqrt(3/2)*sin((angle+180)*pi/180)	Honeyx1[4]=sqrt(3/2)*cos((angle+240)*pi/180)	Honeyy1[4]=sqrt(3/2)*sin((angle+240)*pi/180)	Honeyx1[5]=sqrt(3/2)*cos((angle+300)*pi/180)	Honeyy1[5]=sqrt(3/2)*sin((angle+300)*pi/180)	Honeyx1[6]=Honeyx1[0]	Honeyy1[6]=Honeyy1[0]//	Appendtograph Honeyy1 vs Honeyx1	i=2	v1=-3	Do		v2=-3		Do			distance=sqrt((v1*Vec_ax+v2*Vec_bx)^2+(v1*Vec_ay+v2*Vec_by)^2)			IF(((v1!=0)||(v2!=0))&&(distance<=3*vec_ax))				thisnamex="Honeyx"+num2str(i)				thisnamey="Honeyy"+num2str(i)				Duplicate/O Honeyx1 $thisnamex				Duplicate/O Honeyy1 $thisnamey				$thisnamex[]+=v1*Vec_ax+v2*Vec_bx				$thisnamey[]+=v1*Vec_ay+v2*Vec_by				//				appendtograph $thisnamey vs $thisnamex				i+=1			Endif			v2+=1		While(v2<4)		v1+=1					While(v1<4)//	Removefromgraph Honeyy1//	Appendtograph Honeyy1 vs Honeyx1End//********************************************************************************************************************************Proc update_making_fsH()	pauseupdate	silent 1	Variable i,size_final	Duplicate/O original_theta theta_shifted	Duplicate/O original_phi phi_shifted		theta_shifted[]=original_theta[p]+theta_zero		phi_shifted[]=original_phi[p]+phi_zero		Duplicate/O original_theta kx_norot	Duplicate/O original_theta ky_norot		kx_norot[]=0.51231*sqrt(KEatEF)*sin(theta_shifted[p]*pi/180)	ky_norot[]=0.51231*sqrt(KEatEF)*cos(theta_shifted[p]*pi/180)*sin(phi_shifted[p]*pi/180)	Duplicate/O original_theta kx_final	Duplicate/O original_theta ky_final	kx_final[]=(kx_norot[p]*cos(rot_zero*pi/180)-ky_norot[p]*sin(rot_zero*pi/180))/lattice_0	ky_final[]=(kx_norot[p]*sin(rot_zero*pi/180)+ky_norot[p]*cos(rot_zero*pi/180))/lattice_0	Make/O/N=(5*dimsize(original_theta,0)) kx_finalrot				Make/O/N=(5*dimsize(original_theta,0)) ky_finalrot	kx_finalrot[]=0	ky_finalrot[]=0	size_final=dimsize(original_theta,0)	i=0	Do		kx_finalrot[i]=cos(60*pi/180)*kx_final[i]-sin(60*pi/180)*ky_final[i]		ky_finalrot[i]=sin(60*pi/180)*kx_final[i]+cos(60*pi/180)*ky_final[i]		kx_finalrot[i+size_final]=cos(120*pi/180)*kx_final[i]-sin(120*pi/180)*ky_final[i]		ky_finalrot[i+size_final]=sin(120*pi/180)*kx_final[i]+cos(120*pi/180)*ky_final[i]		kx_finalrot[i+2*size_final]=cos(180*pi/180)*kx_final[i]-sin(180*pi/180)*ky_final[i]		ky_finalrot[i+2*size_final]=sin(180*pi/180)*kx_final[i]+cos(180*pi/180)*ky_final[i]		kx_finalrot[i+3*size_final]=cos(240*pi/180)*kx_final[i]-sin(240*pi/180)*ky_final[i]		ky_finalrot[i+3*size_final]=sin(240*pi/180)*kx_final[i]+cos(240*pi/180)*ky_final[i]		kx_finalrot[i+4*size_final]=cos(300*pi/180)*kx_final[i]-sin(300*pi/180)*ky_final[i]		ky_finalrot[i+4*size_final]=sin(300*pi/180)*kx_final[i]+cos(300*pi/180)*ky_final[i]		i+=1	While(i<size_final)End//********************************************************************************************************************************Proc updateHexagonFS()	Silent 1;PauseUpdate	Variable/G lattice_hexagon	VAriable/G FS_H_type	string listname	String listitem	String thisname,thisnamey,thisnamex	Variable condition	Variable i	Variable Vec_ax,Vec_ay,Vec_bx,Vec_by	Variable v1,v2	Variable distance	Vec_ax=3/(sqrt(2))	Vec_ay=0	Vec_bx=Vec_ax*cos(60*pi/180)	Vec_by=Vec_ax*sin(60*pi/180)		listname=TraceNameList("making_fsHEX", ";", 1 )	IF(FS_H_type==1)		condition=0		i=0		Do			listitem=StringFromList(i, listname,";")			IF(cmpstr(listitem,"FS_H_y")==0)				condition=1			Endif			i+=1				While((i<ItemsInList(listname,";")&&condition==0))		If(condition==1)			Removefromgraph FS_H_y			i=2			Do				thisname="FS_H"+num2str(i)+"_y"				Removefromgraph $thisname				i+=1			While(i<38)		Endif	Endif	IF(FS_H_type==2)		Makehexagon(lattice_hexagon,0,"FS_H")		i=2		v1=-3		Do			v2=-3			Do				distance=sqrt((v1*Vec_ax+v2*Vec_bx)^2+(v1*Vec_ay+v2*Vec_by)^2)				IF(((v1!=0)||(v2!=0))&&(distance<=3*vec_ax))					thisnamex="FS_H"+num2str(i)+"_x"					thisnamey="FS_H"+num2str(i)+"_y"					Duplicate/O FS_H_x $thisnamex					Duplicate/O FS_H_y $thisnamey					$thisnamex[]+=v1*Vec_ax+v2*Vec_bx					$thisnamey[]+=v1*Vec_ay+v2*Vec_by									i+=1				Endif				v2+=1			While(v2<4)			v1+=1						While(v1<4)				condition=0		i=0		Do			listitem=StringFromList(i, listname,";")			IF(cmpstr(listitem,"FS_H_y")==0)				print "banane"				condition=1			Endif			i+=1				While((i<ItemsInList(listname,";")&&condition==0))		If(condition==0)			Appendtograph FS_H_y vs FS_H_x			ModifyGraph rgb(FS_H_y)=(1,26214,0)			i=2			Do				thisname="FS_H"+num2str(i)+"_y"				thisnamex="FS_H"+num2str(i)+"_x"								Appendtograph $thisname vs $thisnamex				ModifyGraph rgb($thisname)=(1,26214,0)				i+=1			While(i<38)		Endif	Endif	IF(FS_H_type==3)		Makehexagon(lattice_hexagon,30,"FS_H")		i=2		v1=-3		Do			v2=-3			Do				distance=sqrt((v1*Vec_ax+v2*Vec_bx)^2+(v1*Vec_ay+v2*Vec_by)^2)				IF(((v1!=0)||(v2!=0))&&(distance<=3*vec_ax))					thisnamex="FS_H"+num2str(i)+"_x"					thisnamey="FS_H"+num2str(i)+"_y"					Duplicate/O FS_H_x $thisnamex					Duplicate/O FS_H_y $thisnamey					$thisnamex[]+=v1*Vec_ax+v2*Vec_bx					$thisnamey[]+=v1*Vec_ay+v2*Vec_by									i+=1				Endif				v2+=1			While(v2<4)			v1+=1						While(v1<4)				condition=0		i=0		Do			listitem=StringFromList(i, listname,";")			IF(cmpstr(listitem,"FS_H_y")==0)				condition=1			Endif			i+=1				While((i<ItemsInList(listname,";")&&condition==0))		If(condition==0)			Appendtograph FS_H_y vs FS_H_x			ModifyGraph rgb(FS_H_y)=(1,26214,0)			i=2			Do				thisname="FS_H"+num2str(i)+"_y"				thisnamex="FS_H"+num2str(i)+"_x"								Appendtograph $thisname vs $thisnamex				ModifyGraph rgb($thisname)=(1,26214,0)				i+=1			While(i<38)		Endif	Endif	End//********************************************************************************************************************************Function PopMenuProc_FS_Htype(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G FS_H_type	FS_H_type=popNum	IF(popNum==1)		Setvariable setvarlattice_hexagon disable=2		Setvariable setvarlattice_hexagon_inc disable=2		Button button1 disable=2		Else			Setvariable setvarlattice_hexagon disable=0			Setvariable setvarlattice_hexagon_inc disable=0			Button button1 disable=0	Endif		Execute "updateHexagonFS()"	Execute "lattice_hexagon_set()"	End//********************************************************************************************************************************Function PopMenuProc_FS_Htype1(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G FS_H_type	FS_H_type=popNum	IF(popNum==1)		Setvariable setvarlattice_hexagon disable=2		Setvariable setvarlattice_hexagon_inc disable=2		Button for_dop disable=2		Else			Setvariable setvarlattice_hexagon disable=0			Setvariable setvarlattice_hexagon_inc disable=0			Button for_dop disable=0	Endif		Execute "updateHexagonFS1()"	Execute "lattice_hexagon_set()"	End//********************************************************************************************************************************Function SetVarProclattice_hexagon(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "updateHexagonFS()"End//********************************************************************************************************************************Function SetVarProclattice_hexagon1(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "updateHexagonFS1()"End//********************************************************************************************************************************Function setvarincrement_lattice_hexagon(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "lattice_hexagon_incset()"	Execute "lattice_hexagon_set()"End//********************************************************************************************************************************Proc lattice_hexagon_incset()	PauseUpdate	Silent 1	SetVariable setvarlattice_hexagon_inc,limits={0,1,0.01},value= lattice_hexagon_incEnd	//********************************************************************************************************************************	Proc lattice_hexagon_set()	PauseUpdate	Silent 1	IF(FS_H_type==3)		SetVariable setvarlattice_hexagon,limits={0,sqrt(3/2),lattice_hexagon_inc},value= lattice_hexagon		Endif	IF(FS_H_type==2)		SetVariable setvarlattice_hexagon,limits={0,3/(2*sqrt(2)),lattice_hexagon_inc},value= lattice_hexagon		EndifEnd	//********************************************************************************************************************************	Function ButtonProc_doping_hexagon(ctrlName) : ButtonControl	String ctrlName	PauseUpdate	Silent 1	Variable/G global_x	Variable/G lattice_hexagon	global_x=2*lattice_hexagon^2/3End	//********************************************************************************************************************************Window making_fs2f() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(59,44,665,629) ky_final vs kx_final	AppendToGraph ky_finalrot vs kx_finalrot	AppendToGraph BZbondaries_y vs BZbondaries_x	AppendToGraph MBZbondaries_y vs MBZbondaries_x	AppendToGraph upr_y vs upr_x	AppendToGraph upl_y vs upl_x	AppendToGraph lowr_y vs lowr_x	AppendToGraph lowl_y vs lowl_x	AppendToGraph mainb5_y vs mainb5_x	AppendToGraph mainb6_y vs mainb6_x	AppendToGraph mainb7_y vs mainb7_x	AppendToGraph mainb8_y vs mainb8_x	AppendToGraph mainb9_y vs mainb9_x	AppendToGraph mainb10_y vs mainb10_x	AppendToGraph mainb11_y vs mainb11_x	AppendToGraph mainb12_y vs mainb12_x	AppendToGraph mainb13_y vs mainb13_x	AppendToGraph mainb14_y vs mainb14_x	AppendToGraph mainb15_y vs mainb15_x	AppendToGraph mainb16_y vs mainb16_x	AppendToGraph folded1_y vs folded1_x	AppendToGraph folded2_y vs folded2_x	AppendToGraph folded3_y vs folded3_x	AppendToGraph folded4_y vs folded4_x	AppendToGraph folded5_y vs folded5_x	AppendToGraph folded6_y vs folded6_x	AppendToGraph folded7_y vs folded7_x	AppendToGraph folded8_y vs folded8_x	AppendToGraph folded9_y vs folded9_x	ModifyGraph width=515,height=390.152,cbRGB=(49151,53155,65535)	ModifyGraph mode(ky_final)=3,mode(ky_finalrot)=3	ModifyGraph marker(ky_final)=8,marker(ky_finalrot)=8	ModifyGraph lSize(MBZbondaries_y)=2	ModifyGraph lStyle(MBZbondaries_y)=1,lStyle(folded1_y)=3,lStyle(folded2_y)=3,lStyle(folded3_y)=3	ModifyGraph lStyle(folded4_y)=3,lStyle(folded5_y)=3,lStyle(folded6_y)=3,lStyle(folded7_y)=3	ModifyGraph lStyle(folded8_y)=3,lStyle(folded9_y)=3	ModifyGraph rgb(ky_final)=(0,0,0),rgb(BZbondaries_y)=(0,0,65535),rgb(MBZbondaries_y)=(65535,21845,0)	ModifyGraph rgb(upr_y)=(1,26214,0),rgb(upl_y)=(1,26214,0),rgb(lowr_y)=(1,26214,0)	ModifyGraph rgb(lowl_y)=(1,26214,0),rgb(mainb5_y)=(1,26214,0),rgb(mainb6_y)=(1,26214,0)	ModifyGraph rgb(mainb7_y)=(1,26214,0),rgb(mainb8_y)=(1,26214,0),rgb(mainb9_y)=(1,26214,0)	ModifyGraph rgb(mainb10_y)=(1,26214,0),rgb(mainb11_y)=(1,26214,0),rgb(mainb12_y)=(1,26214,0)	ModifyGraph rgb(mainb13_y)=(1,26214,0),rgb(mainb14_y)=(1,26214,0),rgb(mainb15_y)=(1,26214,0)	ModifyGraph rgb(mainb16_y)=(1,26214,0),rgb(folded1_y)=(43690,43690,43690),rgb(folded2_y)=(43690,43690,43690)	ModifyGraph rgb(folded3_y)=(43690,43690,43690),rgb(folded4_y)=(43690,43690,43690)	ModifyGraph rgb(folded5_y)=(43690,43690,43690),rgb(folded6_y)=(43690,43690,43690)	ModifyGraph rgb(folded7_y)=(43690,43690,43690),rgb(folded8_y)=(43690,43690,43690)	ModifyGraph rgb(folded9_y)=(43690,43690,43690)	ModifyGraph msize(ky_final)=4,msize(ky_finalrot)=4	ModifyGraph tick=2	ModifyGraph mirror=1	ModifyGraph fSize=12	ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0}	ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Label left "\\Z16k\\By\\M\\Z16 (\\F'symbol'p\\F'arial'/a)"	Label bottom "\\Z16k\\Bx\\M \\Z16(\\F'symbol'p\\F'arial'/a)"	SetAxis left -1.51515151515151,1.51515151515151	SetAxis bottom -2,2	Cursor/P A ky_final 0	ShowInfo	ControlBar 129	Button button0,pos={134,53},size={100,20},proc=ButtonProc_update_making_fs2f,title="\\K(65535,65535,65535)Update points"	Button button0,fColor=(26214,0,0)	SetVariable vartheta_zero_inc,pos={4,31},size={100,15},proc=setvarincrement_theta_zero,title="Increment"	SetVariable vartheta_zero_inc,limits={0,inf,0.01},value= theta_zero_inc	SetVariable varphi_zero_inc,pos={110,31},size={100,15},proc=setvarincrement_phi_zero,title="Increment"	SetVariable varphi_zero_inc,limits={0,inf,0.01},value= phi_zero_inc	SetVariable varrot_zero_inc,pos={214,31},size={100,15},proc=setvarincrement_rot_zero,title="Increment"	SetVariable varrot_zero_inc,limits={0,inf,0.01},value= rot_zero_inc	SetVariable varlattice_0_inc,pos={316,31},size={100,15},proc=setvarincrement_lattice_0,title="Increment"	SetVariable varlattice_0_inc,limits={0,inf,0.002},value= lattice_0_inc	SetVariable vartheta_zero,pos={4,6},size={100,16},proc=setvartheta_zero2f,title="q_0"	SetVariable vartheta_zero,font="Symbol"	SetVariable vartheta_zero,limits={-inf,inf,0.005},value= theta_zero,live= 1	SetVariable varphi_zero,pos={110,7},size={100,16},proc=setvarphi_zero2f,title="j_0"	SetVariable varphi_zero,font="Symbol"	SetVariable varphi_zero,limits={-inf,inf,0.005},value= phi_zero,live= 1	SetVariable varrot_zero,pos={214,7},size={100,15},proc=setvarrot_zero2f,title="Rotation"	SetVariable varrot_zero,limits={-360,360,1},value= rot_zero,live= 1	SetVariable varlattice_0,pos={316,7},size={100,16},proc=setvarlattice_02f,title="p/a"	SetVariable varlattice_0,font="Symbol"	SetVariable varlattice_0,limits={0,inf,0.002},value= lattice_0,live= 1	SetVariable varKEatEF,pos={4,55},size={120,15},proc=setKEatEF2f,title="Kenetic E"	SetVariable varKEatEF,limits={-inf,inf,0.001},value= KEatEF	SetVariable varglobal_mu,pos={5,85},size={120,16},proc=setvarglobal_mu2f,title="m"	SetVariable varglobal_mu,font="Symbol"	SetVariable varglobal_mu,limits={-inf,inf,0.001},value= global_mu,live= 1	SetVariable varglobal_mu_inc,pos={5,109},size={120,15},proc=setvarincrement_global_mu,title="Increment"	SetVariable varglobal_mu_inc,limits={0,inf,0.001},value= global_mu_inc	SetVariable varglobal_t,pos={136,85},size={120,15},proc=setvarglobal_t2f,title="t"	SetVariable varglobal_t,limits={-inf,inf,0.01},value= global_t,live= 1	SetVariable varglobal_t_inc,pos={136,109},size={120,15},proc=setvarincrement_global_t,title="Increment"	SetVariable varglobal_t_inc,limits={-inf,inf,0.001},value= global_t_inc	SetVariable varglobal_tprime,pos={261,85},size={120,15},proc=setvarglobal_tprime2f,title="t'"	SetVariable varglobal_tprime,limits={-inf,inf,0.001},value= global_tprime,live= 1	SetVariable varglobal_tprime_inc,pos={261,109},size={120,15},proc=setvarincrement_global_tprime,title="Increment"	SetVariable varglobal_tprime_inc,limits={-inf,inf,0.001},value= global_tprime_inc	Button button1,pos={518,30},size={85,20},proc=ButtonProc_calc_tbarea,title="Calc. doping"	ValDisplay valglobal_x,pos={501,53},size={99,17},title="Doping",fSize=12	ValDisplay valglobal_x,limits={0,0,0},barmisc={0,1000},value= #"global_x"	Button button2,pos={392,82},size={95,20},proc=ButtonProc_plot_tbGXMGMprimeX2f,title="Plot GXMGM'X"	Button for_phi_theta,pos={508,76},size={85,20},proc=ButtonProc_return_phi_theta,title="Pt at new hv"	Button buttonmain,pos={508,104},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17	Button button3table,pos={519,5},size={80,20},proc=ButtonProc_tableafs,title="Show  table"	Button button3table,fColor=(1,16019,65535)	PopupMenu popupview,pos={394,105},size={68,20},proc=PopMenuProc_viewmaking_fs2f,title="View"	PopupMenu popupview,fSize=13	PopupMenu popupview,mode=6,popvalue="2",value= #"\"1/4;2/4;3/4;4/4;1;2;3\"   "	SetVariable varaonb,pos={419,7},size={95,15},proc=setvaraonb2f,title="a/b a>b"	SetVariable varaonb,limits={1,inf,0.01},value= aonb,live= 1	SetVariable varaonb_inc,pos={419,31},size={95,15},proc=setvarincrement_aonb,title="Increment"	SetVariable varaonb_inc,limits={0,inf,0.002},value= aonb_inc	SetDrawLayer UserFront	SetDrawEnv fname= "Arial"	DrawText 0.598,-0.174,"Superlattice"	SetDrawEnv fname= "Arial"	DrawText 0.604,-0.174,"Superlattices"	DrawRect 0.526,-0.182,0.608,-0.144	DrawRect 0.636,-0.198,0.71,-0.152EndMacro//********************************************************************************************************************************Proc update_making_fs2f()//note: the calculated points are in units of pi/a for both a and b axis. The user can adjust the calculated curves to find a/b	pauseupdate				//This is to reflect the orthorombicity in the visualisation	silent 1	Variable i,size_final	Duplicate/O original_theta theta_shifted	Duplicate/O original_phi phi_shifted		theta_shifted[]=original_theta[p]+theta_zero		phi_shifted[]=original_phi[p]+phi_zero		Duplicate/O original_theta kx_norot	Duplicate/O original_theta ky_norot		kx_norot[]=0.51231*sqrt(KEatEF)*sin(theta_shifted[p]*pi/180)	ky_norot[]=0.51231*sqrt(KEatEF)*cos(theta_shifted[p]*pi/180)*sin(phi_shifted[p]*pi/180)	Duplicate/O original_theta kx_final	Duplicate/O original_theta ky_final	kx_final[]=(kx_norot[p]*cos(rot_zero*pi/180)-ky_norot[p]*sin(rot_zero*pi/180))/lattice_0	ky_final[]=(kx_norot[p]*sin(rot_zero*pi/180)+ky_norot[p]*cos(rot_zero*pi/180))/lattice_0	Make/O/N=(3*dimsize(original_theta,0)) kx_finalrot				Make/O/N=(3*dimsize(original_theta,0)) ky_finalrot	kx_finalrot[]=0	ky_finalrot[]=0	size_final=dimsize(original_theta,0)	i=0	Do		kx_finalrot[i]=kx_final[i] //reflection by the x=0 axis		ky_finalrot[i]=-ky_final[i]		kx_finalrot[i+size_final]=-kx_final[i]   //ok		ky_finalrot[i+size_final]=-ky_final[i]  //ok		kx_finalrot[i+2*size_final]=-kx_final[i]  //reflection by the y=0 axis		ky_finalrot[i+2*size_final]=ky_final[i]		i+=1	While(i<size_final)End//********************************************************************************************************************************Window image_fs_ploterHex() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(577,44,1138,677) Honeyy2 vs Honeyx2	AppendToGraph Honeyy3 vs Honeyx3	AppendToGraph Honeyy4 vs Honeyx4	AppendToGraph Honeyy5 vs Honeyx5	AppendToGraph Honeyy6 vs Honeyx6	AppendToGraph Honeyy7 vs Honeyx7	AppendToGraph Honeyy8 vs Honeyx8	AppendToGraph Honeyy9 vs Honeyx9	AppendToGraph Honeyy10 vs Honeyx10	AppendToGraph Honeyy11 vs Honeyx11	AppendToGraph Honeyy12 vs Honeyx12	AppendToGraph Honeyy13 vs Honeyx13	AppendToGraph Honeyy14 vs Honeyx14	AppendToGraph Honeyy15 vs Honeyx15	AppendToGraph Honeyy16 vs Honeyx16	AppendToGraph Honeyy17 vs Honeyx17	AppendToGraph Honeyy18 vs Honeyx18	AppendToGraph Honeyy19 vs Honeyx19	AppendToGraph Honeyy20 vs Honeyx20	AppendToGraph Honeyy21 vs Honeyx21	AppendToGraph Honeyy22 vs Honeyx22	AppendToGraph Honeyy23 vs Honeyx23	AppendToGraph Honeyy24 vs Honeyx24	AppendToGraph Honeyy25 vs Honeyx25	AppendToGraph Honeyy26 vs Honeyx26	AppendToGraph Honeyy27 vs Honeyx27	AppendToGraph Honeyy28 vs Honeyx28	AppendToGraph Honeyy29 vs Honeyx29	AppendToGraph Honeyy30 vs Honeyx30	AppendToGraph Honeyy31 vs Honeyx31	AppendToGraph Honeyy32 vs Honeyx32	AppendToGraph Honeyy33 vs Honeyx33	AppendToGraph Honeyy34 vs Honeyx34	AppendToGraph Honeyy35 vs Honeyx35	AppendToGraph Honeyy36 vs Honeyx36	AppendToGraph Honeyy37 vs Honeyx37	AppendToGraph Honeyy1 vs Honeyx1	ModifyGraph width=475,height=475,cbRGB=(1,39321,39321)	ModifyGraph lStyle(Honeyy2)=3,lStyle(Honeyy3)=3,lStyle(Honeyy4)=3,lStyle(Honeyy5)=3	ModifyGraph lStyle(Honeyy6)=3,lStyle(Honeyy7)=3,lStyle(Honeyy8)=3,lStyle(Honeyy9)=3	ModifyGraph lStyle(Honeyy10)=3,lStyle(Honeyy11)=3,lStyle(Honeyy12)=3,lStyle(Honeyy13)=3	ModifyGraph lStyle(Honeyy14)=3,lStyle(Honeyy15)=3,lStyle(Honeyy16)=3,lStyle(Honeyy17)=3	ModifyGraph lStyle(Honeyy18)=3,lStyle(Honeyy19)=3,lStyle(Honeyy20)=3,lStyle(Honeyy21)=3	ModifyGraph lStyle(Honeyy22)=3,lStyle(Honeyy23)=3,lStyle(Honeyy24)=3,lStyle(Honeyy25)=3	ModifyGraph lStyle(Honeyy26)=3,lStyle(Honeyy27)=3,lStyle(Honeyy28)=3,lStyle(Honeyy29)=3	ModifyGraph lStyle(Honeyy30)=3,lStyle(Honeyy31)=3,lStyle(Honeyy32)=3,lStyle(Honeyy33)=3	ModifyGraph lStyle(Honeyy34)=3,lStyle(Honeyy35)=3,lStyle(Honeyy36)=3,lStyle(Honeyy37)=3	ModifyGraph rgb(Honeyy2)=(32768,40777,65535),rgb(Honeyy3)=(32768,40777,65535),rgb(Honeyy4)=(32768,40777,65535)	ModifyGraph rgb(Honeyy5)=(32768,40777,65535),rgb(Honeyy6)=(32768,40777,65535),rgb(Honeyy7)=(32768,40777,65535)	ModifyGraph rgb(Honeyy8)=(32768,40777,65535),rgb(Honeyy9)=(32768,40777,65535),rgb(Honeyy10)=(32768,40777,65535)	ModifyGraph rgb(Honeyy11)=(32768,40777,65535),rgb(Honeyy12)=(32768,40777,65535)	ModifyGraph rgb(Honeyy13)=(32768,40777,65535),rgb(Honeyy14)=(32768,40777,65535)	ModifyGraph rgb(Honeyy15)=(32768,40777,65535),rgb(Honeyy16)=(32768,40777,65535)	ModifyGraph rgb(Honeyy17)=(32768,40777,65535),rgb(Honeyy18)=(32768,40777,65535)	ModifyGraph rgb(Honeyy19)=(32768,40777,65535),rgb(Honeyy20)=(32768,40777,65535)	ModifyGraph rgb(Honeyy21)=(32768,40777,65535),rgb(Honeyy22)=(32768,40777,65535)	ModifyGraph rgb(Honeyy23)=(32768,40777,65535),rgb(Honeyy24)=(32768,40777,65535)	ModifyGraph rgb(Honeyy25)=(32768,40777,65535),rgb(Honeyy26)=(32768,40777,65535)	ModifyGraph rgb(Honeyy27)=(32768,40777,65535),rgb(Honeyy28)=(32768,40777,65535)	ModifyGraph rgb(Honeyy29)=(32768,40777,65535),rgb(Honeyy30)=(32768,40777,65535)	ModifyGraph rgb(Honeyy31)=(32768,40777,65535),rgb(Honeyy32)=(32768,40777,65535)	ModifyGraph rgb(Honeyy33)=(32768,40777,65535),rgb(Honeyy34)=(32768,40777,65535)	ModifyGraph rgb(Honeyy35)=(32768,40777,65535),rgb(Honeyy36)=(32768,40777,65535)	ModifyGraph rgb(Honeyy37)=(32768,40777,65535),rgb(Honeyy1)=(0,0,65535)	ModifyGraph tick=2	ModifyGraph mirror=1	ModifyGraph fSize=12	ModifyGraph manTick(left)={0,1,0,0},manMinor(left)={4,0}	ModifyGraph manTick(bottom)={0,1,0,0},manMinor(bottom)={4,0}	Label left "\\Z16k\\By\\M\\Z16 (\\F'symbol'p\\F'arial'/a)"	Label bottom "\\Z16k\\Bx\\M \\Z16(\\F'symbol'p\\F'arial'/a)"	SetAxis left -3.06186217847897,3.06186217847897	SetAxis bottom -3.06186217847897,3.06186217847897	ShowInfo	ControlBar 94	Button for_dop,pos={302,42},size={70,20},proc=ButtonProc_doping_hexagon,title="Doping"	ValDisplay valdisp0,pos={311,67},size={50,14},limits={0,0,0},barmisc={0,1000}	ValDisplay valdisp0,value= #"global_x"	SetVariable vartheta1_zero,pos={11,3},size={120,16},proc=setvartheta1_zero,title="q_0"	SetVariable vartheta1_zero,font="Symbol"	SetVariable vartheta1_zero,limits={-inf,inf,0.005},value= theta1_zero,live= 1	SetVariable vartheta1_zero_inc,pos={11,21},size={115,15},proc=setvartheta1_zero,title="Increment"	SetVariable vartheta1_zero_inc,limits={0,inf,0.001},value= theta1_zero_inc	SetVariable varphi1_zero,pos={135,4},size={115,16},proc=setvarphi1_zero,title="j_0"	SetVariable varphi1_zero,font="Symbol"	SetVariable varphi1_zero,limits={-inf,inf,0.005},value= phi1_zero,live= 1	SetVariable varphi1_zero_inc,pos={135,23},size={115,15},proc=setvarincrement_phi1_zero,title="Increment"	SetVariable varphi1_zero_inc,limits={0,inf,0.01},value= phi1_zero_inc	SetVariable varrot1_zero,pos={257,4},size={115,15},proc=setvarrot1_zero,title="Rotation"	SetVariable varrot1_zero,limits={-360,360,0.2},value= rot1_zero,live= 1	SetVariable varrot1_zero_inc,pos={259,25},size={115,15},proc=setvarincrement_rot1_zero,title="Increment"	SetVariable varrot1_zero_inc,limits={0,inf,0.01},value= rot1_zero_inc	SetVariable varlattice1_0,pos={382,4},size={115,16},proc=setvarlattice1_0,title="p/a"	SetVariable varlattice1_0,font="Symbol"	SetVariable varlattice1_0,limits={0,inf,0.002},value= lattice1_0,live= 1	SetVariable varlattice1_0_inc,pos={383,25},size={115,15},proc=setvarincrement_lattice1_0,title="Increment"	SetVariable varlattice1_0_inc,limits={0,inf,0.002},value= lattice1_0_inc	Button update_graph,pos={3,44},size={80,20},proc=ButtonProc_update_image_fs,title="\\K(65535,65535,65535)Update"	Button update_graph,fColor=(27085,28,1)	Button for_phi_theta,pos={3,67},size={80,20},proc=ButtonProc_return_phi_theta1,title="Pt at new hv"	SetVariable Varquality_factor,pos={213,44},size={85,15},proc=setquality_factor,title="Quality"	SetVariable Varquality_factor,limits={0.1,inf,1},value= quality_factor	Button buttonshowmain,pos={472,65},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonshowmain,fStyle=17	Button buttontable,pos={503,12},size={50,20},proc=ButtonProc_tableafs,title="Table"	Button buttontable,fColor=(1,16019,65535)	Slider sliderx,pos={80,123},size={219,41},disable=1,proc=SliderProcCsrslicerx	Slider sliderx,fSize=8	Slider sliderx,limits={-2,2,0.01},value= 1,vert= 0,thumbColor= (49151,65535,65535)	Slider slidery,pos={5,159},size={43,233},disable=1,proc=SliderProcCsrslicery	Slider slidery,fSize=8	Slider slidery,limits={-2,2,0.01},value= 1,thumbColor= (65535,65532,16385)	PopupMenu popupwhichpnt,pos={7,133},size={67,20},disable=1,proc=PopMenuProcwhichpnt	PopupMenu popupwhichpnt,mode=2,popvalue="Point 2",value= #"\"Point 1;Point 2\""	ValDisplay valdispCsrx1,pos={312,124},size={65,17},disable=1,title=" X1"	ValDisplay valdispCsrx1,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsrx1,value= #"Csrx1forslicer"	ValDisplay valdispCsrx2,pos={396,124},size={65,17},disable=1,title=" X2"	ValDisplay valdispCsrx2,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsrx2,value= #"Csrx2forslicer"	ValDisplay valdispCsry1,pos={312,141},size={65,17},disable=1,title=" Y1"	ValDisplay valdispCsry1,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsry1,value= #"Csry1forslicer"	ValDisplay valdispCsry2,pos={396,141},size={65,17},disable=1,title=" Y2"	ValDisplay valdispCsry2,fSize=12,frame=5,limits={0,0,0},barmisc={0,1000}	ValDisplay valdispCsry2,value= #"Csry2forslicer"	PopupMenu popupspecialorientationslicer,pos={299,161},size={186,21},disable=1,proc=PopMenuProcorientationforslicer,title="Special orientation:"	PopupMenu popupspecialorientationslicer,fSize=14	PopupMenu popupspecialorientationslicer,mode=2,popvalue="G-Y",value= #"\"None;G-Y;G-X;G-M;G-M';M-Y;M'-Y\""	Button buttonshowimageCsrslicer,pos={502,124},size={85,20},disable=1,proc=Buttonshowimageforslicer,title="Show Image"	Button forzoom,pos={516,160},size={50,20},disable=1,proc=Button_zoom_forCsrslicer,title="Zoom"	PopupMenu popupview,pos={214,63},size={68,20},proc=PopMenuProc_viewimage_fsH,title="View"	PopupMenu popupview,fSize=13	PopupMenu popupview,mode=6,popvalue="2",value= #"\"1/4;2/4;3/4;4/4;1;2;3\""	SetVariable setvarlattice_hexagon,pos={87,46},size={120,15},proc=SetVarProclattice_hexagon1,title="Hexagon size"	SetVariable setvarlattice_hexagon,limits={0,1.06066,0.01},value= lattice_hexagon,live= 1	SetVariable setvarlattice_hexagon_inc,pos={88,66},size={120,15},proc=setvarincrement_lattice_hexagon,title="Increment"	SetVariable setvarlattice_hexagon_inc,limits={0,1,0.01},value= lattice_hexagon_inc,live= 1	PopupMenu popupFS_H_type,pos={379,43},size={142,20},proc=PopMenuProc_FS_Htype1,title="FS type:"	PopupMenu popupFS_H_type,fSize=13	PopupMenu popupFS_H_type,mode=2,popvalue="Hexagon1",value= #"\"None;Hexagon1;Hexagon2\""EndMacro//********************************************************************************************************************************Function ButtonProc_image_fsHEX(ctrlName) : ButtonControl	String ctrlName	If(Wintype("image_fs_ploterHex")==0)			Execute "ini_image_fsHex()"		Execute "Honeycomb()"				Execute "image_fs_ploterHex()"		Else			Dowindow/F image_fs_ploterHex	EndifEnd//********************************************************************************************************************************Proc ini_image_fsHex()	pauseupdate	silent 1	Variable/G theta_zero,phi_zero,rot_zero,KEatEF,lattice_0	Variable/G theta_zero_inc,phi_zero_inc,rot_zero_inc,lattice_0_inc	Variable/G FS_H_type	Variable/G lattice_hexagon		Variable/G lattice_hexagon_inc	Variable/G global_x					if(Exists("original_theta")==0)		Make/O/N=0 original_theta		Make/O/N=0 theta_shifted		Make/O/N=0 original_phi		Make/O/N=0 phi_shifted		Make/O/N=0 kx_norot		Make/O/N=0 ky_norot		Make/O/N=0 kx_final		Make/O/N=0 ky_final		Make/O/N=0 kx_finalrot		Make/O/N=0 ky_finalrot		Edit original_theta,original_phi,theta_shifted,phi_shifted,kx_norot,ky_norot,kx_final,ky_final,kx_finalrot,ky_finalrot		Dowindow/C table_making_fs	Endif	theta_zero=0	phi_zero=0	rot_zero=0	KEatEF=21.2182	lattice_0=1.12	theta_zero_inc=0.005	phi_zero_inc=0.005	rot_zero_inc=0.2	lattice_0_inc=0.002	FS_H_type=1	lattice_hexagon=0.5	lattice_hexagon_inc=0.01	global_x=0						End//********************************************************************************************************************************Proc updateHexagonFS1()	Silent 1;PauseUpdate	Variable/G lattice_hexagon	VAriable/G FS_H_type	string listname	String listitem	String thisname,thisnamey,thisnamex	Variable condition	Variable i	Variable Vec_ax,Vec_ay,Vec_bx,Vec_by	Variable v1,v2	Variable distance	Vec_ax=3/(sqrt(2))	Vec_ay=0	Vec_bx=Vec_ax*cos(60*pi/180)	Vec_by=Vec_ax*sin(60*pi/180)		listname=TraceNameList("image_fs_ploterHEX", ";", 1 )	IF(FS_H_type==1)		condition=0		i=0		Do			listitem=StringFromList(i, listname,";")			IF(cmpstr(listitem,"FS_H_y")==0)				condition=1			Endif			i+=1				While((i<ItemsInList(listname,";")&&condition==0))		If(condition==1)			Removefromgraph FS_H_y			i=2			Do				thisname="FS_H"+num2str(i)+"_y"				Removefromgraph $thisname				i+=1			While(i<38)		Endif	Endif	IF(FS_H_type==2)		Makehexagon(lattice_hexagon,0,"FS_H")		i=2		v1=-3		Do			v2=-3			Do				distance=sqrt((v1*Vec_ax+v2*Vec_bx)^2+(v1*Vec_ay+v2*Vec_by)^2)				IF(((v1!=0)||(v2!=0))&&(distance<=3*vec_ax))					thisnamex="FS_H"+num2str(i)+"_x"					thisnamey="FS_H"+num2str(i)+"_y"					Duplicate/O FS_H_x $thisnamex					Duplicate/O FS_H_y $thisnamey					$thisnamex[]+=v1*Vec_ax+v2*Vec_bx					$thisnamey[]+=v1*Vec_ay+v2*Vec_by									i+=1				Endif				v2+=1			While(v2<4)			v1+=1						While(v1<4)				condition=0		i=0		Do			listitem=StringFromList(i, listname,";")			IF(cmpstr(listitem,"FS_H_y")==0)				condition=1			Endif			i+=1				While((i<ItemsInList(listname,";")&&condition==0))		If(condition==0)			Appendtograph FS_H_y vs FS_H_x			ModifyGraph rgb(FS_H_y)=(1,26214,0)			i=2			Do				thisname="FS_H"+num2str(i)+"_y"				thisnamex="FS_H"+num2str(i)+"_x"								Appendtograph $thisname vs $thisnamex				ModifyGraph rgb($thisname)=(1,26214,0)				i+=1			While(i<38)		Endif	Endif	IF(FS_H_type==3)		Makehexagon(lattice_hexagon,30,"FS_H")		i=2		v1=-3		Do			v2=-3			Do				distance=sqrt((v1*Vec_ax+v2*Vec_bx)^2+(v1*Vec_ay+v2*Vec_by)^2)				IF(((v1!=0)||(v2!=0))&&(distance<=3*vec_ax))					thisnamex="FS_H"+num2str(i)+"_x"					thisnamey="FS_H"+num2str(i)+"_y"					Duplicate/O FS_H_x $thisnamex					Duplicate/O FS_H_y $thisnamey					$thisnamex[]+=v1*Vec_ax+v2*Vec_bx					$thisnamey[]+=v1*Vec_ay+v2*Vec_by									i+=1				Endif				v2+=1			While(v2<4)			v1+=1						While(v1<4)				condition=0		i=0		Do			listitem=StringFromList(i, listname,";")			IF(cmpstr(listitem,"FS_H_y")==0)				condition=1			Endif			i+=1				While((i<ItemsInList(listname,";")&&condition==0))		If(condition==0)			Appendtograph FS_H_y vs FS_H_x			ModifyGraph rgb(FS_H_y)=(1,26214,0)			i=2			Do				thisname="FS_H"+num2str(i)+"_y"				thisnamex="FS_H"+num2str(i)+"_x"								Appendtograph $thisname vs $thisnamex				ModifyGraph rgb($thisname)=(1,26214,0)				i+=1			While(i<38)		Endif	Endif	End//********************************************************************************************************************************Proc mat3dHD_pi(num,box)//Use mat3d	variable num,box	prompt num,"How many times to be smoothed"	prompt box,"Input the box width"	PauseUpdate	Silent 1	Variable i,j	Duplicate/O Mat3d Mat3dHD	Mat3dHD[][][]=0	if(src_vs_bnl==0)		func_mat3dHD_pi(mat3d,mat3dHD,num,box)		else			func_mat3dHD_als_pi(mat3d,mat3dHD,num,box)	EndifEnd	//********************************************************************************************************************************Function func_mat3dHD_als_pi(mat3d,mat3dHD,num,box)	Wave mat3d	Wave mat3dHD	variable num,box	Variable i,j	j=0	Do		i=0		Do			Make/O/N=(dimsize(mat3d,2)) tempwave			Setscale/P x,dimoffset(mat3d,2),dimdelta(mat3d,2),""tempwave			tempwave[]=mat3d[i][j][p]			Smooth/E=3/B=(num) box,tempwave						differentiate tempwave			Smooth/E=3/B=(num) box,tempwave				differentiate tempwave			mat3dHD[i][j][]=tempwave[r]									i+=1		While(i<dimsize(mat3d,0))		j+=1	While(j<dimsize(mat3d,1))End//*******************************************************************************************************************************Function func_mat3dHD_pi(mat3d,mat3dHD,num,box)	Wave mat3d	Wave mat3dHD	variable num,box	Variable i,j	j=0	Do		i=0		Do			Make/O/N=(dimsize(mat3d,0)) tempwave			Setscale/P x,dimoffset(mat3d,0),dimdelta(mat3d,0),""tempwave			tempwave[]=mat3d[p][j][i]			Smooth/E=3/B=(num) box,tempwave						differentiate tempwave			Smooth/E=3/B=(num) box,tempwave				differentiate tempwave			mat3dHD[][j][i]=tempwave[p]									i+=1		While(i<dimsize(mat3d,2))		j+=1	While(j<dimsize(mat3d,1))End//*******************************************************************************************************************************Proc symmat3dhv()  // symmetrize mat_khv with respect to zero. The zero must be set first	Pauseupdate;Silent 1		Variable i	Make/O/N=(2*dimsize(mat_khv,0),dimsize(mat_khv,1),dimsize(mat_khv,2)) mat_khvtemp	Setscale/I x,dimoffset(mat_khv,0),-dimoffset(mat_khv,0),""mat_khvtemp	Setscale/P y,dimoffset(mat_khv,1),dimdelta(mat_khv,1),""mat_khvtemp	Setscale/P z,dimoffset(mat_khv,2),dimdelta(mat_khv,2),""mat_khvtemp	print dimoffset(mat_khvtemp,0),dimdelta(mat_khvtemp,0) 	func_symmat3dhv(mat_khv,mat_khvtemp)	Duplicate/O mat_khvtemp mat_khv	Killwaves mat_khvtemp			End//*******************************************************************************************************************************Function func_symmat3dhv(matold,matnew)  // symmetrize mat_khv with respect to zero. The zero must be set first	wave matold	Wave matnew	Pauseupdate;Silent 1		Variable i,j, positionbefore0	Make/O/N=(dimsize(matold,0)) waveofxs	waveofxs[]=dimoffset(matold,0)+p*dimdelta(matold,0)	positionbefore0=Floor(-dimoffset(matnew,0)/dimdelta(matnew,0))	matnew[][][]=NaN	print positionbefore0	i=0	Do		j=0		Do			Make/O/N=(dimsize(matold,0)) thiswave			thiswave[]=matold[p][j][i]			matnew[0,positionbefore0][j][i]=interp(dimoffset(matnew,0)+p*dimdelta(matnew,0),waveofxs,thiswave)			matnew[positionbefore0+1,*][j][i]=interp(-dimoffset(matnew,0)-p*dimdelta(matnew,0),waveofxs,thiswave)			j+=1		While(j<dimsize(matold,1))		i+=1	While(i<dimsize(matold,2))End//*******************************************************************************************************************************Function ButtonProc_symmat3dhv(ctrlName) : ButtonControl	String ctrlName	Execute "symmat3dhv()"End//*******************************************************************************************************************************		Function Tab_convert(ctrlName,tabNum) : TabControl	String ctrlName	Variable tabNum	IF(tabNum==3)		Button button22 disable=1		Button button26 disable=1		Button button46 disable=1				Button button85 disable=1		Button button86 disable=1		Button button87 disable=1						Button button_mat3d_pi disable=1		Button button24 disable=1		Button but_mat3dHD disable=1		Button button5 disable=1		Button button30 disable=1		Button button44 disable=1				Button button27 disable=1			Button button25 disable=1			Button button45 disable=1		Button button100 disable=1					Button button_Generatecut disable=1						Button button32 disable=1		Button button112 disable=1		Button button113 disable=1						Button button63 disable=1						Button button64 disable=1						Button button65 disable=1						Button button66 disable=1						Button button67 disable=1						Button button68 disable=1						Button button69 disable=1						Button button70 disable=1		Button button71 disable=1			Button button108 disable=1				Button button75 disable=1			Button button76 disable=1																																		Button button77 disable=1																																		Button button78 disable=1																																		Button button79 disable=1			Button button80 disable=1																																																																			Button button81 disable=1																																		Button button82 disable=1																																		Button button83 disable=1																																		Button button84 disable=1		Button button111 disable=1		Button button114 disable=1					Button button115 disable=1										//List		Button button96 disable=0																																		Button button97 disable=0																																		Button button98 disable=0		Button button99 disable=0		Button button109 disable=0				Button button110 disable=0														Valdisplay Valdisp0 disable=0		Valdisplay Valdisp1 disable=0		Checkbox check0 disable=0		Checkbox check1 disable=0		Checkbox check2 disable=0		Checkbox check3 disable=0		Checkbox check4 disable=0		Checkbox check5 disable=0		//For Old, New and hv only		Button button88 disable=1																																	Endif				IF(tabNum==2)		Button button22 disable=1		Button button26 disable=1		Button button46 disable=1				Button button85 disable=1		Button button86 disable=1		Button button87 disable=1						Button button_mat3d_pi disable=1		Button button24 disable=1		Button but_mat3dHD disable=1		Button button5 disable=1		Button button30 disable=1		Button button44 disable=1				Button button27 disable=1			Button button25 disable=1			Button button45 disable=1		Button button100 disable=1					Button button_Generatecut disable=1						Button button32 disable=1		Button button112 disable=1		Button button113 disable=1						Button button63 disable=1						Button button64 disable=1						Button button65 disable=1						Button button66 disable=1						Button button67 disable=1						Button button68 disable=1						Button button69 disable=1						Button button70 disable=1		Button button71 disable=1			Button button108 disable=1				Button button75 disable=0			Button button76 disable=0																																		Button button77 disable=0																																		Button button78 disable=0																																		Button button79 disable=0			Button button80 disable=0																																																																			Button button81 disable=0																																		Button button82 disable=0																																		Button button83 disable=0																																		Button button84 disable=0																																		Button button111 disable=0		Button button114 disable=0					Button button115 disable=0															//List		Button button96 disable=1																																		Button button97 disable=1																																		Button button98 disable=1		Button button99 disable=1		Button button109 disable=1								Button button110 disable=1														Valdisplay Valdisp0 disable=1		Valdisplay Valdisp1 disable=1		Checkbox check0 disable=1		Checkbox check1 disable=1		Checkbox check2 disable=1		Checkbox check3 disable=1		Checkbox check4 disable=1		Checkbox check5 disable=1		//For Old, New and hv only		Button button88 disable=0																																	Endif			IF(tabNum==1)		Button button22 disable=0		Button button26 disable=0		Button button46 disable=0				Button button85 disable=0		Button button86 disable=0		Button button87 disable=0				Button button_mat3d_pi disable=1		Button button24 disable=1		Button but_mat3dHD disable=1		Button button5 disable=1		Button button30 disable=1		Button button44 disable=1				Button button27 disable=1			Button button25 disable=1			Button button45 disable=1		Button button100 disable=1						Button button_Generatecut disable=1						Button button32 disable=1		Button button112 disable=1		Button button113 disable=1						Button button63 disable=0						Button button64 disable=0						Button button65 disable=0						Button button66 disable=0						Button button67 disable=0						Button button68 disable=0						Button button69 disable=0						Button button70 disable=0		Button button71 disable=0			Button button108 disable=0																													Button button75 disable=1																																Button button76 disable=1																																		Button button77 disable=1																																		Button button78 disable=1																																		Button button79 disable=1																																		Button button80 disable=1																																		Button button81 disable=1																																		Button button82 disable=1																																		Button button83 disable=1																																		Button button84 disable=1																																		Button button111 disable=1					Button button114 disable=1					Button button115 disable=1										//List		Button button96 disable=1																																		Button button97 disable=1																																		Button button98 disable=1		Button button99 disable=1		Button button109 disable=1								Button button110 disable=1														Valdisplay Valdisp0 disable=1		Valdisplay Valdisp1 disable=1		Checkbox check0 disable=1		Checkbox check1 disable=1		Checkbox check2 disable=1		Checkbox check3 disable=1		Checkbox check4 disable=1		Checkbox check5 disable=1		//For Old, New and hv only		Button button88 disable=0																																	Endif		IF(tabNum==0)		Button button22 disable=0		Button button26 disable=0		Button button46 disable=0				Button button85 disable=0		Button button86 disable=0		Button button87 disable=0				Button button_mat3d_pi disable=0		Button button24 disable=0		Button but_mat3dHD disable=0		Button button5 disable=0		Button button30 disable=0		Button button44 disable=0		Button button25 disable=0			Button button45 disable=0		Button button27 disable=0									Button button100 disable=0						Button button_Generatecut disable=0						Button button32 disable=0		Button button112 disable=0		Button button113 disable=0						Button button63 disable=1						Button button64 disable=1						Button button65 disable=1						Button button66 disable=1						Button button67 disable=1						Button button68 disable=1						Button button69 disable=1						Button button70 disable=1						Button button71 disable=1		Button button108 disable=1																	Button button75 disable=1																																Button button76 disable=1																																		Button button77 disable=1																																		Button button78 disable=1																																		Button button79 disable=1																																		Button button80 disable=1																																		Button button81 disable=1																																		Button button82 disable=1																																		Button button83 disable=1																																		Button button84 disable=1																																		Button button111 disable=1					Button button114 disable=1					Button button115 disable=1										//List		Button button96 disable=1																																		Button button97 disable=1																																		Button button98 disable=1		Button button99 disable=1		Button button109 disable=1								Button button110 disable=1														Valdisplay Valdisp0 disable=1		Valdisplay Valdisp1 disable=1		Checkbox check0 disable=1		Checkbox check1 disable=1		Checkbox check2 disable=1		Checkbox check3 disable=1		Checkbox check4 disable=1		Checkbox check5 disable=1																																				//For Old, New and hv only		Button button88 disable=0																																	Endif	return 0	End//*******************************************************************************************************************************		//?????????????????????????????????????????????New transformation macros///////////////////////////////////////////////////////////\\\\\############################################################################################//\\\\\############################################################################################//\\\\\############################################################################################//\\\\\############################################################################################//\\\\\############################################################################################//*******************************************************************************************************************************		Function PopMenuProc_mode_ifs4(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G mode_ifs4	Variable/G auto_update_ifs4	mode_ifs4=popNum	if(popNum==1)		Setvariable Setvar0 disable=1		Setvariable Setvar1 disable=1					Endif	if(popNum==2)		Setvariable Setvar0 disable=0		Setvariable Setvar1 disable=0						Endif	If(auto_update_ifs4==2)		Execute "Update_image_fs()"	EndifEnd//*****************************CHUNK STORY*******************************Function PopMenuProc_mode_mfs4(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G mode_mfs4	mode_mfs4=popNumEnd//*******************************************************************************************************************************		Proc Make_onechunkcut(number)	Variable number	PauseUpdate;Silent 1	Variable/G SRC_vs_BNL	String thislist	String thisdata	String ThisItem	String firstname	String chunkname	Variable items	Variable i	Variable Deltaangle	thislist=chunkcutlist[number]	items=Itemsinlist(thislist,";")	chunkname="chunkcut"+num2str(number)	firstname="data"+num2str(imageindex[str2num(StringFromList(0,thislist,";"))])	Deltaangle=imagephi[str2num(StringFromList(1,thislist,";"))]-imagephi[str2num(StringFromList(0,thislist,";"))]	IF(SRC_vs_BNL==1)		Make/O/N=(items,chunketalast[number]-chunketafirst[number]+1,dimsize($firstname,1)) $chunkname		print "Esize",dimsize($chunkname,2)		SetScale/P x,imagephi[str2num(StringFromList(0,thislist,";"))],Deltaangle,""$chunkname		SetScale/P y, dimoffset($firstname,0)+chunketafirst[number],dimdelta($firstname,0),""$chunkname		Setscale/P z, dimoffset($firstname,1),dimdelta($firstname,1),""$chunkname		Else			Make/O/N=(items,chunketalast[number]-chunketafirst[number]+1,dimsize($firstname,1)) $chunkname	//I inversed 1 and 2 position			SetScale/P x,imagephi[str2num(StringFromList(0,thislist,";"))],Deltaangle,""$chunkname			SetScale/P y, dimoffset($firstname,0)+chunketafirst[number],dimdelta($firstname,0),""$chunkname			Setscale/P z, dimoffset($firstname,1),dimdelta($firstname,1),""$chunkname		Endif	i=0	Do		Thisitem=StringFromList(i,thislist,";")		thisdata="data"+num2str(imageindex[str2num(Thisitem)])		If(SRC_vs_BNL==1)			$chunkname[i][][]=$thisdata[q+chunketafirst[number]][r]			Else				$chunkname[i][][]=$thisdata[q+chunketafirst[number]][r]		Endif		i+=1	While(i<items)End//*******************************************************************************************************************************Proc Make_allchunkcuts()	PauseUpdate;Silent 1	Variable i	i=0	Do		Make_onechunkcut(i)		i+=1	While(i<dimsize(chunkcutlist,0))End//*******************************************************************************************************************************Proc Generate_chunklist(imtheta,imphi1,imphi2,number)	Variable imtheta	Variable imphi1	Variable imphi2	Variable number	Prompt imtheta,"Enter the theta angle from Image_Table"	Prompt imphi1,"Enter the lowest phi angle from Image_Table"		Prompt imphi2,"Enter the highest phi angle from Image_Table"		Prompt number,"Number of the chunkcut"	PauseUpdate;silent 1	String thelist,thisstring	Variable newadd	If(number>dimsize(chunkcutlist,0)-1)		newadd=number-dimsize(chunkcutlist,0)+1		Insertpoints dimsize(chunkcutlist,0),newadd,chunkcutlist		Insertpoints dimsize(chunkcutlist,0),newadd,chunketafirst		Insertpoints dimsize(chunkcutlist,0),newadd,chunketalast		Insertpoints dimsize(chunkcutlist,0),newadd,chunkfixedangle					Endif	Chunkcutlist[number]=Func_Generate_chunklist(imageindex,imagetheta,imagephi,imtheta,imphi1,imphi2)	thelist=Chunkcutlist[number]	thisstring=Stringfromlist(0,thelist,";")	chunketafirst[number]=waveetast[str2num(thisstring)]	chunketalast[number]=waveetaed[str2num(thisstring)]	chunkfixedangle[number]=imthetaEnd//*******************************************************************************************************************************Function/S Func_Generate_chunklist(imageindex,imagetheta,imagephi,imtheta,imphi1,imphi2)	Wave imageindex	Wave imagetheta	Wave imagephi	Variable imtheta	Variable imphi1	Variable imphi2	PauseUpdate;silent 1	String thestring	Variable i	Make/O/N=0 numwave	Make/O/N=0 anglewave	i=0	Do		IF((ABS(imagetheta[i]-imtheta)<=0.00001)&&(imagephi[i]>=imphi1)&&(imagephi[i]<=imphi2))			Insertpoints 0,1,numwave			Insertpoints 0,1,anglewave			numwave[0]=i			anglewave[0]=imagephi[i]		Endif		i+=1	While(i<dimsize(imageindex,0))	Sort anglewave, anglewave,numwave	thestring=num2str(numwave[0])	i=1	Do		thestring+=";"+num2str(numwave[i])		i+=1	While(i<dimsize(numwave,0))	Return thestringEnd//*******************************************************************************************************************************Proc make_mat3dk(addtheta,addphi,Fermi_level)	Variable addtheta	Variable addphi	Variable Fermi_level	Prompt addtheta,"Quantity to add to the physical theta"	Prompt addphi,"Quantity to add to the physical phi"	Prompt Fermi_level,"Fermi level"		PauseUpdate;Silent 1	Variable/G SRC_vs_BNL	String thischunk,thiskchunk	Variable slit	Variable i	Variable kxsize,kysize,kxmin,kymin,kxmax,kymax	Variable kxdelta,kydelta	Variable sizeE	Variable angle 	Slit=SRC_vs_BNL	Make/O/N=0 vec4kxmin	Make/O/N=0 vec4kymin	Make/O/N=0 vec4kxmax	Make/O/N=0 vec4kymax	Make/O/N=0 vec4kxdelta	Make/O/N=0 vec4kydelta		i=0	Do		Print "Chunk number", i		thischunk="chunkcut"+num2str(i)		thiskchunk="k"+thischunk		angle=chunkfixedangle[i]		Make/O/N=6 kproperties		size4cvtchunkcut($thischunk,angle,addphi,addtheta,slit,kproperties)		kxsize=kproperties[0]		kysize=kproperties[1]		kxmin=kproperties[2]		kymin=kproperties[3]		kxmax=kproperties[4]		kymax=kproperties[5]				sizeE=dimsize($thischunk,2)		Make/O/N=(kxsize,kysize,sizeE) $thiskchunk		Setscale/I x,kxmin,kxmax,""$thiskchunk		Setscale/I y,kymin,kymax,""$thiskchunk		Setscale/P z,dimoffset($thischunk,2)-Fermi_level,dimdelta($thischunk,2),""$thiskchunk		Print "Begin conversion"		convert1chunkcut($thischunk,$thiskchunk,chunkfixedangle[i],addphi,addtheta,slit)		insertpoints 0,1,vec4kxmin		insertpoints 0,1,vec4kxmax		insertpoints 0,1,vec4kymin		insertpoints 0,1,vec4kymax		insertpoints 0,1,vec4kxdelta		insertpoints 0,1,vec4kydelta		vec4kxmin[0]=kxmin		vec4kxmax[0]=kxmax		vec4kymin[0]=kymin		vec4kymax[0]=kymax		vec4kxdelta[0]=dimdelta($thiskchunk,0)		vec4kydelta[0]=dimdelta($thiskchunk,1)			i+=1	While(i<dimsize(chunkcutlist,0))	killwaves kproperties	IF(dimsize(chunkcutlist,0)==1)		Duplicate/O $thiskchunk mat3dk		Else			kxmin=WaveMin(vec4kxmin)			kxmax=WaveMax(vec4kxmax)			kymin=WaveMin(vec4kymin)			kymax=WaveMax(vec4kymax)			kxdelta=WaveMin(vec4kxdelta)				kydelta=WaveMin(vec4kydelta)			kxsize=Floor((kxmax-kxmin)/kxdelta)			kxsize=Floor((kymax-kymin)/kydelta)			Make/O/N=(kxsize,kysize,sizeE) mat3dk			Setscale/I x,kxmin,kxmax,""mat3dk			Setscale/I y,kymin,kymax,""mat3dk			Setscale/P z,dimoffset($thiskchunk,2),dimdelta($thiskchunk,2),""mat3dk			Make/O/N=(kxsize,kysize,sizeE,dimsize(chunkcutlist,0)) mergedmat			Setscale/I x,kxmin,kxmax,""mergedmat			Setscale/I y,kymin,kymax,""mergedmat			Setscale/P z,dimoffset($thiskchunk,2),dimdelta($thiskchunk,2),""mergedmat			Print "Creating mergedmat"			i=0			Do				thiskchunk="kchunkcut"+num2str(i)				merged1kchunk($thiskchunk, mergedmat,i)				killwaves $thiskchunk				i+=1			While(i<dimsize(chunkcutlist,0))			Print "Begin final merging"			mergekchunks(mergedmat,mat3dk)						Killwaves mergedmat							Endif	End//*******************************************************************************************************************************Proc make_mat3dkVD(addtheta,addphi,Fermi_level)	Variable addtheta	Variable addphi	Variable Fermi_level	Prompt addtheta,"Quantity to add to the physical theta"	Prompt addphi,"Quantity to add to the physical phi"	Prompt Fermi_level,"Fermi level"		PauseUpdate;Silent 1	Variable/G SRC_vs_BNL	String thischunk,thiskchunk	Variable slit	Variable i	Variable kxsize,kysize,kxmin,kymin,kxmax,kymax	Variable kxdelta,kydelta	Variable sizeE	Variable angle 	Slit=SRC_vs_BNL	Make/O/N=0 vec4kxmin	Make/O/N=0 vec4kymin	Make/O/N=0 vec4kxmax	Make/O/N=0 vec4kymax	Make/O/N=0 vec4kxdelta	Make/O/N=0 vec4kydelta		i=0	Do		Print "Chunk number", i		thischunk="chunkcutVD"+num2str(i)		thiskchunk="k"+thischunk		angle=chunkfixedangle[i]		Make/O/N=6 kproperties		size4cvtchunkcut($thischunk,angle,addphi,addtheta,slit,kproperties)		kxsize=kproperties[0]		kysize=kproperties[1]		kxmin=kproperties[2]		kymin=kproperties[3]		kxmax=kproperties[4]		kymax=kproperties[5]				sizeE=dimsize($thischunk,2)		Make/O/N=(kxsize,kysize,sizeE) $thiskchunk		Setscale/I x,kxmin,kxmax,""$thiskchunk		Setscale/I y,kymin,kymax,""$thiskchunk		Setscale/P z,dimoffset($thischunk,2)-Fermi_level,dimdelta($thischunk,2),""$thiskchunk		Print "Begin conversion"		convert1chunkcut($thischunk,$thiskchunk,chunkfixedangle[i],addphi,addtheta,slit)		insertpoints 0,1,vec4kxmin		insertpoints 0,1,vec4kxmax		insertpoints 0,1,vec4kymin		insertpoints 0,1,vec4kymax		insertpoints 0,1,vec4kxdelta		insertpoints 0,1,vec4kydelta		vec4kxmin[0]=kxmin		vec4kxmax[0]=kxmax		vec4kymin[0]=kymin		vec4kymax[0]=kymax		vec4kxdelta[0]=dimdelta($thiskchunk,0)		vec4kydelta[0]=dimdelta($thiskchunk,1)			i+=1	While(i<dimsize(chunkcutlist,0))	killwaves kproperties	IF(dimsize(chunkcutlist,0)==1)		Duplicate/O $thiskchunk mat3dkVD		Else			kxmin=WaveMin(vec4kxmin)			kxmax=WaveMax(vec4kxmax)			kymin=WaveMin(vec4kymin)			kymax=WaveMax(vec4kymax)			kxdelta=WaveMin(vec4kxdelta)				kydelta=WaveMin(vec4kydelta)			kxsize=Floor((kxmax-kxmin)/kxdelta)			kxsize=Floor((kymax-kymin)/kydelta)			Make/O/N=(kxsize,kysize,sizeE) mat3dkVD			Setscale/I x,kxmin,kxmax,""mat3dkVD			Setscale/I y,kymin,kymax,""mat3dkVD			Setscale/P z,dimoffset($thiskchunk,2),dimdelta($thiskchunk,2),""mat3dkVD			Make/O/N=(kxsize,kysize,sizeE,dimsize(chunkcutlist,0)) mergedmat			Setscale/I x,kxmin,kxmax,""mergedmat			Setscale/I y,kymin,kymax,""mergedmat			Setscale/P z,dimoffset($thiskchunk,2),dimdelta($thiskchunk,2),""mergedmat			Print "Creating mergedmat"			i=0			Do				thiskchunk="kchunkcutVD"+num2str(i)				merged1kchunk($thiskchunk, mergedmat,i)				killwaves $thiskchunk				i+=1			While(i<dimsize(chunkcutlist,0))			Print "Begin final merging"			mergekchunks(mergedmat,mat3dkVD)						Killwaves mergedmat							Endif	End//*******************************************************************************************************************************Proc make_mat3dkHD(addtheta,addphi,Fermi_level)	Variable addtheta	Variable addphi	Variable Fermi_level	Prompt addtheta,"Quantity to add to the physical theta"	Prompt addphi,"Quantity to add to the physical phi"	Prompt Fermi_level,"Fermi level"		PauseUpdate;Silent 1	Variable/G SRC_vs_BNL	String thischunk,thiskchunk	Variable slit	Variable i	Variable kxsize,kysize,kxmin,kymin,kxmax,kymax	Variable kxdelta,kydelta	Variable sizeE	Variable angle 	Slit=SRC_vs_BNL	Make/O/N=0 vec4kxmin	Make/O/N=0 vec4kymin	Make/O/N=0 vec4kxmax	Make/O/N=0 vec4kymax	Make/O/N=0 vec4kxdelta	Make/O/N=0 vec4kydelta		i=0	Do		Print "Chunk number", i		thischunk="chunkcutHD"+num2str(i)		thiskchunk="k"+thischunk		angle=chunkfixedangle[i]		Make/O/N=6 kproperties		size4cvtchunkcut($thischunk,angle,addphi,addtheta,slit,kproperties)		kxsize=kproperties[0]		kysize=kproperties[1]		kxmin=kproperties[2]		kymin=kproperties[3]		kxmax=kproperties[4]		kymax=kproperties[5]				sizeE=dimsize($thischunk,2)		Make/O/N=(kxsize,kysize,sizeE) $thiskchunk		Setscale/I x,kxmin,kxmax,""$thiskchunk		Setscale/I y,kymin,kymax,""$thiskchunk		Setscale/P z,dimoffset($thischunk,2)-Fermi_level,dimdelta($thischunk,2),""$thiskchunk		Print "Begin conversion"		convert1chunkcut($thischunk,$thiskchunk,chunkfixedangle[i],addphi,addtheta,slit)		insertpoints 0,1,vec4kxmin		insertpoints 0,1,vec4kxmax		insertpoints 0,1,vec4kymin		insertpoints 0,1,vec4kymax		insertpoints 0,1,vec4kxdelta		insertpoints 0,1,vec4kydelta		vec4kxmin[0]=kxmin		vec4kxmax[0]=kxmax		vec4kymin[0]=kymin		vec4kymax[0]=kymax		vec4kxdelta[0]=dimdelta($thiskchunk,0)		vec4kydelta[0]=dimdelta($thiskchunk,1)			i+=1	While(i<dimsize(chunkcutlist,0))	killwaves kproperties	IF(dimsize(chunkcutlist,0)==1)		Duplicate/O $thiskchunk mat3dkHD		Else			kxmin=WaveMin(vec4kxmin)			kxmax=WaveMax(vec4kxmax)			kymin=WaveMin(vec4kymin)			kymax=WaveMax(vec4kymax)			kxdelta=WaveMin(vec4kxdelta)				kydelta=WaveMin(vec4kydelta)			kxsize=Floor((kxmax-kxmin)/kxdelta)			kxsize=Floor((kymax-kymin)/kydelta)			Make/O/N=(kxsize,kysize,sizeE) mat3dkHD			Setscale/I x,kxmin,kxmax,""mat3dkHD			Setscale/I y,kymin,kymax,""mat3dkHD			Setscale/P z,dimoffset($thiskchunk,2),dimdelta($thiskchunk,2),""mat3dkHD			Make/O/N=(kxsize,kysize,sizeE,dimsize(chunkcutlist,0)) mergedmat			Setscale/I x,kxmin,kxmax,""mergedmat			Setscale/I y,kymin,kymax,""mergedmat			Setscale/P z,dimoffset($thiskchunk,2),dimdelta($thiskchunk,2),""mergedmat			Print "Creating mergedmat"			i=0			Do				thiskchunk="kchunkcutHD"+num2str(i)				merged1kchunk($thiskchunk, mergedmat,i)				killwaves $thiskchunk				i+=1			While(i<dimsize(chunkcutlist,0))			Print "Begin final merging"			mergekchunks(mergedmat,mat3dkHD)						Killwaves mergedmat							Endif	End//*******************************************************************************************************************************Function merged1kchunk(kchunk,merged,number)	Wave kchunk	Wave merged	Variable number	PauseUpdate;Silent 1	Variable iEnergy	iEnergy=0	Do		Make/O/N=(dimsize(kchunk,0),dimsize(kchunk,1)) thismat		Setscale/P x,dimoffset(kchunk,0),dimdelta(kchunk,0),""thismat		Setscale/P y,dimoffset(kchunk,1),dimdelta(kchunk,1),""thismat				thismat[][]=kchunk[p][q][iEnergy]		merged[][][iEnergy][number]=interp2D(thismat,dimoffset(merged,0)+p*dimdelta(merged,0),dimoffset(merged,1)+q*dimdelta(merged,1))		iEnergy+=1	While(iEnergy<dimsize(kchunk,2))//	merged[][][][number]=interp3D(kchunk,dimoffset(merged,0)+p*dimdelta(merged,0),dimoffset(merged,1)+q*dimdelta(merged,1),dimoffset(merged,2)+r*dimdelta(merged,2))	End//*******************************************************************************************************************************Function mergekchunks(merged,matout)	Wave merged	Wave matout	PauseUpdate;Silent 1	Variable iEnergy,i,j	iEnergy=0	Do		If(mod(iEnergy,10)==0)			print iEnergy,"/",dimsize(matout,2)-1		Endif		i=0		Do			j=0			Do				Make/O/N=(dimsize(merged,3)) thiswave				thiswave[]=merged[i][j][iEnergy][p]				Wavestats/Q thiswave				matout[i][j][iEnergy]=V_avg				j+=1			While(j<dimsize(matout,1))			i+=1		While(i<dimsize(matout,0))		iEnergy+=1	While(iEnergy<dimsize(matout,2))		killwaves thiswaveEnd//*******************************************************************************************************************************Function convert1chunkcut(achunk,kchunk,angle,addphi,addtheta,slit)   //Findroots method	Wave achunk	Wave kchunk	Variable angle	Variable addphi	Variable addtheta	Variable Slit	PauseUpdate;Silent 1	Variable iEnergy,i,j	Variable speed	speed=1         //Speed=1 is the fast way but the last layer is NaN	IF(Slit==1)		Make/O/N=2 paraVx		Make/O/N=3 paraVy		Make/O/N=2 W_Root		iEnergy=0		Do			if(mod(iEnergy,10)==0)				Print "Energy",iEnergy,"/",dimsize(kchunk,2)-1			Endif			paraVx[0]=sqrt(dimoffset(achunk,2)+iEnergy*dimdelta(achunk,2))			paraVy[0]=paraVx[0]			paraVy[1]=angle+addphi			i=0			Do				paraVx[1]=dimoffset(kchunk,0)+i*dimdelta(kchunk,0)				j=0				Do					paraVy[2]=dimoffset(kchunk,1)+j*dimdelta(kchunk,1)										FindRoots/Q kxtransV,paraVx, kytransV,paraVy					IF((speed==0)||(iEnergy==dimsize(kchunk,2)-1)||(i==dimsize(kchunk,0)-1)||(i==dimsize(kchunk,0)-2)||(j==dimsize(kchunk,0)-1)||(j==dimsize(kchunk,1)-2))						Make/O/N=(dimsize(achunk,0),dimsize(achunk,1)) thismat						Setscale/P x,dimoffset(achunk,0),dimdelta(achunk,0),""thismat						Setscale/P y,dimoffset(achunk,1),dimdelta(achunk,1),""thismat						thismat[][]=achunk[p][q][iEnergy]											kchunk[i][j][iEnergy]=Interp2d(thismat,W_Root[0]*180/pi-addtheta,W_Root[1]*180/pi)//,dimoffset(achunk,2)+iEnergy*dimdelta(achunk,2))					Endif					If((Speed==1)&&(iEnergy!=dimsize(kchunk,2)-1)&&(i!=dimsize(kchunk,0)-1)&&(i!=dimsize(kchunk,0)-2)&&(j!=dimsize(kchunk,0)-1)&&(j!=dimsize(kchunk,1)-2))						kchunk[i][j][iEnergy]=Interp3d(achunk,W_Root[0]*180/pi-addtheta,W_Root[1]*180/pi,dimoffset(achunk,2)+iEnergy*dimdelta(achunk,2))											Endif					j+=1				While(j<dimsize(kchunk,1))				i+=1			While(i<dimsize(kchunk,0))			iEnergy+=1		While(iEnergy<dimsize(kchunk,2))		Killwaves paraVx,paraVy,W_Root	Endif	IF(Slit==0)		Make/O/N=3 paraHx		Make/O/N=3 paraHy		Make/O/N=2 W_Root		iEnergy=0		Do			if(mod(iEnergy,10)==0)				Print "Energy",iEnergy,"/",dimsize(kchunk,2)-1			Endif			paraHx[0]=sqrt(dimoffset(achunk,2)+iEnergy*dimdelta(achunk,2))			paraHy[0]=paraHx[0]			paraHy[1]=angle+addtheta			paraHx[1]=paraHy[1]			i=0			Do				paraHx[2]=dimoffset(kchunk,0)+i*dimdelta(kchunk,0)				j=0				Do					paraHy[2]=dimoffset(kchunk,1)+j*dimdelta(kchunk,1)										FindRoots/Q kxtransH,paraHx, kytransH,paraHy					If((speed==0)||(iEnergy==dimsize(kchunk,2)-1)||(i==dimsize(kchunk,0)-1)||(i==dimsize(kchunk,0)-2)||(j==dimsize(kchunk,0)-1)||(j==dimsize(kchunk,1)-2))						Make/O/N=(dimsize(achunk,0),dimsize(achunk,1)) thismat						Setscale/P x,dimoffset(achunk,0),dimdelta(achunk,0),""thismat						Setscale/P y,dimoffset(achunk,1),dimdelta(achunk,1),""thismat						thismat[][]=achunk[p][q][iEnergy]											kchunk[i][j][iEnergy]=Interp2d(thismat,W_Root[1]*180/pi-addphi,W_Root[0]*180/pi)//,dimoffset(achunk,2)+iEnergy*dimdelta(achunk,2))					Endif					If((speed==1)&&(iEnergy!=dimsize(kchunk,2)-1)&&(i!=dimsize(kchunk,0)-1)&&(i!=dimsize(kchunk,0)-2)&&(j!=dimsize(kchunk,0)-1)&&(j!=dimsize(kchunk,1)-2))						kchunk[i][j][iEnergy]=Interp3d(achunk,W_Root[1]*180/pi-addphi,W_Root[0]*180/pi,dimoffset(achunk,2)+iEnergy*dimdelta(achunk,2))											Endif					j+=1				While(j<dimsize(kchunk,1))				i+=1			While(i<dimsize(kchunk,0))			iEnergy+=1		While(iEnergy<dimsize(kchunk,2))		Killwaves paraHx,paraHy,W_Root	Endif		End//*******************************************************************************************************************************Function kxtransV(paraVx,xx,yy)	Wave paraVx	Variable xx	Variable yy	PauseUpdate;Silent 1	Return 0.51231*paraVx[0]*sin(xx)*cos(yy)-paraVx[1]End//*******************************************************************************************************************************Function kytransV(paraVy,xx,yy)	Wave paraVy	Variable xx	Variable yy	PauseUpdate;Silent 1	Return 0.51231*paraVy[0]*(cos(paraVy[1]*pi/180)*sin(yy)+sin(paraVy[1]*pi/180)*cos(xx)*cos(yy))-paraVy[2]End//*******************************************************************************************************************************Function kxtransH(paraHx,xx,yy)	Wave paraHx	Variable xx	Variable yy	PauseUpdate;Silent 1	Return 0.51231*paraHx[0]*(cos(paraHx[1]*pi/180)*sin(xx)+sin(paraHx[1]*pi/180)*cos(xx))-paraHx[2]End//*******************************************************************************************************************************Function kytransH(paraHy,xx,yy)	Wave paraHy	Variable xx	Variable yy	PauseUpdate;Silent 1	Return 0.51231*paraHy[0]*(sin(paraHy[1]*pi/180)*sin(xx)*sin(yy)+cos(paraHy[1]*pi/180)*cos(xx)*sin(yy))-paraHy[2]End//*******************************************************************************************************************************Function size4cvtchunkcut(thischunk,angle,addphi,addtheta,slit,kproperties)	Wave thischunk	Variable angle	Variable addphi	Variable addtheta	Variable Slit	Wave kproperties	PauseUpdate;silent 1	Variable kxsize	Variable kysize	Variable kxmin	Variable kxmax	Variable kymin	Variable kymax	Variable dkx,dky	Variable i	Variable thisphi	Variable thistheta	Variable sqrtKE	Make/O/N=0 vectorx	Make/O/N=0 vectory	//Finding kmax and kmin	If(slit==1)		thisphi=angle+addphi		i=0		Do			thistheta=dimoffset(thischunk,0)+i*dimdelta(thischunk,0)+addtheta			sqrtKE=sqrt(dimoffset(thischunk,2))			Insertpoints 0,dimsize(thischunk,1),vectorx			Insertpoints 0,dimsize(thischunk,1),vectory			vectorx[0,dimsize(thischunk,1)-1]=0.51231*sqrtKE*sin(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)			Vectory[0,dimsize(thischunk,1)-1]=0.51231*sqrtKE*cos(thisphi*pi/180)*sin((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)			Vectory[0,dimsize(thischunk,1)-1]+=0.51231*sqrtKE*sin(thisphi*pi/180)*cos(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)					sqrtKE=sqrt(dimoffset(thischunk,2)+(dimsize(thischunk,2)-1)*dimdelta(thischunk,2))			Insertpoints 0,dimsize(thischunk,1),vectorx			Insertpoints 0,dimsize(thischunk,1),vectory			vectorx[0,dimsize(thischunk,1)-1]=0.51231*sqrtKE*sin(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)			Vectory[0,dimsize(thischunk,1)-1]=0.51231*sqrtKE*cos(thisphi*pi/180)*sin((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)			Vectory[0,dimsize(thischunk,1)-1]+=0.51231*sqrtKE*sin(thisphi*pi/180)*cos(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)					i+=1			While(i<dimsize(thischunk,0))		Else			thistheta=angle+addtheta			i=0			Do				thisphi=dimoffset(thischunk,0)+i*dimdelta(thischunk,0)+addphi				sqrtKE=sqrt(dimoffset(thischunk,2))				Insertpoints 0,dimsize(thischunk,1),vectorx				Insertpoints 0,dimsize(thischunk,1),vectory				vectorx[0,dimsize(thischunk,1)-1]=0.51231*sqrtKE*sin(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)				vectorx[0,dimsize(thischunk,1)-1]+=0.51231*sqrtKE*cos(thistheta*pi/180)*sin((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)				Vectory[0,dimsize(thischunk,1)-1]=-0.51231*sqrtKE*sin(thisphi*pi/180)*sin(thistheta*pi/180)*sin((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)				Vectory[0,dimsize(thischunk,1)-1]+=0.51231*sqrtKE*sin(thisphi*pi/180)*cos(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)										sqrtKE=sqrt(dimoffset(thischunk,2)+(dimsize(thischunk,2)-1)*dimdelta(thischunk,2))				Insertpoints 0,dimsize(thischunk,1),vectorx				Insertpoints 0,dimsize(thischunk,1),vectory				vectorx[0,dimsize(thischunk,1)-1]=0.51231*sqrtKE*sin(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)				vectorx[0,dimsize(thischunk,1)-1]+=0.51231*sqrtKE*cos(thistheta*pi/180)*sin((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)				Vectory[0,dimsize(thischunk,1)-1]=-0.51231*sqrtKE*sin(thisphi*pi/180)*sin(thistheta*pi/180)*sin((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)				Vectory[0,dimsize(thischunk,1)-1]+=0.51231*sqrtKE*sin(thisphi*pi/180)*cos(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)						i+=1				While(i<dimsize(thischunk,0))				Endif	Wavestats/Q vectorx	kxmin=V_min	Kxmax=V_max	Wavestats/Q vectory	kymin=V_min	Kymax=V_max	If(Slit==1)		dkx=0.51231*sqrt(dimoffset(thischunk,2))*dimdelta(thischunk,0)*pi/(1.4*180)      //related with theta		dky=0.51231*sqrt(dimoffset(thischunk,2))*dimdelta(thischunk,1)*pi/(1*180)	//related with eta		kxsize=Ceil((kxmax-kxmin)/dkx)		kysize=Ceil((kymax-kymin)/dky)		Else			dkx=0.51231*sqrt(dimoffset(thischunk,2))*dimdelta(thischunk,1)*pi/(1*180)  //related with eta			dky=0.51231*sqrt(dimoffset(thischunk,2))*dimdelta(thischunk,0)*pi/(1.4*180)  //related with phi			kxsize=Ceil((kxmax-kxmin)/dkx)			kysize=Ceil((kymax-kymin)/dky)			Endif	kproperties[0]=kxsize	kproperties[1]=kysize	kproperties[2]=kxmin	kproperties[3]=kymin	kproperties[4]=kxmax	kproperties[5]=kymax		Print "kx",kxmin,kxmax,dkx	Print "ky",kymin,kymax,dky	print "size calculated",kxsize,kysize	killwaves Vectorx,VectoryEnd//*******************************************************************************************************************************Proc deriv_1chunkcut(number,pass,boxwidth,factor, method)	Variable number=0	Variable pass=7	Variable boxwidth=7	Variable factor=0.1	Variable method	Prompt number,"Enter the number of the chunkcut"	Prompt pass,"Number of smooth pass"	Prompt boxwidth,"Smooth box width"	Prompt factor,"Curvature factor (for curvature only)"	Prompt method,"Derivative(curvature) direction",popup "Vertical derivative;Horizontal derivative;Vertical curvature;Horizontal curvature"	PauseUpdate;Silent 1	String newname,oldname	Variable i	IF(method==1)		oldname="chunkcut"+num2str(number)		newname="chunkcutVD"+num2str(number)		Duplicate/O $oldname $newname		$newname[][][]=NaN		derivthischunkcut($oldname,$newname,pass,boxwidth,factor,1)	Endif	IF(method==2)		oldname="chunkcut"+num2str(number)		newname="chunkcutHD"+num2str(number)		Duplicate/O $oldname $newname		$newname[][][]=NaN		derivthischunkcut($oldname,$newname,pass,boxwidth,factor,2)	Endif	IF(method==3)		oldname="chunkcut"+num2str(number)		newname="chunkcutVD"+num2str(number)		Duplicate/O $oldname $newname		$newname[][][]=NaN		derivthischunkcut($oldname,$newname,pass,boxwidth,factor,1)	Endif	IF(method==4)		oldname="chunkcut"+num2str(number)		newname="chunkcutHD"+num2str(number)		Duplicate/O $oldname $newname		$newname[][][]=NaN		derivthischunkcut($oldname,$newname,pass,boxwidth,factor,2)	Endif					End//*******************************************************************************************************************************Proc deriv_allchunkcut(pass,boxwidth,factor,method)	Variable pass=7	Variable boxwidth=7	Variable factor=0.1	Variable method	Prompt pass,"Number of smooth pass"	Prompt boxwidth,"Smooth box width"	Prompt factor, "Curvature factor (curvature only)"	Prompt method,"Derivative(curvature) direction",popup "Vertical derivative;Horizontal derivative;Vertical curvature;Horizontal curvature"	PauseUpdate;Silent 1	Variable i	i=0	Do		deriv_1chunkcut(i,pass,boxwidth,factor,method)		i+=1	While(i<dimsize(chunkcutlist,0))End//*******************************************************************************************************************************Function derivthischunkcut(oldname,newname,pass,boxwidth,factor, choice)	Wave oldname	Wave newname	Variable pass	Variable boxwidth	Variable factor //for curvature only	Variable choice	PauseUpdate;Silent 1	Variable i, j	If(choice==1)		i=0		Do			j=0			Do				Make/O/N=(dimsize(oldname,2)) thiswave				thiswave[]=oldname[i][j][p]				Smooth/E=3/B=(pass) boxwidth, thiswave				differentiate thiswave				differentiate thiswave				newname[i][j][]=thiswave[r]				j+=1			While(j<dimsize(oldname,1))			i+=1		While(i<dimsize(oldname,0))	Endif	If(choice==2)//derivation along eta		i=0		Do			j=0			Do				Make/O/N=(dimsize(oldname,1)) thiswave				thiswave[]=oldname[i][p][j]				Smooth/E=3/B=(pass) boxwidth, thiswave				differentiate thiswave				differentiate thiswave				newname[i][][j]=thiswave[q]				j+=1			While(j<dimsize(oldname,2))			i+=1		While(i<dimsize(oldname,0))	Endif	If(choice==3)		i=0		Do			Make/O/N=(dimsize(oldname,1),dimsize(oldname,2)) sectionmat			Setscale/P x,dimoffset(oldname,1),dimdelta(oldname,1),""sectionmat			Setscale/P y,dimoffset(oldname,2),dimdelta(oldname,2),""sectionmat			sectionmat[][]=oldname[i][p][q]			duplicate/O sectionmat returnmat			curvature4mat3d(sectionmat,returnmat,pass,boxwidth,1,factor)			newname[i][][]=returnmat[q][r]					i+=1		While(i<dimsize(oldname,0))		killwaves sectionmat,returnmat		Endif	If(choice==4)//derivation along eta		i=0		Do			Make/O/N=(dimsize(oldname,1),dimsize(oldname,2)) sectionmat			Setscale/P x,dimoffset(oldname,1),dimdelta(oldname,1),""sectionmat			Setscale/P y,dimoffset(oldname,2),dimdelta(oldname,2),""sectionmat			sectionmat[][]=oldname[i][p][q]			duplicate/O sectionmat returnmat			curvature4mat3d(sectionmat,returnmat,pass,boxwidth,2,factor)			newname[i][][]=returnmat[q][r]					i+=1		While(i<dimsize(oldname,0))		killwaves sectionmat,returnmat		EndifEnd//********************************************************************************************************************************Proc update_image_fs_exact()	pauseupdate	silent 1	String/G colordefault	Variable/G colordefaultinv		Variable/G theta1_zero,phi1_zero,KEatEF,quality_factor	Variable/G central_ifs4, irange_ifs4			String newname,old_image_list,old_image	Variable i	old_image_list=ImageNameList("image_fs_ploter",";")	old_image=StringFromList(0,old_image_list)	If(WaveExists($old_image)==1)		Removeimage $old_image	Endif//	Print "Begin conversion"	make_mat2dk(theta1_zero,phi1_zero,central_ifs4,irange_ifs4)	Duplicate/O matrix2dk image_fs_plot	killwaves matrix2dk//	Print "Begin rotation"//	mat2dk_pi("image_fs_plot",theta1_zero,phi1_zero,KEatEF)//	Duplicate/O image_fs_plot_k image_fs_plot//	Killwaves image_fs_plot_k	rot2dimage_pi("image_fs_plot",rot1_zero,0,0,quality_factor)	Setscale/P x,dimoffset(image_fs_plot,0)/lattice1_0,dimdelta(image_fs_plot,0)/lattice1_0,""image_fs_plot	Setscale/P y,dimoffset(image_fs_plot,1)/lattice1_0,dimdelta(image_fs_plot,1)/lattice1_0,""image_fs_plot				Appendimage image_fs_plot	ModifyImage image_fs_plot ctab= {0.0070496,0.52635,Terrain,0}	//ModifyImage image_fs_plot ctab= {*,*,$colordefault,colordefaultinv}	End//*******************************************************************************************************************************Function PopMenuProc_auto_ifs4(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	pauseupdate	silent 1	Variable/G auto_update_ifs4	auto_update_ifs4=popNum	End//*******************************************************************************************************************************Proc make_mat2dk(addtheta,addphi,Fermilevel,irange)	Variable addtheta	Variable addphi	Variable Fermilevel	Variable irange	Prompt addtheta,"Quantity to add to the physical theta"	Prompt addphi,"Quantity to add to the physical phi"	Prompt Fermilevel,"Fermi level"		Prompt irange, "Integral window:"	PauseUpdate;Silent 1	Variable/G SRC_vs_BNL	String thischunk,thiskchunk	Variable slit	Variable i	Variable kxsize,kysize,kxmin,kymin,kxmax,kymax	Variable kxdelta,kydelta	Variable sizeE	Variable angle 	Slit=SRC_vs_BNL	Make/O/N=0 vec4kxmin	Make/O/N=0 vec4kymin	Make/O/N=0 vec4kxmax	Make/O/N=0 vec4kymax	Make/O/N=0 vec4kxdelta	Make/O/N=0 vec4kydelta		i=0	Do//		Print "Chunk number", i		thischunk="chunkcut"+num2str(i)		thiskchunk="k2d"+thischunk		angle=chunkfixedangle[i]		Make/O/N=6 kproperties		size4cvtchunkcut2d($thischunk,angle,addphi,addtheta,slit,kproperties,Fermilevel)		kxsize=kproperties[0]		kysize=kproperties[1]		kxmin=kproperties[2]		kymin=kproperties[3]		kxmax=kproperties[4]		kymax=kproperties[5]		Make/O/N=(kxsize,kysize) $thiskchunk		Setscale/I x,kxmin,kxmax,""$thiskchunk		Setscale/I y,kymin,kymax,""$thiskchunk		$thiskchunk[][]=NaN//		Print "Begin conversion"		convert1chunkcut2d($thischunk,$thiskchunk,chunkfixedangle[i],addphi,addtheta,slit,Fermilevel,irange)		insertpoints 0,1,vec4kxmin		insertpoints 0,1,vec4kxmax		insertpoints 0,1,vec4kymin		insertpoints 0,1,vec4kymax		insertpoints 0,1,vec4kxdelta		insertpoints 0,1,vec4kydelta		vec4kxmin[0]=kxmin		vec4kxmax[0]=kxmax		vec4kymin[0]=kymin		vec4kymax[0]=kymax		vec4kxdelta[0]=dimdelta($thiskchunk,0)		vec4kydelta[0]=dimdelta($thiskchunk,1)			i+=1	While(i<dimsize(chunkcutlist,0))	killwaves kproperties	IF(dimsize(chunkcutlist,0)==1)		Duplicate/O $thiskchunk matrix2dk		Else			kxmin=WaveMin(vec4kxmin)			kxmax=WaveMax(vec4kxmax)			kymin=WaveMin(vec4kymin)			kymax=WaveMax(vec4kymax)			kxdelta=WaveMin(vec4kxdelta)				kydelta=WaveMin(vec4kydelta)			kxsize=Floor((kxmax-kxmin)/kxdelta)			kxsize=Floor((kymax-kymin)/kydelta)			Make/O/N=(kxsize,kysize) matrix2dk			Setscale/I x,kxmin,kxmax,""matrix2dk			Setscale/I y,kymin,kymax,""matrix2dk			Make/O/N=(kxsize,kysize,dimsize(chunkcutlist,0)) mergedmat			Setscale/I x,kxmin,kxmax,""mergedmat			Setscale/I y,kymin,kymax,""mergedmat//			Print "Creating mergedmat"			i=0			Do				thiskchunk="k2dchunkcut"+num2str(i)				merged1kchunk2d($thiskchunk, mergedmat,i)				killwaves $thiskchunk				i+=1			While(i<dimsize(chunkcutlist,0))//			Print "Begin final merging"			mergekchunks2d(mergedmat,matrix2dk)						Killwaves mergedmat							Endif	End//*******************************************************************************************************************************Function size4cvtchunkcut2d(thischunk,angle,addphi,addtheta,slit,kproperties,Fermilevel)	Wave thischunk	Variable angle	Variable addphi	Variable addtheta	Variable Slit	Wave kproperties	Variable Fermilevel	PauseUpdate;silent 1	Variable kxsize	Variable kysize	Variable kxmin	Variable kxmax	Variable kymin	Variable kymax	Variable dkx,dky	Variable i	Variable thisphi	Variable thistheta	Variable sqrtKE	Make/O/N=0 vectorx	Make/O/N=0 vectory	//Finding kmax and kmin	If(slit==1)		thisphi=angle+addphi		i=0		Do			thistheta=dimoffset(thischunk,0)+i*dimdelta(thischunk,0)+addtheta			sqrtKE=sqrt(Fermilevel)			Insertpoints 0,dimsize(thischunk,1),vectorx			Insertpoints 0,dimsize(thischunk,1),vectory			vectorx[0,dimsize(thischunk,1)-1]=0.51231*sqrtKE*sin(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)			Vectory[0,dimsize(thischunk,1)-1]=0.51231*sqrtKE*cos(thisphi*pi/180)*sin((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)			Vectory[0,dimsize(thischunk,1)-1]+=0.51231*sqrtKE*sin(thisphi*pi/180)*cos(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)					i+=1			While(i<dimsize(thischunk,0))		Else			thistheta=angle+addtheta			i=0			Do				thisphi=dimoffset(thischunk,0)+i*dimdelta(thischunk,0)+addphi				sqrtKE=sqrt(Fermilevel)				Insertpoints 0,dimsize(thischunk,1),vectorx				Insertpoints 0,dimsize(thischunk,1),vectory				vectorx[0,dimsize(thischunk,1)-1]=0.51231*sqrtKE*sin(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)				vectorx[0,dimsize(thischunk,1)-1]+=0.51231*sqrtKE*cos(thistheta*pi/180)*sin((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)				Vectory[0,dimsize(thischunk,1)-1]=-0.51231*sqrtKE*sin(thisphi*pi/180)*sin(thistheta*pi/180)*sin((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)				Vectory[0,dimsize(thischunk,1)-1]+=0.51231*sqrtKE*sin(thisphi*pi/180)*cos(thistheta*pi/180)*cos((dimoffset(thischunk,1)+p*dimdelta(thischunk,1))*pi/180)										i+=1				While(i<dimsize(thischunk,0))				Endif	Wavestats/Q vectorx	kxmin=V_min	Kxmax=V_max	Wavestats/Q vectory	kymin=V_min	Kymax=V_max	If(Slit==1)		dkx=0.51231*sqrt(dimoffset(thischunk,2))*dimdelta(thischunk,0)*pi/(1.4*180)      //related with theta		dky=0.51231*sqrt(dimoffset(thischunk,2))*dimdelta(thischunk,1)*pi/(1*180)	//related with eta		kxsize=Ceil((kxmax-kxmin)/dkx)		kysize=Ceil((kymax-kymin)/dky)		Else			dkx=0.51231*sqrt(dimoffset(thischunk,2))*dimdelta(thischunk,1)*pi/(1*180)  //related with eta			dky=0.51231*sqrt(dimoffset(thischunk,2))*dimdelta(thischunk,0)*pi/(1.4*180)  //related with phi			kxsize=Ceil((kxmax-kxmin)/dkx)			kysize=Ceil((kymax-kymin)/dky)			Endif	kproperties[0]=kxsize	kproperties[1]=kysize	kproperties[2]=kxmin	kproperties[3]=kymin	kproperties[4]=kxmax	kproperties[5]=kymax	//	Print "kx",kxmin,kxmax,dkx//	Print "ky",kymin,kymax,dky//	print "size calculated",kxsize,kysize	killwaves Vectorx,VectoryEnd//*******************************************************************************************************************************Function convert1chunkcut2d(achunk,kchunk,angle,addphi,addtheta,slit,Fermilevel,irange)   //Findroots method	Wave achunk	Wave kchunk	Variable angle	Variable addphi	Variable addtheta	Variable Slit	Variable Fermilevel	Variable irange	PauseUpdate;Silent 1	Variable iEnergy,i,j	Variable iEstart,iEend	Variable speed	//First we create a unique layer	iEstart=Round((Fermilevel-irange/2-dimoffset(achunk,2))/dimdelta(achunk,2))	iEend=Round((Fermilevel+irange/2-dimoffset(achunk,2))/dimdelta(achunk,2))	Make/O/N=(dimsize(achunk,0),dimsize(achunk,1)) achunk2d	Setscale/P x,dimoffset(achunk,0),dimdelta(achunk,0),""achunk2d	Setscale/P y,dimoffset(achunk,1),dimdelta(achunk,1),""achunk2d		achunk2d[][]=0		iEnergy=iEstart	Do		achunk2d[][]+=achunk[p][q][iEnergy]		iEnergy+=1	While(iEnergy<=iEend+1)	achunk2d[][]/=(iEend-iEstart+1)	IF(Slit==1)		Make/O/N=2 paraVx		Make/O/N=3 paraVy		Make/O/N=2 W_Root		paraVx[0]=sqrt(Fermilevel)		paraVy[0]=paraVx[0]		paraVy[1]=angle+addphi		i=0		Do			paraVx[1]=dimoffset(kchunk,0)+i*dimdelta(kchunk,0)			j=0			Do				paraVy[2]=dimoffset(kchunk,1)+j*dimdelta(kchunk,1)									FindRoots/Q kxtransV,paraVx, kytransV,paraVy				W_Root[]*=180/pi				W_Root[0]-=addtheta				If((W_Root[0]>=dimoffset(achunk2d,0))&&(W_Root[1]>=dimoffset(achunk2d,1))&&(W_Root[0]<=dimoffset(achunk2d,0)+(dimsize(achunk2d,0)-1)*dimdelta(achunk2d,0))&&(W_Root[1]<=dimoffset(achunk2d,1)+(dimsize(achunk2d,1)-1)*dimdelta(achunk2d,1)))//					kchunk[i][j]=Interp2d(achunk2d,W_Root[0]*180/pi-addtheta,W_Root[1]*180/pi)					kchunk[i][j]=Interp2d(achunk2d,W_Root[0],W_Root[1])				Endif				j+=1			While(j<dimsize(kchunk,1))			i+=1		While(i<dimsize(kchunk,0))		Killwaves paraVx,paraVy,W_Root,achunk2d	Endif	IF(Slit==0)		Make/O/N=3 paraHx		Make/O/N=3 paraHy		Make/O/N=2 W_Root		paraHx[0]=sqrt(Fermilevel)		paraHy[0]=paraHx[0]		paraHy[1]=angle+addtheta		paraHx[1]=paraHy[1]		i=0		Do			paraHx[2]=dimoffset(kchunk,0)+i*dimdelta(kchunk,0)			j=0			Do				paraHy[2]=dimoffset(kchunk,1)+j*dimdelta(kchunk,1)									FindRoots/Q kxtransH,paraHx, kytransH,paraHy				W_Root[]*=180/pi				W_Root[1]-=addphi				If((W_Root[1]>=dimoffset(achunk2d,0))&&(W_Root[0]>=dimoffset(achunk2d,1))&&(W_Root[1]<=dimoffset(achunk2d,0)+(dimsize(achunk2d,0)-1)*dimdelta(achunk2d,0))&&(W_Root[0]<=dimoffset(achunk2d,1)+(dimsize(achunk2d,1)-1)*dimdelta(achunk2d,1)))					kchunk[i][j]=Interp2d(achunk2d,W_Root[1],W_Root[0])				Endif				j+=1			While(j<dimsize(kchunk,1))			i+=1		While(i<dimsize(kchunk,0))		Killwaves paraHx,paraHy,W_Root,achunk2d	Endif		End//*******************************************************************************************************************************Function merged1kchunk2d(kchunk,merged,number)	Wave kchunk	Wave merged	Variable number	PauseUpdate;Silent 1	merged[][][number]=interp2D(kchunk,dimoffset(merged,0)+p*dimdelta(merged,0),dimoffset(merged,1)+q*dimdelta(merged,1))End//*******************************************************************************************************************************Function mergekchunks2d(merged,matout)	Wave merged	Wave matout	PauseUpdate;Silent 1	Variable i,j	i=0	Do		j=0		Do			Make/O/N=(dimsize(merged,2)) thiswave			thiswave[]=merged[i][j][p]			Wavestats/Q thiswave			matout[i][j]=V_avg			j+=1		While(j<dimsize(matout,1))		i+=1	While(i<dimsize(matout,0))	killwaves thiswaveEnd//*******************************************************************************************************************************Proc anglemode_converter_fs(sequence)	//Enter 1;3;5;6-10;15; etc... or * for all	String sequence	Prompt sequence,"Enter the index sequence"	PauseUpdate;Silent 1	Variable/G SRC_vs_BNL	String thisstr,nextstr	String cutname,thisdata	Variable num	Variable i,j	Variable from,to	Variable newadd	Variable cutslice	Variable condition	Variable thisimagephi	num=itemsinlist(sequence,";")	//First we check Which points are to be converted	IF(num>1)		Make/O/N=0 vector_list				i=0		Do			thisstr=Stringfromlist(i,sequence,";")			IF(CmpStr(thisstr,"-")!=0)				Insertpoints 0,1,vector_list				vector_list[0]=Str2num(thisstr)			Endif			IF(CmpStr(thisstr,"-")==0)				from=vector_list[0]				to=Str2num(Stringfromlist(i+1,sequence,";"))				Insertpoints 0,to-from,vector_list				vector_list[0,to-from-1]=from+p+1				i+=1			Endif						i+=1		While(i<num)				Sort vector_list,vector_list		num=dimsize(vector_list,0)	Endif	IF((num==1)&&(CmpStr(Stringfromlist(0,sequence,";"),"*")==0))		num=dimsize(original_theta,0)		Make/O/N=(num) vector_list		vector_list[]=p			Endif	IF((num==1)&&(CmpStr(Stringfromlist(0,sequence,";"),"*")!=0))		Make/O/N=1 vector_list		vector_list[0]=Str2num(Stringfromlist(0,sequence,";"))	Endif		i=0	Do		IF(vector_list[i]>=dimsize(original_rtheta,0))			newadd=vector_list[i]-dimsize(original_rtheta,0)+1			Insertpoints dimsize(original_rtheta,0),newadd,original_rtheta		Endif		IF(vector_list[i]>=dimsize(original_rphi,0))			newadd=vector_list[i]-dimsize(original_rphi,0)+1			Insertpoints dimsize(original_rphi,0),newadd,original_rphi		Endif		IF(vector_list[i]>=dimsize(original_eta,0))			newadd=vector_list[i]-dimsize(original_eta,0)+1			Insertpoints dimsize(original_eta,0),newadd,original_eta		Endif		IF(vector_list[i]>=dimsize(original_data,0))			newadd=vector_list[i]-dimsize(original_data,0)+1			Insertpoints dimsize(original_data,0),newadd,original_data		Endif		IF(vector_list[i]>=dimsize(original_slice,0))			newadd=vector_list[i]-dimsize(original_slice,0)+1			Insertpoints dimsize(original_slice,0),newadd,original_slice		Endif		Make/O/N=0 vecforindex		Make/O/N=0 vecforimagetheta		IF(SRC_vs_BNL==1)			original_rtheta[i]=original_theta[i]			cutname="cut"+num2str(original_theta[i])			thisimagephi=original_theta[i]			cutslice=Round((original_phi[i]-dimoffset($cutname,0))/dimdelta($cutname,0))			j=0			Do				IF(imagephi[j]==thisimagephi)					Insertpoints 0,1,vecforindex					Insertpoints 0,1,vecforimagetheta					vecforindex[0]=j					vecforimagetheta[0]=imagetheta[j]				Endif				j+=1			While(j<dimsize(imageindex,0))			Sort vecforimagetheta,vecforimagetheta,vecforindex			condition=1			j=0			Do				IF(cutslice<=(waveed[vecforindex[j]]-wavest[vecforindex[j]]))   //not +1					condition=0					original_slice[i]=cutslice+wavest[vecforindex[j]]					original_data[i]=imageindex[vecforindex[j]]					original_rphi[i]=imagetheta[vecforindex[j]]					thisdata="data"+num2str(original_data[i])					original_eta[i]=dimoffset($thisdata,0)+original_slice[i]*dimdelta($thisdata,0)					Else						cutslice-=(waveed[vecforindex[j]]-wavest[vecforindex[j]]+1)				Endif				j+=1			While((j<dimsize(vecforindex,0))&&(condition==1))		Endif		IF(SRC_vs_BNL==0)			original_rphi[i]=original_phi[i]			cutname="cut"+num2str(original_phi[i])			thisimagephi=original_phi[i]			cutslice=Round((original_theta[i]-dimoffset($cutname,0))/dimdelta($cutname,0))			j=0			Do				IF(imagephi[j]==thisimagephi)					Insertpoints 0,1,vecforindex					Insertpoints 0,1,vecforimagetheta					vecforindex[0]=j					vecforimagetheta[0]=imagetheta[j]				Endif				j+=1			While(j<dimsize(imageindex,0))			Sort vecforimagetheta,vecforimagetheta,vecforindex			condition=1			j=0			Do				IF(cutslice<=(waveed[vecforindex[j]]-wavest[vecforindex[j]]))   //not +1					condition=0					original_slice[i]=cutslice+wavest[vecforindex[j]]					original_data[i]=imageindex[vecforindex[j]]					original_rtheta[i]=imagetheta[vecforindex[j]]					thisdata="data"+num2str(original_data[i])					original_eta[i]=dimoffset($thisdata,0)+original_slice[i]*dimdelta($thisdata,0)					Else						cutslice-=(waveed[vecforindex[j]]-wavest[vecforindex[j]]+1)				Endif				j+=1			While((j<dimsize(vecforindex,0))&&(condition==1))		Endif				i+=1	While(i<num)	killwaves vector_list,vecforimagetheta,vecforindexEnd//**************************************hv mapping project**************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************Proc CVT2K_vs_kz(slitorientation,Vzero,kzgridfactor)	Variable slitorientation	Variable Vzero	Variable kzgridfactor=3	Prompt slitorientation,"Slit orientation",popup "V;H"	Prompt Vzero,"Enter V0(bigger,higher)"	Prompt kzgridfactor,"How many times more points"	PauseUpdate;Silent 1	String thisname	Variable i	Variable kzgridsize	Variable firstkz,lastkz		kzgridsize=Round(kzgridfactor*dimsize(mat_khv,2))	//Find the equivalent kz's for mat_khv	Duplicate/O mat_khv mat_kkz1		Make/O/N=(dimsize(mat_khv,2)) lowestwave	Make/O/N=(dimsize(mat_khv,2)) highestwave	lowestwave[]=NaN	highestwave[]=NaN				func_CVT2K_vs_kz_boundaries(mat_khv,mat_kkz1,EFvals4kz,lowestwave,highestwave,Vzero)	//Defining matrix with k-BE-kz	Wavestats/Q lowestwave	firstkz=V_min	Wavestats/Q highestwave	lastkz=V_max	Killwaves lowestwave,highestwave	Make/O/N=(dimsize(mat_khv,0),dimsize(mat_khv,1),kzgridsize) mat_kkz	Setscale/P x,dimoffset(mat_khv,0),dimdelta(mat_khv,0),""mat_kkz	Setscale/P y,dimoffset(mat_khv,1),dimdelta(mat_khv,1),""mat_kkz	Setscale/I z, firstkz, lastkz,""mat_kkz	mat_kkz[][][]=NaN	func_CVT2K_vs_kz_interp(mat_khv,mat_kkz,mat_kkz1)//	killwaves mat_kkz1End//*******************************************************************************************************************************Function func_CVT2K_vs_kz_interp(matkhv,matkkz,matkkz1)	Wave matkhv	Wave matkkz		Wave matkkz1	PauseUpdate;Silent 1	Variable i,j	Variable firstindex,lastindex	Print "Begin interpolation"	Make/O/N=(dimsize(matkhv,2)) thisIntensitywave	Make/O/N=(dimsize(matkhv,2)) thiskzwave	thisIntensitywave[]=NaN	thiskzwave[]=NaN		i=0  //loop on BE	Do		IF(mod(i,50)==0)			print i,"/",dimsize(matkhv,1)-1		Endif		j=0 //loop on k		Do			thisIntensitywave[]=matkhv[j][i][p]			thiskzwave[]=matkkz1[j][i][p]			firstindex=Ceil((thiskzwave[0]-dimoffset(matkkz,2))/dimdelta(matkkz,2))			lastindex=Ceil((thiskzwave[dimsize(thiskzwave,0)-1]-dimoffset(matkkz,2))/dimdelta(matkkz,2))							matkkz[j][i][firstindex,lastindex]=interp(dimoffset(matkkz,2)+r*dimdelta(matkkz,2),thiskzwave,thisIntensitywave)					j+=1		While(j<dimsize(matkhv,0))		i+=1	While(i<dimsize(matkhv,1))	killwaves	thisIntensitywave,thiskzwaveEnd//*******************************************************************************************************************************Function func_mat2d_1orNaN(matname)	Wave matname	PauseUpdate;Silent 1	Variable i,j	i=0	Do		j=0		Do			IF(mod(round(matname[i][j]),1)!=0)				matname[i][j]=NaN				Else					matname[i][j]=1			Endif			j+=1		While(j<dimsize(matname,1))		i+=1	While(i<dimsize(matname,0))End//*******************************************************************************************************************************Function func_CVT2K_vs_kz_boundaries(matkhv,matkkz1,EFwave,lowestwave,highestwave,Vzero)	Wave matkhv	Wave matkkz1	Wave EFwave	Wave lowestwave	Wave highestwave	Variable Vzero	PauseUpdate;Silent 1	Variable i	//Find the equivalent kz's for mat_khv and finding kz boundaries	i=0	Do		matkkz1[][][i]=0.51231*sqrt(dimoffset(matkhv,1)+q*dimdelta(matkhv,1)+EFwave[i]+Vzero-((dimoffset(matkhv,0)+p*dimdelta(matkhv,0))/0.51231)^2)				Make/O/N=(dimsize(matkhv,0),dimsize(matkhv,1)) thiscutkz		Make/O/N=(dimsize(matkhv,0),dimsize(matkhv,1)) thiscut1NAN		thiscut1NAN[][]=matkhv[p][q][i]		func_mat2d_1orNaN(thiscut1NAN)		thiscutkz[][]=matkkz1[p][q][i]*thiscut1NAN[p][q]		imagestats/Q thiscutkz		lowestwave[i]=V_min		highestwave[i]=V_max		i+=1	While(i<dimsize(matkhv,2))	killwaves	thiscutkz,thiscut1NANEnd//*******************************************************************************************************************************Proc CVT2K_vs_hv(slitorientation,CVTornot,Showornot)	Variable slitorientation	Variable CVTornot	Variable Showornot	Prompt slitorientation,"Slit orientation",popup "V;H"	Prompt CVTornot,"Do you convert in k space",popup "YES;NO"				Prompt Showornot,"Do you want to display the E vs k cuts",popup "YES;NO"				PauseUpdate;Silent 1	String name,hvwave,FermiEwave,realthetas,realphis	String thisname	Variable i	Variable mostleft,mostright,deltakmin,sizek,emax,emin,deltaemin,sizee	name="hvcuts4kz"	hvwave="photonE4kz"	FermiEwave="EFvals4kz"	realthetas="theta4kz"	realphis="phi4kz"	Sort $hvwave,$hvwave,$name,$FermiEwave,$realthetas,$realphis	Duplicate/O $hvwave leftwave	Duplicate/O $hvwave rightwave	Duplicate/O $hvwave deltakwave	Duplicate/O $hvwave eminwave	Duplicate/O $hvwave emaxwave	Duplicate/O $hvwave deltaewave	Duplicate/O $hvwave kzminwave	Duplicate/O $hvwave kzmaxwave	print "Make all the E-k matrices"	i=0	Do		thisname=$name[i]		If(CVTornot==1)			CVT2EK_exact1cut(thisname,1,$FermiEwave[i],$realthetas[i],$realphis[i],1,0,Showornot)					thisname=$name[i]+"_k"		Endif		leftwave[i]=dimoffset($thisname,0)		rightwave[i]=dimoffset($thisname,0)+dimdelta($thisname,0)*(dimsize($thisname,0)-1)		deltakwave[i]=dimdelta($thisname,0)		eminwave[i]=dimoffset($thisname,1)		emaxwave[i]=dimoffset($thisname,1)+dimdelta($thisname,1)*(dimsize($thisname,1)-1)		deltaewave[i]=dimdelta($thisname,1)		i+=1	While(i<dimsize($name,0)))	//Make a super matrix k-E-hv   note: same form as mat3d	print "Filling matrix mat_khv"	Wavestats/Q leftwave	mostleft=V_min	Wavestats/Q rightwave	mostright=V_max	Wavestats/Q deltakwave	deltakmin=V_min		sizek=Ceil(1+(mostright-mostleft)/deltakmin)	Wavestats/Q eminwave	emin=V_min	Wavestats/Q emaxwave	emax=V_max	Wavestats/Q deltaewave	deltaemin=V_min		sizee=Ceil(1+(emax-emin)/deltaemin)	print "sizee=",sizee,"sizek=",sizek	Make/O/N=(sizek,sizee,dimsize($hvwave,0)) mat_khv	mat_khv[][][]=NaN	Setscale/I x,mostleft,mostright,""mat_khv	Setscale/I y,emin,emax,""mat_khv		Setscale/P z,$hvwave[0],$hvwave[1]-$hvwave[0],""mat_khv	i=0	Do		print "hv ",i,"/",dimsize($name,0)-1		If(CVTornot==1)			thisname=$name[i]+"_k"			Else				thisname=$name[i]		Endif		mat_khv[][][i]=interp2d($thisname,dimoffset(mat_khv,0)+p*dimdelta(mat_khv,0),dimoffset(mat_khv,1)+q*dimdelta(mat_khv,1))		i+=1	While(i<dimsize($name,0)))	killwaves leftwave,rightwave,deltakwave,eminwave,emaxwave,deltaewaveEnd//********************************************************************************************************************************Proc make_table_hv_kz()	Pauseupdate	Silent 1	If(Wintype("table_hv_kz")==0)		If(Exists("photonE4kz")==0)			Make/O/N=0 photonE4kz			Make/O/T/N=0 hvcuts4kz			Make/O/N=0 EFvals4kz			Make/O/N=0 theta4kz				Make/O/N=0 phi4kz											Edit photonE4kz,hvcuts4kz,EFvals4kz,theta4kz,phi4kz			Dowindow/C table_hv_kz			Else				Edit photonE4kz,hvcuts4kz,EFvals4kz,theta4kz,phi4kz				Dowindow/C table_hv_kz		Endif		Else			Dowindow/F table_hv_kz	Endif	End	//********************************************************************************************************************************Function ButtonProc_make_table_hv_kz(ctrlName) : ButtonControl	String ctrlName	Execute "make_table_hv_kz()"End//********************************************************************************************************************************Function ButtonProc_CVT2K_vs_hv(ctrlName) : ButtonControl	String ctrlName	Execute "CVT2K_vs_hv()"End//********************************************************************************************************************************Function ButtonProc_CVT2K_vs_kz(ctrlName) : ButtonControl	String ctrlName	Execute "CVT2K_vs_kz()"End//********************************************************************************************************************************Function ButtonDuplicate_hvmat3d(ctrlName) : ButtonControl	String ctrlName	//	Duplicate/O mat_khv mat3dEnd//********************************************************************************************************************************Function ButtonDuplicate_kzmat3d(ctrlName) : ButtonControl	String ctrlName	Duplicate/O mat_kkz mat3dEnd//********************************************************************************************************************************Function SliderProc_sqleft(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Wave sq4Raman_3D_x	Wave sq4Raman_3D_y	Wave mat3d		if(event %& 0x1)	// bit 0, value set	endif	sq4Raman_3D_x[0]=dimoffset(mat3d,0)+sliderValue*dimdelta(mat3d,0)	sq4Raman_3D_x[3]=sq4Raman_3D_x[0]	sq4Raman_3D_x[4]=sq4Raman_3D_x[0]	avgRaman4_3Dspectra()	return 0End//********************************************************************************************************************************Function SliderProc_sqright(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Wave sq4Raman_3D_x	Wave sq4Raman_3D_y	Wave mat3d		if(event %& 0x1)	// bit 0, value set	endif	sq4Raman_3D_x[1]=dimoffset(mat3d,0)+sliderValue*dimdelta(mat3d,0)	sq4Raman_3D_x[2]=sq4Raman_3D_x[1]	avgRaman4_3Dspectra()	return 0End//********************************************************************************************************************************Function SliderProc_sqbottom(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Wave sq4Raman_3D_x	Wave sq4Raman_3D_y	Wave mat3d		if(event %& 0x1)	// bit 0, value set	endif	sq4Raman_3D_y[0]=dimoffset(mat3d,2)+sliderValue*dimdelta(mat3d,2)	sq4Raman_3D_y[1]=sq4Raman_3D_y[0]	sq4Raman_3D_y[4]=sq4Raman_3D_y[0]	avgRaman4_3Dspectra()	return 0End//********************************************************************************************************************************Function SliderProc_sqtop(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	Wave sq4Raman_3D_x	Wave sq4Raman_3D_y	Wave mat3d		if(event %& 0x1)	// bit 0, value set	endif	sq4Raman_3D_y[2]=dimoffset(mat3d,2)+sliderValue*dimdelta(mat3d,2)	sq4Raman_3D_y[3]=sq4Raman_3D_y[2]	avgRaman4_3Dspectra()	return 0End//********************************************************************************************************************************Function CheckProcshowsq(ctrlName,checked) : CheckBoxControl	String ctrlName	Variable checked	Wave sq4Raman_3D_y	Wave sq4Raman_3D_x	Variable/G showsq_Raman4_3D	showsq_Raman4_3D=checked	If(checked==1)		Dowindow/F mat3d_fs_ploter		appendtograph sq4Raman_3D_y vs sq4Raman_3D_x		ModifyGraph mode=4,marker=8,lstyle=7		Dowindow/F Raman4_3Dspectra_plotter		avgRaman4_3Dspectra()	Endif	If(checked==0)		Dowindow/F mat3d_fs_ploter		removefromgraph sq4Raman_3D_y		Dowindow/F Raman4_3Dspectra_plotter			Endif	End//********************************************************************************************************************************Function avgRaman4_3Dspectra()	Wave sq4Raman_3D_x	Wave sq4Raman_3D_y	Wave mat3d		Wave Raman4_3Dspectra	Wave rightRaman4_3Dspectra_y	Wave leftRaman4_3Dspectra_y	Variable avgRaman4_3Dspectrax1	Variable avgRaman4_3Dspectrax2	Variable avgRaman4_3Dspectray1	Variable avgRaman4_3Dspectray2	Variable i,j,k	Variable thisnumber	avgRaman4_3Dspectrax1=(sq4Raman_3D_x[0]-dimoffset(mat3d,0))/dimdelta(mat3d,0)	avgRaman4_3Dspectrax2=(sq4Raman_3D_x[1]-dimoffset(mat3d,0))/dimdelta(mat3d,0)	avgRaman4_3Dspectray1=(sq4Raman_3D_y[0]-dimoffset(mat3d,2))/dimdelta(mat3d,2)	avgRaman4_3Dspectray2=(sq4Raman_3D_y[2]-dimoffset(mat3d,2))/dimdelta(mat3d,2)	If(avgRaman4_3Dspectrax1>avgRaman4_3Dspectrax2)		i=avgRaman4_3Dspectrax1		avgRaman4_3Dspectrax1=avgRaman4_3Dspectrax2		avgRaman4_3Dspectrax2=i	Endif	If(avgRaman4_3Dspectray1>avgRaman4_3Dspectray2)		i=avgRaman4_3Dspectray1		avgRaman4_3Dspectray1=avgRaman4_3Dspectray2		avgRaman4_3Dspectray2=i	Endif	Make/O/N=(dimsize(mat3d,1)) Raman4_3Dspectra	Raman4_3Dspectra[]=0	Setscale/P x,dimoffset(mat3d,1),dimdelta(mat3d,1),""Raman4_3Dspectra	k=0	i=avgRaman4_3Dspectrax1	Do		j=avgRaman4_3Dspectray1		Do			k+=1			Raman4_3Dspectra[]+=mat3d[i][p][j]//			print "bananas",i,j,k			j+=1		While(j<avgRaman4_3Dspectray2)		i+=1	While(i<avgRaman4_3Dspectrax2)	Raman4_3Dspectra[]/=k	wavestats/Q Raman4_3Dspectra	rightRaman4_3Dspectra_y[0]=V_min	leftRaman4_3Dspectra_y[0]=V_min	rightRaman4_3Dspectra_y[1]=V_max	leftRaman4_3Dspectra_y[1]=V_max	//	print k, avgRaman4_3Dspectrax1,avgRaman4_3Dspectrax2,avgRaman4_3Dspectray1,avgRaman4_3Dspectray2	//	Display Raman4_3DspectraEnd//********************************************************************************************************************************//******************************hv mapping project end*************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************Proc Interpmat3D(matchoice,matdirection,qfactor)	Variable matchoice	Variable matdirection	Variable qfactor=3	Prompt matchoice,"Matrix", popup "Mat3d;Mat3dVD;Mat3dHD;Mat3dk;Mat3dkVD;Mat3dkHD"	Prompt matdirection,"Direction", popup "Horizontal;Vertical;Energy"	Prompt qfactor,"Enter the quality factor"	PauseUpdate;Silent 1	String matname	Variable indexofcol	IF(matchoice>3)		indexofcol=matdirection-1		Else			if(matdirection==1)				indexofcol=0			Endif			if(matdirection==2)				indexofcol=2			Endif			if(matdirection==3)				indexofcol=1			Endif	Endif	IF(matchoice==1)		matname="Mat3d"	Endif	IF(matchoice==2)		matname="Mat3dVD"	Endif	IF(matchoice==3)		matname="Mat3dHD"	Endif	IF(matchoice==4)		matname="Mat3dk"	Endif	IF(matchoice==5)		matname="Mat3dkVD"	Endif	IF(matchoice==6)		matname="Mat3dkHD"	Endif	func_Interpmat3D($matname,indexofcol,qfactor)			End//*******************************************************************************************************************************Function func_Interpmat3D(matname,indexofcol,qfactor)	Wave matname	Variable indexofcol	Variable qfactor	PauseUpdate;Silent 1	Variable i,j	Variable newsize	IF(indexofcol==0)		newsize=Round(qfactor*dimsize(matname,0))		Make/O/N=(newsize,dimsize(matname,1),dimsize(matname,2)) thistemp4mat3d		Setscale/I x,dimoffset(matname,0),dimoffset(matname,0)+(dimsize(matname,0)-1)*dimdelta(matname,0),""thistemp4mat3d		Setscale/P y,dimoffset(matname,1),dimdelta(matname,1),"" thistemp4mat3d		Setscale/P z,dimoffset(matname,2),dimdelta(matname,2),"" thistemp4mat3d		thistemp4mat3d[][][]=NaN		Make/O/N=(dimsize(matname,0)) thisxwave		thisxwave[]=dimoffset(matname,0)+p*dimdelta(matname,0)		i=0		Do			j=0			Do				Duplicate/O thisxwave thisywave				thisywave[]=matname[p][i][j]				thistemp4mat3d[][i][j]=Interp(dimoffset(thistemp4mat3d,0)+p*dimdelta(thistemp4mat3d,0),thisxwave,thisywave)				j+=1			While(j<dimsize(matname,2))			i+=1		While(i<dimsize(matname,1))	Endif	IF(indexofcol==1)		newsize=Round(qfactor*dimsize(matname,1))		Make/O/N=(dimsize(matname,0),newsize,dimsize(matname,2)) thistemp4mat3d		Setscale/P x,dimoffset(matname,0),dimdelta(matname,0),"" thistemp4mat3d		Setscale/I y,dimoffset(matname,1),dimoffset(matname,1)+(dimsize(matname,1)-1)*dimdelta(matname,1),""thistemp4mat3d		Setscale/P z,dimoffset(matname,2),dimdelta(matname,2),"" thistemp4mat3d		thistemp4mat3d[][][]=NaN		Make/O/N=(dimsize(matname,1)) thisxwave		thisxwave[]=dimoffset(matname,1)+p*dimdelta(matname,1)		i=0		Do			j=0			Do				Duplicate/O thisxwave thisywave				thisywave[]=matname[i][p][j]				thistemp4mat3d[i][][j]=Interp(dimoffset(thistemp4mat3d,1)+q*dimdelta(thistemp4mat3d,1),thisxwave,thisywave)				j+=1			While(j<dimsize(matname,2))			i+=1		While(i<dimsize(matname,0))	Endif	IF(indexofcol==2)		newsize=Round(qfactor*dimsize(matname,2))		Make/O/N=(dimsize(matname,0),dimsize(matname,1),newsize) thistemp4mat3d		Setscale/P x,dimoffset(matname,0),dimdelta(matname,0),"" thistemp4mat3d		Setscale/P y,dimoffset(matname,1),dimdelta(matname,1),"" thistemp4mat3d		Setscale/I z,dimoffset(matname,2),dimoffset(matname,2)+(dimsize(matname,2)-1)*dimdelta(matname,2),""thistemp4mat3d		thistemp4mat3d[][][]=NaN		Make/O/N=(dimsize(matname,2)) thisxwave		thisxwave[]=dimoffset(matname,2)+p*dimdelta(matname,2)		i=0		Do			j=0			Do				Duplicate/O thisxwave thisywave				thisywave[]=matname[i][j][p]				thistemp4mat3d[i][j][]=Interp(dimoffset(thistemp4mat3d,2)+r*dimdelta(thistemp4mat3d,2),thisxwave,thisywave)				j+=1			While(j<dimsize(matname,1))			i+=1		While(i<dimsize(matname,0))	Endif	Duplicate/O thistemp4mat3d matname	killwaves thistemp4mat3d, thisxwave, thisywaveEnd//*******************************************************************************************************************************Function ButtonProcInterp3D(ctrlName) : ButtonControl	String ctrlName	Execute "Interpmat3D()"End//*******************************************************************************************************************************Proc BEatheight_EDC(EDCname,height,smoothfactor)	String EDCname	Variable height	Variable smoothfactor=0	Prompt EDCname,"Enter the name of the ECC"	Prompt height,"Height for the leading edge"		Prompt smoothfactor,"Enter the smooth factor"	PauseUpdate;Silent 1	print func_BEatheight_EDC($EDCname,height,smoothfactor)End//*******************************************************************************************************************************Function func_BEatheight_EDC(EDCname,height,smoothfactor)	Wave EDCname	Variable height	Variable smoothfactor	PauseUpdate;Silent 1	Variable xbefore,xafter,hbefore,hafter	Variable index	Variable BE	Variable slope	Duplicate/O EDCname smoothtemp	smoothtemp[]-=height	If(smoothfactor>0)		Smooth/E=3/B=(smoothfactor) smoothfactor,smoothtemp	Endif	Duplicate/O smoothtemp tempname		tempname[]=ABS(smoothtemp[p])	Wavestats/Q tempname	index=x2pnt(tempname,V_minloc)	If(V_min==0)		BE=V_minloc	Endif	IF((V_min!=0)&&(sign(smoothtemp[index-1])!=sign(smoothtemp[index])))		BE=pnt2x(smoothtemp,index-1)-smoothtemp[index-1]*(pnt2x(smoothtemp,index)-pnt2x(smoothtemp,index-1))/(smoothtemp[index]-smoothtemp[index-1])	Endif	IF((V_min!=0)&&(sign(smoothtemp[index+1])!=sign(smoothtemp[index])))		BE=pnt2x(smoothtemp,index)-smoothtemp[index]*(pnt2x(smoothtemp,index+1)-pnt2x(smoothtemp,index))/(smoothtemp[index+1]-smoothtemp[index])	Endif	Killwaves tempname,smoothtemp	Return BEEnd//*******************************************************************************************************************************Proc BEatheight_mat3d(mat3dname,outputname,typeofmatrix,height,smoothfactor)	String mat3dname	String outputname	variable typeofmatrix	Variable height	Variable smoothfactor=0	Prompt mat3dname,"Enter the name of the matrix"	Prompt outputname,"Enter the outputname"	Prompt typeofmatrix,"Type of matrix",popup "k;angle"	Prompt height,"Height for the leading edge"		Prompt smoothfactor,"Enter the smooth factor"	PauseUpdate;Silent 1	If(typeofmatrix==1)		Make/O/N=(dimsize($mat3dname,0),dimsize($mat3dname,1)) $outputname		Setscale/P x,dimoffset($mat3dname,0),dimdelta($mat3dname,0),""$outputname		Setscale/P y,dimoffset($mat3dname,1),dimdelta($mat3dname,1),""$outputname		Else			Make/O/N=(dimsize($mat3dname,0),dimsize($mat3dname,2)) $outputname			Setscale/P x,dimoffset($mat3dname,0),dimdelta($mat3dname,0),""$outputname			Setscale/P y,dimoffset($mat3dname,2),dimdelta($mat3dname,2),""$outputname			Endif	$outputname[][]=NaN	func_BEatheight_mat3d($mat3dname,$outputname,typeofmatrix,height,smoothfactor)	display;appendimage $outputname			End//*******************************************************************************************************************************Function func_BEatheight_mat3d(mat3dname,outputname,typeofmatrix,height,smoothfactor)	Wave mat3dname	Wave outputname	variable typeofmatrix	Variable height	Variable smoothfactor	PauseUpdate;Silent 1	Variable i,j	If(typeofmatrix==1)		i=0		Do			if(mod(i,50)==0)				Print i,"/",dimsize(mat3dname,0)-1			Endif			j=0			Do				Make/O/N=(dimsize(mat3dname,2)) thisEDCfrommat				Setscale/P x,dimoffset(mat3dname,2),dimdelta(mat3dname,2),""thisEDCfrommat				thisEDCfrommat[]=mat3dname[i][j][p]				outputname[i][j]=func_BEatheight_EDC(thisEDCfrommat,height,smoothfactor)				j+=1			While(j<dimsize(mat3dname,1))			i+=1		While(i<dimsize(mat3dname,0))		Else			i=0			Do				if(mod(i,50)==0)					Print i,"/",dimsize(mat3dname,0)-1				Endif				j=0				Do					Make/O/N=(dimsize(mat3dname,1)) thisEDCfrommat					Setscale/P x,dimoffset(mat3dname,1),dimdelta(mat3dname,1),""thisEDCfrommat					thisEDCfrommat[]=mat3dname[i][p][j]					outputname[i][j]=func_BEatheight_EDC(thisEDCfrommat,height,smoothfactor)					j+=1				While(j<dimsize(mat3dname,2))				i+=1			While(i<dimsize(mat3dname,0))	Endif	killwaves thisEDCfrommat	End//*******************************************************************************************************************************//**************************************Map list****************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************Proc Makenewmap(thisnameofmap,thiscomment4map)	String thisnameofmap	String thiscomment4map	Prompt thisnameofmap,"Enter a name for your mapping"	Prompt thiscomment4map,"Enter a comment for your mapping (do not use \";\")"		PauseUpdate;Silent 1	Variable/G activenumber4map	Variable i	If(Exists("list4mappings")==0)		Make/T/N=1 list4mappings		Make/T/N=1 comment4mappings		activenumber4map=0		list4mappings[0]=thisnameofmap		comment4mappings[0]=thiscomment4map		copymap(thisnameofmap)		Valdisplay valdisp0 Format=list4mappings[0]		Valdisplay valdisp1 Format=comment4mappings[0]				Else			Insertpoints 0,1,list4mappings			Insertpoints 0,1,comment4mappings			list4mappings[0]=thisnameofmap			comment4mappings[0]=thiscomment4map			Make/O/N=(dimsize(list4mappings,0)) tempwavemap			tempwavemap[]=p			Sort list4mappings,list4mappings,comment4mappings,tempwavemap			copymap(thisnameofmap)			i=0			Do				If(tempwavemap[i]==0)					activenumber4map=i					i=dimsize(tempwavemap,0)				Endif				i+=1			While(i<dimsize(tempwavemap,0))				Valdisplay valdisp0 Format=list4mappings[activenumber4map]			Valdisplay valdisp1 Format=comment4mappings[activenumber4map]					killwaves tempwavemap		EndifEnd//**********************************************************************************************************************Proc Save3D(suffixe,comment)	String suffixe,comment	Prompt suffixe,"Enter a suffixe"	Prompt comment,"Enter a comment"		PauseUpdate;Silent 1	Variable/G Mat3dcopy	Variable/G Mat3dVDcopy	Variable/G Mat3dHDcopy	Variable/G Mat3dkcopy	Variable/G Mat3dkVDcopy	Variable/G Mat3dkHDcopy	String newname	If(Mat3dcopy==1)		If(waveexists(Mat3d)==1)			newname="mat3d_"+suffixe			Duplicate/O mat3d $newname			Wave2file(newname)			Else				Print "Mat3d does not exists"		Endif	Endif	If(Mat3dVDcopy==1)		If(waveexists(Mat3dVD)==1)			newname="mat3dVD_"+suffixe			Duplicate/O mat3dVD $newname			Wave2file(newname)			Else				Print "Mat3dVD does not exists"		Endif	Endif	If(Mat3dHDcopy==1)		If(waveexists(Mat3dHD)==1)			newname="mat3dHD_"+suffixe			Duplicate/O mat3dHD $newname			Wave2file(newname)			Else				Print "Mat3dHD does not exists"		Endif	Endif	If(Mat3dkcopy==1)		If(waveexists(Mat3dk)==1)			newname="mat3dk_"+suffixe			Duplicate/O mat3dk $newname			Wave2file(newname)			Else				Print "Mat3dk does not exists"		Endif	Endif	If(Mat3dkVDcopy==1)		If(waveexists(Mat3dVkD)==1)			newname="mat3dkVD_"+suffixe			Duplicate/O mat3dkVD $newname			Wave2file(newname)			Else				Print "Mat3dkVD does not exists"		Endif	Endif	If(Mat3dkHDcopy==1)		If(waveexists(Mat3dkHD)==1)			newname="mat3dkHD_"+suffixe			Duplicate/O mat3dkHD $newname			Wave2file(newname)			Else				Print "Mat3dkHD does not exists"		Endif	Endif	If(exists("save3dlist")==0)		Make/T/N=0 save3dlist		Make/T/N=0 save3dcomment				Make/N=0 save3d_mat3d		Make/N=0 save3d_mat3dVD		Make/N=0 save3d_mat3dHD		Make/N=0 save3d_mat3dk		Make/N=0 save3d_mat3dkVD		Make/N=0 save3d_mat3dkHD		Edit save3dlist,save3dcomment,save3d_mat3d, save3d_mat3dVD,save3d_mat3dHD,save3d_mat3dk,save3d_mat3dkVD,save3d_mat3dkHD		Dowindow/C save3dtable	Endif	Insertpoints 0,1,save3dlist	Insertpoints 0,1,save3dcomment	Insertpoints 0,1,save3d_mat3d	Insertpoints 0,1,save3d_mat3dVD	Insertpoints 0,1,save3d_mat3dHD	Insertpoints 0,1,save3d_mat3dk	Insertpoints 0,1,save3d_mat3dkVD	Insertpoints 0,1,save3d_mat3dkHD	save3dlist[0]=suffixe	save3dcomment[0]=comment	save3d_mat3d[0]=Mat3dcopy	save3d_mat3dVD[0]=Mat3dVDcopy	save3d_mat3dHD[0]=Mat3dHDcopy	save3d_mat3dk[0]=Mat3dkcopy	save3d_mat3dkVD[0]=Mat3dkVDcopy	save3d_mat3dkHD[0]=Mat3dkHDcopyEnd//**********************************************************************************************************************Proc Load3D1()	Pauseupdate;Silent 1//	String/G name2bkgndremoved	String/G listnameofall3D	Variable i	listnameofall3D=save3dlist[0]	i=1	Do		listnameofall3D+=";"+save3dlist[i]		i+=1	While(i<dimsize(save3dlist,0))	Load3D2()End//**********************************************************************************************************************Proc Load3D2(thischoiceof3d)	String thischoiceof3d	Prompt thischoiceof3d,"Mapping:",popup listnameofall3D		Pauseupdate;Silent 1	Variable/G Mat3dcopy	Variable/G Mat3dVDcopy	Variable/G Mat3dHDcopy	Variable/G Mat3dkcopy	Variable/G Mat3dkVDcopy	Variable/G Mat3dkHDcopy	String thisname,this_suffixe	Variable index4load3D	index4load3D=WhichListItem(thischoiceof3d, listnameofall3D)	this_suffixe=save3dlist[index4load3D]	print this_suffixe, index4load3D	If(Mat3dcopy==1)		thisname="mat3d_"+this_suffixe		file2wave(thisname)		Duplicate/O $thisname mat3d		killwaves $thisname		If(wintype("mat3d_fs_ploter")!=0)			Dowindow/K mat3d_fs_ploter			Resumeupdate			initmat3d()			mat3d_fs_ploter()				initmat3d()				Pauseupdate		Endif	Endif		If(Mat3dVDcopy==1)		thisname="mat3dVD_"+this_suffixe		file2wave(thisname)		Duplicate/O $thisname mat3dVD		killwaves $thisname		If(wintype("mat3dVD_fs_ploter")!=0)			Dowindow/K mat3dVD_fs_ploter			Resumeupdate			initmat3dVD()			mat3dVD_fs_ploter()				initmat3dVD()				Pauseupdate		Endif	Endif		If(Mat3dHDcopy==1)		thisname="mat3dHD_"+this_suffixe		file2wave(thisname)		Duplicate/O $thisname mat3dHD		killwaves $thisname		If(wintype("mat3dHD_fs_ploter")!=0)			Dowindow/K mat3dHD_fs_ploter			Resumeupdate			initmat3dHD()			mat3dHD_fs_ploter()				initmat3dHD()			Endif	Endif		If(Mat3dkcopy==1)		thisname="mat3dk_"+this_suffixe		file2wave(thisname)		Duplicate/O $thisname mat3dk		killwaves $thisname		If(wintype("mat3dk_fs_ploter")!=0)			Dowindow/K mat3dk_fs_ploter			Resumeupdate			initmat3dk()			mat3dk_fs_ploter()				initmat3dk()				Pauseupdate		Endif	Endif		If(Mat3dkcopy==1)		thisname="mat3dkVD_"+this_suffixe		file2wave(thisname)		Duplicate/O $thisname mat3dkVD		killwaves $thisname				If(wintype("mat3dkVD_fs_ploter")!=0)			Dowindow/K mat3dkVD_fs_ploter			Resumeupdate			initmat3dkVD()			mat3dkVD_fs_ploter()				initmat3dkVD()				Pauseupdate		Endif	Endif		If(Mat3dkHDcopy==1)		thisname="mat3dkHD_"+this_suffixe		file2wave(thisname)		Duplicate/O $thisname mat3dkHD		killwaves $thisname				If(wintype("mat3dkHD_fs_ploter")!=0)			Dowindow/K mat3dkHD_fs_ploter			Resumeupdate			initmat3dkHD()			mat3dkHD_fs_ploter()				initmat3dkHD()				Pauseupdate		Endif	Endif	Duplicate/O save3d_mat3d sortwave		sortwave[]=p	sortwave[index4load3D]=-1	sort sortwave,save3dlist,save3dcomment,save3d_mat3d, save3d_mat3dVD,save3d_mat3dHD,save3d_mat3dk,save3d_mat3dkVD,save3d_mat3dkHD	killwaves sortwave// 	Valdisplay valdisp0 Format=thischoiceofmapEnd//*******************************************************************************************************************************Function ButtonProc_Save3D(ctrlName) : ButtonControl	String ctrlName	Execute "Save3D()"End//*******************************************************************************************************************************Function ButtonProc_Load3D(ctrlName) : ButtonControl	String ctrlName	Execute "Load3D1()"End//**********************************************************************************************************************Proc Copymap(prefix)	String prefix	Prompt prefix,"Prefix"	PauseUpdate;Silent 1	String newname	newname=prefix+"_Imageindex"	Duplicate/O imageindex $newname	newname=prefix+"_Imagetheta"	Duplicate/O Imagetheta $newname	newname=prefix+"_Imagephi"	Duplicate/O Imagephi $newname	newname=prefix+"_wavest"	Duplicate/O wavest $newname	newname=prefix+"_waveed"	Duplicate/O waveed $newname	newname=prefix+"_waveetast"	Duplicate/O waveetast $newname	newname=prefix+"_waveetaed"	Duplicate/O waveetaed $newname	newname=prefix+"_phiindex"	Duplicate/O phiindex $newnameEnd//**********************************************************************************************************************Proc pastemap(prefix)	String prefix	Prompt prefix,"Prefix"	PauseUpdate;Silent 1	String newname	newname=prefix+"_Imageindex"	Duplicate/O $newname imageindex	newname=prefix+"_Imagetheta"	Duplicate/O $newname Imagetheta	newname=prefix+"_Imagephi"	Duplicate/O $newname Imagephi	newname=prefix+"_wavest"	Duplicate/O $newname wavest	newname=prefix+"_waveed"	Duplicate/O $newname waveed	newname=prefix+"_waveetast"	Duplicate/O $newname waveetast	newname=prefix+"_waveetaed"	Duplicate/O $newname waveetaed	newname=prefix+"_phiindex"	Duplicate/O $newname phiindexEnd//**********************************************************************************************************************Proc selectlistmap1()	Pauseupdate;Silent 1//	String/G name2bkgndremoved	String/G listnameofallmaps	Variable i	listnameofallmaps=list4mappings[0]+" :: "+comment4mappings[0]	i=1	Do		listnameofallmaps+=";"+list4mappings[i]+" :: "+comment4mappings[i]		i+=1	While(i<dimsize(list4mappings,0))//	name2bkgndremoved=StringFromList(0, listnameofallmaps, ";")	selectlistmap2()End//**********************************************************************************************************************Proc selectlistmap2(thischoiceofmap)	String thischoiceofmap	Prompt thischoiceofmap,"Mapping:",popup listnameofallmaps		Pauseupdate;Silent 1//	String/G choiceofmap	String/G listnameofallmaps	Variable/G activenumber4map	String activename	String activecomment//	choiceofmap=thischoiceofmap	activenumber4map=WhichListItem(thischoiceofmap, listnameofallmaps)	pastemap(list4mappings[activenumber4map])	Valdisplay valdisp0 Format=list4mappings[activenumber4map] 	Valdisplay valdisp1 Format=comment4mappings[activenumber4map]  	 // 	Valdisplay valdisp0 Format=thischoiceofmap	End//*******************************************************************************************************************************Function ButtonProc_Makenewmap(ctrlName) : ButtonControl	String ctrlName	Execute "Makenewmap()"End//*******************************************************************************************************************************Function ButtonProc_selectlistmap(ctrlName) : ButtonControl	String ctrlName	Execute "selectlistmap1()"End//*******************************************************************************************************************************Function ButtonProc_copymapactive(ctrlName) : ButtonControl	String ctrlName	Execute "copymap(list4mappings[activenumber4map])"End//*******************************************************************************************************************************Function CheckProcMat3d(ctrlName,checked) : CheckBoxControl	String ctrlName	Variable checked	Variable/G Mat3dcopy	Mat3dcopy=checked		 End//*******************************************************************************************************************************Function CheckProcMat3dVD(ctrlName,checked) : CheckBoxControl	String ctrlName	Variable checked	Variable/G Mat3dVDcopy	Mat3dVDcopy=checked		 End//*******************************************************************************************************************************Function CheckProcMat3dHD(ctrlName,checked) : CheckBoxControl	String ctrlName	Variable checked	Variable/G Mat3dHDcopy	Mat3dHDcopy=checked		 End//*******************************************************************************************************************************Function CheckProcMat3dk(ctrlName,checked) : CheckBoxControl	String ctrlName	Variable checked	Variable/G Mat3dkcopy	Mat3dkcopy=checked		 End//*******************************************************************************************************************************Function CheckProcMat3dkVD(ctrlName,checked) : CheckBoxControl	String ctrlName	Variable checked	Variable/G Mat3dkVDcopy	Mat3dkVDcopy=checked		 End//*******************************************************************************************************************************Function CheckProcMat3dkHD(ctrlName,checked) : CheckBoxControl	String ctrlName	Variable checked	Variable/G Mat3dkHDcopy	Mat3dkHDcopy=checked		 End//*******************************************************************************************************************************Function ButtonProc(ctrlName) : ButtonControl	String ctrlName	If(wintype("save3dtable")!=0)		Dowindow/F save3dtable	EndifEnd//**************************************Map list  end****************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////End of Pierre's macros//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Movie maker, by Jonathan Henry Bowen//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//NOTE: Global variables are stored in a new data folder called "movie_maker"//		The data folder that is created can cause problems when loading data because of the way //		Pierre's macro loads data.  The data folder MUST be killed before any more data is loaded.//		If you use the close button before loading more data, the macro will cleap itself upWindow movie_maker(): Graph	PauseUpdate; Silent 1		// building window...		if( exists("Mat3d_energy_plot") == 0 )		movie_maker_startup_warning()		return	Endif		dowindow movie_maker	if( v_flag ==1 || v_flag == 2 )		dowindow/F movie_maker		return	Endif		//Initialize Global Variables	newdatafolder/O root:movie_maker	setdatafolder movie_maker	String/G working_mat = "Mat3d"	Variable/G index = 0	Variable/G axis_height = -1 		Variable/G dynamic_var = 0       //To display the variable that will change in time in an annotation box in the movie	variable/G cut_direction = 1	variable/G EF_var = 16.825	//This is the variable for the setVar in the window controls; that is the only place it is used; the real global variable "mat3d_energy_center" could be used	Variable/G combine_Jon=1	make/o/n=(1,1) movie_maker_image = 0	make/o/n=2 position_lineX	make/o/n=2 position_lineY	make/o/n=2 EF = 16.825		//This is the wave that is drawn to show EF in the graph			duplicate/o root:mat3d_energy_plot inset_image	//NOTE: This will have to be changed if a different inset image is to be used.	setdatafolder root:		Display /W=(175,98,621,492)	AppendImage root:movie_maker:movie_maker_image	ModifyImage movie_maker_image ctab= {*,*,Terrain,1}	TextBox/N=dynamic_var/A=LT/X=0.00/Y=0.00 "Variable = \\{root:movie_maker:dynamic_var}"	do_movie_maker_image()	doInsetYesNo(1)	ControlBar 60	PopupMenu chose_matrix,pos={99,5},size={81,20},proc=movie_maker_mat_popUp	PopupMenu chose_matrix,mode=2,popvalue="Mat3d",value= #"\"Mat3d;Mat3dVD;Mat3dHD;Mat3dk;Mat3dkVD;Mat3dkHD\""	PopupMenu Cut_Direction,pos={99,31},size={86,20},proc=movie_Maker_dir_PopMenuProc	PopupMenu Cut_Direction,mode=1,bodyWidth= 86,popvalue="Vertical",value= #"\"Vertical;Horizontal;Up&Down\""	SetVariable var_combine_Jon,pos={184,9},size={80,15},title="Comb"//,proc=movie_maker_index_SetVarProc		SetVariable var_combine_Jon,limits={1,inf,1},value= root:movie_maker:combine_Jon,bodyWidth= 50,live= 1	SetVariable change_index,pos={267,9},size={78,15},proc=movie_maker_index_SetVarProc	SetVariable change_index,format="%d"	SetVariable change_index,limits={0,inf,1},value= root:movie_maker:index,bodyWidth= 50,live= 1	SetVariable axis_height,pos={204,34},size={126,15},proc=movie_maker_axis_SetVarProc_1,title="Axis Height"	SetVariable axis_height,limits={-inf,inf,0.01},value= root:movie_maker:axis_height,bodyWidth= 70	SetVariable fermi_energy,pos={349,9},size={84,15},proc=EF_SetVarProc,title="EF"	SetVariable fermi_energy,limits={-inf,inf,0},value= root:movie_maker:EF_var,bodyWidth= 70	Button make_movie,pos={348,32},size={87,20},proc=make_movie_ButtonProc,title="Make Movie"	Button close_buttton,pos={10,4},size={72,47},proc=movie_maker_close_ButtonProc,title="CLOSE"	Button close_buttton,font="Arial",fSize=14,fColor=(65535,0,0)EndMacro//*** FUNCTIONS **************************//Function doInsetYesNo(answer)  // This funciton adds or removes the inset in the graph	variable answer	wave EF = root:movie_maker:EF	wave inset_image = root:movie_maker:inset_image	if( answer == 1)		dowindow/F movie_maker		AppendToGraph EF		ModifyGraph lSize(EF)=1.5		ModifyGraph lStyle(EF)=3		AppendImage/B=Inset_Bottom/L=Inset_Left inset_image		AppendToGraph/B=Inset_Bottom/L=Inset_Left root:movie_maker:position_lineY vs root:movie_maker:position_lineX		ModifyImage inset_image ctab= {*,*,Rainbow,1}		ModifyGraph tick(Inset_Left)=1,tick(Inset_Bottom)=1		ModifyGraph mirror(left)=2,mirror(bottom)=2		ModifyGraph lblPos(left)=60,lblPos(bottom)=38		ModifyGraph freePos(Inset_Left)={0.73,kwFraction}		ModifyGraph freePos(Inset_Bottom)={0.8,kwFraction}		ModifyGraph axisEnab(Inset_Left)={0.8,0.99}		ModifyGraph axisEnab(Inset_Bottom)={0.73,0.99}	elseif( answer == 0 )		dowindow/F movie_maker		RemoveImage/Z inset_image		RemoveFromGraph/Z position_lineY		RemoveFromGraph/Z EF	EndifEndfunction do_movie_maker_image()	NVAR index = root:movie_maker:index	NVAR dynamic_var = root:movie_maker:dynamic_var	NVAR cut_direction= root:movie_maker:cut_direction	NVAR tocombine= root:movie_maker:combine_Jon	SVAR tempString = root:movie_maker:working_mat	wave working_mat = $tempString	wave movie_maker_image = root:movie_maker:movie_maker_image	wave position_lineX=root:movie_maker:position_lineX	wave position_lineY = root:movie_maker:position_lineY	Variable initial,i	if((cmpstr(tempString,"mat3d")==0)||(cmpstr(tempString,"mat3dVD")==0)||(cmpstr(tempString,"mat3dHD")==0))		if( cut_direction == 1 )			if( index > dimsize(working_mat, 0) - 1)				index = dimsize(working_mat, 0) - 1			Endif			redimension/n=(dimsize(working_mat,2),dimsize(working_mat,1)) movie_maker_image			if(Floor(index-(tocombine-1)/2)<0)				initial=0				Else					initial=Floor(index-(tocombine-1)/2)			Endif			movie_maker_image[][]=0			i=0			Do				movie_maker_image[][] += working_mat[initial+i][q][p]  //CHANGING INDEX HERE				i+=1			While((i<tocombine)&&(initial+i<dimsize(working_mat,0)))			movie_maker_image[][]/=i			setscale/P x dimoffset(working_mat,2), dimdelta(working_mat,2), movie_maker_image			setscale/P y dimoffset(working_mat,1), dimdelta(working_mat,1), movie_maker_image						position_lineX[] = dimoffset(working_mat,0) + dimdelta(working_mat,0)*index  //CHANGING INDEX HERE			position_lineY[0] = dimoffset(working_mat,2)			position_lineY[1] = dimoffset(working_mat,2) + dimdelta(working_mat,2)*dimsize(working_mat,2)			dynamic_var = dimoffset(working_mat,0) + dimdelta(working_mat,0)*index    //CHANGING INDEX HERE; this displays the value changing in time in an annotation box in the graph		elseif( cut_direction == 2 )			if( index > dimsize(working_mat, 2) - 1)				index = 0			Endif			redimension/n=(dimsize(working_mat,0),dimsize(working_mat,1)) movie_maker_image			if(Floor(index-(tocombine-1)/2)<0)				initial=0				Else					initial=Floor(index-(tocombine-1)/2)			Endif			movie_maker_image[][]=0			i=0			Do					movie_maker_image[][] += working_mat[p][q][initial+i]  //CHANGING INDEX HERE				i+=1			While((i<tocombine)&&(initial+i<dimsize(working_mat,2)))			movie_maker_image[][]/=i								setscale/P x dimoffset(working_mat,0), dimdelta(working_mat,0), movie_maker_image			setscale/P y dimoffset(working_mat,1), dimdelta(working_mat,1), movie_maker_image						position_lineY[] = dimoffset(working_mat,2) + dimdelta(working_mat,2)*index  //CHANGING INDEX HERE			position_lineX[0] = dimoffset(working_mat,0)			position_lineX[1] = dimoffset(working_mat,0) + dimdelta(working_mat,0)*dimsize(working_mat,0)			dynamic_var = dimoffset(working_mat,2) + dimdelta(working_mat,2)*index  //CHANGING INDEX HERE		elseif( cut_direction == 3 )			if( index > dimsize(working_mat, 1) - 1)				index = 0			Endif			redimension/n=(dimsize(working_mat,0),dimsize(working_mat,2)) movie_maker_image			if(Floor(index-(tocombine-1)/2)<0)				initial=0				Else					initial=Floor(index-(tocombine-1)/2)			Endif			movie_maker_image[][]=0			i=0			Do					movie_maker_image[][] += working_mat[p][initial+i][q]  //CHANGING INDEX HERE				i+=1			While((i<tocombine)&&(initial+i<dimsize(working_mat,1)))			movie_maker_image[][]/=i								//			matrixtranspose movie_maker_image			setscale/P x dimoffset(working_mat,0), dimdelta(working_mat,0), movie_maker_image			setscale/P y dimoffset(working_mat,2), dimdelta(working_mat,2), movie_maker_image			dynamic_var = dimoffset(working_mat,1) + dimdelta(working_mat,1)*index    //CHANGING INDEX HERE		else			print "ERROR in do_movie_maker_image()"		endif	endif	if((cmpstr(tempString,"mat3d")!=0)&&(cmpstr(tempString,"mat3dVD")!=0)&&(cmpstr(tempString,"mat3dHD")!=0))		if( cut_direction == 1 )			if( index > dimsize(working_mat, 0) - 1)				index = dimsize(working_mat, 0) - 1			Endif			redimension/n=(dimsize(working_mat,1),dimsize(working_mat,2)) movie_maker_image			movie_maker_image[][] = working_mat[index][p][q]  //CHANGING INDEX HERE			setscale/P x dimoffset(working_mat,1), dimdelta(working_mat,1), movie_maker_image			setscale/P y dimoffset(working_mat,2), dimdelta(working_mat,2), movie_maker_image						position_lineX[] = dimoffset(working_mat,0) + dimdelta(working_mat,0)*index  //CHANGING INDEX HERE			position_lineY[0] = dimoffset(working_mat,1)			position_lineY[1] = dimoffset(working_mat,1) + dimdelta(working_mat,1)*dimsize(working_mat,1)			dynamic_var = dimoffset(working_mat,0) + dimdelta(working_mat,0)*index    //CHANGING INDEX HERE; this displays the value changing in time in an annotation box in the graph		elseif( cut_direction == 2 )			if( index > dimsize(working_mat, 1) - 1)				index = 0			Endif			redimension/n=(dimsize(working_mat,0),dimsize(working_mat,2)) movie_maker_image			movie_maker_image[][] = working_mat[p][index][q]  //CHANGING INDEX HERE			setscale/P x dimoffset(working_mat,0), dimdelta(working_mat,0), movie_maker_image			setscale/P y dimoffset(working_mat,2), dimdelta(working_mat,2), movie_maker_image						position_lineY[] = dimoffset(working_mat,1) + dimdelta(working_mat,1)*index  //CHANGING INDEX HERE			position_lineX[0] = dimoffset(working_mat,0)			position_lineX[1] = dimoffset(working_mat,0) + dimdelta(working_mat,0)*dimsize(working_mat,0)			dynamic_var = dimoffset(working_mat,1) + dimdelta(working_mat,1)*index  //CHANGING INDEX HERE		elseif( cut_direction == 3 )			if( index > dimsize(working_mat, 2) - 1)				index = 0			Endif			redimension/n=(dimsize(working_mat,1),dimsize(working_mat,0)) movie_maker_image			movie_maker_image[][] = working_mat[q][p][index]  //CHANGING INDEX HERE			matrixtranspose movie_maker_image			setscale/P x dimoffset(working_mat,0), dimdelta(working_mat,0), movie_maker_image			setscale/P y dimoffset(working_mat,1), dimdelta(working_mat,1), movie_maker_image			dynamic_var = dimoffset(working_mat,2) + dimdelta(working_mat,2)*index    //CHANGING INDEX HERE		else			print "ERROR in do_movie_maker_image()"		endif	endif		setscale/P x, dimoffset(movie_maker_image,0), (dimdelta(movie_maker_image,0)*dimsize(movie_maker_image,0)), root:movie_maker:EFEndFunction make_movie()	NVAR index = root:movie_maker:index	NVAR cut_direction = root:movie_maker:cut_direction	SVAR working_mat = root:movie_maker:working_mat	Variable size	Variable frameRate = 2	prompt frameRate, "Enter the desired frame rate (1-60):"	doprompt "Frame Rate", frameRate		if( V_flag == 1 )		return 0	elseif( cut_direction == 1 )		size =  dimsize($working_mat, 0)	elseif( cut_direction == 2 )		size = dimsize($working_mat, 2)	elseif( cut_direction == 3 )		size = dimsize($working_mat, 1)	else		print "ERROR in make_movie()"	Endif	index = 0	//index is a global variable stored in the movie_maker data folder; it controls which cut of a matrix to display	newmovie/L/F = (frameRate)	do			do_movie_maker_image()			index+=1			dowindow/F movie_maker			addmovieframe	while(index < size )	CloseMovieEnd//*** WINDOW CONTROLS ***************************************************//Function movie_Maker_dir_PopMenuProc(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr		NVAR cut_direction = root:movie_maker:cut_direction	If(popNum==1)		cut_direction = 1		doInsetYesNo(0)   //remove then put back so it doesn't append duplicate images		doInsetYesNo(1)	elseIf(popNum==2)		cut_direction = 2		doInsetYesNo(0)   //remove then put back so it doesn't append duplicate images		doInsetYesNo(1)		elseIf(popNum==3)		cut_direction = 3		doInsetYesNo(0)	else		print "ERROR in movie_Maker_dir_PopMenuProc"		Endif	do_movie_maker_image()EndFunction movie_maker_index_SetVarProc(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	do_movie_maker_image()EndFunction movie_maker_mat_popUp(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	SVAR working_mat = root:movie_maker:working_mat	If(popNum==1)		working_mat = "mat3d"			ModifyImage movie_maker_image ctab= {*,*,Terrain,1}		duplicate/o root:mat3d_energy_plot root:movie_maker:inset_image	elseIf(popNum==2)		working_mat = "mat3dVD"			duplicate/o root:mat3d_energy_plot root:movie_maker:inset_image		ModifyImage movie_maker_image ctab= {*,0,Terrain,1}	elseIf(popNum==3)		working_mat = "mat3dHD"		duplicate/o root:mat3d_energy_plot root:movie_maker:inset_image		ModifyImage movie_maker_image ctab= {*,0,Terrain,1}		elseIf(popNum==4)		duplicate/o root:mat3dk_energy_plot root:movie_maker:inset_image		ModifyImage movie_maker_image ctab= {*,*,Terrain,1}			working_mat = "mat3dk"	elseIf(popNum==5)		duplicate/o root:mat3dk_energy_plot root:movie_maker:inset_image		working_mat = "mat3dkVD"		ModifyImage movie_maker_image ctab= {*,0,Terrain,1}	elseIf(popNum==6)		duplicate/o root:mat3dk_energy_plot root:movie_maker:inset_image		working_mat = "mat3dkHD"		ModifyImage movie_maker_image ctab= {*,0,Terrain,1}	else		print "ERROR in movie_maker_mat_popUp"	Endif		if( exists("root:"+working_mat) == 0 )		Display /W=(548,225,850,341)		TextBox/C/N=text0/F=0/A=MC/X=1.32/Y=6.90 "\\Z12\\{root:movie_maker:working_mat} does not exist yet.\rPlease create it first."		DoWindow/C/T warning,"Warning"		return 0	Endif	do_movie_maker_image()EndFunction movie_maker_axis_SetVarProc_1(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	dowindow/F movie_maker	if(varnum == -1 )		SetAxis left *,*	else		SetAxis left *, varNum	EndifEndFunction EF_SetVarProc(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName		wave EF = root:movie_maker:EF	EF = varNumEndFunction make_movie_ButtonProc(ctrlName) : ButtonControl	String ctrlName	make_movie()EndFunction movie_maker_close_ButtonProc(ctrlName) : ButtonControl	String ctrlName	KillWindow movie_maker	KillDataFolder movie_makerEndWindow movie_maker_startup_warning() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(507,220,901,334) as "Warning"	ModifyGraph wbRGB=(52428,1,1),gbRGB=(52428,1,1)	TextBox/C/N=text0/F=0/B=(65535,65535,0)/A=MC/X=-0.25/Y=3.51 "\t\t\t\t  \\Z12Warning:\r This macro uses waves created by the Mat3d and Plot button\t "	AppendText " group.  If the matrix Mat3d and the wave Mat3d_energy_plot\t\r are not created at macro start time, there will be an error.\t   \r "	AppendText " Please create and plot Mat3d.\t"EndMacro//End of Movie maker, by Jonathan Henry Bowen//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************Function setvarwide_emat3d(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "mat3d_eplot()"	Execute "Update_Raman4_3DfromFS()"End