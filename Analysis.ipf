#pragma rtGlobals=1		// Use modern global access method.	Variable/G typeofdata	Variable/G colorsetedc	Variable/G colorinverseedc	Variable/G NTP_num	Variable/G NTP_num_max	Variable/G num_of_band	Variable/G global_cspacing	String/G topgraphname	String/G topgraphimage	Variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax	Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio	Variable/G topimagemaxratio							String/G topgraphcolor		String/G topgraphcolorinv		Variable/G curv_box_x	Variable/G curv_box_y	Variable/G curv_num_x	Variable/G curv_num_y	Variable/G curv_box_xy	Variable/G curv_num_xy	Variable/G curv_box_yx	Variable/G curv_num_yx	Variable/G curv_choice	Variable/G curv_ifact	Variable/G curv_ifact_inc	String/G curv_name				Window dataploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(144,71,527,485)	AppendImage Data1	ModifyImage Data1 ctab= {*,*,PlanetEarth,0}	ModifyGraph wbRGB=(60928,60928,60928),gbRGB=(60928,60928,60928)	ModifyGraph mirror=2	ShowInfo	ControlBar 74	SetVariable varplot,pos={5,4},size={100,20},proc=setvarplot,title="Data"	SetVariable varplot,fSize=14,limits={1,inf,1},value= gv_GroupNum	Button button0,pos={111,4},size={80,20},proc=ButtonProc_DisplayMat,title="Make Image"	Button button1,pos={270,4},size={35,20},proc=ButtonProc_MakeEDC,title="EDC"	Button button2,pos={309,4},size={35,20},proc=ButtonProc_MkMDC,title="MDC"	Button button3,pos={4,26},size={60,20},proc=ButtonProc_ConvertSingleData,title="Cvt data"	Button button4,pos={194,4},size={30,20},proc=ButtonProc_MatNkPlot,title="NK"	Button button5,pos={227,4},size={40,20},proc=ButtonProc_MatNorm,title="Norm"	Button Open_this_data,pos={67,26},size={100,20},proc=ButtonProc_open_onedata_pi,title="Open this data"	Button Rem_dataedc,pos={169,26},size={85,20},proc=ButtonProc_Remove_data_EDC,title="Subtract EDC"	Button but_rm_background,pos={256,26},size={115,20},proc=ButtonProc_Rm_simplebgnd_data,title="Remove backgrnd"	Button buttonfilter,pos={4,49},size={65,20},proc=ButtonFFTfilterdata,title="FFT filter"	Button buttonshowmain,pos={295,49},size={75,20},title="Main Panel",fStyle=16	Button buttonfftlist,pos={73,49},size={60,20},proc=ButtonProc_FFTlist,title="FFT list"	Button button6,pos={136,49},size={120,20},proc=ButtonProc_add_this_data,title="Combine this data"	Button buttonhelp,pos={351,3},size={25,20},proc=Button_Help_Data_ploter,title="\\K(65535,65535,65535)?"	Button buttonhelp,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Point_reader() : Panel	PauseUpdate; Silent 1		// building window...	NewPanel /K=2 /W=(966,224,1236,408) as "The_Point_Reader"	ModifyPanel cbRGB=(16385,28398,65535)	SetDrawLayer UserBack	SetDrawEnv fname= "Times New Roman",fsize= 15,fstyle= 3	DrawText 36,19,"Point reader"	SetDrawEnv linefgc= (65535,43690,0),fillfgc= (65535,43690,0)	DrawPoly 4,407,0.584415,0.828945,{206,258,228,277,207,277,206,258}	Button button0,pos={10,31},size={80,20},proc=ButtonProc_createband,title="New band"	SetVariable setvarbn,pos={93,31},size={133,18}	SetVariable setvarbn,limits={0,inf,1},value= num_of_band	Button button1,pos={10,81},size={120,20},proc=ButtonProc_readcsr,title="Read point"	Button button2,pos={140,81},size={120,20},proc=ButtonProc_sortpnts,title="Sort"	Button button3,pos={10,106},size={120,20},proc=ButtonProc_deletelastpnt,title="Delete last"	Button button4,pos={140,106},size={120,20},proc=ButtonProc_deleteallpnts,title="Delete all"	Button button5,pos={10,131},size={120,20},proc=ButtonProc_plotpnts,title="Plot"	Button button6,pos={140,131},size={120,20},proc=ButtonProc_appendpnts,title="Append pnts"	Button buttonmain,pos={131,3},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17	Button buttonshowtable,pos={10,154},size={80,20},proc=ButtonProc_tableallbands,title="Show Table"	Button button7,pos={236,2},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button7,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button8,pos={227,30},size={40,20},proc=ButtonProc_PReader_edit_mode,title="Edit"	Button button9,pos={11,55},size={50,20},proc=ButtonProc_PReader_normal_mode,title="Normal"	Button button10,pos={65,55},size={110,20},proc=ButtonProc_PReader_draw_live,title="Draw continous"EndMacro//**********************************************************************************************************************Function setvarplot(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName//	print ctrlName,varNum,varStr,varName	Execute "plotraw()"	Execute "show_dos()"	//Execute "curv_data()"	//Execute "refresh_disp()"	//Execute "EDCCurv()"	//Execute "MDCcurv()"	//Execute "twoDcurv()""EndProc plotraw()	String thedata	String old_image,old_image_list	String/G info	String/G colordefault	Variable/G gv_GroupNum	Variable/G colordefaultinv	Variable i	thedata="data"+num2str(gv_GroupNum)	old_image_list=ImageNameList("dataploter",";")	old_image=StringFromList(0,old_image_list)	If(WaveExists($old_image)==1)		Removeimage $old_image	Endif	If(WaveExists($thedata)==1)		Appendimage $thedata		ModifyImage $thedata ctab= {*,*,$colordefault,colordefaultinv}		Endif	info=File_Name[gv_GroupNum]EndProc Show_dos()	PauseUpdate; Silent 1	String thisdata 	String WindowName="DOS" 	String traces_on_graph,old_data 	Variable i	thisdata="data"+num2str(gv_GroupNum)	DoWindow  $WindowName	if( V_Flag== 0 )		Display as WindowName		DoWindow /C $(WindowName)	else		DoWindow  /F $(WindowName)	endif	traces_on_graph=TraceNamelist("DOS",";",1)	old_data=StringFromList(0,traces_on_graph)	if(WaveExists($old_data)==1)		removefromgraph $old_data	Endif	Showinfo	Make/O/N=(dimsize($thisdata,1)) density_of_states	Setscale/P x,dimoffset($thisdata,1),dimdelta($thisdata,1),""density_of_states	density_of_states[]=0	i=0	Do		density_of_states[]+=$thisdata[i][p]		i+=1	While(i<dimsize($thisdata,0))	density_of_states[]/=dimsize($thisdata,0)	Appendtograph density_of_states	DoWindow  /F dataploterEndWindow Data_Analysis_BNL() : Panel	PauseUpdate; Silent 1		// building window...	NewPanel /K=2 /W=(807,89,1255,646) as "Main_panel"	ModifyPanel cbRGB=(0,52224,0)	SetDrawLayer UserBack	SetDrawEnv linethick= 2,linefgc= (32768,54528,65280),fillfgc= (32768,54528,65280),fillbgc= (0,15872,65280)	DrawRect 148,309,438,390	SetDrawEnv linethick= 2,fillfgc= (65280,65280,0),fillbgc= (65280,65280,0)	DrawRect 145,4,439,305	SetDrawEnv linethick= 2,linefgc= (1,26214,0),fillpat= 0	DrawRect 159,319,245,369	SetDrawEnv linethick= 2,linebgc= (0,0,0),fillfgc= (65280,0,0),fillbgc= (65280,0,0)	DrawRect 9,270,141,369	SetDrawEnv linethick= 2,linebgc= (0,0,0),fillfgc= (51456,44032,58880),fillbgc= (51456,44032,58880)	DrawRect 10,5,140,264	SetDrawEnv linethick= 0,linefgc= (49163,65535,16385),linebgc= (49163,65535,32768),fillpat= 0	DrawRect 462,174,468,174	SetDrawEnv textrot= 180	SetDrawEnv save	SetDrawEnv fname= "Times New Roman",fsize= 18,fstyle= 1,textrot= 0	DrawText 22,28,"Raw data"	SetDrawEnv fname= "Times New Roman",fsize= 18,fstyle= 1,textrot= 0	DrawText 16,294,"MDC-EDC"	SetDrawEnv fname= "Times New Roman",fsize= 18,fstyle= 1,textrot= 0	DrawText 364,28,"Mapping"	SetDrawEnv linethick= 0,linefgc= (65535,65535,65535),fillpat= 0	DrawRect 318,38,325,38	DrawRect 202,154,206,154	SetDrawEnv linefgc= (65535,21845,0),fillpat= 0	DrawRect 252,319,363,369	SetDrawEnv fsize= 14,fstyle= 1,textrgb= (65535,21845,0),textrot= 0	DrawText 259,339,"Other Panel"	SetDrawEnv fsize= 14,fstyle= 1,textrgb= (1,26214,0),textrot= 0	DrawText 164,340,"NTP"	SetDrawEnv linethick= 2,linefgc= (65535,0,0),fillfgc= (65535,21845,0),fillbgc= (65535,21845,0)	DrawRect 203,129,269,154	SetDrawEnv linefgc= (1,12815,52428),fillfgc= (1,12815,52428),fillbgc= (1,12815,52428)	DrawRect 147,127,199,153	SetDrawEnv linethick= 0,linefgc= (65535,65535,65535),fillfgc= (52428,52425,1),fillbgc= (52428,52425,1)	DrawRect 147,222,438,304	SetDrawEnv fname= "Times New Roman",fsize= 14,textrot= 0	DrawText 27,244,"Channel spacing"	Button button14,pos={12,524},size={65,20},proc=ButtonProc_Constoffset,title="\\K(0,0,65535)ConstOff"	Button button14,fStyle=1	Button button100,pos={150,103},size={45,20},disable=1,proc=ButtonProc_CVT2EK,title="\\F'symbol'q\\F'arial' to k"	Button button101,pos={12,344},size={25,20},proc=ButtonProc_mdc_pi,title="M"	Button button101,labelBack=(65535,0,0)	Button button102,pos={39,344},size={30,20},proc=ButtonProc_plot_mdc_pi,title="Plot"	Button button102,labelBack=(65535,0,0)	Button button103,pos={96,321},size={40,20},proc=ButtonProc_mdcfit_pi,title="M fit"	Button button103,labelBack=(65535,0,0)	Button button104,pos={64,321},size={30,20},proc=ButtonProc_find_kf_pi,title="KF"	Button button104,labelBack=(65535,0,0)	Button button105,pos={12,296},size={25,20},proc=ButtonProc_edc_pi,title="E"	Button button105,labelBack=(65535,0,0)	Button button106,pos={39,296},size={30,20},proc=ButtonProc_plot_edc_pi,title="Plot"	Button button106,labelBack=(65535,0,0)	Button button107,pos={67,69},size={70,20},proc=ButtonProc_open_data_pi,title="Open data"	Button button_LoadAll,pos={15,69},size={45,20},proc=ButtonProc_Loaddata,title="Load"	Button button_LoadAll,fColor=(65535,65535,65535)	Button button_ConvertAllData,pos={18,188},size={115,20},proc=ButtonProc_ConvertAllData,title="Convert  All  Data"	Button button0,pos={276,130},size={80,20},proc=ButtonProc_MakeImagetable,title="Imagetable"	Button button_Generatecut,pos={196,103},size={72,20},disable=1,proc=ButtonProc_Makecutimage,title="Cut Image"	Button button_MakeCutTable,pos={357,130},size={70,20},proc=ButtonProc_MakeCutTable,title="Cut Table"	Button button_mat3d_pi,pos={149,35},size={70,20},disable=1,proc=ButtonProc_mat3d_pi,title="Mat3D"	Button button_mat3d_pi,labelBack=(0,0,0)	Button button1,pos={20,107},size={110,20},proc=ButtonProc_open_select,title="Open select"	Button button2,pos={18,127},size={65,20},proc=ButtonProc_Mkbad_slices,title="Bad slices"	Button button3,pos={18,168},size={115,20},proc=ButtonProc_dataploter,title="Data ploter"	Button button3,labelBack=(27085,28,1),fColor=(65535,21845,0)	Button button5,pos={220,35},size={60,20},disable=1,proc=ButtonProc_mat3dfsploter,title="-->Plot"	Button button5,labelBack=(0,0,0)	Button button6,pos={107,445},size={60,20},disable=1,proc=ButtonProc_combine_range,title="Cb range"	Button button7,pos={197,424},size={70,20},disable=1,proc=ButtonProc_comb_krange,title="Cb krange"	Button button8,pos={196,401},size={70,20},disable=1,proc=ButtonProc_combineall,title="Cb all"	Button button9,pos={149,180},size={100,20},proc=ButtonProc_normcut,title="Norm cut"	Button button11,pos={367,152},size={60,20},proc=ButtonProc_rescale_pi,title="Rescale"	Button button12,pos={22,420},size={75,20},disable=1,proc=ButtonProc_file2wave,title="File 2 wave"	Button button13,pos={102,420},size={80,20},disable=1,proc=ButtonProc_wave2file,title="Wave 2 file"	Button button15,pos={22,444},size={120,20},disable=1,proc=ButtonProc_wave2filenokill,title="Wave2file (no kill)"	Button button16,pos={301,466},size={60,20},disable=1,proc=ButtonProc_new_eres_pi,title="E-comb"	Button button17,pos={368,466},size={60,20},disable=1,proc=ButtonProc_new_kres_pi,title="M-comb"	Button button18,pos={67,468},size={52,20},disable=1,proc=ButtonProc_ln_mat_pi,title="Ln(mat)"	Button button19,pos={12,468},size={52,20},disable=1,proc=ButtonProc_mat_n_pi,title="(mat)^n"	Button button20,pos={95,490},size={60,20},disable=1,proc=ButtonProc_nan0,title="NaN to 0"	Button button21,pos={12,423},size={100,20},disable=1,proc=ButtonProc_derivmat,title="2nd derivative"	Button button21,fColor=(52428,52425,1)	Button button22,pos={357,36},size={50,20},disable=1,proc=ButtonProc_mat3dkfsploter,title="->Plot"	Button button22,labelBack=(0,0,0)	Button button23,pos={12,445},size={84,20},disable=1,proc=ButtonProc_rot2d_pi,title="Rotate image"	Button button24,pos={149,58},size={45,20},disable=1,proc=ButtonProc_mat3dVD_pi,title="3dVD"	Button button24,labelBack=(0,0,0)	Button button25,pos={285,59},size={70,20},disable=1,proc=ButtonProc_mat3dkVD_pi,title="Mat3dkVD"	Button button25,labelBack=(0,0,0)	Button button26,pos={357,59},size={50,20},disable=1,proc=ButtonProc_mat3dkVDfsploter,title="->Plot"	Button button26,labelBack=(0,0,0)	Button button45,pos={285,82},size={70,20},disable=1,proc=ButtonProc_mat3dkHD_pi,title="Mat3dkHD"	Button button45,labelBack=(0,0,0)	Button button46,pos={357,81},size={50,20},disable=1,proc=ButtonProc_mat3dkHDfsploter,title="->Plot"	Button button46,labelBack=(0,0,0)	Button button27,pos={285,36},size={70,20},disable=1,proc=ButtonProc_mat3dk_pi,title="Mat3dk"	Button button27,labelBack=(0,0,0)	Button button28,pos={276,152},size={90,20},proc=ButtonProc_renormcut_k,title="Renormcut_k"	Button button30,pos={221,58},size={60,20},disable=1,proc=ButtonProc_mat3dVDfsploter,title="-->Plot"	Button button30,labelBack=(0,0,0)	Button button44,pos={222,81},size={60,20},disable=1,proc=ButtonProc_mat3dHDfsploter,title="-->Plot"	Button button44,labelBack=(0,0,0)	Button button29,pos={148,230},size={80,20},proc=ButtonProc_making_fs,title="Making FS"	Button button29,fColor=(1,26214,0)	Button button31,pos={313,443},size={100,20},disable=1,proc=ButtonProc_new_step,title="New-stepsize"	Button button2001,pos={119,424},size={65,20},disable=1,proc=ButtonProc_zeronan,title="0 to NaN"	Button button32,pos={270,103},size={60,20},disable=1,proc=ButtonProc_allcuts,title="All cuts"	Button button34,pos={77,400},size={70,20},disable=1,proc=ButtonProc_normwave,title="Normwave"	Button button36,pos={136,400},size={55,20},disable=1,proc=ButtonProc_smoothmat_k,title="Smooth"	Button button37,pos={343,426},size={70,20},disable=1,proc=ButtonProc_give_area,title="Give area"	Button button38,pos={205,418},size={25,20},disable=1,proc=ButtonProc_finddispersion_min,title="V-"	Button button39,pos={233,418},size={25,20},disable=1,proc=ButtonProc_finddispersionHD_min,title="H-"	Button button40,pos={222,440},size={80,20},disable=1,proc=ButtonProc_showpntreader,title="Bands table"	Button button43,pos={121,468},size={80,20},disable=1,proc=ButtonProc_NaN0mat3d,title="NaN0mat3d"	Button for_image_fs,pos={149,253},size={80,20},proc=ButtonProc_image_fs,title="\\K(65535,65535,65535)Image FS"	Button for_image_fs,fColor=(27085,28,1)	Button for_copy_TB,pos={231,230},size={75,20},proc=ButtonProc_copy_circles,title="Copy TB"	Button for_append_TB,pos={231,253},size={75,20},proc=ButtonProc_append_circles,title="Append TB"	Button but_mat3dHD,pos={149,81},size={45,20},disable=1,proc=ButtonProc_mat3dHD_pi,title="3dHD"	Button but_mat3dHD,labelBack=(0,0,0)	Button but_rm_simpleedc,pos={30,493},size={50,20},disable=1,proc=ButtonProc_Rm_simplebgnd_edc,title="EDC"	Button but_rm_mat,pos={90,493},size={50,20},disable=1,proc=ButtonProc_Rm_simplebgnd_mat,title="Matrix"	Button but_sym_edc,pos={14,400},size={60,20},disable=1,proc=ButtonProc_sym_one_edc,title="Sym EDC"	Button but_sym_kfedc,pos={347,178},size={85,20},proc=ButtonProc_sym_kf_edcs,title="Sym kf EDCs"	PopupMenu Data_type,pos={18,49},size={115,20},bodyWidth=115,proc=PopMenuProc	PopupMenu Data_type,mode=1,popvalue="pxt",value= #"\"pxt;txt (Scienta);dat (Scienta); txt (A1)\""	Button button47NTP,pos={199,322},size={40,20},proc=ButtonProc_Table_Notthesepoints,title="Table"	SetVariable varNTP_num,pos={163,346},size={40,15},proc=setvarNTP_num,title=" "	SetVariable varNTP_num,limits={0,1,1},value= NTP_num	Button Add_NTP_wave,pos={204,345},size={35,20},proc=ButtonProc_add_NTP	PopupMenu popup0,pos={208,131},size={58,20},proc=PopMenuProc_3	PopupMenu popup0,mode=2,popvalue="V slit",value= #"\"H slit;V slit\""	Button button_copy_traces,pos={150,400},size={100,20},disable=1,proc=ButtonProc_Copytraces,title="Copy all traces"	Button buttonGet_ledge_kf,pos={308,253},size={110,20},proc=ButtonProc_Get_ledge_kf,title="Leading Edge KF"	Button buttonSlicer,pos={148,131},size={50,20},proc=ButtonProc_openmat3dslicer,title="Slicer"	Button buttonSlicer,labelBack=(1,3,39321),fSize=14,fStyle=1	Button buttonSlicer,fColor=(65535,16385,55749)	Button buttonpntreader,pos={257,341},size={85,20},proc=ButtonProc_showpntreader,title="Point reader"	Button buttonpntreader,fStyle=16	Button buttonpredictcuts,pos={264,178},size={80,20},proc=ButtonProc_predict_cuts,title="Predict cuts"	Button buttonDOSatkf,pos={308,230},size={100,20},proc=ButtonProc_DOS_kf,title="DOS at KF vs \\F'symbol'q"	Button buttonfftlist,pos={85,127},size={50,20},proc=ButtonProc_FFTlist,title="FFT list"	TabControl tab_matrices,pos={9,370},size={431,179},proc=TabProc_main	TabControl tab_matrices,labelBack=(16385,49025,65535),font="Geneva",fSize=11	TabControl tab_matrices,fStyle=16,tabLabel(0)="Matrices",tabLabel(1)="Traces"	TabControl tab_matrices,tabLabel(2)="Pres. 1",tabLabel(3)="2"	TabControl tab_matrices,tabLabel(4)="Miscellaneous",value= 2	GroupBox groupstepsize,pos={294,425},size={140,70},disable=1,title="Change Stepsize"	GroupBox groupstepsize,fSize=12,fStyle=1,fColor=(0,9472,39168)	GroupBox groupsaveload,pos={14,400},size={180,70},disable=1,title="Save and load"	GroupBox groupsaveload,fSize=12,fStyle=1,fColor=(52428,1,1)	GroupBox groupfinddispersion,pos={200,399},size={134,66},disable=1,title="Find Dispersion"	GroupBox groupfinddispersion,fSize=12,fStyle=1,fColor=(1,26214,0)	GroupBox groupRmback,pos={14,475},size={140,45},disable=1,title="Rm linear bkgnd"	GroupBox groupRmback,fSize=12,fStyle=1,fColor=(0,17409,26214)	Button buttonefedc,pos={82,517},size={90,20},proc=ButtonProc_put_fermi_edc,title="EF line (EDC)"	Button buttonEFimage,pos={176,517},size={100,20},proc=ButtonProc_put_fermi_image,title="EF line (image)"	Button coloredcnow,pos={181,410},size={70,20},proc=ButtonProc_color_edc,title="Color now"	PopupMenu inversecoloredc,pos={255,410},size={71,20},proc=PopMenuProc_2	PopupMenu inversecoloredc,mode=1,popvalue="Normal",value= #"\"Normal;Inverse\""	PopupMenu edccolorset,pos={181,435},size={200,20},proc=PopMenuProc_1	PopupMenu edccolorset,mode=40,value= #"\"*COLORTABLEPOP*\""	GroupBox grouplotoftraces,pos={176,391},size={210,70},title="Group of traces"	GroupBox grouplotoftraces,fSize=12,fStyle=1,fColor=(65535,65535,65535)	Button buttonintbe,pos={18,411},size={70,20},proc=ButtonProc_legend_int_vs_BE,title="Int. \\f02vs\\f00 BE"	Button buttonintke,pos={98,410},size={70,20},proc=ButtonProc_legend_int_vs_KE,title="Int. \\f02vs\\f00 KE"	Button buttonbeangle,pos={113,434},size={55,22},proc=ButtonProc_legend_BE_vs_angle,title="BE \\f02vs\\f00 \\F'symbol'q"	Button buttonKEangle,pos={114,462},size={55,20},proc=ButtonProc_legend_KE_vs_angle,title="KE \\f02vs\\f00 \\F'symbol'q"	Button buttonBEvsmom_pi,pos={18,434},size={90,22},proc=ButtonProc_legendBEvsmompia,title="BE \\f02vs\\f00 k (\\F'symbol'p\\F'Geneva'/a)"	Button buttonBEvsmom_pi1,pos={19,459},size={90,25},proc=ButtonProc_legendBEvsmomang,title="BE \\f02vs\\f00 k (\\S-1\\M)"	GroupBox grouplegend,pos={13,393},size={160,120},title="Axis legend",fSize=12	GroupBox grouplegend,fStyle=1,fColor=(26411,1,52428)	PopupMenu mirror_onoff,pos={179,467},size={87,20},proc=PopMenuProc_mirroronoff	PopupMenu mirror_onoff,mode=2,popvalue="Mirror ON",value= #"\"Mirror OFF;Mirror ON\""	PopupMenu popupthicks_inout,pos={180,491},size={98,20},proc=PopMenuProc_6	PopupMenu popupthicks_inout,mode=1,popvalue="Ticks inside",value= #"\"Ticks inside;Ticks outside\""	TabControl tab4vs6,pos={147,200},size={288,22},proc=Tab4vs6	TabControl tab4vs6,labelBack=(52428,52425,1),fSize=9,fStyle=16	TabControl tab4vs6,tabLabel(0)="2fold",tabLabel(1)="4fold",tabLabel(2)="6fold"	TabControl tab4vs6,value= 1	Button button33,pos={148,230},size={80,20},disable=1,proc=ButtonProc_making_fsH,title="Making FS"	Button button33,fColor=(1,26214,0)	Button button35,pos={148,230},size={80,20},disable=1,proc=ButtonProc_making_fs2f,title="Making FS"	Button button35,fColor=(1,26214,0)	Button for_copy_TB2f,pos={231,230},size={75,20},disable=1,proc=ButtonProc_copy_circles2f,title="Copy TB"	Button for_image_fs2f,pos={149,253},size={80,20},disable=1,proc=ButtonProc_image_fs2f,title="\\K(65535,65535,65535)Image FS"	Button for_image_fs2f,fColor=(27085,28,1)	Button for_image_fsH,pos={149,253},size={80,20},disable=1,proc=ButtonProc_image_fsHEX,title="\\K(65535,65535,65535)Image FS"	Button for_image_fsH,fColor=(27085,28,1)	Button button41,pos={12,490},size={80,20},disable=1,proc=ButtonProc_normcut,title="Norm matrix"	Button button42,pos={157,490},size={55,20},disable=1,proc=ButtonProc_get_fermi_profile,title="Fermi P"	Button button47,pos={253,400},size={50,20},disable=1,proc=ButtonProc_rot_vector,title="Rotate"	Button button48,pos={209,513},size={125,20},disable=1,proc=ButtonProc_sym_edc_matrix,title="Symetrize EDC mat"	Button button49,pos={305,400},size={90,20},disable=1,proc=ButtonProc_dividewavebyfermi,title="Divide by FD"	Button button50,pos={13,513},size={85,20},disable=1,proc=ButtonProc_dividematrixbyfermi,title="Divide by FD"	Button button51,pos={102,513},size={50,20},disable=1,proc=ButtonProc_keep_positive,title="Keep +"	Button button52,pos={155,513},size={50,20},disable=1,proc=ButtonProc_keep_negative,title="Keep -"	Button button53,pos={93,147},size={40,20},proc=ButtonProc_makeadd_data_table,title="Table"	Button button54,pos={19,147},size={70,20},proc=ButtonProc_add_data,title="Cmb. data"	Button button55,pos={268,418},size={25,20},disable=1,proc=ButtonProc_finddispersion_plus,title="V+"	Button button56,pos={296,418},size={25,20},disable=1,proc=ButtonProc_finddispersionHDplus,title="H+"	Button button57,pos={348,200},size={85,20},proc=ButtonProc_plot_kf_edcs,title="Plot kf EDCs"	Button button58,pos={14,424},size={135,20},disable=1,proc=ButtonProc_openbkgndremover,title="\\K(65535,0,0)Background remover"	Button button59,pos={153,424},size={115,20},disable=1,proc=ButtonProc_trans2equiv_waves,title="Equivalent waves"	SetVariable setvarspacing,pos={18,246},size={115,15},title=" "	SetVariable setvarspacing,labelBack=(51664,44236,58982),value= global_cspacing	SetVariable setvarsmfactor,pos={14,211},size={125,18},title="Smooth factor"	SetVariable setvarsmfactor,labelBack=(51664,44236,58982),fSize=11	SetVariable setvarsmfactor,value= smoothfactor	Button buttonini,pos={17,29},size={115,20},proc=ButtonProc_mainpanelinitalize,title="\\K(65535,65535,65535)Initialize"	Button buttonini,fSize=15,fStyle=1,fColor=(39321,1,1)	Button buttonhelpraw,pos={108,9},size={25,20},proc=Button_Help_raw_data,title="\\K(65535,65535,65535)?"	Button buttonhelpraw,labelBack=(44253,29492,58982),fSize=14,fStyle=16	Button buttonhelpraw,fColor=(16385,16388,65535)	Button buttonhelpraw1,pos={111,273},size={25,20},proc=Button_Help_MDC_EDC,title="\\K(65535,65535,65535)?"	Button buttonhelpraw1,labelBack=(65535,0,0),fSize=14,fStyle=16	Button buttonhelpraw1,fColor=(16385,16388,65535)	Button buttonhelptools,pos={410,314},size={25,20},proc=Button_Help_Tools,title="\\K(65535,65535,65535)?"	Button buttonhelptools,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button buttonhelptools1,pos={408,397},size={25,20},disable=1,proc=Button_Help_tab_matrices,title="\\K(65535,65535,65535)?"	Button buttonhelptools1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button buttonhelptools2,pos={408,397},size={25,20},disable=1,proc=Button_help_tab_traces,title="\\K(65535,65535,65535)?"	Button buttonhelptools2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button buttonhelptools3,pos={408,397},size={25,20},proc=Button_Help_tab_presentation,title="\\K(65535,65535,65535)?"	Button buttonhelptools3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button buttonhelptools4,pos={408,397},size={25,20},disable=1,proc=Button_Help_tab_Misc,title="\\K(65535,65535,65535)?"	Button buttonhelptools4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={313,399},size={75,20},disable=1,proc=ButtonProc_trans2equiv_mat,title="Equiv. mat"	Button button10,pos={187,489},size={30,20},disable=1,proc=ButtonProc_FlipRGBimage,title="Flip"	Button button60,pos={219,489},size={80,20},disable=1,proc=ButtonProc_RGBimagetoRGB,title="Image2RGB"	Button button61,pos={188,511},size={55,20},disable=1,proc=ButtonProc_RGBimagetoIntensity,title="\\K(65535,0,0)RGB2Int"	GroupBox groupimage,pos={183,473},size={120,62},disable=1,title="RGB image"	GroupBox groupimage,fSize=12,fStyle=1,fColor=(26411,1,52428)	Button button62,pos={12,321},size={50,20},proc=ButtonProc_EMDC,title="EMDC"	TabControl mat3d_tab,pos={146,10},size={287,117},proc=Tab_convert	TabControl mat3d_tab,labelBack=(1,16019,65535),fStyle=16,tabLabel(0)="Old"	TabControl mat3d_tab,tabLabel(1)="New",tabLabel(2)="hv",tabLabel(3)="List"	TabControl mat3d_tab,value= 2	Button button63,pos={285,36},size={70,20},disable=1,proc=ButtonProc_make_mat3dk,title="Mat3dk"	Button button63,labelBack=(0,0,0)	Button button64,pos={285,59},size={70,20},disable=1,proc=ButtonProc_make_mat3dkVD,title="Mat3dkVD"	Button button64,labelBack=(0,0,0)	Button button65,pos={285,82},size={70,20},disable=1,proc=ButtonProc_make_mat3dkHD,title="Mat3dkHD"	Button button65,labelBack=(0,0,0)	Button button66,pos={151,35},size={75,20},disable=1,proc=ButtonProc_Make_onechunkcut,title="1chunkcut"	Button button67,pos={228,35},size={55,20},disable=1,proc=ButtonProc_Make_allchunkcuts,title="All Ckts"	Button button68,pos={151,57},size={50,20},disable=1,proc=ButtonProc_Generate_chunklist,title="Mk List"	Button button69,pos={152,79},size={50,20},disable=1,proc=ButtonProc_deriv_1chunkcut,title="Deriv1"	Button button70,pos={203,79},size={55,20},disable=1,proc=ButtonProc_deriv_allchunkcut,title="Deriv all"	Button button71,pos={280,103},size={100,20},disable=1,proc=ButtonProc_angmodeconverterfs,title="Angle Cvter \\K(65535,0,0)FS"	Button button72,pos={337,512},size={70,20},disable=1,proc=ButtonProc_shiftNsym,title="ShiftNsym"	Button button108,pos={150,103},size={30,20},disable=1,proc=ButtonProc_CVT2EK_exact1cut,title="\\F'symbol'q\\F'arial'2k"	Button button73,pos={148,157},size={120,20},proc=ButtonWindow_movie_maker,title="\\K(0,0,65535)Jon's Movie Maker"	Button button73,fColor=(18234,38317,37260)	Button button74,pos={19,409},size={55,20},disable=1,proc=ButtonProc_Capturename,title="Capture"	SetVariable setvargrnum,pos={81,412},size={45,15},disable=1,title="#"	SetVariable setvargrnum,labelBack=(16385,49025,65535)	SetVariable setvargrnum,limits={0,inf,1},value= topgraphnum	Slider topimagetop,pos={18,436},size={375,16},disable=1,proc=SliderProc_topmax	Slider topimagetop,fSize=6	Slider topimagetop,limits={-2,3,0.01},variable= topimagemaxratio,vert= 0,ticks= 0	Slider topimagebot,pos={18,452},size={375,41},disable=1,proc=SliderProc_topmin	Slider topimagebot,fSize=8	Slider topimagebot,limits={-2,3,0.01},variable= topimageminratio,side= 2,vert= 0,ticks= 4	Button button_a_up,pos={396,432},size={15,20},disable=1,proc=Button_image_auto_up,title="A"	Button button_a_down,pos={396,476},size={15,20},disable=1,proc=Button_image_auto_down,title="A"	Button button_0_up,pos={417,432},size={15,20},disable=1,proc=Button_image_0_up,title="0"	Button button_0_down,pos={417,476},size={15,20},disable=1,proc=Button_image_0_down,title="0"	Button button_a_both,pos={396,454},size={35,20},disable=1,proc=Button_image_auto_both,title="Auto"	Button button_a_both,labelBack=(52428,17472,1),fStyle=0,fColor=(52428,17472,1)	PopupMenu popupmatcolor,pos={133,409},size={200,20},disable=1,proc=PopMenuProc_colormat	PopupMenu popupmatcolor,mode=8,value= #"\"*COLORTABLEPOP*\""	PopupMenu popupinvmatcolor,pos={339,409},size={69,20},disable=1,proc=PopMenuProc_colormatinv	PopupMenu popupinvmatcolor,mode=1,popvalue="Normal",value= #"\"Normal;Inverse\""	GroupBox Matcolorscalegroup,pos={14,392},size={422,110},disable=1,title="Matrix color scale"	GroupBox Matcolorscalegroup,fSize=12,fStyle=1,fColor=(1,3,39321)	Button button75,pos={151,35},size={55,20},proc=ButtonProc_make_table_hv_kz,title="Table"	Button button76,pos={151,58},size={55,20},proc=ButtonProc_CVT2K_vs_hv,title="Map hv"	Button button77,pos={151,81},size={55,20},proc=ButtonProc_CVT2K_vs_kz,title="Map kz"	Button button78,pos={210,59},size={74,20},proc=ButtonDuplicate_hvmat3d,title="-->mat3d"	Button button79,pos={209,81},size={75,20},proc=ButtonDuplicate_kzmat3d,title="-->mat3d"	Button button80,pos={313,59},size={30,20},proc=ButtonProc_mat3dVD_pi,title="VD"	Button button80,labelBack=(0,0,0)	Button button81,pos={367,35},size={60,20},proc=ButtonProc_mat3dfsploter,title="-->Plot"	Button button81,labelBack=(0,0,0)	Button button82,pos={367,59},size={60,20},proc=ButtonProc_mat3dVDfsploter,title="-->Plot"	Button button82,labelBack=(0,0,0)	Button button83,pos={313,81},size={30,20},proc=ButtonProc_mat3dHD_pi,title="HD"	Button button83,labelBack=(0,0,0)	Button button84,pos={367,81},size={60,20},proc=ButtonProc_mat3dHDfsploter,title="-->Plot"	Button button84,labelBack=(0,0,0)	Button button85,pos={408,36},size={20,20},disable=1,proc=ButtonProc_mat3dkrot,title="\\K(65535,0,0)Q"	Button button85,font="Wingdings 3",fStyle=0,fColor=(32792,65535,1)	Button button86,pos={408,59},size={20,20},disable=1,proc=ButtonProc_mat3dkVDrot,title="\\K(65535,0,0)Q"	Button button86,font="Wingdings 3",fStyle=0,fColor=(32792,65535,1)	Button button87,pos={408,81},size={20,20},disable=1,proc=ButtonProc_mat3dkHDrot,title="\\K(65535,0,0)Q"	Button button87,font="Wingdings 3",fStyle=0,fColor=(32792,65535,1)	Button button88,pos={382,103},size={45,20},proc=ButtonProcInterp3D,title="Interp"	Button button89,pos={202,468},size={90,20},disable=1,proc=ButtonProcCutNaNedges,title="CutNaNedges"	Button button90,pos={277,467},size={60,20},proc=Button_set_auto_axis,title="A axises"	Button button91,pos={217,490},size={55,20},disable=1,proc=Button_adjust_to_fp,title="Fix FP 1"	Button button92,pos={279,489},size={25,20},disable=1,proc=Button_adjust_all_to_fp,title="All"	Button button93,pos={13,400},size={120,20},disable=1,proc=ButtonProc_curv_Zhang,title="\\K(65535,65535,65535)Peng's Curvature"	Button button93,fSize=14,fColor=(13107,0,5243)	Button button94,pos={16,521},size={95,20},disable=1,proc=ButtonProc_findEres,title="\\K(65535,65535,65535)E-Resolution"	Button button94,labelBack=(65535,65535,65535),fStyle=1,fColor=(13112,0,26214)	Button button95,pos={342,456},size={70,20},disable=1,proc=ButtonProcAVG_tool,title="\\K(65535,65535,0)AVG_tool"	Button button95,fStyle=1,fColor=(0,0,65535)	Button button96,pos={190,35},size={25,20},disable=1,proc=ButtonProc_Makenewmap,title="\\K(1,26214,0)As"	Button button96,fStyle=16	Button button97,pos={216,35},size={55,20},disable=1,proc=ButtonProc_selectlistmap,title="\\K(65535,0,0)Choose"	Button button97,fStyle=16	ValDisplay valdisp0,pos={273,36},size={155,16},disable=1,fSize=11	ValDisplay valdisp0,format="mapGX48",limits={0,0,0},barmisc={0,1000},value= #"0"	ValDisplay valdisp1,pos={152,57},size={275,14},disable=1	ValDisplay valdisp1,format="Mapping along GX at 48 eV"	ValDisplay valdisp1,limits={0,0,0},barmisc={0,1000},value= #"0"	Button button98,pos={153,35},size={35,20},disable=1,proc=ButtonProc_copymapactive,title="\\K(1,26214,0)Save"	Button button98,fStyle=16	CheckBox check0,pos={267,74},size={53,14},disable=1,proc=CheckProcMat3d,title="Mat3d"	CheckBox check0,fSize=10,fStyle=1,variable= Mat3dcopy	CheckBox check1,pos={267,90},size={68,14},disable=1,proc=CheckProcMat3dVD,title="Mat3dVD"	CheckBox check1,fSize=10,fStyle=1,variable= Mat3dVDcopy	CheckBox check2,pos={267,105},size={69,14},disable=1,proc=CheckProcMat3dHD,title="Mat3dHD"	CheckBox check2,fSize=10,fStyle=1,variable= Mat3dHDcopy	CheckBox check3,pos={347,74},size={60,14},disable=1,proc=CheckProcMat3dk,title="Mat3dk"	CheckBox check3,fSize=10,fStyle=1,variable= Mat3dkcopy	CheckBox check4,pos={347,90},size={75,14},disable=1,proc=CheckProcMat3dkVD,title="Mat3dkVD"	CheckBox check4,fSize=10,fStyle=1,variable= Mat3dkVDcopy	CheckBox check5,pos={347,107},size={76,14},disable=1,proc=CheckProcMat3dkHD,title="Mat3dkHD"	CheckBox check5,fSize=10,fStyle=1,variable= Mat3dkHDcopy	Button button99,pos={150,79},size={55,20},disable=1,proc=ButtonProc_Save3D,title="\\K(1,26214,0)Save3D"	Button button99,fStyle=16	Button button109,pos={208,79},size={55,20},disable=1,proc=ButtonProc_Load3D,title="\\K(65535,0,0)Load3D"	Button button109,fStyle=16	Button button110,pos={153,101},size={40,20},disable=1,proc=ButtonProc,title="Table"	Button button111,pos={151,102},size={55,20},proc=ButtonProc_symmat3dhv,title="Sym hv"	Button button112,pos={199,58},size={20,20},disable=1,proc=ButtonProc_mat3dVC_pi,title="\\K(65535,0,0)C"	Button button112,labelBack=(0,0,0)	Button button113,pos={199,81},size={20,20},disable=1,proc=ButtonProc_mat3dHC_pi,title="\\K(65535,0,0)C"	Button button113,labelBack=(0,0,0)	Button button114,pos={345,59},size={20,20},proc=ButtonProc_mat3dVC_pi,title="\\K(65535,0,0)C"	Button button114,labelBack=(0,0,0)	Button button115,pos={345,81},size={20,20},proc=ButtonProc_mat3dHC_pi,title="\\K(65535,0,0)C"	Button button115,labelBack=(0,0,0)	PopupMenu colordefault_menu,pos={53,509},size={282,20},disable=1,proc=PopMenuProc_colordefault,title="Default color"	PopupMenu colordefault_menu,font="Times New Roman",fSize=14,fStyle=1	PopupMenu colordefault_menu,mode=1,value= #"\"*COLORTABLEPOP*\""	PopupMenu popup_colordefault_inv,pos={341,509},size={69,20},disable=1,proc=PopMenuProc_colordefaultinv	PopupMenu popup_colordefault_inv,mode=1,popvalue="Normal",value= #"\"Normal;Inverse\""	Button button116,pos={71,296},size={30,20},proc=Button_plot_all_edc_pi,title="All"	Button button116,labelBack=(65535,0,0)	Button button117,pos={71,344},size={30,20},proc=Button_plot_all_mdc_pi,title="All"	Button button117,labelBack=(65535,0,0)	Button buttonBEvshv,pos={18,488},size={60,22},proc=ButtonProc_legendBEvshv,title="BE \\f02vs\\f00 h\\F'symbol'n"	Button button00,pos={298,199},size={50,20},proc=ButtonProc_setscale_zlk,title="setscale"	Button button00,font="»ªÎÄ¿¬Ìå",fSize=14,fStyle=1,fColor=(0,26214,13293)	Button button01,pos={13,89},size={67,16},proc=ButtonProc_Roughmapping_zlk,title="roughmap"	Button button01,fSize=12,fStyle=1,fColor=(0,26214,13293)	Button button02,pos={151,278},size={75,20},proc=ButtonProc_appendcalculation,title="appendLDA"	Button button02,fSize=12,fStyle=1,fColor=(0,26214,13293)	Button button03,pos={232,281},size={61,16},proc=ButtonProc_Figformat,title="Figformat"	Button button03,fSize=12,fStyle=1,fColor=(0,26214,13293)	Button button04,pos={296,281},size={61,16},proc=ButtonProc_MDCfig,title="MDCfig"	Button button04,fSize=12,fStyle=1,fColor=(0,26214,13293)	Button button05,pos={361,272},size={61,16},proc=ButtonProc_auto,title="autowind"	Button button05,fSize=12,fStyle=1,fColor=(0,26214,13293)	Button button06,pos={361,288},size={61,16},proc=ButtonProc_merge,title="Merge"	Button button06,fSize=12,fStyle=1,fColor=(0,26214,13293)	Button button07,pos={340,372},size={61,16},proc=ButtonProc_layout,title="Layout"	Button button07,fSize=12,fStyle=1,fColor=(0,26214,13293)EndMacro//**********************************************************************************************************************Function ButtonProc_PReader_edit_mode(ctrlName) : ButtonControl	String ctrlName	Execute "PReader_switch_edit_mode()"End//**********************************************************************************************************************Function ButtonProc_PReader_normal_mode(ctrlName) : ButtonControl	String ctrlName	Execute "PReader_normal_mode()"End//**********************************************************************************************************************Function ButtonProc_PReader_draw_live(ctrlName) : ButtonControl	String ctrlName	Execute "PReader_draw_live()"End//**********************************************************************************************************************Function Button_selectlistbkgndremover(ctrlName) : ButtonControl	String ctrlName	Execute "selectlistbkgndremover1()"End//**********************************************************************************************************************Function Button_list4bkgndremoveral(ctrlName) : ButtonControl	String ctrlName	Execute "list4bkgndremoveral1()"End//**********************************************************************************************************************Function Button_wave4bkgndremoval(ctrlName) : ButtonControl	String ctrlName	Execute "wave4bkgndremoval()"End//**********************************************************************************************************************Function Button_createresultremovedbkgnd(ctrlName) : ButtonControl	String ctrlName	Execute "createresultremovedbkgnd()"End//**********************************************************************************************************************Function Button_createbkgndremovedbkgnd(ctrlName) : ButtonControl	String ctrlName	Execute "createbkgndremovedbkgnd()"End//**********************************************************************************************************************Function ButtonProc_closethiswindow(ctrlName) : ButtonControl	String ctrlName	Dowindow/C win2close	Dowindow/K win2closeEnd//**********************************************************************************************************************Function ButtonProc_openbkgndremover(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("background_remover")==1)		Dowindow/F background_remover		Else			Make/O/N=(2,2) blank_bkgndremover			blank_bkgndremover[][]=NaN			Execute "background_remover()"	EndifEnd//**********************************************************************************************************************Function ButtonProc_wave2bkgndremoved(ctrlName) : ButtonControl	String ctrlName	Execute "wave2bkgndremoved()"End//**********************************************************************************************************************Function ButtonProc_addpntbkgndremover(ctrlName) : ButtonControl	String ctrlName	Execute "addpntbkgndremover()"End//**********************************************************************************************************************Function ButtonProc_delpntbkgndremover(ctrlName) : ButtonControl	String ctrlName	Execute "delpntbkgndremover()"End//**********************************************************************************************************************Function Button_adjust_to_fp(ctrlName) : ButtonControl	String ctrlName	Execute "adjust_to_fp()"End//**********************************************************************************************************************Function Button_adjust_all_to_fp(ctrlName) : ButtonControl	String ctrlName	Execute "adjust_all_to_fp()"End//**********************************************************************************************************************Function PopMenuProc(ctrlName,popNum,popStr) : PopupMenuControl   //type of data menu	String ctrlName	Variable popNum	String popStr	Variable/G typeofdata	typeofdata=popNum	print popStrEndFunction PopMenuProc_2(ctrlName,popNum,popStr) : PopupMenuControl  //inverse the color	String ctrlName	Variable popNum	String popStr	Variable/G colorinverseedc	colorinverseedc=popNumEndFunction PopMenuProc_1(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G colorsetedc	colorsetedc=popNumEndFunction ButtonProc_showpntreader(ctrlName) : ButtonControl	String ctrlName	if(Wintype("Point_Reader")==7)		Dowindow/F Point_reader		Else			Execute "Point_reader()"	EndifEndFunction ButtonFFTfilterdata(ctrlName) : ButtonControl	String ctrlName	If(Waveexists(FFTfilterlist)==1)		Execute "FFTfilterdata()"	EndifEndFunction ButtonProc_showpresentation(ctrlName) : ButtonControl	String ctrlName	if(Wintype("Presentation_Panel")==7)		Dowindow/F Presentation_Panel		Else			Execute "Presentation_Panel()"	EndifEndFunction ButtonProc_showmain(ctrlName) : ButtonControl	String ctrlName	if(Wintype("Data_Analysis_BNL")==7)		Dowindow/F Data_Analysis_BNL		Else			Execute "Data_Analysis_BNL()"	EndifEndFunction ButtonProc_FlipRGBimage(ctrlName) : ButtonControl	String ctrlName	Execute "Flip_digimage()"EndFunction ButtonProc_RGBimagetoRGB(ctrlName) : ButtonControl	String ctrlName	Execute "color_digimage()"EndFunction ButtonProc_RGBimagetoIntensity(ctrlName) : ButtonControl	String ctrlName	Execute "Intensity_digimage()"EndFunction ButtonProc_tableallbands(ctrlName) : ButtonControl	String ctrlName	if(Wintype("Table_allbands")==2)		Dowindow/F Table_allbands		Else			Print "Press New band first"	EndifEndFunction ButtonProc_tableafs(ctrlName) : ButtonControl	String ctrlName	if(Wintype("Table_making_fs")==2)		Dowindow/F Table_making_fs		Else			Print "Create table firstt"	EndifEndFunction ButtonProc_backtomain(ctrlName) : ButtonControl	String ctrlName	if(Wintype("Data_Analysis")==7)		Dowindow/F Data_Analysis_BNL		Else			Execute "Data_Analysis_BNL()"	EndifEndFunction ButtonProc_mainpanelinitalize(ctrlName) : ButtonControl	String ctrlName	Execute "mainpanelinitalize()"EndFunction ButtonProc_Copytraces(ctrlName) : ButtonControl	String ctrlName	Execute "Copytraces()"EndFunction ButtonProc_color_edc(ctrlName) : ButtonControl	String ctrlName	Execute "color_edc()"EndFunction ButtonProc_Table_Notthesepoints(ctrlName) : ButtonControl	String ctrlName	Execute "Table_Notthesepoints()"EndFunction ButtonProc_add_NTP(ctrlName) : ButtonControl	String ctrlName	Execute "increase_NTP_num_max()"EndFunction ButtonProc_not_in_fct(ctrlName) : ButtonControl	String ctrlName	Execute "not_in_fct()"EndFunction ButtonProc_bluetored(ctrlName) : ButtonControl	String ctrlName	Execute "bluetored()"EndFunction ButtonProc_CVT2EK_exact1cut(ctrlName) : ButtonControl	String ctrlName	Execute "CVT2EK_exact1cut()"EndFunction ButtonProc_Capturename(ctrlName) : ButtonControl	String ctrlName	Execute "Capturename()"EndFunction ButtonProc_NaN0mat3d(ctrlName) : ButtonControl	String ctrlName	Execute "NaN0mat3d()"EndFunction ButtonProc_Remove_data_EDC(ctrlName) : ButtonControl	String ctrlName	Execute "Remove_data_EDC()"EndFunction ButtonProc_put_fermi_edc(ctrlName) : ButtonControl	String ctrlName	Execute "put_fermi_edc()"EndFunction ButtonProc_put_fermi_image(ctrlName) : ButtonControl	String ctrlName	Execute "put_fermi_image()"EndFunction ButtonProc_finddispersion_min(ctrlName) : ButtonControl	String ctrlName	Execute "finddispersion_min()"EndFunction ButtonProc_finddispersionHD_min(ctrlName) : ButtonControl	String ctrlName	Execute "finddispersionHD_min()"EndFunction ButtonProc_finddispersion_plus(ctrlName) : ButtonControl	String ctrlName	Execute "finddispersion_plus()"EndFunction ButtonProc_finddispersionHDplus(ctrlName) : ButtonControl	String ctrlName	Execute "finddispersionHD_plus()"EndFunction ButtonProc_smoothmat_k(ctrlName) : ButtonControl	String ctrlName	Execute "smoothmat_k()"EndFunction ButtonProc_sym_kf_edcs(ctrlName) : ButtonControl	String ctrlName	Execute "sym_kf_edcs()"EndFunction ButtonProc_plot_kf_edcs(ctrlName) : ButtonControl	String ctrlName	Execute "plot_kf_edcs()"EndFunction ButtonProc_give_area(ctrlName) : ButtonControl	String ctrlName	Execute "give_area()"EndFunction ButtonProc_trans2equiv_waves(ctrlName) : ButtonControl	String ctrlName	Execute "transform2equiv_waves()"EndFunction ButtonProc_trans2equiv_mat(ctrlName) : ButtonControl	String ctrlName	Execute "transform2equiv_mat()"EndFunction ButtonProc_allcuts(ctrlName) : ButtonControl	String ctrlName	Execute "allcuts()"EndFunction ButtonProc_sym_one_edc(ctrlName) : ButtonControl	String ctrlName	Execute "sym_one_edc()"EndFunction ButtonProc_get_fermi_profile(ctrlName) : ButtonControl	String ctrlName	Execute "get_fermi_profile()"EndFunction ButtonProc_Rm_simplebgnd_edc(ctrlName) : ButtonControl	String ctrlName	Execute "Remove_simplebgnd_edc()"EndFunction ButtonProc_Rm_simplebgnd_data(ctrlName) : ButtonControl	String ctrlName	Execute "Remove_simplebgnd_data()"EndFunction ButtonProc_Rm_simplebgnd_mat(ctrlName) : ButtonControl	String ctrlName	Execute "Remove_simplebgnd_mat()"EndFunction ButtonProc_dataploter(ctrlName) : ButtonControl	String ctrlName	If(wintype("dataploter")==0)		Execute "dataploter()"		Else			DoWindow/F dataploter	Endif	EndFunction ButtonProc_mat3dfsploter(ctrlName) : ButtonControl	String ctrlName	if(Wintype("mat3d_fs_ploter")==0)		Execute "initmat3d()"			Execute "mat3d_fs_ploter()"			Execute "initmat3d()"		Execute "ini1Raman4_3D()"		Execute "Raman4_3Dspectra_plotter()"		Execute "ini2Raman4_3D()"				Dowindow/F mat3d_fs_ploter			Else			Dowindow/F Raman4_3Dspectra_plotter			Dowindow/F mat3d_fs_ploter	Endif	EndFunction ButtonProc_mat3dVDfsploter(ctrlName) : ButtonControl	String ctrlName	if(Wintype("mat3dVD_fs_ploter")==0)		Execute "initmat3dVD()"			Execute "mat3dVD_fs_ploter()"			Execute "initmat3dVD()"			Else			Dowindow/F mat3dVD_fs_ploter	Endif					EndFunction ButtonProc_mat3dHDfsploter(ctrlName) : ButtonControl	String ctrlName	if(Wintype("mat3dHD_fs_ploter")==0)		Execute "initmat3dHD()"			Execute "mat3dHD_fs_ploter()"			Execute "initmat3dHD()"			Else			Dowindow/F mat3dHD_fs_ploter	Endif					EndFunction ButtonProc_mat3dkfsploter(ctrlName) : ButtonControl	String ctrlName	if(Wintype("mat3dk_fs_ploter")==0)		Execute "initmat3dk()"			Execute "mat3dk_fs_ploter()"		Execute "initmat3dk()"			Else			Dowindow/F mat3dk_fs_ploter	Endif				EndFunction ButtonProc_mat3dkVDfsploter(ctrlName) : ButtonControl	String ctrlName	if(Wintype("mat3dkVD_fs_ploter")==0)		Execute "initmat3dkVD()"			Execute "mat3dkVD_fs_ploter()"		Execute "initmat3dk()"			Else			Dowindow/F mat3dkVD_fs_ploter	Endif				EndFunction ButtonProc_mat3dkHDfsploter(ctrlName) : ButtonControl	String ctrlName	if(Wintype("mat3dkHD_fs_ploter")==0)		Execute "initmat3dkHD()"			Execute "mat3dkHD_fs_ploter()"		Execute "initmat3dkHD()"				Else			Dowindow/F mat3dkHD_fs_ploter	Endif			EndFunction ButtonProc_plot_vb_pi(ctrlName) : ButtonControl	String ctrlName	Execute "plot_vb_pi()"EndFunction ButtonProc_norm_range(ctrlName) : ButtonControl	String ctrlName	Execute "norm_range()"EndFunction ButtonProc_rot2d_pi(ctrlName) : ButtonControl	String ctrlName	Execute "rot2d_pi()"EndFunction ButtonProc_combine_range(ctrlName) : ButtonControl	String ctrlName	Execute "combine_range()"EndFunction ButtonProc_shiftNsym(ctrlName) : ButtonControl	String ctrlName	Execute "Shift_and_sym_edc_matrix_far()"EndFunction ButtonProc_comb_krange(ctrlName) : ButtonControl	String ctrlName	Execute "comb_krange()"EndFunction ButtonProc_combineall(ctrlName) : ButtonControl	String ctrlName	Execute "combineall()"EndFunction ButtonProc_rescale_pi(ctrlName) : ButtonControl	String ctrlName	Execute "rescale_pi()"EndFunction ButtonProc_apporbital_zlk(ctrlName) : ButtonControl	String ctrlName	Execute "apporbital_zlk()"EndFunction ButtonProc_setscale_zlk(ctrlName) : ButtonControl	String ctrlName	Execute "setscale_zlk()"EndFunction ButtonProc_format_zlk(ctrlName) : ButtonControl	String ctrlName	Execute "format_zlk()"Endmakeadd_data_tableFunction ButtonProc_makeadd_data_table(ctrlName) : ButtonControl	String ctrlName	Execute "makeadd_data_table()"EndFunction ButtonProc_derivmat(ctrlName) : ButtonControl	String ctrlName	Execute "derivmat()"EndFunction ButtonProc_new_eres_pi(ctrlName) : ButtonControl	String ctrlName	Execute "new_eres_pi()"EndFunction ButtonProc_new_kres_pi(ctrlName) : ButtonControl	String ctrlName	Execute "new_kres_pi()"EndFunction ButtonProc_renormcut_k(ctrlName) : ButtonControl	String ctrlName	Execute "renormcut_k()"EndFunction ButtonProc_mat_n_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mat_n_pi()"EndFunction ButtonProc_nan0(ctrlName) : ButtonControl	String ctrlName	Execute "Nan0()"EndFunction ButtonProc_zeronan(ctrlName) : ButtonControl	String ctrlName	Execute "ZeroNaN()"EndFunction ButtonProc_ln_mat_pi(ctrlName) : ButtonControl	String ctrlName	Execute "ln_mat_pi()"EndFunction ButtonProc_normcut(ctrlName) : ButtonControl	String ctrlName	Execute "normcut()"EndFunction ButtonProc_normwave(ctrlName) : ButtonControl	String ctrlName	Execute "normwave()"EndFunction ButtonProc_open_select(ctrlName) : ButtonControl	String ctrlName	Execute "open_select()"EndFunction ButtonProc_Mk_vb_table_pi(ctrlName) : ButtonControl	String ctrlName	Execute "Mk_vb_table_pi()"EndFunction ButtonProc_norm_high_e_pi(ctrlName) : ButtonControl	String ctrlName	Execute "norm_high_e_pi()"EndFunction ButtonProc_Mk_nk_table_pi(ctrlName) : ButtonControl	String ctrlName	Execute "Mk_nk_table_pi()"EndFunction ButtonProc_CVT2EK(ctrlName) : ButtonControl	String ctrlName	Execute "CVT2EK_pi()"EndFunction ButtonProc_Mkbad_slices(ctrlName) : ButtonControl	String ctrlName	Execute "Mkbad_slices()"EndFunction ButtonProc_mdc_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mdc_pi()"EndFunction ButtonProc_plot_mdc_pi(ctrlName) : ButtonControl	String ctrlName	Execute "plot_mdc_pi()"EndFunction ButtonProc_mdcfit_pi(ctrlName) : ButtonControl	String ctrlName	Execute "mdcfit_pi_choice()"EndFunction ButtonProc_find_kf_pi(ctrlName) : ButtonControl	String ctrlName	Execute "find_kf_pi()"EndFunction ButtonProc_edc_pi(ctrlName) : ButtonControl	String ctrlName	Execute "edc_pi()"EndFunction ButtonProc_plot_edc_pi(ctrlName) : ButtonControl	String ctrlName	Execute "plot_edc_pi()"EndFunction ButtonProc_open_data_pi(ctrlName) : ButtonControl	String ctrlName	Execute "open_data_pi()"EndFunction ButtonProc_open_onedata_pi(ctrlName) : ButtonControl	String ctrlName	Execute "open_onedata_pi()"EndFunction ButtonProc_edc_to_zero_pi(ctrlName) : ButtonControl	String ctrlName	Execute "edc_to_zero_pi()"EndFunction ButtonProc_scale_e_pi(ctrlName) : ButtonControl	String ctrlName	Execute "scale_e_pi()"EndFunction ButtonProc_MakeEDC(ctrlName) : ButtonControl	String ctrlName	Execute "MakeEDC_pi()"EndFunction ButtonProc_FitEDC(ctrlName) : ButtonControl	String ctrlName	Execute "FitEDC()"EndFunction ButtonProc_DisplayMat(ctrlName) : ButtonControl	String ctrlName	Execute "DisplayMat()"EndFunction ButtonProc_Killwave(ctrlName) : ButtonControl	String ctrlName	Execute "KillWave()"EndFunction ButtonProc_MatNorm(ctrlName) : ButtonControl	String ctrlName	Execute "MatNorm()"EndFunction ButtonProc_Multiply(ctrlName) : ButtonControl	String ctrlName	Execute "Multiply()"EndFunction ButtonProc_LiftMdc(ctrlName) : ButtonControl	String ctrlName	Execute "LiftMdcAtEf()"EndFunction ButtonProc_savegraph(ctrlName) : ButtonControl//"Special"	String ctrlName	Execute  "savegraph()"EndFunction ButtonProc_ConstOffset(ctrlName) : ButtonControl//"Special"	String ctrlName	Execute  "constantoffset_n()"EndFunction ButtonProc_MDCfit(ctrlName) : ButtonControl//"fit MDC"	String ctrlName	Execute "MDCfit()"EndFunction ButtonProc_MkMDC(ctrlName) : ButtonControl//"Full MDC"	String ctrlName	Execute "MakeMDC_pi()"EndFunction ButtonProc_showUpdate(ctrlName) : ButtonControl//Update	String ctrlName	Execute "showupdate()"EndFunction ButtonProc_shiftedc(ctrlName) : ButtonControl//"Combine"	String ctrlName	Execute "shiftedc()"EndFunction ButtonProc_MatNkPlot(ctrlName) : ButtonControl//"Plot N(k)"	String ctrlName		Execute "MatNKPlot()"EndFunction ButtonProc_4(ctrlName) : ButtonControl //"Fix"	String ctrlName		execute "Variable /G OldOffset1; OldOffset1=nan"EndFunction ButtonProc_Constant(ctrlName) : ButtonControl  // "Const"	String ctrlName	Execute "ConstantOffset_n()"EndFunction ButtonProc_rot_vector(ctrlName) : ButtonControl 	String ctrlName	Execute "rot_vector()"EndFunction ButtonProc_keep_negative(ctrlName) : ButtonControl 	String ctrlName	Execute "keep_negative()"EndFunction ButtonProc_keep_positive(ctrlName) : ButtonControl 	String ctrlName	Execute "keep_positive()"EndFunction ButtonProc_new_step(ctrlName) : ButtonControl  	String ctrlName	Execute "new_stepsize()"EndFunction ButtonProc_add_data(ctrlName) : ButtonControl  	String ctrlName	Execute "add_data()"EndFunction ButtonProc_add_this_data(ctrlName) : ButtonControl  	String ctrlName	Execute "add_this_data()"EndFunction ButtonProc_dividematrixbyfermi(ctrlName) : ButtonControl  	String ctrlName	Execute "dividematrixbyfermi()"EndFunction ButtonProc_dividewavebyfermi(ctrlName) : ButtonControl  	String ctrlName	Execute "dividewavebyfermi()"EndFunction ButtonProc_sym_edc_matrix(ctrlName) : ButtonControl  	String ctrlName	Execute "sym_edc_matrix_far()"EndFunction format_zlk(mat)	wave mat	//mat=imagenamelist("")	//string graphname,wavenam	//wavenam=nameofwave(mat)	//graphname=nameofwave(mat)+"_dup"		//if(wintype(graphname)==1)		//dowindow/f $graphname		//else			//display/n=$graphname; appendimage mat			//Showinfo				ModifyGraph tick=2,mirror(left)=1,nticks=20,noLabel(left)=1	//endifendFunction PopMenuProc_6(ctrlName,popNum,popStr) : PopupMenuControl  //for ticks_in or out	String ctrlName	Variable popNum	String popStr	If(popNum==1)		ModifyGraph tick=2		Else			ModifyGraph tick=0	EndifEndFunction PopMenuProc_mirroronoff(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	IF(popNum==1)		ModifyGraph mirror=0		Else			ModifyGraph mirror=1	EndifEndFunction ButtonProc_DOS_kf(ctrlName) : ButtonControl  	String ctrlName	Execute "DOS_kf()"EndFunction ButtonProc_return_phi_theta(ctrlName) : ButtonControl  	String ctrlName	Execute "return_phi_theta()"EndFunction ButtonProc_return_phi_theta1(ctrlName) : ButtonControl  	String ctrlName	Execute "return_phi_theta1()"EndFunction ButtonProc_FFTlist(ctrlName) : ButtonControl  	String ctrlName	Execute "FFTlist()"EndFunction SetVarProc_7(ctrlName,varNum,varStr,varName) : SetVariableControl //Delta_offset	String ctrlName	Variable varNum	String varStr	String varName	NVAR gv_Delta_YOffset	SetVariable setvar2 limits={-Inf,Inf,gv_Delta_YOffset}EndFunction SetVarProc_2(ctrlName,varNum,varStr,varName) : SetVariableControl //base	String ctrlName	Variable varNum	String varStr	String varName		Execute "Update()"EndFunction SetVarProc_8(ctrlName,varNum,varStr,varName) : SetVariableControl  //Delta_Base	String ctrlName	Variable varNum	String varStr	String varName	NVAR gv_Delta_YBase		SetVariable setvar3 limits={-Inf,Inf, gv_Delta_YBase}EndProc Show2DImage(matName)	String/G colordefault	Variable/G colordefaultinv	 	String matName 	String   WindowName="Image_"+matName	DoWindow  $WindowName	if( V_Flag== 0 )		Display as WindowName;  AppendImage $MatName		DoWindow /C $(WindowName)		ModifyImage $MatName ctab= {*,*,$colordefault,colordefaultinv}		ModifyGraph standoff=0	else		DoWindow  /F $(WindowName)	endif		Showinfo	EndProc ShowUpdate()	PauseUpdate; silent 1	DoWindow /F $WinName(0,1)	String Base=yybb, xbase=xxbb//|----- remove Graphs	String WaveName, xwaveName,   TracesList = TraceNameList("","",0)	Variable NumOfTraces=itemsInList(TracesList)	Variable index	index=0		Do		WaveName=StringFromList(index,TracesList,";")		RemoveFromGraph /Z $WaveName		index+=1	While(index<NumOftraces)	//|----remove Contours		TracesList = TraceNameList("","",1)	NumOfTraces=itemsInList(TracesList)	index=0	Do		WaveName=StringFromList(index,TracesList,";")		RemoveFromGraph /Z $WaveName		index+=1	While(index<NumOftraces)//|---remove Images	String ImagesList=ImageNameList("",";")	Variable NumOfImages=	itemsInList(ImagesList)	String ImageName	index=0	Do		ImageName=StringFromList(index,ImagesList,";")		RemoveImage /Z $ImageName		index+=1	While(index<NumofImages)	//|---Display Traces	Variable YOffset=0	DoWindow /T $WinName(0,1), "Group # "+num2istr(gv_GroupNum)	index=gv_ystart	Do		WaveName=base+num2istr(index)		if( cmpStr(xbase,"Dummy")==0 )			AppendTograph $WaveName		else					XwaveName=Xbase+num2istr(index-gv_ystart+gv_xstart)			AppendTograph $WaveName vs $XwaveName		endif				ModifyGraph offset($WaveName)={0,YOffset}		YOffset+=gv_Yoffset		index+=1	While(index<=gv_yend)//|---Display Image if needed	String MatName="M"+num2istr(gv_GroupNum)	WaveName=base+num2istr(gv_ystart)		ControlInfo /W=Data_Analysis Check1	K17=V_Value	if( K17==1)			make /O/n=(DimSize($WaveName,0),(gv_yend-gv_ystart+1)) $MatName		SetScale /P x, DimOffset($WaveName,0), DimDelta($WaveName,0),"", $MatName			index=gv_ystart		Do			WaveName=base+num2istr(index)			$MatName()[index-gv_ystart]=$WaveName(x)			index+=1		While(index<=gv_yend)					appendImage /L=LeftA /B=BottomA $MatName				ModifyGraph standoff(left)=0,standoff(bottom)=0,axisEnab(left)={0,0.48};DelayUpdate		ModifyGraph axisEnab(LeftA)={0.55,1},freePos(LeftA)=0;DelayUpdate		ModifyGraph freePos(BottomA)={0,leftA}		ModifyImage $MatName ctab= {*,*,Rainbow,1}	endif	String WindowName="Group_"+num2istr(gv_GroupNum)	DoWindow $(WindowName)	If (V_Flag ==0)		DoWindow /F $(WinName(0,1))		DoWindow /C $(WindowName)	else		DoWindow /F $(WinName(0,1))		Variable indexA=1		String  NewWindowName		Do			NewWindowName=WindowName+"_v"+num2istr(indexA)			DoWindow $(newWindowName)			indexA+=1		While(V_Flag==1)				DoWindow /C/T  $(NewWindowName) NewWindowName	EndifEndProc UpdateMdc()//|---Update current graph---msg="Update current graph."PauseUpdate;Silent 1	String waveName,base=MDCBaseWave[gv_groupNum]	Variable waveNum,TotalWave,i,Y_Offset	TotalWave=gv_MdcEnd-gv_Mdcstart+1	i=gv_Mdcstart	Y_Offset=0	waveName = base+num2istr(i)	ModifyGraph offset($waveName)={0,Y_Offset}	i+=1	Y_Offset += gv_Mdcoffset	If ((gv_Mdcend-gv_Mdcstart)>0)		Do			waveName = base+num2istr(i)	//		print i			ModifyGraph offset($waveName)={0,Y_Offset}			Y_Offset += gv_Mdcoffset			i+=1		While (i<gv_Mdcend)	EndifEnd Proc UpdateEdc()	PauseUpdate	Silent 1		String waveName,base=EdcBaseWave[gv_groupNum]	Variable waveNum,TotalWave,i,Y_Offset	TotalWave=gv_EdcEnd-gv_Edcstart+1	i=gv_Edcstart	Y_Offset=gv_EdcBias	waveName = base+num2istr(i)	ModifyGraph offset($waveName)={0,Y_Offset}	i+=1	Y_Offset += gv_Edcoffset	If ((gv_Edcend-gv_Edcstart)>0)		Do			waveName = base+num2istr(i)			ModifyGraph offset($waveName)={0,Y_Offset}			Y_Offset += gv_Edcoffset			i+=1		While (i<=gv_Edcend)	EndifEnd Proc Nkplot()	PauseUpdate	Silent 1	String nkName="nk"	Variable startW, lastW, waveNum,numW,i=0,V_mean	numW=gv_yend-gv_ystart+1		If( numW<=0 )		return	Endif	Make/N=(numW)/D/O $nkName	String base=yybb		String waveName	startW=gv_ystart	lastW=gv_yend	numW=lastW-startW+1		pauseUpdate; Silent 1		waveNum=startW			if ((lastW-startW) >=2)		do	               	waveName=base + num2istr(waveNum)	             $nkName[i]=fAverage($waveName,85.1,85.8)                         	             waveNum+=1	             i+=1		while (waveNum <= (lastW))			endif	V_mean=Mean($nkName,0,LastW)	$nkName/=V_meanEndProc MDCfit(EF,number)	Variable Ef=0	Variable number=200	Prompt Ef, "Fermi Energy:"	Prompt number,"Enter the mdc you want to compare"	Pauseupdate; silent 1		String peakname,widthname,base,MatName,peaksmooth,widthsmooth	MatName="Data"+Num2Str(gv_groupnum)	Variable y_start,y_delta,y_size,y_end	Variable x_start,x_delta	Variable MStart,MEnd	Variable k	y_start=Dimoffset($MatName,1)	y_delta=Dimdelta($MatName,1)	y_size=Dimsize($MatName,1)	y_end=y_start+y_delta*(y_size-1)	x_start=Dimoffset($MatName,0)	x_delta=Dimdelta($MatName,0)	base=MdcBaseWave[gv_groupNum]	make/N=4/D/O m	make/N=4/D/O store_m	variable n=0,totalnum=0,i=0,stop,groupnum,addnum,newdy	groupnum=gv_groupnum	totalnum=qcsr(B)-qcsr(A)	String WaveName	stop=qcsr(B)	peakname="MDCpeak"+num2str(groupnum)	widthname="MDCwidth"+num2str(groupnum)	addnum=mcombine[gv_groupnum]	newdy=addnum*y_delta	Mstart=y_start+(qcsr(A))*newdy        Mend=y_start+(qcsr(B)-1)*y_delta		Make/N=(totalnum)/D/O $peakname	SetScale/p x, Mstart-Ef,newdy,"",$peakname	Make/N=(totalnum)/D/O $widthname	SetScale/p x, Mstart-Ef,newdy,"",$widthname	n=Floor((qcsr(A)+qcsr(B))/2)	WaveName=MdcBaseWave[gv_groupnum]+Num2Str(n)	Wavestats/Q $WaveName	m[0]=(vcsr(A)*xcsr(B)-vcsr(B)*xcsr(A))/(xcsr(B)-xcsr(A))	m[2]=V_Maxloc   //MDC position	m[1]=V_max	m[3]=abs(xcsr(A)-xcsr(B))/6			//MDC width        n=qcsr(A)		Do		WaveName=base+Num2Str(n)		FuncFit/N/Q/H="00000" Lorentz m $WaveName (xcsr(A),xcsr(B))//  /D	        If(i==number-qcsr(A))	          k=0	          Do	                store_m[k]=0	                store_m[k]=m[k]	                k+=1	          While(k<4)	        EndIF     		$peakname[i]=m[2]		$widthname[i]=abs(m[3])		if (m[2]>xcsr(B))			m[2]=(xcsr(B)+xcsr(A))/2		Endif			if (m[2]<xcsr(A))			m[2]=(xcsr(B)+xcsr(A))/2		Endif		n+=1		i+=1	While (n<stop)	String pkx 	pkx="pkx"+num2istr(groupnum)	duplicate/o $peakName $pkx	SetScale/p x, Mstart,newdy,"",$pkx	$pkx=xEndMacro GetSigma(index)	variable index	pauseupdate	silent 1	string resigw,peakw,bbw,peaksw,imsigw,widthw,widthsw,bew	variable  startpntx,startpnty,endpntx,endpnty,pnt,vf	peakw="mdcpeak"+num2str(index)	widthw="mdcwidth"+num2str(index)	resigw="resig"+num2str(index)	bbw="bb"+num2str(index)	imsigw="imsig"+num2str(index)	peaksw="mdcs"+num2str(index)	widthsw="mdcw"+num2str(index)	bew="be"+num2str(index)	duplicate/o $peakw,$resigw	duplicate/o $peakw,$peaksw	duplicate/o $peakw,$bbw	duplicate/o $widthw,$imsigw	duplicate/o $widthw,$widthsw		smoothntimes(widthsw,3,20)	smoothntimes(peaksw,3,20)		pnt=0//bareband	startpntx=pnt2x($peaksw,pnt)	startpnty=mean($peaksw,pnt2x($peaksw,pnt),pnt2x($peaksw,pnt+10))	endpntx=0	endpnty=mean($peakw,-0.002,0.002)	$bbw=endpnty+x*(endpnty-startpnty)/(endpntx-startpntx)		$resigw=$bbw-$peaksw// resigma		vf=(endpntx-startpntx)/(endpnty-startpnty)//imsigma	$imsigw=0.5*$widthsw*vf		display	append $widthw,$widthsw	append/r $imsigw	modifygraph rgb($widthsw)=(0,0,65535),rgb($imsigw)=(0,65535,0);delayupdate	variable knkanal=1	if(KnkAnal == 2)		return 	String dispNm, WidthNm, dispCopy, WidthCopy, DispVf, ImgPrtSE	DispNm="disp"+num2istr(groupnum)	WidthNm="Width"+num2istr(groupnum)	DispCopy="dispCP"+num2istr(groupnum)	WidthCopy="wiCP"+num2istr(groupnum)	DispVF="VF"+Num2istr(groupnum)	ImgPrtSE="imSE"+num2istr(groupnum)	Make/N=(totalnum)/D/O $DispNm, $widthNm, $DispCopy, $widthCopy, $DispVF, $ImgPrtSE	Setscale/i x EnergystartWave[groupnum]-Ef, EnergyEndWave[groupnum]-Ef ,"", $DispNm, $widthNm, $DispCopy, $widthCopy, $DispVF, $ImgPrtSE	$DispNm = $peakName	$widthNm = $WidthName	$DispCopy = $PeakName	$WidthCopy = $WidthName	$DispVF = $peakName	$ImgPrtSE = $WidthName	smoothNtimes(DispCopy,10)	smoothNtimes(WidthCopy,10)	Differentiate $DispVF	smoothNtimes(DispVF,100)	Variable Sum0	Sum0= sum($DispVF,-inf,inf)	if(Sum0 < 0)		$DispVF*=-1	Endif	$ImgPrtSE = $WidthCopy/$DispVF		display $DispNm, $DispCopy	appendtograph/r $WidthNm,$WidthCopy,$DispVF,$ImgPrtSE	ModifyGraph standoff=0;DelayUpdate	ModifyGraph mode($DispNm)=3,marker($DispNm)=8,mode($WidthNm)=3;DelayUpdate	ModifyGraph marker($WidthNm)=8,lstyle($DispVF)=1;DelayUpdate	ModifyGraph rgb($DispNm)=(0,65535,0),rgb($WidthNm)=(0,65535,0);DelayUpdate	ModifyGraph rgb($DispVF)=(0,0,65535),rgb($ImgPrtSE)=(0,0,0)	endifEndFunction Lorentz2(m,x) : fitfunc	wave m; variable x		return (m[0]+m[1]/((x-m[2])^2+m[3]^2)+m[4]/((x-m[5])^2+m[6]^2))//+m[4]*xEndFunction Lorentz(m,x)	wave m; variable x		return (m[0]+m[1]/((x-m[2])^2+m[3]^2))//+m[4]*xEndFunction SetVarProc_4(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	SVAR  yybb	NVAR gv_ystart, gv_YEnd,gv_groupnum	NVAR gv_SingleWaveNum	Wave/T EdcBaseWave	Wave EdcStartWave	execute "Variable /G Offset1=gv_SingleWaveNum, oldOffset1"	execute "ChangeOneWaveLook(oldOffset1,65535,0,0,1)"	execute "ChangeOneWaveLook(Offset1,0,65535,0,2)"	execute "oldOffset1=Offset1"		SetVariable setvar8 limits={0,gv_yEnd-gv_YStart,1}	ControlInfo setVar8	gv_SingleWaveNum = v_Value	yybb=EdcBaseWave[gv_groupnum]	ValDisplay WaveNameDisplay format=yybb+num2istr(EdcStartWave[gv_groupnum]+gv_SingleWaveNum)EndProc ChangeOneWaveLook(Waveoffset, R,G,B, size)	Variable WaveOffset	Variable R,G,B, size	Pauseupdate; silent 1	String base=yybb	String sWaveName=base+num2istr(gv_EdcStart+waveOffset)	String CompareName		CompareName = WaveList( sWaveName, "","WIN:")	if( 0==cmpstr(CompareName, SwaveName))		ModifyGraph lsize($sWaveName)=size		ModifyGraph rgb($SwaveName)=(R,G,B)	endifEndProc DisplayMat()	PauseUpdate	Silent 1	Variable/G gv_groupnum	String MatName	MatName="Data"+Num2Str(gv_groupnum)	Show2DImage(MatName) 	Modifygraph height=125,width=125	ResumeUpdate	Modifygraph height=0,width=0	EndProc MatNKPlot(first,last)	Variable first	Variable last	Prompt first,"Enter the first slice of the range"	Prompt last,"Enter the last slice of the range"	PauseUpdate	Silent 1	Variable groupnum,i,lenth,nkmean	String MatName	Variable StartE,DeltaE	groupnum=gv_groupnum	MatName="Data"+Num2Str(groupnum)	lenth=Dimsize($MatName,1)	Make/O/n=(lenth) tempwave	StartE=Dimoffset($MatName,1)	DeltaE=Dimdelta($MatName,1)	SetScale/p x StartE,DeltaE,"",tempwave	lenth=Dimsize($MatName,0)	Make/O/N=(lenth) NK	i=0	Do		tempwave=$MatName[i][p]		NK[i]=mean(tempwave,pnt2x(tempwave, first),pnt2x(tempwave, last))		i+=1	While(i<lenth)	ShowGraph("nk")	Killwaves tempwave	EndProc MatNorm()	PauseUpdate	Silent 	1	Variable groupnum,i,lenth	String MatName	groupnum=gv_groupnum	MatName="Data"+Num2Str(groupnum)	lenth=Dimsize($MatName,0)	i=0	Do		$MatName[i][]/=NK[i]		i+=1	While(i<lenth)EndProc ShowGraph(WaveName) String WaveName PauseUpdate Silent 1 String WindowName="Graph_"+WaveName DoWindow $(WindowName) if( V_Flag== 0 ) Display as WindowName; Append $WaveName DoWindow /C $(WindowName) else DoWindow /F $(WindowName) endif EndProc LiftMdcAtEf()	PauseUpdate	Silent 1	Variable  groupnum	String Wavename	groupnum=gv_groupnum	Wavename="EfMdc"+Num2Str(groupnum)	Lift(WaveName)EndProc Lift(WaveName)	String WaveName	PauseUpdate	Silent 1	WaveStats/Q $Wavename	$WaveName-=V_min	WaveStats/Q $Wavename	$Wavename*=100000/V_maxEndFunction EdcPeakFit(w,x) : FitFunc	Wave w	Variable x	//CurveFitDialog/ These comments were created by the Curve Fitting dialog. Altering them will	//CurveFitDialog/ make the function less convenient to work with in the Curve Fitting dialog.	//CurveFitDialog/ Equation:	//CurveFitDialog/ f(x) = ( w0+w6*x+w1*w3/((x-w2)^2+w3^2))*1/(1+Exp((x-w4)/w5))+w7	//CurveFitDialog/ End of Equation	//CurveFitDialog/ Independent Variables 1	//CurveFitDialog/ x	//CurveFitDialog/ Coefficients 8	//CurveFitDialog/ w[0] = w0	//CurveFitDialog/ w[1] = w1	//CurveFitDialog/ w[2] = w2	//CurveFitDialog/ w[3] = w3	//CurveFitDialog/ w[4] = w4	//CurveFitDialog/ w[5] = w5	//CurveFitDialog/ w[6] = w6	//CurveFitDialog/ w[7] = w7	return ( w[0]+w[6]*x+w[1]*w[3]/((x-w[2])^2+w[3]^2))*1/(1+Exp((x-w[4])/w[5]))+w[7]EndProc MakeEdc(edcstart,edcend,addnum)	Variable edcstart=0,edcend=100,addnum=1	Prompt edcstart,"Input the start num"	Prompt edcend, "Input the end num"	Prompt addnum,"Input the Num to be combined"	PauseUpdate 	Silent 1		String WaveName,MatName,base	Variable i,k,j,x_start,x_delta,x_size,y_start,y_delta,y_size,WaveNum,EdcNum	base=EdcBaseWave[gv_groupnum]	MatName="Data"+Num2Str(gv_groupnum)	x_start=Dimoffset($MatName,0)	x_delta=Dimdelta($MatName,0)	x_size=Dimsize($MatName,0)	y_start=Dimoffset($MatName,1)	y_delta=Dimdelta($MatName,1)	y_size=Dimsize($MatName,1)	EdcNum=(EdcEnd-EdcStart+1)/addnum	WaveNum=Floor(EdcNum)	Display	Variable Choice	i=0	Do		WaveName=base+Num2Str(i)		Make/O/N=(y_size) $WaveName=0		j=0		Do			$WaveName+=$MatName[EdcStart+addnum*i+j][p]			j+=1		While(j<addnum)		SetScale/p x ,y_start,y_delta,"", $WaveName		AppendtoGraph $WaveName		i+=1	While(i<WaveNum)	EdcStartWave[gv_groupnum]=0	EdcLastWave[gv_groupnum]=WaveNum-1	gv_edcstart=0	gv_edcend=wavenum-1EndFunction EdcHWHM(para,x)	Wave para	Variable x	Variable y0,c,A,B,x0,T	y0=para[0]	c=para[1]	A=para[2]	B=para[3]	x0=para[4]	T=para[5]	return  (y0+c*x+A*B/((x-x0)^2+B^2))/(1+Exp((x-12.781)/T))//	return  (y0+A*B/((x-x0)^2+B^2))//	return  (y0+c*x+A*Exp(-((x-x0)/B)^2))/(1+Exp((x-12.668)/T))//	return  (y0+c*x+A*Exp(-((x-x0)/B)^2))//	return  (y0+A*B/((x-x0)^2+B^2))	Endproc FindEdcPeakDispersion()	PauseUpdate	Silent 1	Variable groupnum,i,xsize,ysize	String MatName,PeakName	groupnum=gv_groupnum	Peakname="EdcPeak"+Num2Str(groupnum)	MatName="Data"+Num2Str(groupnum)	xsize=Dimsize($MatName,0)	ysize=Dimsize($MatName,1)	Make/O/n=(ysize) TempWave	Make/O/n=(xsize) $PeakName	i=0	Do		TempWave=$MatName[i][p]		WaveStats /Q  TempWave		$Peakname[i]=V_maxloc		i+=1	While(i<xsize)EndFunction GetWaveOffset(w)        Wave w	  String s= TraceInfo("",NameOfWave (w),0)	        if( strlen(s) == 0 ) 	           return NaN	      endif	   String subs= "offset(x)={"	      Variable v1= StrSearch(s,subs,0) 	       if( v1 == -1 )	          return NaN	      endif	   v1 += strlen(subs)	      Variable xoff= str2num(s[v1,1e6]) 	      v1= StrSearch(s,",",v1)	 Variable yoff= str2num(s[v1+1,1e6])//     return cmplx(xoff,yoff)	return yoffend    Function LorFit(w,x) : FitFunc	Wave w	Variable x	//CurveFitDialog/ These comments were created by the Curve Fitting dialog. Altering them will	//CurveFitDialog/ make the function less convenient to work with in the Curve Fitting dialog.	//CurveFitDialog/ Equation:	//CurveFitDialog/ f(x) = y0+A*B/((x-x0)^2+B^2)	//CurveFitDialog/ End of Equation	//CurveFitDialog/ Independent Variables 1	//CurveFitDialog/ x	//CurveFitDialog/ Coefficients 4	//CurveFitDialog/ w[0] = y0	//CurveFitDialog/ w[1] = A	//CurveFitDialog/ w[2] = x0	//CurveFitDialog/ w[3] = B	return w[0]+w[1]*w[3]/((x-w[2])^2+w[3]^2)EndFunction Cal_Posi(x,y,z)		Variable x,y,z		Variable n		n=Floor((x-y)/z)		return nEndMacro AppendtoCut(Mat)		String Mat="Cut"	Prompt Mat,"input mat name"	PauseUpdate	Silent 1	Variable i,num,m	String WaveName	m=Dimsize($Mat,0)	num=gv_edcend-gv_edcstart+1	InsertPoints m,num, $Mat	i=0	Do		WaveName=EdcBaseWave[gv_groupnum]+Num2Str(i+gv_edcstart)		$Mat[i+m][]=$WaveName[q]		i+=1	While(i<+num)End	Macro UpdateAppend(Mat)	String Mat="Cut"	Prompt Mat,"input mat name"	PauseUpdate	Silent 1	Variable i,num,m,startpoint	String WaveName	m=Dimsize($Mat,0)	num=gv_edcend-gv_edcstart+1	startpoint=m-num	i=0	Do		WaveName=EdcBaseWave[gv_groupnum]+Num2Str(i+gv_edcstart)		$Mat[i+startpoint][]=$WaveName[q]		i+=1	While(i<+num)End#pragma rtGlobals=1		// Use modern global access method.Macro  MakeEfMdcTable()	pauseupdate	silent 1	if(  2==winType("efmdc_table"))		DoWindow /F efmdc_table	endif	if(  0==wintype("efmdc_table"))		string efmi="efmdcindex"		if(!waveexists($efmi))			make/n=1 $efmi		endif		string efmt="efmdctemp"		if(!waveexists($efmt))			make/n=1 $efmt		endif		string efmw="efmdcw"		if(!waveexists($efmw))			make/n=1 $efmw		endif		string efmp="efmdcpara"		if(!waveexists($efmp))			make/n=5 $efmp		endif		string efmn="efmdcpn"		if(!waveexists($efmn))			make/t/n=5 $efmn			$efmn[0]="y0"			$efmn[1]="a"			$efmn[2]="posi"			$efmn[3]="width"			$efmn[4]="b"		endif		edit $efmi,$efmt,$efmw,$efmn,$efmp as "efmdc_table"		DoWindow /C efmdc_table	endif		EndMacro FitEfMdc()	pauseupdate	silent 1	string  efmw,paraw	variable i,dim,t	dim=dimsize(efmdcindex,0)	paraw="efmdcpara"	i=0	do		efmw="efmdc"+num2str(efmdcindex[i])		//		FuncFit/N/Q/H="00000" Lorentz efmdcpara $WaveName  (xcsr(A),xcsr(B))//  /D		FuncFit/N/Q/H="00001" Lorentz efmdcpara $efmw (xcsr(A),xcsr(B))		efmdcw[i]=0.5*$paraw[3]		i+=1	while(i<dim)EndMacro DisplayEfmdc()	pauseupdate	silent 1	string wavename	variable i,dim	display	dim=dimsize(efmdcindex,0)	i=0	do		wavename="efmdc"+num2str(efmdcindex[i])		append $wavename		i+=1	while(i<dim)EndMacro GetWidth()	pauseupdate	silent 1	string wavename	variable i,dim	dim=dimsize(efmdcindex,0)	i=0	do		wavename="mdcwidth"+num2str(efmdcindex[i])		mdcw[i]=0.5*mean($wavename,-0.01,0.001)		i+=1	while(i<dim)EndMacro GetAverageWidth()	pauseupdate	silent 1	string 	variable i,dimi,j=0,dimj,m,sumwidth	dimi=dimsize(tempave,0)	dimj=dimsize(temp,0)	i=0	do		m=0		sumwidth=0		j=0		do			if(temp[j]==tempave[i])				sumwidth+=fitwidth[j]				m+=1			endif			j+=1		while(j<dimj)		widthave[i]=sumwidth/m		i+=1	while(i<dimi)EndProc EfMdcArea()	Pauseupdate; silent 1	Variable n=0	String WN0	Variable  i,dim,X_Offset=0,BaseOffset,Y_Offset	dim=dimsize(efmdcindex,0)	i=0	Do		WN0="efmdc"+num2str(efmdcindex[i])		efmdca[i]=mean($wn0,0.5,0.7)		i+=1	while( i<dim)EndMacro Matrix_To_Wave(Matname, WaveBase, StartNum, toFolder)//---Change several waves in graph to one matrix file---	String MatName="EF", WaveBase="", toFolder=""	Variable StartNum=nan	Prompt MatName, "Input the matrix name", popup WaveList("*", ";","DIMS:2")	PauseUpdate;Silent 1//	String savedFolder=getDataFolder(1)	Variable NumOfWaves=DimSize($MatName, 1)	Variable vWaveLength=DimSize($MatName,0)	String sWaveName	Variable waveNum=0	Do		sWaveName=toFolder+WaveBase+num2istr(StartNum+waveNum)		make /O/n=(vWaveLength) $sWaveName//		setScale  /P x DimOffset($MatName,0), DimDelta($MatName, 0), "", $sWaveName		$sWaveName=$(savedFolder+possiblyquotename(MatName))[p][waveNum]		note $sWaveName "Angle="+num2str(DimOffset($Matname,1)+waveNum*DimDelta($Matname,1))		waveNum+=1	While( WaveNum<NumofWaves)	Root:gv_NumofWaves = numofWaves	print "---Matrix:  {"+savedFolder+MatName+"} has been convert to: {"+toFolder+":"+WaveBase+num2istr(startNum)+ "---"+WaveBase+num2istr(startNum+numofWaves-1)+"}"EndFunction ButtonProc_FitAu(ctrlName) : ButtonControl//" Fit Au Edge"	String ctrlName 	Execute "Fit_Au()"EndProc Fit_Au()	PauseUpdate	Silent 1	Make/N=6/D/O w	w[0]=vcsr(A)	w[1]=-0.01//	w[2]=17.630//(hcsr(A)+hcsr(B))/2	w[2]=(hcsr(A)+hcsr(B))/2	w[3]=0.004	w[4]=vcsr(B)	w[5]=0	String base=EdcBaseWave[gv_groupnum],xbase=xxbb	String WaveName,Xwavename,FitName	Variable TotalWave,i,j,n,offsety		TotalWave=gv_Edcend-gv_Edcstart+1	i=gv_Edcstart	n=0	Make/N=(TotalWave)/D/O AuEF	Make/N=(TotalWave)/D/O AuReso	Do		waveName = Base+num2istr(i)		FuncFit/Q Fermi w $waveName(xcsr(A),xcsr(B))  /D		AuEF[n]=w[2]		AuReso[n]=w[3]*4.39445		offsety=GetWaveOffset($WaveName)		FitName="Fit_"+WaveNameModifyGraph offset($FitName)={0,offsety}		i+=1		n+=1	While (i<=gv_Edcend)EndFunction Fermi(w,x)	wave w; Variable x		return (w[0]*(1+w[1]*x))/(1+exp((x-w[2])/w[3]))+w[4]*(1+w[5]*x)EndProc makegraphtable()	String/G info="Graph info"	String/G xxbb="xwave"	String/G yybb="wave"	String/G beamCurrent="beamCur"	String /G SampleInfo="Sample Info"	String /G Comment_MSG=""			String FN="File_Name"	if(!WaveExists( $FN) )		Make/N=1/T $FN	endif		if(2==winType("Information_table"))		DoWindow /F Information_table	endif	if(0==wintype("Information_table"))//		Edit $in,$E0,$E1,$Temperature,$cmnts,$yb, $st,$ls,$of,$bi, $Angle, $FAT,  as "Information Table"		Edit $FN		DoWindow /C Information_table	endif	End Macrofunction hexfunction(kx,ky)	variable kx,ky	variable a=pi	variable v,delta	delta=0.05	v=0	if(ky>=0)		if(kx>=-a&&kx<=-a/2)			if(abs(ky-(sqrt(3)*kx+a*sqrt(3)))<=delta)				v=1			endif		elseif(kx>=-a/2&&kx<=a/2)			if(abs(ky-sqrt(3)*0.5*a)<=delta)				v=1			endif		elseif(kx>=a/2&&kx<=a)			if(abs(ky-(-sqrt(3)*kx+sqrt(3)*a))<=delta)				v=1			endif		endif	else		if(kx>=-a&&kx<=-a/2)			if(abs(ky-(-sqrt(3)*kx-sqrt(3)*a))<=delta)				v=1			endif		elseif(kx>=-a/2&&kx<=a/2)			if(abs(ky+sqrt(3)*0.5*a)<=delta)				v=1			endif		elseif(kx>=a/2&&kx<=a)			if(abs(ky-(sqrt(3)*kx-sqrt(3)*a))<=delta)				v=1			endif		endif	endif	return vend//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Begining of Pierre's macros/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////*******************************************************************************************************************************Proc CutNaNedges(matname)	String matname	Prompt matname,"Name of the matrix"	PauseUpdate;Silent 1	funcCutNaNedges($matname)End	//*******************************************************************************************************************************Function funcCutNaNedges(matname)	Wave matname	PauseUpdate;Silent 1	Variable i,j	Variable lowx,lowy,highx,highy	lowx=9999999	highx=-1	lowy=9999999	highy=-1	//check along x	i=0	Do		Make/O/N=(dimsize(matname,0)) thiswave		thiswave[]=matname[p][i]		Wavestats/Q thiswave		IF(V_numNaNs==0)			lowx=0			highx=dimsize(matname,0)-1			i=dimsize(matname,1)		Endif		IF((V_numNaNs!=0)&&(lowx!=0))			j=0			Do				IF((mod(Round(thiswave[j]),1)==0)&&(j<=lowx))					lowx=j					j=dimsize(matname,0)				Endif				j+=1			While((j<dimsize(matname,0))&&(j<lowx))		Endif		IF((V_numNaNs!=0)&&(highx!=dimsize(matname,0)-1))			j=dimsize(matname,0)-1			Do				IF((mod(Round(thiswave[j]),1)==0)&&(j>=highx))					highx=j					j=0				Endif				j-=1			While((j>0)&&(j>highx))		Endif				i+=1	While(i<dimsize(matname,1))	//check along y	i=0	Do		Make/O/N=(dimsize(matname,1)) thiswave		thiswave[]=matname[i][p]		Wavestats/Q thiswave		IF(V_numNaNs==0)			lowy=0			highy=dimsize(matname,1)-1			i=dimsize(matname,0)		Endif		IF((V_numNaNs!=0)&&(lowy!=0))			j=0			Do				IF((mod(Round(thiswave[j]),1)==0)&&(j<=lowy))					lowy=j					j=dimsize(matname,1)				Endif				j+=1			While((j<dimsize(matname,1))&&(j<lowy))		Endif		IF((V_numNaNs!=0)&&(highy!=dimsize(matname,1)-1))			j=dimsize(matname,1)-1			Do				IF((mod(Round(thiswave[j]),1)==0)&&(j>=highy))					highy=j					j=0				Endif				j-=1			While((j>0)&&(j>highy))		Endif				i+=1	While(i<dimsize(matname,1))	Duplicate/O/R=[lowx,highx][lowy,highy] matname thistempmat	Duplicate/O thistempmat matname	Killwaves thistempmat,thiswaveEnd//*******************************************************************************************************************************Function ButtonProcCutNaNedges(ctrlName) : ButtonControl	String ctrlName	Execute "CutNaNedges()"End//*******************************************************************************************************************************Proc DerivMat(OldM,num,box,choice)	string OldM,	variable num,box,choice	prompt OldM,"Input the matrix Name"	prompt num,"how many times to be smoothed"	prompt box,"Input the box width"	prompt choice,"choose direciton",	popup "Vertical;Horizontal;both;dVdH;dHdV"	pauseupdate 	silent 1	string mat,mat1	if(choice==1)		mat=OldM+"VD"		duplicate/o $OldM,$mat		DM($OldM,$mat,num,box,1)		Display		Appendimage $mat		Showinfo		ModifyImage $mat ctab= {*,0,Terrain,1}	endif	if(choice==2)		mat=OldM+"HD"		duplicate/o $OldM,$mat		DM($OldM,$mat,num,box,2)		Display		Appendimage $mat		Showinfo			ModifyImage $mat ctab= {*,0,Terrain,1}				endif	if(choice==3)		mat=OldM+"VD"		mat1=OldM+"HD"		duplicate/o $OldM,$mat		duplicate/o $OldM,$mat1		DM($OldM,$mat,num,box,1)		DM($OldM,$mat1,num,box,2)		Display		Appendimage $mat		Showinfo		ModifyImage $mat ctab= {*,0,Terrain,1}				Display		Appendimage $mat1		Showinfo			ModifyImage $mat1 ctab= {*,0,Terrain,1}				endif	if(choice==4)		mat=OldM+"dVdH"		duplicate/O $OldM,$mat		DM($OldM,$mat,num,box,4)		Display		Appendimage $mat		Showinfo			ModifyImage $mat ctab= {*,0,Terrain,1}				endif	if(choice==5)		mat=OldM+"dHdV"		duplicate/O $OldM,$mat		DM($OldM,$mat,num,box,5)		Display		Appendimage $mat		Showinfo			ModifyImage $mat ctab= {*,0,Terrain,1}				endifendMacro DerivMatrix(OldM,num,box,choice)	string OldM,	variable num,box,choice	prompt OldM,"Input the matrix Name"	prompt num,"how many times to be smoothed"	prompt box,"Input the box width"	prompt choice,"choose direciton",	popup "Vertical;Horizontal;both;dVdH;dHdV"	pauseupdate 	silent 1	string mat,mat1	if(choice==1)		mat=OldM+"VD"		duplicate/o $OldM,$mat		DM($OldM,$mat,num,box,1)		Display		Appendimage $mat		Showinfo		ModifyImage $mat ctab= {*,0,Terrain,1}	endif	if(choice==2)		mat=OldM+"HD"		duplicate/o $OldM,$mat		DM($OldM,$mat,num,box,2)		Display		Appendimage $mat		Showinfo			ModifyImage $mat ctab= {*,0,Terrain,1}				endif	if(choice==3)		mat=OldM+"VD"		mat1=OldM+"HD"		duplicate/o $OldM,$mat		duplicate/o $OldM,$mat1		DM($OldM,$mat,num,box,1)		DM($OldM,$mat1,num,box,2)		Display		Appendimage $mat		Showinfo		ModifyImage $mat ctab= {*,0,Terrain,1}				Display		Appendimage $mat1		Showinfo			ModifyImage $mat1 ctab= {*,0,Terrain,1}				endif	if(choice==4)		mat=OldM+"dVdH"		duplicate/O $OldM,$mat		DM($OldM,$mat,num,box,4)		Display		Appendimage $mat		Showinfo			ModifyImage $mat ctab= {*,0,Terrain,1}				endif	if(choice==5)		mat=OldM+"dHdV"		duplicate/O $OldM,$mat		DM($OldM,$mat,num,box,5)		Display		Appendimage $mat		Showinfo			ModifyImage $mat ctab= {*,0,Terrain,1}				endifendfunction DM(OldM,NewM,num,box,choice)	wave oldM,newM	variable num,box,choice	Variable i=0,j=0, l, m, k, x0, dx, y0, dy	Variable j1	Variable startofwave,endofwave	l=dimsize(OldM,0)	m=dimsize(OldM,1)	x0=dimoffset(OldM,0)	dx=dimdelta(OldM,0)	y0=dimoffset(OldM,1)	dy=dimdelta(OldM,1)	make/o/n=(l) f0	make/o/n=(m) f1	setscale/p x x0,dx,"", f0	setscale/p x y0,dy,"", f1	NewM[][]=NaN	if(choice==2) //Horizontal derivative for k-space cuts		i=0		do			f0[]=OldM[p][i]			startofwave=0			If(mod(Round(OldM[startofwave][i]),1)!=0)				DO					startofwave+=1				While((mod(Round(OldM[startofwave][i]),1)!=0)&&(startofwave<dimsize(OldM,0)+1))			Endif			endofwave=dimsize(OldM,0)-1			If(mod(Round(OldM[endofwave][i]),1)!=0)				DO					endofwave-=1				While((mod(Round(OldM[endofwave][i]),1)!=0)&&(endofwave>0))			Endif			Duplicate/O/R=[startofwave,endofwave] f0 tempwave						Smooth/E=3/B=(num) box,tempwave						differentiate tempwave			differentiate tempwave			NewM[startofwave,endofwave][i]=tempwave[p-startofwave]				//			j=0//			Do//				NewM[startofwave+j][i]=tempwave[j]				//				j+=1//			While(j<dimsize(tempwave,0))			i+=1		while(i<dimsize(OldM,1))		Killwaves f0,f1,tempwave	endif	if(choice==1)//Vertical derivative for k-space cuts		i=0		DO			j=0			If(mod(Round(OldM[i][j]),1)!=0)				DO					j+=1				While((mod(Round(OldM[i][j]),1)!=0)&&(j<dimsize(OldM,1)+1))			Endif			If(j!=dimsize(OldM,1))				f1[]=OldM[i][p]				Duplicate/O/R=[j,*] f1 tempwave				Smooth/E=3/B=(num) box,tempwave							differentiate tempwave				differentiate tempwave				f1[j,*]=tempwave[p-j]//				j1=j//				Do//					f1[j1]=tempwave[j1-j]//					j1+=1//				While(j1<dimsize(f1,0))				NewM[i][]=f1[q]			Endif			i+=1		while(i<l)		Killwaves f1,f0	endif	if(choice==4)		Duplicate/O OldM intermediatemat		intermediatemat[][]=NaN		NewM[][]=NaN		i=0				//first derivative (V)		DO			j=0			If(mod(Round(OldM[i][j]),1)!=0)				DO					j+=1				While((mod(Round(OldM[i][j]),1)!=0)&&(j<dimsize(OldM,1)+1))			Endif			If(j!=dimsize(OldM,1))				f1[]=OldM[i][p]				Duplicate/O/R=[j,*] f1 tempwave				Smooth/E=3/B=(num) box,tempwave							differentiate tempwave				j1=j				Do					f1[j1]=tempwave[j1-j]					j1+=1				While(j1<dimsize(f1,0))				intermediatemat[i][]=f1[q]			Endif			i+=1		while(i<l)				i=0                //Second derivative (H)		do			f0[]=intermediatemat[p][i]			startofwave=0			If(mod(Round(intermediatemat[startofwave][i]),1)!=0)				DO					startofwave+=1				While((mod(Round(intermediatemat[startofwave][i]),1)!=0)&&(startofwave<dimsize(intermediatemat,0)+1))			Endif			endofwave=dimsize(intermediatemat,0)-1			If(mod(Round(intermediatemat[endofwave][i]),1)!=0)				DO					endofwave-=1				While((mod(Round(intermediatemat[endofwave][i]),1)!=0)&&(endofwave>0))			Endif			Duplicate/O/R=[startofwave,endofwave] f0 tempwave						Smooth/E=3/B=(num) box,tempwave						differentiate tempwave			j=0			Do				NewM[startofwave+j][i]=tempwave[j]								j+=1			While(j<dimsize(tempwave,0))			i+=1		while(i<dimsize(intermediatemat,1))		Killwaves f0,f1,tempwave			endif			if(choice==5)		Duplicate/O OldM intermediatemat		intermediatemat[][]=NaN		NewM[][]=NaN		i=0                //first derivative (H)		do			f0[]=OldM[p][i]			startofwave=0			If(mod(Round(OldM[startofwave][i]),1)!=0)				DO					startofwave+=1				While((mod(Round(OldM[startofwave][i]),1)!=0)&&(startofwave<dimsize(OldM,0)+1))			Endif			endofwave=dimsize(OldM,0)-1			If(mod(Round(OldM[endofwave][i]),1)!=0)				DO					endofwave-=1				While((mod(Round(OldM[endofwave][i]),1)!=0)&&(endofwave>0))			Endif			Duplicate/O/R=[startofwave,endofwave] f0 tempwave						Smooth/E=3/B=(num) box,tempwave						differentiate tempwave			j=0			Do				intermediatemat[startofwave+j][i]=tempwave[j]								j+=1			While(j<dimsize(tempwave,0))			i+=1		while(i<dimsize(OldM,1))		i=0				//second derivative (V)		DO			j=0			If(mod(Round(intermediatemat[i][j]),1)!=0)				DO					j+=1				While((mod(Round(intermediatemat[i][j]),1)!=0)&&(j<dimsize(intermediatemat,1)+1))			Endif			If(j!=dimsize(intermediatemat,1))				f1[]=intermediatemat[i][p]				Duplicate/O/R=[j,*] f1 tempwave				Smooth/E=3/B=(num) box,tempwave							differentiate tempwave				j1=j				Do					f1[j1]=tempwave[j1-j]					j1+=1				While(j1<dimsize(f1,0))				NewM[i][]=f1[q]			Endif			i+=1		while(i<l)				Killwaves f0,f1,tempwave			endif	End	Proc not_in_fct()	PauseUpdate 	Silent 1	Print "SORRY. THIS IS NOT FUNCTIONNAL NOW"End	//********************************************************************************************************************************	Proc NTP_num_set()	PauseUpdate	Silent 1	SetVariable varNTP_num,limits={0,NTP_num_max,1},value= NTP_num	End	//********************************************************************************************************************************	Function setvarNTP_num(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "NTP_num_set()"End//********************************************************************************************************************************Proc increase_NTP_num_max()	PauseUpdate	Silent 1	Variable/G NTP_num_max	String newwave	NTP_num_max+=1	DoWindow/F Not_these_points	newwave="NTP"+num2str(NTP_num_max)	Make/O/N=0 $newwave	Appendtotable $newwaveEnd	//********************************************************************************************************************************Function TabProc_main(ctrlName,tabNum) : TabControl	String ctrlName	Variable tabNum	IF(tabNum==0)		Button Button36 disable=0		Button Button43 disable=0		Button Button8 disable=0		Button Button21 disable=0		Button Button2001 disable=0		Button Button20 disable=0		Button Button23 disable=0		Button Button19 disable=0		Button Button18 disable=0		Button Button7 disable=0		Button Button6 disable=0		Button Button36 disable=0		Button Button31 disable=0		Button Button16 disable=0		Button Button17 disable=0		GroupBox groupstepsize disable=0			Button Button41 disable=0		Button Button42 disable=0				Button Button48 disable=0				Button Button50 disable=0							Button Button51 disable=0							Button Button52 disable=0							Button buttonhelptools1 disable=0		Button Button4 disable=0		Button button72 disable=0		Button button89 disable=0		Button Button91 disable=0				Button Button92 disable=0				Button Button93 disable=0															Button Button34 disable=1			Button Button49 disable=1			Button Button_copy_traces disable=1			Button But_sym_edc disable=1		Button Button47 disable=1				Button Button58 disable=1							Button Button59 disable=1							Button buttonhelptools2 disable=1		Button Button94 disable=1									Button Button14 disable=1			Button Buttonefedc disable=1			Button ButtonEFimage disable=1			Button ColorEDCnow disable=1		PopupMenu inversecoloredc disable=1		PopupMenu edccolorset disable=1		GroupBox grouplotoftraces disable=1		GroupBox grouplegend disable=1		Button ButtonintBE disable=1			Button ButtonintKE disable=1			Button ButtonBEangle disable=1			Button ButtonKEangle disable=1				Button buttonBEvsmom_pi disable=1			Button buttonBEvsmom_pi1 disable=1		Button buttonBEvshv disable=1						PopupMenu mirror_onoff disable=1		PopupMenu popupthicks_inout disable=1		Button buttonhelptools3 disable=1		Button Button90 disable=1					Button Button74 disable=1		Button button_a_up disable=1				Button button_a_down disable=1				Button button_a_both disable=1		Button button_0_up disable=1				Button button_0_down disable=1								Setvariable setvargrnum disable=1		Slider topimagetop disable=1		Slider topimagebot disable=1		PopupMenu popupmatcolor disable=1		PopupMenu popupinvmatcolor disable=1		GroupBox Matcolorscalegroup disable=1					PopupMenu colordefault_menu disable=1		PopupMenu popup_colordefault_inv disable=1					Button Button12 disable=1			Button Button13 disable=1			Button Button15 disable=1			Button Button37 disable=1			Button Button38 disable=1			Button Button39 disable=1			Button Button40 disable=1			Button Button55 disable=1			Button Button56 disable=1					Button But_rm_simpleedc disable=1			Button But_rm_mat disable=1					GroupBox groupsaveload disable=1								GroupBox groupRmback disable=1								GroupBox groupfinddispersion disable=1			Button buttonhelptools4 disable=1		Button button10 disable=1 							Button button60 disable=1 							Button button61 disable=1 		GroupBox groupimage disable=1		Button button95 disable=1 											Endif	IF(tabNum==1)		Button Button36 disable=1		Button Button43 disable=1		Button Button8 disable=1		Button Button21 disable=1		Button Button2001 disable=1		Button Button20 disable=1		Button Button23 disable=1		Button Button19 disable=1		Button Button18 disable=1		Button Button7 disable=1		Button Button6 disable=1		Button Button36 disable=1		Button Button31 disable=1		Button Button16 disable=1		Button Button17 disable=1				Button Button41 disable=1		Button Button42 disable=1				Button Button48 disable=1				Button Button50 disable=1							Button Button51 disable=1							Button Button52 disable=1							GroupBox groupstepsize disable=1			Button buttonhelptools1 disable=1		Button Button4 disable=1		Button button72 disable=1		Button button89 disable=1				Button Button91 disable=1				Button Button92 disable=1			Button Button93 disable=1									Button Button34 disable=0			Button Button49 disable=0			Button Button_copy_traces disable=0			Button But_sym_edc disable=0			Button Button47 disable=0							Button Button58 disable=0							Button Button59 disable=0							Button buttonhelptools2 disable=0		Button Button94 disable=0																Button Button14 disable=1			Button Buttonefedc disable=1			Button ButtonEFimage disable=1			Button ColorEDCnow disable=1		PopupMenu inversecoloredc disable=1		PopupMenu edccolorset disable=1		GroupBox grouplotoftraces disable=1		GroupBox grouplegend disable=1		Button ButtonintBE disable=1			Button ButtonintKE disable=1			Button ButtonBEangle disable=1			Button ButtonKEangle disable=1				Button buttonBEvsmom_pi disable=1			Button buttonBEvsmom_pi1 disable=1				Button buttonBEvshv disable=1						PopupMenu mirror_onoff disable=1		PopupMenu popupthicks_inout disable=1		Button buttonhelptools3 disable=1		Button Button90 disable=1							Button Button74 disable=1		Setvariable setvargrnum disable=1		Slider topimagetop disable=1		Slider topimagebot disable=1												Button button_a_up disable=1				Button button_a_down disable=1				Button button_a_both disable=1		Button button_0_up disable=1				Button button_0_down disable=1								PopupMenu popupmatcolor disable=1					PopupMenu popupinvmatcolor disable=1					GroupBox Matcolorscalegroup disable=1					PopupMenu colordefault_menu disable=1		PopupMenu popup_colordefault_inv disable=1						Button Button12 disable=1			Button Button13 disable=1			Button Button15 disable=1			Button Button37 disable=1			Button Button38 disable=1			Button Button39 disable=1			Button Button40 disable=1			Button Button55 disable=1			Button Button56 disable=1					Button But_rm_simpleedc disable=1			Button But_rm_mat disable=1					GroupBox groupsaveload disable=1								GroupBox groupRmback disable=1								GroupBox groupfinddispersion disable=1			Button buttonhelptools4 disable=1 							Button button10 disable=1 							Button button60 disable=1 							Button button61 disable=1 		GroupBox groupimage disable=1										Button button95 disable=1 											Endif	IF(tabNum==2)		Button Button36 disable=1		Button Button43 disable=1		Button Button8 disable=1		Button Button21 disable=1		Button Button2001 disable=1		Button Button20 disable=1		Button Button23 disable=1		Button Button19 disable=1		Button Button18 disable=1		Button Button7 disable=1		Button Button6 disable=1		Button Button36 disable=1		Button Button31 disable=1		Button Button16 disable=1		Button Button17 disable=1				Button Button41 disable=1		Button Button42 disable=1				Button Button48 disable=1				Button Button50 disable=1							Button Button51 disable=1							Button Button52 disable=1							GroupBox groupstepsize disable=1			Button buttonhelptools1 disable=1		Button Button4 disable=1		Button button72 disable=1				Button button89 disable=1				Button Button91 disable=1				Button Button92 disable=1				Button Button93 disable=1													Button Button34 disable=1			Button Button49 disable=1			Button Button_copy_traces disable=1			Button But_sym_edc disable=1			Button Button47 disable=1							Button Button58 disable=1							Button Button59 disable=1							Button buttonhelptools2 disable=1							Button Button94 disable=1									Button Button14 disable=0			Button Buttonefedc disable=0			Button ButtonEFimage disable=0			Button ColorEDCnow disable=0		PopupMenu inversecoloredc disable=0		PopupMenu edccolorset disable=0		GroupBox grouplotoftraces disable=0		GroupBox grouplegend disable=0		Button ButtonintBE disable=0			Button ButtonintKE disable=0			Button ButtonBEangle disable=0			Button ButtonKEangle disable=0				Button buttonBEvsmom_pi disable=0			Button buttonBEvsmom_pi1 disable=0				Button buttonBEvshv disable=0						PopupMenu mirror_onoff disable=0		PopupMenu popupthicks_inout disable=0		Button buttonhelptools3 disable=0		Button Button90 disable=0					Button Button74 disable=1		Setvariable setvargrnum disable=1			Slider topimagetop disable=1		Slider topimagebot disable=1											Button button_a_up disable=1				Button button_a_down disable=1				Button button_a_both disable=1		Button button_0_up disable=1				Button button_0_down disable=1								PopupMenu popupmatcolor disable=1					PopupMenu popupinvmatcolor disable=1					GroupBox Matcolorscalegroup disable=1					PopupMenu colordefault_menu disable=1		PopupMenu popup_colordefault_inv disable=1				Button Button12 disable=1			Button Button13 disable=1			Button Button15 disable=1			Button Button37 disable=1			Button Button38 disable=1			Button Button39 disable=1			Button Button40 disable=1			Button Button55 disable=1			Button Button56 disable=1					Button But_rm_simpleedc disable=1			Button But_rm_mat disable=1					GroupBox groupsaveload disable=1								GroupBox groupRmback disable=1								Button buttonhelptools4 disable=1 							GroupBox groupfinddispersion disable=1								Button button10 disable=1 							Button button60 disable=1 							Button button61 disable=1 		GroupBox groupimage disable=1										Button button95 disable=1 											Endif	IF(tabNum==3)		Button Button36 disable=1		Button Button43 disable=1		Button Button8 disable=1		Button Button21 disable=1		Button Button2001 disable=1		Button Button20 disable=1		Button Button23 disable=1		Button Button19 disable=1		Button Button18 disable=1		Button Button7 disable=1		Button Button6 disable=1		Button Button36 disable=1		Button Button31 disable=1		Button Button16 disable=1		Button Button17 disable=1				Button Button41 disable=1		Button Button42 disable=1				Button Button48 disable=1				Button Button50 disable=1							Button Button51 disable=1							Button Button52 disable=1							GroupBox groupstepsize disable=1			Button buttonhelptools1 disable=1		Button Button4 disable=1		Button button72 disable=1		Button button89 disable=1				Button Button91 disable=1				Button Button92 disable=1				Button Button93 disable=1															Button Button34 disable=1			Button Button49 disable=1			Button Button_copy_traces disable=1			Button But_sym_edc disable=1			Button Button47 disable=1							Button Button58 disable=1							Button Button59 disable=1							Button buttonhelptools2 disable=1							Button Button94 disable=1									Button Button14 disable=1			Button Buttonefedc disable=1			Button ButtonEFimage disable=1			Button ColorEDCnow disable=1		PopupMenu inversecoloredc disable=1		PopupMenu edccolorset disable=1		GroupBox grouplotoftraces disable=1		GroupBox grouplegend disable=1		Button ButtonintBE disable=1			Button ButtonintKE disable=1			Button ButtonBEangle disable=1			Button ButtonKEangle disable=1				Button buttonBEvsmom_pi disable=1			Button buttonBEvsmom_pi1 disable=1				Button buttonBEvshv disable=1						PopupMenu mirror_onoff disable=1		PopupMenu popupthicks_inout disable=1		Button buttonhelptools3 disable=1		Button Button90 disable=1							Button Button74 disable=0		Setvariable setvargrnum disable=0		Slider topimagetop disable=0		Slider topimagebot disable=0								Button button_a_up disable=0				Button button_a_down disable=0				Button button_a_both disable=0		Button button_0_up disable=0				Button button_0_down disable=0								PopupMenu popupmatcolor disable=0					PopupMenu popupinvmatcolor disable=0					GroupBox Matcolorscalegroup disable=0					PopupMenu colordefault_menu disable=0		PopupMenu popup_colordefault_inv disable=0								Button Button12 disable=1			Button Button13 disable=1			Button Button15 disable=1			Button Button37 disable=1			Button Button38 disable=1			Button Button39 disable=1			Button Button40 disable=1			Button Button55 disable=1			Button Button56 disable=1					Button But_rm_simpleedc disable=1		Button But_rm_mat disable=1		GroupBox groupsaveload disable=1								GroupBox groupRmback disable=1								Button buttonhelptools4 disable=1 							GroupBox groupfinddispersion disable=1								Button button10 disable=1 							Button button60 disable=1 							Button button61 disable=1 		GroupBox groupimage disable=1										Button button95 disable=1 											Endif				IF(tabNum==4)		Button Button36 disable=1		Button Button43 disable=1		Button Button8 disable=1		Button Button21 disable=1		Button Button2001 disable=1		Button Button20 disable=1		Button Button23 disable=1		Button Button19 disable=1		Button Button18 disable=1		Button Button7 disable=1		Button Button6 disable=1		Button Button36 disable=1		Button Button31 disable=1		Button Button16 disable=1		Button Button17 disable=1				Button Button41 disable=1		Button Button42 disable=1				Button Button48 disable=1				Button Button50 disable=1							Button Button51 disable=1							Button Button52 disable=1							GroupBox groupstepsize disable=1			Button buttonhelptools1 disable=1		Button Button4 disable=1		Button button72 disable=1		Button button89 disable=1				Button Button91 disable=1				Button Button92 disable=1				Button Button93 disable=1															Button Button34 disable=1			Button Button49 disable=1			Button Button_copy_traces disable=1			Button But_sym_edc disable=1			Button Button47 disable=1							Button Button58 disable=1							Button Button59 disable=1							Button buttonhelptools2 disable=1							Button Button94 disable=1									Button Button14 disable=1			Button Buttonefedc disable=1			Button ButtonEFimage disable=1			Button ColorEDCnow disable=1		PopupMenu inversecoloredc disable=1		PopupMenu edccolorset disable=1		GroupBox grouplotoftraces disable=1		GroupBox grouplegend disable=1		Button ButtonintBE disable=1			Button ButtonintKE disable=1			Button ButtonBEangle disable=1			Button ButtonKEangle disable=1				Button buttonBEvsmom_pi disable=1			Button buttonBEvsmom_pi1 disable=1				Button buttonBEvshv disable=1						PopupMenu mirror_onoff disable=1		PopupMenu popupthicks_inout disable=1		Button buttonhelptools3 disable=1		Button Button90 disable=1							Button Button74 disable=1		Setvariable setvargrnum disable=1		Slider topimagetop disable=1		Slider topimagebot disable=1								Button button_a_up disable=1				Button button_a_down disable=1				Button button_a_both disable=1		Button button_0_up disable=1				Button button_0_down disable=1								PopupMenu popupmatcolor disable=1					PopupMenu popupinvmatcolor disable=1					GroupBox Matcolorscalegroup disable=1					PopupMenu colordefault_menu disable=1		PopupMenu popup_colordefault_inv disable=1								Button Button12 disable=0			Button Button13 disable=0			Button Button15 disable=0			Button Button37 disable=0			Button Button38 disable=0			Button Button39 disable=0			Button Button40 disable=0			Button Button55 disable=0			Button Button56 disable=0					Button But_rm_simpleedc disable=0			Button But_rm_mat disable=0		GroupBox groupsaveload disable=0								GroupBox groupRmback disable=0								Button buttonhelptools4 disable=0 							GroupBox groupfinddispersion disable=0								Button button10 disable=0 							Button button60 disable=0 							Button button61 disable=0 		GroupBox groupimage disable=0										Button button95 disable=0 											Endif						return 0EndProc MakeEdc_pi(edcstart,edcend,addnum,one_each)	Variable edcstart=0,edcend=-1,addnum=5,one_each=5	Prompt edcstart,"Input the start num"	Prompt edcend, "Input the end num (-1=END)"	Prompt addnum,"Input the Num to be combined (odd number)"	Prompt one_each,"Show one curve each ...?"	PauseUpdate 	Silent 1		String thisEDCname,thismatname	Variable i	Variable j	Variable jstart, jend	Variable comb	thismatname="Data"+Num2Str(gv_groupnum)	If(edcend<0)		edcend=dimsize($thismatname,0)-1	Endif	Display	i=edcstart	Do		thisEDCname="E"+num2str(gv_groupnum)+"_"+num2str(i)		Make/O/N=(dimsize($thismatname,1)) $thisEDCname		Setscale/P x,dimoffset($thismatname,1),dimdelta($thismatname,1),""$thisEDCname		$thisEDCname[]=0		jstart=i-(addnum-1)/2		jend=i+(addnum-1)/2		If(jstart<0)			jstart=0		Endif		If(jend>(dimsize($thismatname,0)-1))			jend=dimsize($thismatname,0)-1		Endif		comb=0		j=jstart		Do			$thisEDCname[]+=$thismatname[j][p]			comb+=1			j+=1		While(j<jend+1)		$thisEDCname[]/=comb		Appendtograph $thisEDCname		i+=one_each	While(i<=edcend)EndProc MakeMDC_pi(mdcstart,mdcend,addnum,one_each)	Variable mdcstart=0,mdcend=-1,addnum=5,one_each=5	Prompt mdcstart,"Input the start num"	Prompt mdcend, "Input the end num (-1=END)"	Prompt addnum,"Input the Num to be combined (odd number)"	Prompt one_each,"Show one curve each ...?"	PauseUpdate 	Silent 1		String thisMDCname,thismatname	Variable i	Variable j	Variable jstart, jend	Variable comb	thismatname="Data"+Num2Str(gv_groupnum)	If(mdcend<0)		mdcend=dimsize($thismatname,1)-1	Endif	Display	i=mdcstart	Do		thisMDCname="M"+num2str(gv_groupnum)+"_"+num2str(i)		Make/O/N=(dimsize($thismatname,0)) $thisMDCname		Setscale/P x,dimoffset($thismatname,0),dimdelta($thismatname,0),""$thisMDCname		$thisMDCname[]=0		jstart=i-(addnum-1)/2		jend=i+(addnum-1)/2		If(jstart<0)			jstart=0		Endif		If(jend>(dimsize($thismatname,1)-1))			jend=dimsize($thismatname,1)-1)		Endif		comb=0		j=jstart		Do			$thisMDCname[]+=$thismatname[p][j]			comb+=1			j+=1		While(j<jend+1)		$thisMDCname[]/=comb		Appendtograph $thisMDCname		i+=one_each	While(i<=mdcend)EndProc sum_first(which,how_much)        string MatName        variable which, how_much	variable i=10// start k position	variable j=0	variable temp=0	MatName="Data"+Num2Str(which)	pauseUpdate	silent 1	Do	     j=0	     Do	     	temp+=$MatName[i][j]		j+=1	     While(j<how_much)		i+=1	While(i<100)	print tempEndProc compare_mdc(number)	Variable number	Variable i,j	Variable number_of_x	Variable axe_x	Variable delta_axe_x	String wname,mwave//, banane	number_of_x=pcsr(B)-pcsr(A)+1	i=0	Make/D/O/N=(number_of_x) mdcfit_selected	Make/D/O/N=(number_of_x) vector_x        wname="M"+Num2Str(gv_groupNum)+"_"+Num2Str(number)        mwave="store_m"        delta_axe_x=(xcsr(B)-xcsr(A))/number_of_x        axe_x=xcsr(A)	Do 		mdcfit_selected[i]=0		mdcfit_selected[i]=$mwave[0]+$mwave[1]/((axe_x-$mwave[2])^2+$mwave[3]^2)		vector_x[i]=axe_x		i+=1		axe_x+=delta_axe_x	While(i<number_of_x)        	Display	Append $wname	Append mdcfit_selected vs vector_x	ModifyGraph rgb(mdcfit_selected)=(0,15872,65280)	modifygraph width=150, height=150	modifygraph width=0, height=0		TextBox/C/N=text0/F=0/S=3/A=MC wname	TextBox/C/N=text0/A=LT/X=15/Y=-0.80End//********************************************************************************************************************************Proc Copytraces(prefix)	String prefix	Prompt prefix,"Enter a prefix:"	PauseUpdate	Silent 1	String alltraces	String thisname	String thisxname		String newname	String newxname				Variable i	alltraces=TraceNameList("",";",1)	Make/O/T/N=(ItemsInList(alltraces,";")) listofwavey	Make/O/T/N=(ItemsInList(alltraces,";")) listofwavex		i=0	Do		thisname=stringfromlist(i,alltraces,";")		thisxname=NameOfWave(XWaveRefFromTrace("",thisname))		listofwavey[i]=thisname		listofwavex[i]=thisxname		i+=1	While(i<ItemsInList(alltraces,";"))	Display 	i=0	Do		thisname=listofwavey[i]		thisxname=listofwavex[i]		newname=prefix+thisname		newxname=prefix+thisxname		Duplicate/O $thisname $newname		If(Exists(thisxname)==1)			Duplicate/O $thisxname $newxname			Appendtograph $newname vs $newxname			Else				Appendtograph $newname		Endif			i+=1	While(i<ItemsInList(alltraces,";"))End//********************************************************************************************************************************Proc Get_ledge_edc(edcname,fermi_level,search_halfwindow)	String edcname	Variable fermi_level=0	Variable search_halfwindow=0.1	Prompt edcname,"Name of the wave:"	Prompt fermi_level,"Fermi level:"	Prompt search_halfwindow,"Enter the half window size:"	PauseUpdate	Silent 1	Variable ledge_value	Duplicate/O $edcname tempwave	Smooth/E=3/B=3 3, tempwave	Differentiate tempwave	Smooth/E=3/B=3 3, tempwave	Wavestats/Q/R=(fermi_level-search_halfwindow,fermi_level+search_halfwindow) tempwave	ledge_value=fermi_level-V_minloc				Killwaves tempwave	Print ledge_valueEnd//********************************************************************************************************************************//Proc appendcalculation(wavefrom,waveto,firstwave4x,firstwave4y,firstwave4weight,center,period)  //variable wavefrom,waveto,firstwave4x,firstwave4y,firstwave4weight,center,period  //Prompt wavefrom,"wavefrom"  //Prompt waveto,"waveto"  //Prompt firstwave4x,"1stX"  //Prompt firstwave4y,"1stY"  //Prompt firstwave4weight,"1stWeight"  //Prompt center,"symcenter"  //Prompt period,"period"  //PauseUpdate  //Silent 1 // string namewavex,namewavey,namewaveweight  //string namewave_x,namewave_y//namewave_weight  //namewavex="wave"+num2str(firstwave4x)   //duplicate/o $namewavex,plotx  //plotx-=center  //duplicate/o plotx,plot_x  //duplicate/o plotx,plotxx  //duplicate/o plotx,plot_xx   //plot_x*=-1  //print plot_x,plotx  //plotxx-=2*period  //plot_xx=plot_x+2*period  //namewavey="wave"+num2str(firstwave4y)  //duplicate/o $namewavey,ploty  //namewaveweight="wave"+num2str(firstwave4weight)//duplicate/o $namewaveweight,plotweight//appendtograph ploty vs plotx//appendtograph ploty vs plot_x//ModifyGraph zmrkSize(plotx)={namewave[plotweight],*,*,1,10}  //variable i,p  //i=wavefrom //if(i<(waveto+1)/3)     // p=3*i      //namewaveweight="wave"+num2str(firstwave4weight+p)      //namewave_y="wave"+num2str(p+firstwave4y)      //duplicate/o $namewave_y,ploty   // namewave_weight="wave"+num2str(p+firstwave4weight)  //ModifyGraph zmrkSize(plotx)={namewave[plot_weight],*,*,1,10}     //appendtograph $namewave_y vs plot_x     //ModifyGraph zColor(namewave_y)={namewaveweight,*,*,YellowHot}     //appendtograph $namewave_y vs plotx     //ModifyGraph zColor(namewave_y)={namewaveweight,*,*,YellowHot}     //appendtograph $namewave_y vs plotxx     //ModifyGraph zColor(namewave_y)={namewaveweight,*,*,YellowHot}     //appendtograph $namewave_y vs plot_xx     //ModifyGraph zColor(namewave_y)={namewaveweight,*,*,YellowHot}     //print namewave_x,namewave_y//namewave_weight     //i+=1 //endif//end//********************************************************************************************************************************Proc apporbital_zlk(wavefrom,waveto,filp,offset)	Variable wavefrom	variable waveto	variable filp	variable offset	variable p	string wavex,wavey,plotx	Prompt wavefrom, "Enter the wave start?"	Prompt waveto,"Enter the wave end?"	Prompt  flip,"need to filp or not?",popup "flip;not flip"	Prompt offset,"How much do you want to add?"	PauseUpdate	Silent 1	If(flip==1)	wavex="wave"+num2str(wawefrom)	duplicate/o $wavex,plotx	plotx*=-1      plotx+=2*offset	   for(p=wavefrom;p<waveto;p+=3)           wavey="wave"+num2str(p+1)           appendtograph $wavey vs plotx           print wavey          endfor	Else	   wavex="wave"+num2str(wawefrom)	   duplicate/o $wavex,plotx	   plotx+=offset	    for(p=wavefrom;p<waveto;p+=3)           wavey="wave"+num2str(p+1)           appendtograph $wavey vs plotx           print wavey	     endfor	Endif				End//********************************************************************************************************************************Proc rescale_pi(mat,orientation,amount)	String mat	Variable orientation	Variable amount	Prompt mat, "Enter the name of the matrix you want the rescale"	Prompt orientation,"You want to rescale the angle or the energy?",popup "angle;energy"	Prompt amount,"How much do you want to add?"	PauseUpdate	Silent 1	Variable old_0,delta_old	If(orientation==1)		old_0=dimoffset($mat,0)		delta_old=dimdelta($mat,0)		setscale/p x (old_0+amount), delta_old, "", $mat		Else			old_0=dimoffset($mat,1)			delta_old=dimdelta($mat,1)			setscale/p y (old_0+amount), delta_old, "", $mat	Endif				End//********************************************************************************************************************************Proc makewave_zlk(wavefrom,waveto)         variable wavefrom,waveto         prompt wavefrom,"wavefrom"         prompt waveto,"waveto"         pauseupdate         silent 1         variable i         if(i==1)         make wave[i]         edit wave[i]         i+=1         endif   end//********************************************************************************************************************************Proc RoughMapping_zlk(datafrom,datato,anglefrom,angledelta,slices)      Variable datafrom,datato,anglefrom,angledelta,slices	Prompt datafrom,"mapping datafrom"	Prompt datato,"mapping datato"	Prompt  anglefrom,"anglefrom"	Prompt angledelta,"angledelta"	Prompt slices,"data total slices"	PauseUpdate	Silent 1	string cutname	cutname="data"+num2str(datafrom)	make/n=(datato-datafrom+1,dimsize($cutname,1),dimsize($cutname,0))/o mat3d	setscale/p x,anglefrom,angledelta,mat3d	setscale/p z,dimoffset($cutname,0),dimdelta($cutname,0),mat3d	setscale/p y,dimoffset($cutname,1),dimdelta($cutname,1),mat3d	variable i	i=datafrom	Do		cutname="data"+num2str(i)		duplicate/o $cutname t_temp		mat3d[i-datafrom][][]=t_temp[r][q]		i+=1	while(i<=datato)	killwaves t_temp	variable/g mappingdataend=datato      if(Wintype("mat3d_fs_ploter")==0)		Execute "initmat3d()"			Execute "mat3d_fs_ploter()"			Execute "initmat3d()"			Else			Dowindow/F mat3d_fs_ploter			Execute "mat3d_eplot()"	Endif	   Execute "MakeImageTable()"	   Redimension/N=(datato-datafrom+1) ImageIndex,Imagetheta,imagephi,wavest,waveed,waveetast,waveetaed          imageindex=datafrom+p;          imagephi=anglefrom+angledelta*p          waveed=slices          waveetaed=slices          Execute "MakeCutTable()"          duplicate/o imagephi,phiindex     //Proc Generate_chunklist(imtheta,imphi1,imphi2,number)	//Variable imtheta	//Variable imphi1	//imphi1=anglefrom	//Variable imphi2	//imphi2=(datato-datafrom)*angledelta+anglefrom	//Variable number	//Prompt imtheta,"Enter the theta angle from Image_Table"	//Prompt imphi1,"Enter the lowest phi angle from Image_Table"		//Prompt imphi2,"Enter the highest phi angle from Image_Table"		//Prompt number,"Number of the chunkcut"	//PauseUpdate;silent 1	//String thelist,thisstring	//Variable newadd	//If(number>dimsize(chunkcutlist,0)-1)		//newadd=number-dimsize(chunkcutlist,0)+1		//Insertpoints dimsize(chunkcutlist,0),newadd,chunkcutlist		//Insertpoints dimsize(chunkcutlist,0),newadd,chunketafirst		//Insertpoints dimsize(chunkcutlist,0),newadd,chunketalast		//Insertpoints dimsize(chunkcutlist,0),newadd,chunkfixedangle					//Endif	//Chunkcutlist[number]=Func_Generate_chunklist(imageindex,imagetheta,imagephi,imtheta,imphi1,imphi2)	//thelist=Chunkcutlist[number]	//thisstring=Stringfromlist(0,thelist,";")	//chunketafirst[number]=waveetast[str2num(thisstring)]	//chunketalast[number]=waveetaed[str2num(thisstring)]	//chunkfixedangle[number]=imtheta          	    end    //********************************************************************************************************************************Proc dwavefit_zlk(curve,d0,dn)	String curve	Variable orientation	Variable amount;	Prompt curve, "Enter the curve  need to fit"	Prompt d0, "Enter the value of d0"	Prompt dn, "Enter the value of dn"	//Prompt amount,"what scale do you want to setscale?(divided)"	PauseUpdate	Silent 1	FuncFit wave_energy=d0+dn*cos(wave_angle*pi/90)	Variable old_0,delta_old	If(orientation==1)		old_0=dimoffset($mat,0)		delta_old=dimdelta($mat,0)		setscale/p x, dimoffset($mat,0)/amount, dimdelta($mat,0)/amount, $mat		Else			old_0=dimoffset($mat,1)			delta_old=dimdelta($mat,1)                    setscale/p y,dimoffset($mat,1)/amount, dimdelta($mat,1)/amount, $mat	        Endif				End//********************************************************************************************************************************Proc setscale_zlk(mat,orientation,amount)	String mat	Variable orientation	Variable amount;	Prompt mat, "Enter the name of the matrix you want the setscale"	Prompt orientation,"You want to setscale the angle or the energy?",popup "angle;energy"	Prompt amount,"what scale do you want to setscale?(divided)"	PauseUpdate	Silent 1	Variable old_0,delta_old	If(orientation==1)		old_0=dimoffset($mat,0)		delta_old=dimdelta($mat,0)		setscale/p x, dimoffset($mat,0)/amount, dimdelta($mat,0)/amount, $mat		Else			old_0=dimoffset($mat,1)			delta_old=dimdelta($mat,1)                    setscale/p y,dimoffset($mat,1)/amount, dimdelta($mat,1)/amount, $mat	        Endif				End//********************************************************************************************************************************Proc edc_to_zero_pi(mat,start,Combined)	String mat	Variable start=100	Variable Combined=5	Prompt mat,"Enter the name of the matrix"	Prompt Start,"Enter the number of the starting energy index"		Prompt Combined,"Enter the number of combined EDC"		PauseUpdate	Silent 1				Variable i,j	Variable num_mdc,num_edc,addition,number_add	String wname	num_mdc=dimsize($mat,1)	num_edc=dimsize($mat,0)	number_add=num_mdc-start	j=0	Do	wname="e"+mat+"_"+num2str(Combined)+"_"+num2istr(j)	i=start	addition=0		Do 			addition+=$wname[i]			i+=1		While(i<num_mdc)	i=0	 		$wname[]-=(addition/number_add)	j+=1	While(j<num_edc)      End//*******************************************************************************************************************************Function tbfunc(w,x,y) : FitFunc	Wave w	Variable x	Variable y	variable e=0	e+=w[0]	e+=w[1]*0.5*(cos(x*pi)+cos(y*pi))	e+=w[2]*cos(x*pi)*cos(y*pi)//+w[3]*0.5*(cos(2*x*pi)+cos(2*y*pi))//	e+=w[4]*0.5*(cos(2*x*pi)*cos(y*pi)+cos(x*pi)*cos(2*y*pi))//	e+=w[5]*cos(2*x*pi)*cos(2*y*pi)	return e	End//*******************************************************************************************************************************Proc tbfit(name)	String name	Prompt name,"Enter the name of the sample"	PauseUpdate	Silent 1	String xname,yname,ename,wname	String parameters	Variable i,j,condition	xname="x_"+name+"tofit"	yname="y_"+name+"tofit"	ename="e_"+name+"tofit"	wname="w_"+name+"tofit"	parameters=name+"_parameters"	Make/O/T/N=3 Constraints//	Constraints[0]={"K0<1"}//	Constraints[1]={"K1>0.005"}//	Constraints[2]={"K1<-0.01"}	Constraints[0]={"K0>0.640"}	Constraints[1]={"K1<-1"}	Constraints[2]={"K2>0.5"}//	Constraints[3]={"K3<-0.01"}	$parameters[0]=0.640 //-0.0219558	$parameters[1]=-1.795 //-0.955688	$parameters[2]=0.819 //0.17427	If(Waveexists($parameters)==0)		Make/O/N=3 $parameters		$parameters[0]=0.53 //-0.0219558		$parameters[1]=-1.575 //-0.955688		$parameters[2]=0.85 //0.17427//		$parameters[3]=-0.100922//		$parameters[4]=0.0784802//		$parameters[5]=0	Endif//	$parameters[4]=0//	FuncFit/H="000001" tbfunc $parameters  $ename  /X={$xname,$yname} /W=$wname /D  /C=Constraints	FuncFit/H="000" tbfunc $parameters  $ename  /X={$xname,$yname} /W=$wname /D   /C=Constraints	edit $parametersEnd	//*******************************************************************************************************************************Function PopMenuProc_colordefault(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	String/G colordefault	colordefault=popStrEnd//*******************************************************************************************************************************Function PopMenuProc_colordefaultinv(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G colordefaultinv	Variable i	colordefaultinv=popNum-1End//*******************************************************************************************************************************Proc real_im_waves(thiswave)	String thiswave	Prompt thiswave,"Enter the name of the wave"	PauseUpdate	Silent 1	String newreal,newim	newreal="real_"+thiswave	newim="im_"+thiswave	Make/O/N=(dimsize($thiswave,0)) $newreal	Make/O/N=(dimsize($thiswave,0)) $newim	Setscale/P x,dimoffset($thiswave,0),dimdelta($thiswave,0),""$newreal	Setscale/P x,dimoffset($thiswave,0),dimdelta($thiswave,0),""$newim		print dimsize($thiswave,0), 	$newreal[]=real($thiswave[p])	$newim[]=imag($thiswave[p])	End	//*******************************************************************************************************************************Proc FFTfiltermat(thismat)	String thismat	Prompt thismat,"Enter the name of the matrix"	PauseUpdate	Silent 1	If(mod(dimsize($thismat,0),2)==1)		Duplicate/O/R=[0,dimsize($thismat,0)-2][*] $thismat tempmat		Duplicate/O tempmat $thismat		killwaves tempmat	Endif	funcFFTfilterdata($thismat,FFTfilterlist)End	//*******************************************************************************************************************************Proc FFTlist()	PauseUpdate	Silent 1	IF(wintype("FFTlistwindow")==2)		Dowindow/F FFTlistwindow	Endif	IF(wintype("FFTlistwindow")==0)		IF(exists("FFTfilterlist")==0)			Make/O/N=0 FFTfilterlist			Edit FFTfilterlist			Dowindow/C FFTlistwindow			Else				Edit FFTfilterlist				Dowindow/C FFTlistwindow					Endif	Endif			End	//*******************************************************************************************************************************Proc FFTfilterdata()	PauseUpdate	Silent 1	Variable/G gv_GroupNum	String thisdata	thisdata="data"+num2str(gv_GroupNum)	If(mod(dimsize($thisdata,0),2)==1)		Duplicate/O/R=[0,dimsize($thisdata,0)-2][*] $thisdata tempmat		Duplicate/O tempmat $thisdata		killwaves tempmat	Endif		funcFFTfilterdata($thisdata,FFTfilterlist)End	//*******************************************************************************************************************************Function funcFFTfilterdata(matname,badlist)	Wave matname	Wave badlist	PauseUpdate	Silent 1	Variable i,j	Variable realvalue,imvalue	i=0	Do		Make/O/N=(dimsize(matname,0)) thiswave		Setscale/P x,dimoffset(matname,0),dimdelta(matname,0),""thiswave		thiswave[]=matname[p][i]		fft/DEST=ffted thiswave		Make/O/N=(dimsize(ffted,0)) realwave		Make/O/N=(dimsize(ffted,0)) imwave		Make/O/N=(dimsize(ffted,0)) xwave		Setscale/P x,dimoffset(ffted,0),dimdelta(ffted,0),""realwave		Setscale/P x,dimoffset(ffted,0),dimdelta(ffted,0),""imwave			realwave[]=real(ffted[p])		imwave[]=imag(ffted[p])		xwave[]=dimoffset(ffted,0)+p*dimdelta(ffted,0)		Duplicate/O badlist sortedbad		Sort/R sortedbad sortedbad		j=0		Do			Deletepoints badlist[j],1,realwave			Deletepoints badlist[j],1,imwave			Deletepoints badlist[j],1,xwave						j+=1		While(j<dimsize(badlist,0))		Duplicate/O realwave srealwave		Duplicate/O imwave simwave		Smooth/E=3/B=3 3,srealwave		Smooth/E=3/B=3 3,simwave		realwave[Round(dimsize(realwave,0)/2),*]=srealwave[p]		imwave[Round(dimsize(realwave,0)/2),*]=simwave[p]		j=0		Do			realvalue=Interp(dimoffset(ffted,0)+badlist[j]*dimdelta(ffted,0),xwave,realwave)			imvalue=Interp(dimoffset(ffted,0)+badlist[j]*dimdelta(ffted,0),xwave,imwave)						ffted[badlist[j]]=Cmplx(realvalue,imvalue)			j+=1		While(j<dimsize(badlist,0))		ifft ffted		Setscale/P x,dimoffset(matname,0),dimdelta(matname,0),""ffted		matname[][i]=ffted[p]		i+=1	While(i<dimsize(matname,1))	Killwaves thiswave,realwave,imwave,sortedbad,fftedEnd//*******************************************************************************************************************************Proc combineH_all(matname)	String matname	PauseUpdate	Silent 1	Variable i	String Res_name	Res_name=matname+"_Hall"	Make/O/N=(dimsize($matname,0)) $Res_name	Setscale/P x, dimoffset($matname,0),dimdelta($matname,0),""$Res_name	$Res_name[]=0	i=0	Do		$Res_name[]+=$matname[p][i]		i+=1	While(i<dimsize($matname,1))	$Res_name[]/=dimsize($matname,1)End			//********************************************************************************************************************************Proc Table_Notthesepoints()	PauseUpdate	Silent 1	String thename	Variable i	Variable condition	Variable/G NTP_num	Variable/G NTP_num_max	if(winType("Not_these_points")==2)		DoWindow /F Not_these_points	endif	if(wintype("Not_these_points")==0)		Edit		DoWindow /C Not_these_points		NTP_num=0		NTP_num_max=0		If(Exists("NTP_comments")==1)			appendtotable NTP_comments			Else				Make/O/T/N=1 NTP_comments				NTP_comments[0]="N/A"				appendtotable NTP_comments		Endif							i=1		condition=1		Do			thename="NTP"+num2str(i)			If(Exists(thename)==1)				appendtotable $thename				i+=1				Else					condition=0			Endif					While(condition==1)	endif		End	//*******************************************************************************************************************************Proc sym_one_edc(edcname,Fermi_level)	String edcname	Variable Fermi_level=0	Prompt edcname,"Enter the name of the EDC"	Prompt Fermi_level,"Fermi level:"	PauseUpdate	Silent 1	String newname="sym_"+edcname	Variable newlength,newsize	Variable i	newlength=-2*(dimoffset($edcname,0)-Fermi_level)	newsize=newlength/dimdelta($edcname,0)+1	Make/O/N=(newsize) new1	Setscale/P x, dimoffset($edcname,0)-Fermi_level,dimdelta($edcname,0),""new1	new1[]=0	i=0	Do		new1[i]=$edcname[i]		i+=1	While(i<dimsize($edcname,0))	Duplicate/O new1 new2	i=0	Do		new2[i]=new1[dimsize(new1,0)-1-i]		i+=1	While(i<dimsize(new1,0))	Duplicate/O new2 new2x	new2x[]=-(dimoffset(new1,0)+(dimsize(new1,0)-1)*dimdelta(new1,0)-p*dimdelta(new1,0))	Duplicate/O new1 $newname	$newname[]=new1[p]+interp(dimoffset(new1,0)+p*dimdelta(new1,0),new2x,new2)	killwaves new1,new2		End//*******************************************************************************************************************************Proc sym_kf_edcs(Fermi_level,avg_num,backgnd_type,num_back,normfrom,normto)	Variable Fermi_level=0	Variable avg_num=3	Variable backgnd_type	Variable num_back	Variable normfrom=0	Variable normto=10	Prompt Fermi_level,"Fermi level:"	Prompt avg_num,"Number of averged EDCs (odd):"	Prompt backgnd_type,"Background type:",popup "Flat;Linear;None"	Prompt num_back,"Points for background fitting:"	Prompt normfrom,"Normalize from (-1=no normalization):"	Prompt normto,"Normalize to (index):"			PauseUpdate	Silent 1	String thiscut	String newname	String list_of_the_traces,thistrace	String NTPname	Variable j,i	Variable angle_position	Variable condition_NTP	Variable avgnorm	IF(wintype("symedcatkf")==0)		Display		Dowindow/C symedcatkf		Else			Dowindow/F symedcatkf			list_of_the_traces=TraceNameList("symedcatkf",";", 1 )			i=0			Do				thistrace=stringfromlist(i,list_of_the_traces,";")				removefromgraph $thistrace				i+=1			While(i<ItemsInList(list_of_the_traces,";"))	Endif	NTPname="NTP"+num2str(NTP_num)	j=0	Do		If(NTP_num>0)				Condition_NTP=checkNTP($NTPname,j)			Else				Condition_NTP=1		Endif		If(Condition_NTP==1)			If(src_vs_bnl==1)				thiscut="cut"+num2str(original_theta[j])				angle_position=Round((original_phi[j]-dimoffset($thiscut,0))/dimdelta($thiscut,0))				Else					thiscut="cut"+num2str(original_phi[j])					angle_position=Round((original_theta[j]-dimoffset($thiscut,0))/dimdelta($thiscut,0))						Endif			Make/O/N=(dimsize($thiscut,1)) tempwave			Setscale/P x,dimoffset($thiscut,1),dimdelta($thiscut,1),""tempwave			i=angle_position-Round((avg_num-1)/2)			tempwave[]=0			Do				tempwave[]+=$thiscut[i][p]				i+=1			While(	i<angle_position+Round((avg_num-1)/2)+1)			tempwave[]/=avg_num			If((backgnd_type==1)||(backgnd_type==2))				Remove_simplebgnd_edc("tempwave",backgnd_type,num_back)					Endif			if(normfrom>=0)				avgnorm=mean(tempwave,pnt2x(tempwave,normfrom),pnt2x(tempwave,normto))				tempwave[]/=avgnorm			Endif			sym_one_edc("tempwave",Fermi_level)			newname="symEDC_kf"+num2str(j)			Duplicate/O sym_tempwave $newname			appendtograph $newname		Endif		j+=1	While(j<dimsize(original_theta,0))	killwaves tempwave,sym_tempwave		End//*******************************************************************************************************************************Proc Plot_kf_edcs(Fermi_level,avg_num,backgnd_type,num_back,normfrom,normto)	Variable Fermi_level=0	Variable avg_num=3	Variable backgnd_type	Variable num_back	Variable normfrom=0	Variable normto=10	Prompt Fermi_level,"Fermi level:"	Prompt avg_num,"Number of averged EDCs (odd):"	Prompt backgnd_type,"Background type:",popup "Flat;Linear;None"	Prompt num_back,"Points for background fitting:"	Prompt normfrom,"Normalize from (-1=no normalization):"	Prompt normto,"Normalize to (index):"			PauseUpdate	Silent 1	String thiscut	String newname	String list_of_the_traces,thistrace	String NTPname	Variable j,i	Variable angle_position	Variable condition_NTP	Variable avgnorm	IF(wintype("graphedcatkf")==0)		Display		Dowindow/C graphedcatkf		Else			Dowindow/F graphedcatkf			list_of_the_traces=TraceNameList("graphedcatkf",";", 1 )			i=0			Do				thistrace=stringfromlist(i,list_of_the_traces,";")				removefromgraph $thistrace				i+=1			While(i<ItemsInList(list_of_the_traces,";"))	Endif	NTPname="NTP"+num2str(NTP_num)	j=0	Do		If(NTP_num>0)				Condition_NTP=checkNTP($NTPname,j)			Else				Condition_NTP=1		Endif		If(Condition_NTP==1)			If(src_vs_bnl==1)				thiscut="cut"+num2str(original_theta[j])				angle_position=Round((original_phi[j]-dimoffset($thiscut,0))/dimdelta($thiscut,0))				Else					thiscut="cut"+num2str(original_phi[j])					angle_position=Round((original_theta[j]-dimoffset($thiscut,0))/dimdelta($thiscut,0))						Endif			Make/O/N=(dimsize($thiscut,1)) tempwave			Setscale/P x,dimoffset($thiscut,1),dimdelta($thiscut,1),""tempwave			i=angle_position-Round((avg_num-1)/2)			tempwave[]=0			Do				tempwave[]+=$thiscut[i][p]				i+=1			While(	i<angle_position+Round((avg_num-1)/2)+1)			tempwave[]/=avg_num			If((backgnd_type==1)||(backgnd_type==2))				Remove_simplebgnd_edc("tempwave",backgnd_type,num_back)					Endif			if(normfrom>=0)				avgnorm=mean(tempwave,pnt2x(tempwave,normfrom),pnt2x(tempwave,normto))				tempwave[]/=avgnorm			Endif			newname="EDC_kf"+num2str(j)			Duplicate/O tempwave $newname			appendtograph $newname		Endif		j+=1	While(j<dimsize(original_theta,0))	killwaves tempwave		End//*******************************************************************************************************************************Proc DOS_kf(Fermi_level,avg_num,backgnd_type,num_back,normfrom,normto,smoothmax,neworold) 	Variable Fermi_level=0	Variable avg_num=3	Variable backgnd_type	Variable num_back	Variable normfrom=0	Variable normto=10	Variable smoothmax=-1	Variable neworold	Prompt Fermi_level,"Fermi level:"	Prompt avg_num,"Number of averged EDCs (odd):"	Prompt backgnd_type,"Background type:",popup "Flat;Linear;None"	Prompt num_back,"Points for background fitting:"	Prompt normfrom,"Norm from (-1=no norm):"	Prompt normto,"Norm to (index):"		Prompt smoothmax,"MAX (-1=NO) smoothing IF necessary (danger)"		Prompt neworold,"",popup "EXACT;APPROX"				PauseUpdate	Silent 1	String thiscut	String newname	String list_of_the_traces,thistrace	String NTPname,thisNTPwave	Variable j,i	Variable angle_position	Variable condition_NTP	variable index	Variable avgnorm	//calculates the angle vector	update_making_fs()	PutonsameXcorner(kx_final,ky_final)	Make/O/N=(dimsize(waveforXcorner,0),0) vecx	Make/O/N=(dimsize(waveforXcorner,0),0) vecy	vecx[]=waveforXcorner[p][0]	vecy[]=waveforXcorner[p][1]	Killwaves waveforXcorner	Putkfin1zone(vecx,vecy)	vecx[]=wavein1zone[p][0]	vecy[]=wavein1zone[p][1]	Killwaves wavein1zone	Putinsameoctant(vecx,vecy)	vecx[]=waveinoctant[p][0]	vecy[]=waveinoctant[p][1]	Killwaves waveinoctant	Duplicate/O vecx angleinoctant_DOS	angleinoctant_DOS=Calcangleinoctant(vecx,vecy)		//			IF(wintype("graphDOSatkf")==0)		Display		Dowindow/C graphDOSatkf		Else			Dowindow/F graphDOSatkf			list_of_the_traces=TraceNameList("graphDOSatkf",";", 1 )			i=0			Do				thistrace=stringfromlist(i,list_of_the_traces,";")				removefromgraph $thistrace				i+=1			While(i<ItemsInList(list_of_the_traces,";"))	Endif	thisNTPwave="NTP"+num2str(NTP_num)	IF(neworold==2)		If(NTP_num>0)			Make/O/N=(dimsize(original_theta,0)-dimsize($thisNTPwave,0)) DOSatkf			Make/O/N=(dimsize(original_theta,0)-dimsize($thisNTPwave,0)) DOSatkferror				Make/O/N=(dimsize(original_theta,0)-dimsize($thisNTPwave,0)) angle_DOSatkf				Else				Make/O/N=(dimsize(original_theta,0)) DOSatkf				Make/O/N=(dimsize(original_theta,0)) DOSatkferror					Make/O/N=(dimsize(original_theta,0)) angle_DOSatkf			Endif	Endif	IF(neworold==1)		If(NTP_num>0)			Make/O/N=(dimsize(original_rtheta,0)-dimsize($thisNTPwave,0)) DOSatkf			Make/O/N=(dimsize(original_rtheta,0)-dimsize($thisNTPwave,0)) DOSatkferror				Make/O/N=(dimsize(original_rtheta,0)-dimsize($thisNTPwave,0)) angle_DOSatkf				Else				Make/O/N=(dimsize(original_rtheta,0)) DOSatkf				Make/O/N=(dimsize(original_rtheta,0)) DOSatkferror					Make/O/N=(dimsize(original_rtheta,0)) angle_DOSatkf			Endif	Endif		DOSatkf[]=0	DOSatkferror[]=0		angle_DOSatkf[]=0		NTPname="NTP"+num2str(NTP_num)	j=0	index=0	Do		If(NTP_num>0)				Condition_NTP=checkNTP($NTPname,j)			Else				Condition_NTP=1		Endif		If(Condition_NTP==1)			If(src_vs_bnl==1)				IF(neworold==2)					thiscut="cut"+num2str(original_theta[j])					angle_position=Round((original_phi[j]-dimoffset($thiscut,0))/dimdelta($thiscut,0))				Endif				IF(neworold==1)					thiscut="data"+num2str(original_data[j])					angle_position=original_slice[j]				Endif									Else					IF(neworold==2)						thiscut="cut"+num2str(original_phi[j])						angle_position=Round((original_theta[j]-dimoffset($thiscut,0))/dimdelta($thiscut,0))						Endif					IF(neworold==1)						thiscut="data"+num2str(original_data[j])						angle_position=original_slice[j]					Endif																Endif			Make/O/N=(dimsize($thiscut,1)) tempwave			Setscale/P x,dimoffset($thiscut,1),dimdelta($thiscut,1),""tempwave			i=angle_position-Round((avg_num-1)/2)			tempwave[]=0			Do				tempwave[]+=$thiscut[i][p]				i+=1			While(	i<angle_position+Round((avg_num-1)/2)+1)			tempwave[]/=avg_num			Duplicate/O tempwave stempwave			If(smoothmax>0)				DOSatkferror[index]=2*appropriate_smoothing(tempwave,stempwave,smoothmax)				If((backgnd_type==1)||(backgnd_type==2))					Remove_simplebgnd_edc("stempwave",backgnd_type,num_back)						Endif				angle_DOSatkf[index]=angleinoctant_DOS[j]				if(normfrom>=0)					avgnorm=mean(stempwave,pnt2x(stempwave,normfrom),pnt2x(stempwave,normto))					stempwave[]/=avgnorm					DOSatkferror[index]/=avgnorm				Endif				sym_one_edc("stempwave",Fermi_level)				DOSatkf[index]=sym_stempwave[x2pnt(sym_stempwave,0)]			Endif			If(smoothmax<0)				DOSatkferror[index]=2*appropriate_smoothing(tempwave,stempwave,smoothmax)				If((backgnd_type==1)||(backgnd_type==2))					Remove_simplebgnd_edc("tempwave",backgnd_type,num_back)						Endif				angle_DOSatkf[index]=angleinoctant_DOS[j]				if(normfrom>=0)					avgnorm=mean(tempwave,pnt2x(tempwave,normfrom),pnt2x(tempwave,normto))					tempwave[]/=avgnorm					DOSatkferror[index]/=avgnorm				Endif				sym_one_edc("tempwave",Fermi_level)				DOSatkf[index]=sym_tempwave[x2pnt(sym_tempwave,0)]			Endif			index+=1		Endif		j+=1	While(j<dimsize(original_theta,0))		Appendtograph DOSatkf vs angle_DOSatkf	ErrorBars DOSatkf Y,wave=(DOSatkferror,DOSatkferror)		ModifyGraph mode=3,marker=19	Label left "\\Z16\\F'arial'Density of states at 0 (Arbitrary units)"	Label bottom "\\Z16\\F'arial'Angle (degrees)"	ModifyGraph tick=2,mirror=1,manTick(bottom)={0,10,0,0},manMinor(bottom)={4,0};DelayUpdate	SetAxis bottom 0,45	Killwaves angleinoctant_DOS	killwaves tempwave,stempwave	If(Exists("sym_stempwave")==1)		Killwaves sym_stempwave	Endif	If(Exists("sym_tempwave")==1)		Killwaves sym_tempwave	Endif			End//*******************************************************************************************************************************Function appropriate_smoothing(nonsmoothed,smoothed,smoothlimit) //not completed	Wave nonsmoothed	Wave smoothed	Variable smoothlimit	PauseUpdate	Silent 1	Variable smootherror	Variable smootherror1	Variable smootherror2			Variable smoothnumber	Variable i	Variable condition_smooth	Duplicate/O nonsmoothed tempsmoothed	Duplicate/O nonsmoothed errorwave	IF(smoothlimit<0)		smoothlimit=7	Endif	//first run	smoothnumber=3	Smooth/E=3/B=(smoothnumber) smoothnumber,tempsmoothed	errorwave[]=nonsmoothed[p]-tempsmoothed[p]	WaveStats/Q errorwave	smootherror1=V_rms	//iteration	smoothnumber=5	Do		Duplicate/O nonsmoothed tempsmoothed		If(smoothnumber<8)			Smooth/E=3/B=(smoothnumber) smoothnumber,tempsmoothed			Else				Smooth/E=3/B=(smoothnumber) 7,tempsmoothed						Endif		errorwave[]=nonsmoothed[p]-tempsmoothed[p]		WaveStats/Q/R=[dimsize(nonsmoothed,0)-11,dimsize(nonsmoothed,0)-1] errorwave		smootherror2=V_rms		condition_smooth=abs(smootherror2-smootherror1)/smootherror2		smootherror1=smootherror2				smoothnumber+=2	While((condition_smooth>0.1)&&(smoothnumber<(smoothlimit+1)))	//transfert final results	smootherror=smootherror2	smoothnumber-=4	Duplicate/O nonsmoothed tempsmoothed	If(smoothnumber<10)		Smooth/E=3/B=(smoothnumber) smoothnumber,tempsmoothed		Else			Smooth/E=3/B=(smoothnumber) 7,tempsmoothed					Endif	Duplicate/O tempsmoothed smoothed		killwaves tempsmoothed	Return smootherrorEnd//*******************************************************************************************************************************Function checkNTP(NTPname,thisnumber)	Wave NTPname	Variable thisnumber	PauseUpdate	Silent 1	Variable i	Variable condition	condition=1	i=0	if(dimsize(NTPname,0)>0)		Do			If(NTPname[i]==thisnumber)				condition=0			Endif			i+=1		While(i<dimsize(NTPname,0))	Endif	Return conditionEnd	//*******************************************************************************************************************************Proc Remove_data_EDC()	PauseUpdate	Silent 1	String thisname	thisname="data"+num2str(gv_groupNum)	If(xcsr(A)<=xcsr(B))		combine_range(thisname,"tempwave",xcsr(A),xcsr(B))		Else			combine_range(thisname,"tempwave",xcsr(B),xcsr(A))	Endif		$thisname[][]-=tempwave[q]	killwaves tempwaveEnd	//*******************************************************************************************************************************Proc Remove_simplebgnd_edc(edcname,background,backpnts)	String edcname	Variable background	Variable backpnts	Prompt edcname,"Name of EDC:"	Prompt background,"Type of background:",popup "Flat;Linear" 	Prompt backpnts,"Num of pnts used:"	PauseUpdate	Silent 1	If(background==1)		sub_blineedc_pi(edcname,backpnts)	Endif	If(background==2)		func_rm_one_linear_edcbackgnd($edcname,backpnts)	EndifEnd	//*******************************************************************************************************************************Proc Remove_simplebgnd_mat(matname,background,backpnts)	String matname	Variable background	Variable backpnts	Prompt matname,"Name of matrix:"	Prompt background,"Type of background:",popup "Flat;Linear" 	Prompt backpnts,"Num of pnts used:"	PauseUpdate	Silent 1	Variable i	Do		Make/O/N=(dimsize($matname,1)) theedc		Setscale/P x, dimoffset($matname,1),dimdelta($matname,1),""theedc		theedc[]=$matname[i][p]		If(background==1)			sub_blineedc_pi(theedc,backpnts)		Endif		If(background==2)			func_rm_one_linear_edcbackgnd(theedc,backpnts)		Endif		$matname[i][]=theedc[q]		i+=1	While(i<dimsize($matname,0))	killwaves theedcEnd	//*******************************************************************************************************************************Proc Remove_simplebgnd_data(background,backpnts)	Variable background	Variable backpnts	Prompt background,"Type of background:",popup "Flat;Linear" 	Prompt backpnts,"Num of pnts used:"	PauseUpdate	Silent 1	String matname="data"+num2str(gv_groupNum)	Variable i	Do		Make/O/N=(dimsize($matname,1)) theedc		Setscale/P x, dimoffset($matname,1),dimdelta($matname,1),""theedc		theedc[]=$matname[i][p]		If(background==1)			sub_blineedc_pi(theedc,backpnts)		Endif		If(background==2)			func_rm_one_linear_edcbackgnd(theedc,backpnts)		Endif		$matname[i][]=theedc[q]		i+=1	While(i<dimsize($matname,0))	killwaves theedcEnd	//********************************************************************************************************************************Function func_rm_one_linear_background(thisdata,number_of_pnts) //remove a linear background EDC by EDC	Wave thisdata	Variable number_of_pnts	Silent 1	Variable i	i=0	Do 		Make/O/N=(dimsize(thisdata,1)) thiswave		Setscale/P x, dimoffset(thisdata,1),dimdelta(thisdata,1), ""thiswave		thiswave[]=thisdata[i][p]		Make/O/N=2 line_coef		line_coef[0]=1		line_coef[1]=-1		CurveFit/NTHR=0/Q/TBOX=0 line kwCWave=line_coef, thiswave[dimsize(thiswave,0)-number_of_pnts,dimsize(thiswave,0)-1] /D		thiswave[]-=line_coef[0]+line_coef[1]*(dimoffset(thiswave,0)+p*dimdelta(thiswave,0))		thisdata[i][]=thiswave[q]				i+=1	While(i<dimsize(thisdata,0))	killwaves thiswave,line_coefEnd	//********************************************************************************************************************************Function func_rm_one_linear_edcbackgnd(thisedc,number_of_pnts) //remove a linear background EDC by EDC	Wave thisedc	Variable number_of_pnts	Silent 1	Make/O/N=2 line_coef	line_coef[0]=1	line_coef[1]=-1	CurveFit/NTHR=0/Q/TBOX=0 line kwCWave=line_coef, thisedc[dimsize(thisedc,0)-number_of_pnts,dimsize(thisedc,0)-1] /D	Duplicate/O thisedc bgndedc	bgndedc[]-=line_coef[0]+line_coef[1]*(dimoffset(thisedc,0)+p*dimdelta(thisedc,0))	thisedc[]=bgndedc[p]		killwaves line_coef	End		//********************************************************************************************************************************Function func_rm_one_AVG_linear_backgnd(thisdata,number_of_pnts) //remove an averaged linear background 	Wave thisdata	Variable number_of_pnts	Silent 1	Variable i	Make/O/N=(dimsize(thisdata,1)) thiswave	Setscale/P x, dimoffset(thisdata,1),dimdelta(thisdata,1), ""thiswave	thiswave[]=0	i=0	Do 		thiswave[]+=thisdata[i][p]		i+=1	While(i<dimsize(thisdata,0))	thiswave[]/=dimsize(thisdata,0)	Make/O/N=2 line_coef	line_coef[0]=1	line_coef[1]=-1	CurveFit/NTHR=0/Q/TBOX=0 line kwCWave=line_coef, thiswave[dimsize(thiswave,0)-number_of_pnts,dimsize(thiswave,0)-1] /D	thisdata[][]-=line_coef[0]+line_coef[1]*(dimoffset(thiswave,0)+p*dimdelta(thiswave,0))	killwaves thiswaveEnd		//********************************************************************************************************************************Proc rm_linear_background(number_of_pnts,method)	Variable number_of_pnts	Variable method	Prompt number_of_pnts,"Enter the number of points"	Prompt method,"Which method?",popup "EDC by EDC;Avg EDC"	Silent 1	String thisdata	Variable i	i=1	Do		thisdata="data"+num2str(i)		If(method==1)			func_rm_one_linear_background($thisdata,number_of_pnts)		Endif		If(method==2)			func_rm_one_AVG_linear_backgnd($thisdata,number_of_pnts)		Endif		i+=1	While(i<dimsize(file_name,0))End				//********************************************************************************************************************************Proc open_data_pi(from,to,normway,e_from,e_to,background,Normcurve,backpnts,fftonoff)	Variable from=1	Variable to=-1	Variable normway		Variable e_from	Variable e_to	Variable background	String Normcurve	="Normalizationcurve"	Variable backpnts=10	Variable fftonoff	Prompt from,"From which data index?"	Prompt to,"To index:"		Prompt normway,"Normalization way?",popup "Bottom;Above Ef;specific;Normalization curve;All range"	Prompt e_from,"Normalize from (E)(optinal):"	Prompt e_to,"To (optional):" 	Prompt background,"Which background?",popup "Flat;Linear" 	Prompt Normcurve,"Name of the norm curve (optional):"	Prompt backpnts,"Points for background fit?"		Prompt fftonoff,"FFT filter?",popup "OFF;ON"		PauseUpdate	Silent 1			Variable/G global_cspacing		Variable/G smoothfactor	Variable i,j,k	Variable number_of_data	Variable first_slice,last_slice	Variable numfordiv	String mat_name_data	If(to>=from)		number_of_data=to+1		Else			number_of_data=dimsize(File_Name,0)		Endif	i=from	Do 		gv_groupNum=i		mat_name_data="data"+num2str(gv_groupNum)		IF(fftonoff==2)			FFTfilterdata()		Endif		If(normway==1)			If(background==1)				func_sub_bline_pi($mat_name_data,backpnts)			Endif			If(background==2)				func_rm_one_linear_background($mat_name_data,backpnts)			Endif			MatNKPlot(0,15)			If(smoothfactor>0)				Smooth/E=3/B=(smoothfactor) smoothfactor, NK			Endif				MatNorm()		Endif			If(normway==2)			first_slice=Round((e_from-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))			last_slice=dimsize($mat_name_data,1)-1			MatNKPlot(first_slice,last_slice)			Make/O/N=0 nktemp			Make/O/N=0 nktempx			k=0			j=0			Do				if(j!=bad_slices[k])					Insertpoints dimsize(nktemp,0),1,nktemp					Insertpoints dimsize(nktempx,0),1,nktempx					nktemp[dimsize(nktemp,0)-1]=NK[j]					nktempx[dimsize(nktempx,0)-1]=dimoffset(NK,0)+j*dimdelta(NK,0)					Else						k+=1				Endif				j+=1			While(j<dimsize($mat_name_data,0))			If(smoothfactor>0)				Smooth/E=3/B=(smoothfactor) smoothfactor, nktemp			Endif			j=0			Do				NK[j]=Interp(dimoffset(NK,0)+j*dimdelta(NK,0),nktempx,nktemp)				j+=1			While(j<dimsize(NK,0))			Killwaves nktemp,nktempx				If(smoothfactor>0)						Smooth/E=3/B=(smoothfactor) smoothfactor, NK			Endif				If(background==1)					sub_bline_pi(backpnts)				Endif				If(background==2)					func_rm_one_linear_background($mat_name_data,backpnts)				Endif			MatNorm()							Endif		If(normway==3)			first_slice=Round((e_from-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))			last_slice=Round((e_to-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))			If(background==1)				func_sub_bline_pi($mat_name_data,backpnts)			Endif			If(background==2)				func_rm_one_linear_background($mat_name_data,backpnts)			Endif							MatNKPlot(first_slice,last_slice)			If(smoothfactor>0)				Smooth/E=3/B=(smoothfactor) smoothfactor, NK			Endif			MatNorm()		Endif		If(normway==4)			Duplicate/O $Normcurve NK			Make/O/N=(dimsize($mat_name_data,0)) tempnorm   //note that tempnorm is not scaled so the scaling=index			numfordiv=0			j=0			Do				tempnorm[]=$mat_name_data[p][j]				Wavestats/Q tempnorm				numfordiv+=V_avg				j+=1			While(j<10)			numfordiv/=10			If(background==1)				func_sub_bline_pi($mat_name_data,backpnts)			Endif			If(background==2)				func_rm_one_linear_background($mat_name_data,backpnts)			Endif							MatNorm()			$mat_name_data[][]/=numfordiv			Killwaves tempnorm		Endif		If(normway==5)			first_slice=0			last_slice=dimsize($mat_name_data,1)-1			If(background==1)				func_sub_bline_pi($mat_name_data,backpnts)			Endif			If(background==2)				func_rm_one_linear_background($mat_name_data,backpnts)			Endif							MatNKPlot(first_slice,last_slice)			If(smoothfactor>0)				Smooth/E=3/B=(smoothfactor) smoothfactor, NK			Endif			MatNorm()		Endif		If(global_cspacing>0)				factor_src_one(gv_groupNum) // to adjust the channel spacing			Endif																								i+=1	While(i<number_of_data)End//********************************************************************************************************************************Proc open_onedata_pi(normway,e_from,e_to,background,Normcurve,backpnts,fftonoff)	Variable normway		Variable e_from	Variable e_to	Variable background	String Normcurve	="Normalizationcurve"			Variable backpnts=10	Variable fftonoff	Prompt normway,"Normalization way?",popup "Bottom;Above Ef;specific;Normalization curve;All range"	Prompt e_from,"Normalize from (E)(optinal):"	Prompt e_to,"To (optional):" 	Prompt background,"Which background?",popup "Flat;Linear" 	Prompt Normcurve,"Name of the norm curve (optional):"	Prompt backpnts,"Points for background fit?"		Prompt fftonoff,"FFT filter?",popup "OFF;ON"		PauseUpdate	Silent 1				Variable/G global_cspacing		Variable/G smoothfactor	Variable j,k	Variable number_of_data	Variable first_slice,last_slice	Variable numfordiv	String mat_name_data	number_of_data=dimsize(File_Name,0)	mat_name_data="data"+num2str(gv_groupNum)	IF(fftonoff==2)		FFTfilterdata()	Endif	If(normway==1)		If(background==1)			func_sub_bline_pi($mat_name_data,backpnts)		Endif		If(background==2)			func_rm_one_linear_background($mat_name_data,backpnts)		Endif		MatNKPlot(0,15)		IF(smoothfactor>0)			Smooth/E=3/B=1 1, NK		Endif		MatNorm()	Endif		If(normway==2)		first_slice=Round((e_from-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))		last_slice=dimsize($mat_name_data,1)-1		MatNKPlot(first_slice,last_slice)		Make/O/N=0 nktemp		Make/O/N=0 nktempx		k=0		j=0		Do			if(j!=bad_slices[k])				Insertpoints dimsize(nktemp,0),1,nktemp				Insertpoints dimsize(nktempx,0),1,nktempx				nktemp[dimsize(nktemp,0)-1]=NK[j]				nktempx[dimsize(nktempx,0)-1]=dimoffset(NK,0)+j*dimdelta(NK,0)				Else					k+=1			Endif			j+=1		While(j<dimsize($mat_name_data,0))		If(smoothfactor>0)			Smooth/E=3/B=(smoothfactor) smoothfactor, nktemp		Endif		j=0		Do			NK[j]=Interp(dimoffset(NK,0)+j*dimdelta(NK,0),nktempx,nktemp)			j+=1		While(j<dimsize(NK,0))		Killwaves nktemp,nktempx					If(smoothfactor>0)			Smooth/E=3/B=(smoothfactor) smoothfactor, NK		Endif			If(background==1)				func_sub_bline_pi($mat_name_data,backpnts)			Endif			If(background==2)				func_rm_one_linear_background($mat_name_data,backpnts)			Endif		MatNorm()						Endif	If(normway==3)		first_slice=Round((e_from-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))		last_slice=Round((e_to-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))		If(background==1)			func_sub_bline_pi($mat_name_data,backpnts)		Endif		If(background==2)			func_rm_one_linear_background($mat_name_data,backpnts)		Endif						MatNKPlot(first_slice,last_slice)		IF(smoothfactor>0)			Smooth/E=3/B=(smoothfactor) smoothfactor, NK		Endif		MatNorm()	Endif	If(normway==4)		Duplicate/O $Normcurve NK		Make/O/N=(dimsize($mat_name_data,0)) tempnorm   //note that tempnorm is not scaled so the scaling=index		numfordiv=0		j=0		Do			tempnorm[]=$mat_name_data[p][j]			Wavestats/Q tempnorm			numfordiv+=V_avg			j+=1		While(j<10)		numfordiv/=10		If(background==1)			func_sub_bline_pi($mat_name_data,backpnts)		Endif		If(background==2)			func_rm_one_linear_background($mat_name_data,backpnts)		Endif						MatNorm()		$mat_name_data[][]/=numfordiv		Killwaves tempnorm	Endif		If(normway==5)			first_slice=0			last_slice=dimsize($mat_name_data,1)-1			If(background==1)				func_sub_bline_pi($mat_name_data,backpnts)			Endif			If(background==2)				func_rm_one_linear_background($mat_name_data,backpnts)			Endif							MatNKPlot(first_slice,last_slice)			If(smoothfactor>0)				Smooth/E=3/B=(smoothfactor) smoothfactor, NK			Endif			MatNorm()		Endif		If(global_cspacing>0)			factor_src_one(gv_groupNum) // to adjust the channel spacing			Endif												End//********************************************************************************************************************************Proc open_select(normway,e_from,e_to,background,Normcurve,backpnts,fftonoff)	Variable normway	Variable e_from	Variable e_to	Variable background		String Normcurve	="Normalizationcurve"	Variable backpnts=10	Variable fftonoff		Prompt normway,"Normalization",popup "Bottom;Above Ef;specific;Normalization curve;All range"	Prompt e_from,"Normalize from (E)(optinal):"	Prompt e_to,"To (optional):"	Prompt background,"Which background?",popup "Flat;linear" 	Prompt Normcurve,"Name of the norm curve (optional):"	Prompt backpnts,"How many points for the background fit?"		Prompt fftonoff,"FFT filter?",popup "OFF;ON"		PauseUpdate	Silent 1	Variable/G global_cspacing			Variable/G smoothfactor				Variable i,j,k	Variable number_of_data	Variable first_slice,last_slice	variable numfordiv		String mat_name_data	number_of_data=dimsize(File_Name,0)	i=0	Do 			if(imageindex[i]!=-1)					gv_groupNum=imageindex[i]			mat_name_data="data"+num2str(gv_groupNum)			IF(fftonoff==2)				FFTfilterdata()			Endif			If(normway==1)				func_sub_bline_pi($mat_name_data,backpnts)				MatNKPlot(0,15)				If(smoothfactor>0)					Smooth/E=3/B=(smoothfactor) smoothfactor, NK				Endif				MatNorm()			Endif			If(normway==2)				first_slice=Round((e_from-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))				last_slice=dimsize($mat_name_data,1)-1				MatNKPlot(first_slice,last_slice)				Make/O/N=0 nktemp				Make/O/N=0 nktempx				k=0				j=0				Do					if(j!=bad_slices[k])						Insertpoints dimsize(nktemp,0),1,nktemp						Insertpoints dimsize(nktempx,0),1,nktempx						nktemp[dimsize(nktemp,0)-1]=NK[j]						nktempx[dimsize(nktempx,0)-1]=dimoffset(NK,0)+j*dimdelta(NK,0)						Else							k+=1					Endif					j+=1				While(j<dimsize($mat_name_data,0))				If(smoothfactor>0)					Smooth/E=3/B=(smoothfactor) smoothfactor, nktemp				//3,5				Endif				j=0				Do					NK[j]=Interp(dimoffset(NK,0)+j*dimdelta(NK,0),nktempx,nktemp)					j+=1				While(j<dimsize(NK,0))				Killwaves nktemp,nktempx				j=0				If(smoothfactor>0)					Smooth/E=3/B=(smoothfactor) smoothfactor, NK			//3,3					Endif				If(background==1)					func_sub_bline_pi($mat_name_data,backpnts)				Endif				If(background==2)					func_rm_one_linear_background($mat_name_data,backpnts)				Endif				MatNorm()			Endif			If(normway==3)				first_slice=Round((e_from-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))				last_slice=Round((e_to-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))				func_sub_bline_pi($mat_name_data,backpnts)				MatNKPlot(first_slice,last_slice)				IF(smoothfactor>0)					Smooth/E=3/B=(smoothfactor) smoothfactor, NK   				Endif				MatNorm()			Endif											Endif		If(normway==4)			Duplicate/O $Normcurve NK			Make/O/N=(dimsize($mat_name_data,0)) tempnorm   //note that tempnorm is not scaled so the scaling=index			numfordiv=0			j=0			Do				tempnorm[]=$mat_name_data[p][j]				Wavestats/Q tempnorm				numfordiv+=V_avg				j+=1			While(j<10)			numfordiv/=10			If(background==1)				func_sub_bline_pi($mat_name_data,backpnts)			Endif			If(background==2)				func_rm_one_linear_background($mat_name_data,backpnts)			Endif							MatNorm()			$mat_name_data[][]/=numfordiv			Killwaves tempnorm		Endif		If(normway==5)			first_slice=0			last_slice=dimsize($mat_name_data,1)-1			If(background==1)				func_sub_bline_pi($mat_name_data,backpnts)			Endif			If(background==2)				func_rm_one_linear_background($mat_name_data,backpnts)			Endif							MatNKPlot(first_slice,last_slice)			If(smoothfactor>0)				Smooth/E=3/B=(smoothfactor) smoothfactor, NK			Endif			MatNorm()		Endif				If(global_cspacing>0)				factor_src_one(gv_groupNum) // to adjust the channel spacing			Endif																				i+=1	While(i<dimsize(imageindex,0))End//********************************************************************************************************************************Proc EDC_pi(thismatname,addnum)	String thismatname="ttemp"	Variable addnum=3	Prompt thismatname,"Input the matrix for the EDCs"	Prompt addnum, "Input the number of combined edc curves"	PauseUpdate 	Silent 1		String thisEDCname	Variable i	Variable j	Variable jstart, jend	Variable comb	i=0	Do		thisEDCname="E"+thismatname+"_"+num2str(addnum)+"_"+num2istr(i)// "E"+num2str(gv_groupnum)+"_"+num2str(i)		Make/O/N=(dimsize($thismatname,1)) $thisEDCname		Setscale/P x,dimoffset($thismatname,1),dimdelta($thismatname,1),""$thisEDCname		$thisEDCname[]=0		jstart=i-(addnum-1)/2		jend=i+(addnum-1)/2		If(jstart<0)			jstart=0		Endif		If(jend>(dimsize($thismatname,0)-1))			jend=dimsize($thismatname,0)-1		Endif		comb=0		j=jstart		Do			$thisEDCname[]+=$thismatname[j][p]			comb+=1			j+=1		While(j<jend+1)		$thisEDCname[]/=comb		i+=1	While(i<dimsize($thismatname,0))End//********************************************************************************************************************************Proc plot_edc_pi(MatrixName,Combined,one_each)//|---Plot EDCs selected by cursors---	String MatrixName	Variable Combined=5	Variable one_each=5	Prompt MatrixName,"Input the name of the matrix"	Prompt Combined, "Input the number of combined edc curves"	Prompt one_each, "Show one curve over each ..."	PauseUpdate	Silent 1		String EDCname,newedc	Variable edcstart,edcend,e_start,e_end	Variable EDCindex	//edcstart=pcsr(A)	edcstart=pcsr(A)	edcend=pcsr(B)	e_start=qcsr(A)	e_end=qcsr(B)	EDCindex=edcstart		Display 	Do 		If(mod(EDCindex,one_each)==0)			EDCname="E"+MatrixName+"_"+num2str(Combined)+"_"+num2istr(EDCindex)			newedc=EDCname+"_"+num2str(edcstart)+"_"+num2str(edcend)			Duplicate/O/R=[e_start,e_end] $EDCname, $newedc			AppendtoGraph $newedc		EndIf		EDCindex+=1		While (EDCindex<(edcend+1))	Showinfo	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0		End//********************************************************************************************************************************Proc find_kf_pi(MatrixName,Combined)//|---Plot EDCs selected by cursors---	String MatrixName="ttemp"	Variable Combined=3//	Variable fermi_energy	Prompt MatrixName,"Input the name of the matrix"	Prompt Combined, "Input the number of combined edc curves"//	Prompt fermi_energy,"Enter the fermi energy"	PauseUpdate	Silent 1		String EDCname	String top	String index	String thistrace,list_of_the_traces	Variable edcstart,edcend	Variable EDCindex	Variable i	Variable energy_start,energy_delta	Variable intensity	Variable fermi_energy	Variable ystart,yend	top=MatrixName+"_top10"	index=MatrixName+"_topindex"	energy_start=Dimoffset($MatrixName,1)	energy_delta=Dimdelta($MatrixName,1)	Make/O/N=10 $top	Make/O/N=10 $index	Make/O/N=(Dimsize($MatrixName,1)) en	en[]=energy_start+p*energy_delta	$top[]=-999	$index[]=0	edcstart=pcsr(A)	edcend=pcsr(B)	ystart=vcsr(A)	yend=vcsr(B)	EDCname="E"+MatrixName+"_"+num2str(Combined)+"_"+num2istr(edcstart)	Duplicate/O $EDCname find_ef	find_ef[]=0	EDCindex=edcstart	Do		EDCname="E"+MatrixName+"_"+num2str(Combined)+"_"+num2istr(EDCindex)		find_ef[]+=$EDCname[p]				EDCindex+=1		While (EDCindex<(edcend+1))F	Smooth/E=3/B=3 4, find_ef	Differentiate find_ef	Smooth/E=3/B=3 4, find_ef	IF(wintype("find_ef_position")==0)		Display find_ef		Dowindow/C find_ef_position		Else			Dowindow/F find_ef_position	Endif	Wavestats/Q/R=(ystart,yend) find_ef	fermi_energy=V_minloc//+0.01	Print fermi_energy	EDCindex=edcstart	Do 		EDCname="e"+MatrixName+"_"+num2str(Combined)+"_"+num2istr(EDCindex)		intensity=Interp(fermi_energy,en,$EDCname)		i=0		Do			If((intensity>$top[i])&&(i!=0))				$top[i-1]=$top[i]				$top[i]=intensity				$index[i-1]=$index[i]				$index[i]=EDCindex			Endif			If((intensity>$top[i])&&(i==0))				$top[i]=intensity				$index[i]=EdCindex			Endif			i+=1		While(i<10)		EDCindex+=1		While (EDCindex<(edcend+1))	IF(wintype("best_edcs")==0)		Display		dowindow/C best_edcs		Else			dowindow/F best_edcs			list_of_the_traces=TraceNameList("best_edcs",";", 1 )			i=0			Do				thistrace=stringfromlist(i,list_of_the_traces,";")				removefromgraph $thistrace				i+=1			While(i<ItemsInList(list_of_the_traces,";"))	Endif			i=0				Do		EDCindex=$index[i]		EDCname="e"+MatrixName+"_"+num2str(Combined)+"_"+num2istr(EDCindex)		Append $EDCname		i+=1	While(i<10)	Showinfo	modifygraph width=150, height=150	KillWaves en	KillWaves $index	KillWaves $top	ResumeUpdate	modifygraph width=0, height=0			End//********************************************************************************************************************************Proc MDC_pi_old(MatrixName,Combine)//|---Make MDC curves	String MatrixName	Variable Combine=5	Prompt MatrixName,"Input the matrix for the MDCs"	Prompt Combine, "Input the number of combined mdc curves"	PauseUpdate	Silent 1		String MDCname		Variable TotalEnergyStep, EnergyOffset, EnergyDelta, TotalAngleStep, A0, DA, i	TotalEnergyStep=Dimsize($MatrixName,1)	EnergyOffset=DimOffset($MatrixName,1)	EnergyDelta=DimDelta($MatrixName,1)	TotalAngleStep=Dimsize($MatrixName,0)		A0=DimOffset($MatrixName,0)		DA=DimDelta($MatrixName,0)		Variable NumofMDCs=Floor(TotalEnergyStep)	Variable MDCIndex=0		Do		MDCName="m"+MatrixName+"_"+num2str(Combine)+"_"+num2istr(MDCindex)		Make /O/n=(TotalAngleStep) $MDCName		$MDCName=0		i=0                 If(MDCindex>(Combine-1)/2&&MDCindex<NumofMDCs-(Combine-1)/2)                    i=MDCindex-(Combine-1)/2		   Do		 	$MDCName+=$MatrixName[p][i]			i+=1		  While(i<(MDCindex+(Combine-1)/2+1))		  $MDCName=$MDCName/Combine					  setscale/P x A0, DA, "", $MDCName		  MDCIndex+=1		  Else                      i=MDCindex	  		      $MDCName=$MatrixName[p][i]		      setscale/P x A0, DA, "", $MDCName		      MDCIndex+=1	       Endif	      	While(MDCIndex<NumofMDCs)End//********************************************************************************************************************************Proc MDC_pi(thismatname,addnum)	String thismatname="ttemp"	Variable addnum=3	Prompt thismatname,"Input the matrix for the MDCs"	Prompt addnum, "Input the number of combined MDC curves"	PauseUpdate 	Silent 1		String thisMDCname	Variable i	Variable j	Variable jstart, jend	Variable comb	i=0	Do		thisMDCname="M"+thismatname+"_"+num2str(addnum)+"_"+num2istr(i)		Make/O/N=(dimsize($thismatname,0)) $thisMDCname		Setscale/P x,dimoffset($thismatname,0),dimdelta($thismatname,0),""$thisMDCname		$thisMDCname[]=0		jstart=i-(addnum-1)/2		jend=i+(addnum-1)/2		If(jstart<0)			jstart=0		Endif		If(jend>(dimsize($thismatname,1)-1))			jend=dimsize($thismatname,1)-1		Endif		comb=0		j=jstart		Do			$thisMDCname[]+=$thismatname[p][j]			comb+=1			j+=1		While(j<jend+1)		$thisMDCname[]/=comb		i+=1	While(i<dimsize($thismatname,1))End//********************************************************************************************************************************Proc plot_mdc_pi(MatrixName,Combined,one_each)//|---Plot MDCs selected by cursors---	String MatrixName="ttemp"	Variable Combined=3	Variable one_each=5	Prompt MatrixName,"Input the name of the matrix"	Prompt Combined, "Input the number of combined mdc curves"	Prompt one_each, "Show one curve over each ..."	PauseUpdate	Silent 1		String MDCname,newmdc	Variable mdcstart,mdcend	Variable leftcut,rightcut	Variable MDCindex	mdcstart=qcsr(A)	mdcend=qcsr(B)	leftcut=pcsr(A)	rightcut=pcsr(B)	MDCindex=mdcstart		Display 	Do 		If(mod(MDCindex,one_each)==0)			MDCname="m"+MatrixName+"_"+num2str(Combined)+"_"+num2istr(MDCindex)			//MDCname="a"+MatrixName+"_"+num2str(Combined)+"_"+num2istr(MDCindex)			newmdc=MDCname+"_"+num2str(leftcut)+"_"+num2str(rightcut)			Duplicate/O/R=[leftcut,rightcut] $MDCname, $newmdc			AppendtoGraph $newmdc		EndIf		MDCindex+=1		While (MDCindex<(mdcend+1))	Showinfo	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0		End//********************************************************************************************************************************	Proc MDCfit_pi_choice(Matname,combined,choice)      String Matname      Variable combined=3      Variable choice	Prompt Matname, "Enter the name of the matrix"	Prompt combined,"Enter the number of combined MDCs"		Prompt choice,"Method",popup "Lorentzian;Gaussian"		Pauseupdate; silent 1	If(choice==1)		MDCfit_pi(Matname,combined)	endif	If(choice==2)		MDCfit_pi_Gauss(Matname,combined)	endif	//********************************************************************************************************************************	Proc MDCfit_pi_Gauss(Matname,combined)      String Matname      Variable combined=3	Prompt Matname, "Enter the name of the matrix"	Prompt combined,"Enter the number of combined MDCs"		Pauseupdate; silent 1	String peakname,widthname,areaname	String energy	Variable y_start,y_delta	Variable x_start,x_delta	Variable k	y_start=vcsr(A)	y_delta=Dimdelta($MatName,1)	x_start=xcsr(A)	x_delta=Dimdelta($MatName,0)	make/N=4/D/O m	make/N=4/D/O store_m	variable n,totalnum,i,stop	totalnum=qcsr(B)-qcsr(A)	String WaveName	stop=qcsr(B)	peakname="MDCpk"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))	widthname="MDCw"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))	areaname="MDCA"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))		energy="ene"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))		Make/N=(totalnum)/D/O $peakname	SetScale/p x, x_start,x_delta,"",$peakname	Make/N=(totalnum)/D/O $widthname	SetScale/p x, y_start,y_delta,"",$widthname	Make/N=(totalnum)/D/O $areaname	SetScale/p x, y_start,y_delta,"",$areaname		Make/N=(totalnum)/D/O $energy	WaveName="m"+MatName+"_"+num2str(Combined)+"_"+num2istr(qcsr(A))	Wavestats/Q $WaveName	m[0]=(vcsr(A)*xcsr(B)-vcsr(B)*xcsr(A))/(xcsr(B)-xcsr(A))	m[2]=V_Maxloc   //MDC position	m[1]=V_max	m[3]=abs(xcsr(A)-xcsr(B))/6			//MDC width        n=qcsr(A)        i=0	Do		WaveName="M"+Matname+"_"+num2str(combined)+"_"+num2istr(n)//		FuncFit/N/Q/H="00000" Lorentz m $WaveName (xcsr(A),xcsr(B))//  /D		CurveFit/Q/NTHR=0 gauss kwCWave=m  $WaveName (xcsr(A),xcsr(B))/D //TBOX=0 		$peakname[i]=m[2]		$widthname[i]=abs(m[3])*sqrt(ln(2))		$areaname[i]=ABS(m[1]*m[3])*sqrt(pi)		$energy[i]=y_start+i*y_delta		if (m[2]>xcsr(B))			m[2]=(xcsr(B)+xcsr(A))/2		Endif			if (m[2]<xcsr(A))			m[2]=(xcsr(B)+xcsr(A))/2		Endif		n+=1		i+=1	While (n<stop)	Append $energy vs $peakname	ModifyGraph rgb=(0,0,0)	Showinfo	display $widthname vs $energy	ModifyGraph rgb=(0,0,65280)	showinfo	AppendToGraph/R  $areaname vs $energy	ModifyGraph rgb($areaname)=(0,39168,0)	Label left "\\Z16\K(0,0,65280)Width (\S-1\M\Z16)"	Label right "\\Z16\\K(0,39168,0)Peak area (\\S-1\\M\Z16)"	Label bottom "\\Z16Energy (eV)"	ModifyGraph tick=2,mirror(bottom)=1		modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0		End//********************************************************************************************************************************Proc MDCfit_pi(Matname,combined)      String Matname      Variable combined=3	Prompt Matname, "Enter the name of the matrix"	Prompt combined,"Enter the number of combined MDCs"		Pauseupdate; silent 1	String peakname,widthname,areaname	String energy	Variable y_start,y_delta	Variable x_start,x_delta	Variable k	y_start=vcsr(A)	y_delta=Dimdelta($MatName,1)	x_start=xcsr(A)	x_delta=Dimdelta($MatName,0)	make/N=4/D/O m	make/N=4/D/O store_m	variable n,totalnum,i,stop	totalnum=qcsr(B)-qcsr(A)	String WaveName	stop=qcsr(B)	peakname="MDCpk"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))	widthname="MDCw"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))	areaname="MDCA"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))		energy="ene"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))		Make/N=(totalnum)/D/O $peakname	SetScale/p x, x_start,x_delta,"",$peakname	Make/N=(totalnum)/D/O $widthname	SetScale/p x, y_start,y_delta,"",$widthname	Make/N=(totalnum)/D/O $areaname	SetScale/p x, y_start,y_delta,"",$areaname		Make/N=(totalnum)/D/O $energy	WaveName="m"+MatName+"_"+num2str(Combined)+"_"+num2istr(qcsr(A))	Wavestats/Q $WaveName	m[0]=(vcsr(A)*xcsr(B)-vcsr(B)*xcsr(A))/(xcsr(B)-xcsr(A))	m[2]=V_Maxloc   //MDC position	m[1]=V_max	m[3]=abs(xcsr(A)-xcsr(B))/6			//MDC width        n=qcsr(A)        i=0	Do		WaveName="M"+Matname+"_"+num2str(combined)+"_"+num2istr(n)//		FuncFit/N/Q/H="00000" Lorentz m $WaveName (xcsr(A),xcsr(B))//  /D		CurveFit/Q/NTHR=0 lor kwCWave=m  $WaveName (xcsr(A),xcsr(B))/D //TBOX=0 		$peakname[i]=m[2]		$widthname[i]=sqrt(abs(m[3]))		$areaname[i]=Pi*abs(m[1]/sqrt(abs(m[3])))		$energy[i]=y_start+i*y_delta		if (m[2]>xcsr(B))			m[2]=(xcsr(B)+xcsr(A))/2		Endif			if (m[2]<xcsr(A))			m[2]=(xcsr(B)+xcsr(A))/2		Endif		n+=1		i+=1	While (n<stop)	Append $energy vs $peakname	ModifyGraph rgb=(0,0,0)	Showinfo	display $widthname vs $energy	ModifyGraph rgb=(0,0,65280)	showinfo	AppendToGraph/R  $areaname vs $energy	ModifyGraph rgb($areaname)=(0,39168,0)	Label left "\\Z16\K(0,0,65280)Width (\S-1\M\Z16)"	Label right "\\Z16\\K(0,39168,0)Peak area (\\S-1\\M\Z16)"	Label bottom "\\Z16Energy (eV)"	ModifyGraph tick=2,mirror(bottom)=1		modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0		End//********************************************************************************************************************************Proc MDCfit2_pi(Matname,combined,number)        String Matname        Variable combined=5	Variable number=200	Prompt Matname, "Enter the name of the matrix"	Prompt combined,"Enter the number of combined MDCs"		Prompt number,"Enter the mdc you want to compare"	Pauseupdate; silent 1	String peakname1,widthname1,areaname1	String energy	String peakname2,widthname2,areaname2	Variable y_start,y_delta	Variable x_start,x_delta	Variable k	y_start=vcsr(A)	y_delta=Dimdelta($MatName,1)	x_start=xcsr(A)	x_delta=Dimdelta($MatName,0)	make/N=7/D/O m	make/N=7/D/O store_m	variable n,totalnum,i,stop	totalnum=qcsr(B)-qcsr(A)	String WaveName	stop=qcsr(B)	peakname1="MDCpk1"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))	widthname1="MDCw1"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))	areaname1="MDCsurf1"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))		energy="ene"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))		peakname2="MDCpk2"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))	widthname2="MDCw2"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))	areaname2="MDCsurf2"+"_"+Matname+"_"+num2str(Combined)+"_"+num2str(pcsr(A))+"_"+num2str(pcsr(B))			Make/N=(totalnum)/D/O $peakname1	SetScale/p x, x_start,x_delta,"",$peakname1	Make/N=(totalnum)/D/O $widthname1	SetScale/p x, y_start,y_delta,"",$widthname1	Make/N=(totalnum)/D/O $areaname1	SetScale/p x, y_start,y_delta,"",$areaname1		Make/N=(totalnum)/D/O $energy	Make/N=(totalnum)/D/O $peakname2	SetScale/p x, x_start,x_delta,"",$peakname2	Make/N=(totalnum)/D/O $widthname2	SetScale/p x, y_start,y_delta,"",$widthname2	Make/N=(totalnum)/D/O $areaname2	SetScale/p x, y_start,y_delta,"",$areaname2		WaveName="m"+MatName+"_"+num2str(Combined)+"_"+num2istr(qcsr(A))	Wavestats/Q $WaveName	m[0]=(vcsr(A)*xcsr(B)-vcsr(B)*xcsr(A))/(xcsr(B)-xcsr(A))	m[2]=V_Maxloc   //MDC position	m[1]=V_max	m[3]=abs(xcsr(A)-xcsr(B))/6			//MDC width	m[4]=(-sqrt(2)/2-m[2])-sqrt(2)/2	m[5]=V_max/3	m[6]=m[3]/2        n=qcsr(A)        i=0	Do		WaveName="m"+Matname+"_"+num2str(combined)+"_"+num2istr(n)		FuncFit/N/Q/H="0000000" Lorentz2 m $WaveName (xcsr(A),xcsr(B))  /D	        If(n==number)					//To compare the fit with the original curve	          k=0	          Do	                store_m[k]=0	                store_m[k]=m[k]	                k+=1	          While(k<7)	        EndIF     		$peakname1[i]=m[2]		$widthname1[i]=abs(m[3])		$areaname1[i]=Pi*abs(m[1]/m[3])		$energy[i]=y_start+i*y_delta		$peakname2[i]=m[5]		$widthname2[i]=abs(m[6])		$areaname2[i]=Pi*abs(m[4]/m[6])			if (m[2]>xcsr(B))			m[2]=(xcsr(B)+xcsr(A))/2		Endif			if (m[2]<xcsr(A))			m[2]=(xcsr(B)+xcsr(A))/2		Endif		n+=1		i+=1	While (n<stop)	Append $energy1 vs $peakname	ModifyGraph rgb=(0,0,0)	Showinfo	display $widthname1 vs $energy	ModifyGraph rgb=(0,0,65280)	showinfo	AppendToGraph/R  $areaname1 vs $energy	ModifyGraph rgb($areaname1)=(0,39168,0)	Label left "\\Z12\\K(0,0,65280)Width (Å\\S-1\\M)"	Label right "\\Z12\\K(0,39168,0)Peak area (Å\\S-1\\M)"	Label bottom "\\Z12Energy (eV)"		modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0		End//********************************************************************************************************************************Proc mat_n_pi(mat,n)	String mat	Variable n	Prompt mat,"Enter the name of the matrix"	Prompt n,"Enter the power by which you want to multiply the data"		Pauseupdate; silent 1	String newmat	newmat=mat+"_"+num2str(n)	Duplicate/O $mat, $newmat	$newmat[][]=($mat[p][q])^n	Display	Appendimage $newmat	ModifyImage $newmat ctab= {*,*,Rainbow,1}	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0			ShowinfoEnd//********************************************************************************************************************************Proc integrate_VB_range(xlow,xup)	Variable xlow	Variable xup	Prompt xlow,"Average from:"	Prompt xup,"to:"			PauseUpdate	Silent 1	String finalname	String thiswave	Variable indexlow,indexup	Variable i	thiswave="VB"+num2str(hvforVB[0])	indexlow=Round((xlow-dimoffset($thiswave,0))/dimdelta($thiswave,0))	indexup=Round((xup-dimoffset($thiswave,0))/dimdelta($thiswave,0))	finalname="intVB"+num2str(indexlow)+"_"+num2str(indexup)			Make/O/N=(dimsize(hvforVB,0)) $finalname	i=0	Do		thiswave="VB"+num2str(hvforVB[i])		$finalname[i]=mean($thiswave,xlow,xup)*(xup-xlow)		i+=1	While(i<dimsize($finalname,0))	Display $finalname vs hvforVB	Killwaves thiswaveEnd//********************************************************************************************************************************Proc wave2file(name)	String name	Prompt name,"Enter the name of the wave or matrix"	PauseUpdate	Silent 1	Save/C/O/P=home $name		Killwaves $name	End	//********************************************************************************************************************************Proc wave2filenokill(name)	String name	Prompt name,"Enter the name of the wave or matrix"	PauseUpdate	Silent 1	Save/C/O/P=home $name		End	//********************************************************************************************************************************Proc file2wave(name)	String name	Prompt name,"Enter the name of the wave or matrix"	PauseUpdate	Silent 1	String storedata	storedata=name+".ibw"	Loadwave/O/P=home storedata		End	//********************************************************************************************************************************Proc ln_mat_pi(mat)	String mat	Prompt mat,"Enter the name of the matrix"	Pauseupdate; silent 1	String newmat	newmat="ln_"+mat	Duplicate/O $mat, $newmat	$newmat[][]=ln($mat[p][q])	Display	Appendimage $newmat	ModifyImage $newmat ctab= {*,*,Rainbow,1}	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0			ShowinfoEnd//********************************************************************************************************************************Proc finddispersion_min(name,peak_name)	String name	String peak_name	Prompt name,"Enter the name of the cut"	Prompt peak_name,"Enter the name of the peak"	PauseUpdate	Silent 1	String name_x,name_y	Variable i,j	name_x="x_"+name+"pk"+peak_name	name_y="y_"+name+"pk"+peak_name		Make/O/N=(pcsr(B)-pcsr(A)+1) $name_x	Make/O/N=(pcsr(B)-pcsr(A)+1) $name_y	i=pcsr(A)	j=0	Do			Make/O/N=(dimsize($name,1)) thiswave		Setscale/p x,dimoffset($name,1),dimdelta($name,1),""thiswave		thiswave[]=$name[i][p]		Wavestats/Q/R=(vcsr(A),vcsr(B)) thiswave		$name_y[j]=V_minloc		$name_x[j]=xcsr(A)+j*dimdelta($name,0)		i+=1		j+=1	While(i<pcsr(B)+1)	Killwaves thiswave	Appendtograph $name_y vs $name_xEnd//********************************************************************************************************************************Proc finddispersion_plus(name,peak_name)	String name	String peak_name	Prompt name,"Enter the name of the cut"	Prompt peak_name,"Enter the name of the peak"	PauseUpdate	Silent 1	String name_x,name_y	Variable i,j	name_x="x_"+name+"pk"+peak_name	name_y="y_"+name+"pk"+peak_name		Make/O/N=(pcsr(B)-pcsr(A)+1) $name_x	Make/O/N=(pcsr(B)-pcsr(A)+1) $name_y	i=pcsr(A)	j=0	Do			Make/O/N=(dimsize($name,1)) thiswave		Setscale/p x,dimoffset($name,1),dimdelta($name,1),""thiswave		thiswave[]=$name[i][p]		Wavestats/Q/R=(vcsr(A),vcsr(B)) thiswave		$name_y[j]=V_maxloc		$name_x[j]=xcsr(A)+j*dimdelta($name,0)		i+=1		j+=1	While(i<pcsr(B)+1)	Killwaves thiswave	Appendtograph $name_y vs $name_x	End		//********************************************************************************************************************************Proc finddispersionHD_min(name,peak_name)	String name	String peak_name	Prompt name,"Enter the name of the cut"	Prompt peak_name,"Enter the name of the peak"	PauseUpdate	Silent 1	String name_deriv,name_x,name_y	Variable i,j//	name_deriv=name+"HD"	name_x="x_"+name+"pk"+peak_name	name_y="y_"+name+"pk"+peak_name		Make/O/N=(qcsr(B)-qcsr(A)+1) $name_x	Make/O/N=(qcsr(B)-qcsr(A)+1) $name_y	i=qcsr(A)	j=0	Do				Make/O/N=(dimsize($name,0)) thiswave		Setscale/p x,dimoffset($name,0),dimdelta($name,0),""thiswave		thiswave[]=$name[p][i]		Wavestats/Q/R=(xcsr(A),xcsr(B)) thiswave		$name_x[j]=V_minloc		$name_y[j]=vcsr(A)+j*dimdelta($name,1)		i+=1		j+=1	While(i<qcsr(B)+1)	Killwaves thiswave	Appendtograph $name_y vs $name_xEnd//********************************************************************************************************************************Proc finddispersionHD_plus(name,peak_name)	String name	String peak_name	//variable smoothfactor	Prompt name,"Enter the name of the cut"	Prompt peak_name,"Enter the name of the peak"	//Prompt smoothfactor,"Enter the smooth factor"	PauseUpdate	Silent 1	String name_deriv,name_x,name_y	Variable i,j//	name_deriv=name+"HD"	name_x="x_"+name+"pk"+peak_name	name_y="y_"+name+"pk"+peak_name		Make/O/N=(qcsr(B)-qcsr(A)+1) $name_x	Make/O/N=(qcsr(B)-qcsr(A)+1) $name_y	i=qcsr(A)	j=0	Do				Make/O/N=(dimsize($name,0)) thiswave		Setscale/p x,dimoffset($name,0),dimdelta($name,0),""thiswave		thiswave[]=$name[p][i]		Wavestats/Q/R=(xcsr(A),xcsr(B)) thiswave		$name_x[j]=V_maxloc		$name_y[j]=vcsr(A)+j*dimdelta($name,1)		i+=1		j+=1	While(i<qcsr(B)+1)	Killwaves thiswave	Appendtograph $name_y vs $name_x	Smooth 50, $name_yEnd//**********************************************************************************************************************Proc readcsr()	PauseUpdate	Silent 1	String thiswave_e,thiswave_k	thiswave_e="band_e"+num2str(num_of_band)	thiswave_k="band_k"+num2str(num_of_band)	Insertpoints dimsize($thiswave_e,0),1,$thiswave_e	Insertpoints dimsize($thiswave_k,0),1,$thiswave_k	$thiswave_e[dimsize($thiswave_e,0)-1]=vcsr(A)	$thiswave_k[dimsize($thiswave_k,0)-1]=hcsr(A)End	//**********************************************************************************************************************Proc createband()	PauseUpdate	Silent 1	Variable/G num_of_band	String thiswave_e,thiswave_k	String tablename	if(mod(Round(num_of_band),1)!=0)		num_of_band=0	Endif	thiswave_e="band_e"+num2str(num_of_band)	thiswave_k="band_k"+num2str(num_of_band)	tablename="Table_allbands"	If(Wintype(tablename)==2)		DoWindow/F tablename		Else			Edit as tablename			Dowindow/C $tablename	Endif	if(WaveExists($thiswave_e)!=1)		Make/N=0 $thiswave_e		Make/N=0 $thiswave_k		Appendtotable $thiswave_e,$thiswave_k	EndifEnd	//**********************************************************************************************************************Proc deletelastpnt()	PauseUpdate	Silent 1	String thiswave_e,thiswave_k	Variable lastpnt	thiswave_e="band_e"+num2str(num_of_band)	thiswave_k="band_k"+num2str(num_of_band)	if(WaveExists($thiswave_e)==1)		lastpnt=dimsize($thiswave_e,0)-1		Deletepoints lastpnt,1,$thiswave_e		Deletepoints lastpnt,1,$thiswave_k	EndifEnd	//**********************************************************************************************************************Proc Sortpnts()	PauseUpdate	Silent 1	String thiswave_e,thiswave_k	thiswave_e="band_e"+num2str(num_of_band)	thiswave_k="band_k"+num2str(num_of_band)	if(WaveExists($thiswave_e)==1)		Sort $thiswave_k,$thiswave_k,$thiswave_e	EndifEnd	//**********************************************************************************************************************Proc deleteallpnts()	PauseUpdate	Silent 1	String thiswave_e,thiswave_k	Variable numofpnts	thiswave_e="band_e"+num2str(num_of_band)	thiswave_k="band_k"+num2str(num_of_band)	if(WaveExists($thiswave_e)==1)		Make/O/N=0 $thiswave_e		Make/O/N=0 $thiswave_k	EndifEnd//**********************************************************************************************************************Proc plotpnts()	PauseUpdate	Silent 1	String thiswave_e,thiswave_k	Variable numofpnts	thiswave_e="band_e"+num2str(num_of_band)	thiswave_k="band_k"+num2str(num_of_band)	if(WaveExists($thiswave_e)==1)		Display $thiswave_e vs $thiswave_k	EndifEnd//**********************************************************************************************************************Proc showpointreader()	PauseUpdate	Silent 1	String to_check	to_check="Table_allbands"	if(WaveExists($to_check)==0)			Dowindow/F $to_check		Else			print "You must first open the Point Reader Panel"	EndifEnd//**********************************************************************************************************************Proc appendpnts()	PauseUpdate	Silent 1	String thiswave_e,thiswave_k	Variable numofpnts	thiswave_e="band_e"+num2str(num_of_band)	thiswave_k="band_k"+num2str(num_of_band)	if(WaveExists($thiswave_e)==1)		Appendtograph $thiswave_e vs $thiswave_k	EndifEnd				//**********************************************************************************************************************Function ButtonProc_readcsr(ctrlName) : ButtonControl	String ctrlName	Execute "Readcsr()"End//**********************************************************************************************************************Function ButtonProc_plotpnts(ctrlName) : ButtonControl	String ctrlName	Execute "Plotpnts()"End//**********************************************************************************************************************Function ButtonProc_appendpnts(ctrlName) : ButtonControl	String ctrlName	Execute "Appendpnts()"End//**********************************************************************************************************************Function ButtonProc_sortpnts(ctrlName) : ButtonControl	String ctrlName	Execute "Sortpnts()"End//**********************************************************************************************************************Function ButtonProc_createband(ctrlName) : ButtonControl	String ctrlName	Execute "showpointreader()"	Execute "Createband()"End//**********************************************************************************************************************Function ButtonProc_deletelastpnt(ctrlName) : ButtonControl	String ctrlName	Execute "Deletelastpnt()"End//**********************************************************************************************************************Function ButtonProc_deleteallpnts(ctrlName) : ButtonControl	String ctrlName	Execute "Deleteallpnts()"End//********************************************************************************************************************************Proc rot2d_pi(mat,angle,px,py,qualityfactor)	String mat	Variable angle	Variable px=0	Variable py=0	Variable qualityfactor=10	Prompt mat,"Enter the name of the matrix"	Prompt angle,"Enter the rotation angle (degrees, clockwise)"	Prompt px,"Enter the x value of the pivot point"	Prompt py,"Enter the y value of the pivot point"		Prompt qualityfactor,"Enter the quality factor"				Pauseupdate; silent 1	Variable x_0,x_last,delta_x,y_0,y_last,delta_y,total_x,total_y	Variable new_xoffset,new_xlast,new_yoffset,new_ylast	Variable top,bottom,left,right	Variable newsize_x,newsize_y	Variable new_delta	Variable valuex,valuey	Variable oldx,oldy	Variable i,j	String nnewmat,c_mat	nnewmat=mat+"_"+"rot"+num2str(angle)	x_0=dimoffset($mat,0)	y_0=dimoffset($mat,1)	delta_x=dimdelta($mat,0)	delta_y=dimdelta($mat,1)	total_x=dimsize($mat,0)	total_y=dimsize($mat,1)	x_last=x_0+delta_x*(total_x-1)	y_last=y_0+delta_y*(total_y-1)	//Find the borders of the new matrix	i=0	Do		c_mat="cmat"+num2str(i)		Make/O/N=2 $c_mat		i+=1	While(i<4)		cmat2[0]=(x_last-px)*cos(angle*Pi/180)+(y_last-py)*sin(angle*Pi/180)+px		//upper right	cmat2[1]=-(x_last-px)*sin(angle*Pi/180)+(y_last-py)*cos(angle*Pi/180)+py	cmat1[0]=(x_last-px)*cos(angle*Pi/180)+(y_0-py)*sin(angle*Pi/180)+px		//bottom right	cmat1[1]=-(x_last-px)*sin(angle*Pi/180)+(y_0-py)*cos(angle*Pi/180)+py	cmat3[0]=(x_0-px)*cos(angle*Pi/180)+(y_last-py)*sin(angle*Pi/180)+px		//upper left	cmat3[1]=-(x_0-px)*sin(angle*Pi/180)+(y_last-py)*cos(angle*Pi/180)+py	cmat0[0]=(x_0-px)*cos(angle*Pi/180)+(y_0-py)*sin(angle*Pi/180)+px			//bottom left	cmat0[1]=-(x_0-px)*sin(angle*Pi/180)+(y_0-py)*cos(angle*Pi/180)+py	new_xoffset=cmat0[0]	new_xlast=cmat0[0]	new_yoffset=cmat0[1]	new_ylast=cmat0[1]	i=1	Do		c_mat="cmat"+num2str(i)		If($c_mat[0]<new_xoffset)			new_xoffset=$c_mat[0]		Endif		If($c_mat[0]>new_xlast)			new_xlast=$c_mat[0]		Endif		If($c_mat[1]<new_yoffset)			new_yoffset=$c_mat[1]		Endif		If($c_mat[1]>new_ylast)			new_ylast=$c_mat[1]		Endif					i+=1	While(i<4)	//Set the scaling of the new matrix	new_delta=sqrt((new_xlast-new_xoffset)*(new_ylast-new_yoffset)/(total_x*total_y))/qualityfactor	newsize_x=Round((new_xlast-new_xoffset)/new_delta)	newsize_y=Round((new_ylast-new_yoffset)/new_delta)	Make/O/N=(newsize_x,newsize_y) $nnewmat	Setscale/P x,new_xoffset,new_delta,"",$nnewmat	Setscale/P y,new_yoffset,new_delta,"",$nnewmat	//Filling the new matrix	func_rot2d_pi($mat,$nnewmat,angle,px,py,new_delta,delta_x,delta_y,newsize_x,newsize_y,new_xoffset,new_yoffset,x_0,x_last,y_0,y_last)	Killwaves cmat0	Killwaves cmat1	Killwaves cmat2	Killwaves cmat3	Display	Appendimage $nnewmat		ModifyImage $nnewmat ctab= {*,*,Terrain,1}			End//********************************************************************************************************************************Function func_rot2d_pi(mat,nnewmat,angle,px,py,new_delta,delta_x,delta_y,newsize_x,newsize_y,new_xoffset,new_yoffset,x_0,x_last,y_0,y_last)	Wave mat	Wave nnewmat	Variable angle	Variable px	Variable py	Variable new_delta	Variable delta_x	Variable delta_y	Variable newsize_x	Variable newsize_y	Variable new_xoffset		Variable new_yoffset	Variable x_0	Variable x_last	Variable y_0	Variable y_last	Variable valuex,valuey	Variable oldx,oldy	Variable i,j	//Filling the new matrix	nnewmat[][]=NaN	i=0	Do		valuex=new_xoffset+i*new_delta		j=0		Do				valuey=new_yoffset+j*new_delta			oldx=(valuex-px)*cos(angle*Pi/180)-(valuey-py)*sin(angle*Pi/180)+px			oldy=(valuex-px)*sin(angle*Pi/180)+(valuey-py)*cos(angle*Pi/180)+py			If((oldx<=x_last)&&(oldx>=x_0)&&(oldy<=y_last)&&(oldy>=y_0))				nnewmat[i][j]=mat[Round((oldx-x_0)/delta_x)][Round((oldy-y_0)/delta_y)]			Endif			j+=1		While(j<newsize_y)		i+=1	While(i<newsize_x)End//********************************************************************************************************************************Function func_rot3d_pi(mat,nnewmat,angle,px,py,new_delta,delta_x,delta_y,newsize_x,newsize_y,new_xoffset,new_yoffset,x_0,x_last,y_0,y_last)	Wave mat	Wave nnewmat	Variable angle	Variable px	Variable py	Variable new_delta	Variable delta_x	Variable delta_y	Variable newsize_x	Variable newsize_y	Variable new_xoffset		Variable new_yoffset	Variable x_0	Variable x_last	Variable y_0	Variable y_last	Variable valuex,valuey	Variable oldx,oldy	Variable i,j	//Filling the new matrix	nnewmat[][][]=NaN	i=0	Do		valuex=new_xoffset+i*new_delta		If(mod(i,100)==0)			print i, "/",newsize_x-1		Endif		j=0		Do				valuey=new_yoffset+j*new_delta			oldx=(valuex-px)*cos(angle*Pi/180)-(valuey-py)*sin(angle*Pi/180)+px			oldy=(valuex-px)*sin(angle*Pi/180)+(valuey-py)*cos(angle*Pi/180)+py			If((oldx<=x_last)&&(oldx>=x_0)&&(oldy<=y_last)&&(oldy>=y_0))				nnewmat[i][j][]=mat[Round((oldx-x_0)/delta_x)][Round((oldy-y_0)/delta_y)][r]			Endif			j+=1		While(j<newsize_y)		i+=1	While(i<newsize_x)End//********************************************************************************************************************************Proc scale_e_pi(matrix,energy_shift)	String matrix	Variable energy_shift	Prompt matrix,"Enter the name of the matrix"	Prompt energy_shift,"Enter the energy you want to add"	PauseUpdate	Silent 1	Variable energy_0,delta_energy,shift,new_0	energy_0=dimoffset($matrix,1)	delta_energy=dimdelta($matrix,1)	shift=round(energy_shift/delta_energy)*delta_energy	new_0=energy_0+shift	setscale/p y,new_0,delta_energy,"",$matrix	End//********************************************************************************************************************************Proc Mk_vb_table_pi(number)	Variable number	Prompt number,"Enter the number of the table"	PauseUpdate	Silent 1	String tablename	tablename="Valence_band_table"+num2str(number)	String index_data="index_of_data"+num2str(number)		if( !WaveExists( $index_data) )			Make/N=1 $index_data		endif		String energy_data="energy_of_data"+num2str(number)		if( !WaveExists( $energy_data) )			Make/N=1 $energy_data		endif		String first_slice="first_slice_of_data"+num2str(number)		if( !WaveExists( $first_slice) )			Make/N=1  $first_slice		endif		String last_slice="last_slice_of_data"+num2str(number)		if( !WaveExists( $last_slice) )			Make/N=1 $last_slice		endif		if( 2==winType(tablename))		DoWindow /F $tablename	endif	if(  0==wintype(tablename))		Edit $index_data,$energy_data,$first_slice,$last_slice		DoWindow /C $tablename	endif	End//********************************************************************************************************************************Proc plot_vb_pi(e_fermi,normal_energy1,normal_energy2,number)	Variable e_fermi	Variable normal_energy1=-1	Variable normal_energy2=-1	Variable number	Prompt e_fermi,"Enter the fermi energy (positive value below the photon energy)"	Prompt normal_energy1,"Energy range of normalization (positive value below the photon energy). From:"	Prompt normal_energy2,"to:"	Prompt number,"Enter the number of the table"	PauseUpdate	Silent 1	String thiswave,wavedata	String i_of_data,e_of_data,f_of_data,l_of_data	Variable i,j,index,n,position	Variable norm_fact	Display	i=0	i_of_data="index_of_data"+num2str(number)	e_of_data="energy_of_data"+num2str(number)	f_of_data="first_slice_of_data"+num2str(number)	l_of_data="last_slice_of_data"+num2str(number)	Do		index=$i_of_data[i]		wavedata="data"+num2str(index)		thiswave="vb"+num2str(number)+"_"+num2str($e_of_data[i])		Make/O/N=(dimsize($wavedata,1)) $thiswave		setscale/p x,dimoffset($wavedata,1)-$e_of_data[i]+e_fermi,dimdelta($wavedata,1),"",$thiswave//		position=Round(($e_of_data[i]-e_fermi-normal_energy-dimoffset($wavedata,1))/dimdelta($wavedata,1))		$thiswave[]=0		n=0					j=$f_of_data[i]		Do			$thiswave[]+=$wavedata[j][p]			j+=1			n+=1		While(j<($l_of_data[i]+1))		$thiswave[]/=n		norm_fact=1		if((normal_energy1!=-1)&&(normal_energy2!=-1))			norm_fact=mean($thiswave,e_fermi-normal_energy2,e_fermi-normal_energy1)//			norm_fact=$thiswave[position]		Endif		$thiswave[]/=norm_fact		Appendtograph $thiswave		i+=1	While(i<dimsize($i_of_data,0))	Showinfo	Label bottom "Binding energy (eV)"	Label left "Intensity (arb. units)"	End//********************************************************************************************************************************Proc core_level_pi(matrix,first,last,photon_e,Fermi_energy)	String matrix	Variable first,last,Fermi_energy,photon_e	Prompt matrix,"Enter the name of the matrix"	Prompt first,"Enter the first slice"	Prompt last,"Enter the last slice"	Prompt photon_e,"Enter the photon energy (eV)"	Prompt Fermi_energy,"Enter the Fermi energy (eV)"	PauseUpdate	Silent 1	String kin_vec	String bind_vec	Variable i,energy_max	kin_vec="kin"+num2str(photon_e)	bind_vec="bind"+num2str(photon_e)	energy_max=dimoffset($matrix,1)+(dimsize($matrix,1)-1)*dimdelta($matrix,1)	Make/O/N=(dimsize($matrix,1)) $kin_vec	setscale/p x,dimoffset($matrix,1),dimdelta($matrix,1),"",$kin_vec		Make/O/N=(dimsize($matrix,1)) $bind_vec	setscale/p x,dimoffset($matrix,1)-photon_e+Fermi_energy,dimdelta($matrix,1),"",$bind_vec		$kin_vec[]=0	$bind_vec[]=0	i=first	Do		$kin_vec[]+=$matrix[i][p]		$bind_vec[]+=$matrix[i][p]		i+=1	While(i<(last+1))	i=0	Display	Appendtograph $kin_vec	Label bottom "Kinetic energy (eV)"	Display	Appendtograph $bind_vec	Label bottom "Binding energy (eV)"End//********************************************************************************************************************************Proc sub_bline_pi(number_of_average)	Variable number_of_average	PauseUpdate	Silent 1	Variable groupnum	String data_mat	Variable energy0,delta_energy,total_energy	Variable total_edc	Variable i	Variable temp_val	groupnum=gv_groupnum	data_mat="Data"+Num2Str(groupnum)	total_energy=dimsize($data_mat,1)	energy0=dimoffset($data_mat,1)	delta_energy=dimdelta($data_mat,1)	total_edc=dimsize($data_mat,0)	Make/O/N=(total_energy) temporarywave	SetScale/P x energy0,delta_energy,"",temporarywave	i=0	Do		temporarywave=$data_mat[i][p]		temp_val=mean(temporarywave,pnt2x(temporarywave,(total_energy-number_of_average)),pnt2x(temporarywave,(total_energy-1)))		$data_mat[i][]-=temp_val		i+=1	While(i<total_edc)		Killwaves temporarywaveEnd//********************************************************************************************************************************Function func_sub_bline_pi(data_mat,number_of_average)	Wave data_mat	Variable number_of_average	PauseUpdate	Silent 1	Variable groupnum	Variable energy0,delta_energy,total_energy	Variable total_edc	Variable i	Variable temp_val	total_energy=dimsize(data_mat,1)	energy0=dimoffset(data_mat,1)	delta_energy=dimdelta(data_mat,1)	total_edc=dimsize(data_mat,0)	Make/O/N=(total_energy) temporarywave	SetScale/P x energy0,delta_energy,"",temporarywave	i=0	Do		temporarywave=data_mat[i][p]		temp_val=mean(temporarywave,pnt2x(temporarywave,(total_energy-number_of_average)),pnt2x(temporarywave,(total_energy-1)))		data_mat[i][]-=temp_val		i+=1	While(i<total_edc)		Killwaves temporarywaveEnd//********************************************************************************************************************************Proc sub_blineedc_pi(edcname,number_of_average)	String edcname	Variable number_of_average	PauseUpdate	Silent 1	Variable energy0,total_energy	Variable temp_val	total_energy=dimsize($edcname,0)	energy0=dimoffset($edcname,0)	temp_val=mean($edcname,pnt2x($edcname,(total_energy-number_of_average)),pnt2x($edcname,(total_energy-1)))	$edcname[]-=temp_valEnd//*******************************************************************************************************************************Proc return_phi_theta(newhv)	Variable newhv=100	Prompt newhv,"Enter hv"	PauseUpdate	Silent 1	String namewave	Variable newptx	Variable newpty	Variable ptx,pty	Variable tempx,tempy	Variable thistheta,thisphi	namewave=csrwave(A)	If(cmpstr(namewave,"ky_final")==0)		ptx=lattice_0*(kx_final[pcsr(A)])	Endif	If(cmpstr(namewave,"ky_finalrot")==0)		ptx=lattice_0*(kx_finalrot[pcsr(A)])	Endif	If(cmpstr(namewave,"upr_y")==0)		ptx=lattice_0*(upr_x[pcsr(A)])	Endif	If(cmpstr(namewave,"supr1_y")==0)		ptx=lattice_0*(supr1_x[pcsr(A)])	Endif	If(cmpstr(namewave,"supr2_y")==0)		ptx=lattice_0*(supr2_x[pcsr(A)])	Endif	If(cmpstr(namewave,"supr3_y")==0)		ptx=lattice_0*(supr3_x[pcsr(A)])	Endif				If(cmpstr(namewave,"upl_y")==0)		ptx=lattice_0*(upl_x[pcsr(A)])	Endif	If(cmpstr(namewave,"supl1_y")==0)		ptx=lattice_0*(supl1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"upl_y")==0)		ptx=lattice_0*(supl1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"supl2_y")==0)		ptx=lattice_0*(supl2_x[pcsr(A)])	Endif										If(cmpstr(namewave,"lowr_y")==0)		ptx=lattice_0*(lowr_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowr1_y")==0)		ptx=lattice_0*(slowr1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowr2_y")==0)		ptx=lattice_0*(slowr2_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowr3_y")==0)		ptx=lattice_0*(slowr3_x[pcsr(A)])	Endif					If(cmpstr(namewave,"lowl_y")==0)		ptx=lattice_0*(lowl_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowl1_y")==0)		ptx=lattice_0*(slowl1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowl2_y")==0)		ptx=lattice_0*(slowl2_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowl3_y")==0)		ptx=lattice_0*(slowl3_x[pcsr(A)])	Endif					If(cmpstr(namewave,"folded1_y")==0)		ptx=lattice_0*(folded1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded2_y")==0)		ptx=lattice_0*(folded2_x[pcsr(A)])	Endif	If(cmpstr(namewave,"folded3_y")==0)		ptx=lattice_0*(folded3_x[pcsr(A)])	Endif	If(cmpstr(namewave,"folded4_y")==0)		ptx=lattice_0*(folded4_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded5_y")==0)		ptx=lattice_0*(folded5_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded6_y")==0)		ptx=lattice_0*(folded6_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded7_y")==0)		ptx=lattice_0*(folded7_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded8_y")==0)		ptx=lattice_0*(folded8_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded9_y")==0)		ptx=lattice_0*(folded9_x[pcsr(A)])	Endif	If(cmpstr(namewave,"BZbondaries_y")==0)		ptx=lattice_0*(BZbondaries_x[pcsr(A)])	Endif																	If(cmpstr(namewave,"MBZbondaries_y")==0)		ptx=lattice_0*(MBZbondaries_x[pcsr(A)])	Endif																	pty=lattice_0*vcsr(A)	tempx=ptx*cos(rot_zero*pi/180)+pty*sin(rot_zero*pi/180)	tempy=pty*cos(rot_zero*pi/180)-ptx*sin(rot_zero*pi/180)	thistheta=asin(tempx/(0.51231*sqrt(newhv-4.35)))	thisphi=asin(tempy/(0.51231*sqrt(newhv-4.35)*cos(thistheta)))	newptx=thistheta*180/pi-theta_zero	newpty=thisphi*180/pi-phi_zero	print "theta = ",newptx,"phi = ",newptyEnd//*******************************************************************************************************************************Proc return_phi_theta1(newhv)	Variable newhv=100	Prompt newhv,"Enter hv"	PauseUpdate	Silent 1	String namewave	Variable newptx	Variable newpty	Variable ptx,pty	Variable tempx,tempy	Variable thistheta,thisphi	namewave=csrwave(A)	If(cmpstr(namewave,"upr_y")==0)		ptx=lattice1_0*(upr_x[pcsr(A)])	Endif	If(cmpstr(namewave,"supr1_y")==0)		ptx=lattice1_0*(supr1_x[pcsr(A)])	Endif	If(cmpstr(namewave,"supr2_y")==0)		ptx=lattice1_0*(supr2_x[pcsr(A)])	Endif	If(cmpstr(namewave,"supr3_y")==0)		ptx=lattice1_0*(supr3_x[pcsr(A)])	Endif				If(cmpstr(namewave,"upl_y")==0)		ptx=lattice1_0*(upl_x[pcsr(A)])	Endif	If(cmpstr(namewave,"supl1_y")==0)		ptx=lattice1_0*(supl1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"upl_y")==0)		ptx=lattice1_0*(supl1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"supl2_y")==0)		ptx=lattice1_0*(supl2_x[pcsr(A)])	Endif										If(cmpstr(namewave,"lowr_y")==0)		ptx=lattice1_0*(lowr_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowr1_y")==0)		ptx=lattice1_0*(slowr1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowr2_y")==0)		ptx=lattice1_0*(slowr2_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowr3_y")==0)		ptx=lattice1_0*(slowr3_x[pcsr(A)])	Endif					If(cmpstr(namewave,"lowl_y")==0)		ptx=lattice1_0*(lowl_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowl1_y")==0)		ptx=lattice1_0*(slowl1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowl2_y")==0)		ptx=lattice1_0*(slowl2_x[pcsr(A)])	Endif		If(cmpstr(namewave,"slowl3_y")==0)		ptx=lattice1_0*(slowl3_x[pcsr(A)])	Endif					If(cmpstr(namewave,"folded1_y")==0)		ptx=lattice1_0*(folded1_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded2_y")==0)		ptx=lattice1_0*(folded2_x[pcsr(A)])	Endif	If(cmpstr(namewave,"folded3_y")==0)		ptx=lattice1_0*(folded3_x[pcsr(A)])	Endif	If(cmpstr(namewave,"folded4_y")==0)		ptx=lattice1_0*(folded4_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded5_y")==0)		ptx=lattice1_0*(folded5_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded6_y")==0)		ptx=lattice1_0*(folded6_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded7_y")==0)		ptx=lattice1_0*(folded7_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded8_y")==0)		ptx=lattice1_0*(folded8_x[pcsr(A)])	Endif		If(cmpstr(namewave,"folded9_y")==0)		ptx=lattice1_0*(folded9_x[pcsr(A)])	Endif	If(cmpstr(namewave,"BZbondaries_y")==0)		ptx=lattice1_0*(BZbondaries_x[pcsr(A)])	Endif																	If(cmpstr(namewave,"MBZbondaries_y")==0)		ptx=lattice1_0*(MBZbondaries_x[pcsr(A)])	Endif			If(cmpstr(namewave,"image_fs_plot")==0)		ptx=lattice1_0*xcsr(A)	Endif																		pty=lattice1_0*vcsr(A)	tempx=ptx*cos(rot1_zero*pi/180)+pty*sin(rot1_zero*pi/180)	tempy=pty*cos(rot1_zero*pi/180)-ptx*sin(rot1_zero*pi/180)	thistheta=asin(tempx/(0.51231*sqrt(newhv-4.35)))	thisphi=asin(tempy/(0.51231*sqrt(newhv-4.35)*cos(thistheta)))	newptx=thistheta*180/pi-theta1_zero	newpty=thisphi*180/pi-phi1_zero	print "theta = ",newptx,"phi = ",newptyEnd//********************************************************************************************************************************Proc new_eres_pi(dataname,num_to_combine,overwrite)	String dataname	Variable num_to_combine	Variable overwrite	Prompt dataname, "Enter the name of the matrix"	Prompt num_to_combine,"How many energy steps do you want to combine?"	Prompt overwrite,"Do you want to overwrite the old matrix?",popup "Yes;No"	PauseUpdate	Silent 1	String newdata	Variable oldoffset,oldsize,olddelta	Variable newsize,newoffset,newdelta	Variable size_x,offset_x,delta_x	Variable i,j	oldoffset=dimoffset($dataname,1)	oldsize=dimsize($dataname,1)		olddelta=dimdelta($dataname,1)	offset_x=dimoffset($dataname,0)	size_x=dimsize($dataname,0)		delta_x=dimdelta($dataname,0)		newsize=floor(oldsize/num_to_combine)	newdelta=olddelta*num_to_combine	newoffset=oldoffset+olddelta*(num_to_combine-1)/2	newdata=dataname+"combE"+num2str(num_to_combine)	Make/O/N=(size_x,newsize) $newdata	SetScale/P x offset_x,delta_x,"",$newdata	SetScale/P y newoffset,newdelta,"",$newdata		i=0	Do		j=i*num_to_combine		Do			$newdata[][i]+=$dataname[p][j]			j+=1		While(j<(i+1)*num_to_combine)		$newdata[][i]/=num_to_combine		i+=1	While(i<newsize)	If(overwrite==1)		Duplicate/O $newdata $dataname		SetScale/P x offset_x,delta_x,"",$dataname		SetScale/P y newoffset,newdelta,"",$dataname		Killwaves $newdata	Endif	if(overwrite==2)		Display		Appendimage $newdata		ModifyImage $newdata ctab= {*,*,Terrain,0}	Endif				 End//********************************************************************************************************************************Proc new_kres_pi(dataname,num_to_combine,overwrite)	String dataname	Variable num_to_combine	Variable overwrite	Prompt dataname, "Enter the name of the matrix"	Prompt num_to_combine,"How many k steps do you want to combine?"	Prompt overwrite,"Do you want to overwrite the old matrix?",popup "Yes;No"	PauseUpdate	Silent 1	String newdata	Variable oldoffset,oldsize,olddelta	Variable newsize,newoffset,newdelta	Variable size_e,offset_e,delta_e	Variable i,j	oldoffset=dimoffset($dataname,0)	oldsize=dimsize($dataname,0)		olddelta=dimdelta($dataname,0)	offset_e=dimoffset($dataname,1)	size_e=dimsize($dataname,1)		delta_e=dimdelta($dataname,1)		newsize=floor(oldsize/num_to_combine)	newdelta=olddelta*num_to_combine	newoffset=oldoffset+olddelta*(num_to_combine-1)/2	newdata=dataname+"combk"+num2str(num_to_combine)	Make/O/N=(newsize,size_e) $newdata	SetScale/P y offset_e,delta_e,"",$newdata	SetScale/P x newoffset,newdelta,"",$newdata		i=0	Do		j=i*num_to_combine		Do			$newdata[i][]+=$dataname[j][q]			j+=1		While(j<(i+1)*num_to_combine)		$newdata[i][]/=num_to_combine		i+=1	While(i<newsize)	If(overwrite==1)		Duplicate/O $newdata $dataname		SetScale/P y offset_e,delta_e,"",$dataname		SetScale/P x newoffset,newdelta,"",$dataname		Killwaves $newdata	Endif				 End//********************************************************************************************************************************Proc cut_the_edge_pi(dataname,start_num,end_num,overwrite)	String dataname	Variable start_num=14	Variable end_num=244	Variable overwrite	Prompt dataname, "Enter the name of the matrix"	Prompt start_num,"Enter the first angle"	Prompt end_num,"Enter the last angle"		Prompt overwrite,"Do you want to overwrite the old matrix?",popup "Yes;No"	PauseUpdate	Silent 1	String newdata	newdata=dataname+"cut_edge"	Duplicate/O/R=[start_num,end_num][*] $dataname $newdata	If(overwrite==1)		Duplicate/O $newdata $dataname		Killwaves $newdata	Endif				 End//********************************************************************************************************************************Proc cut_edge_all()//	PauseUpdate	Silent 1	String name	Variable i	i=1	Do		name="data"+num2str(i)		cut_the_edge_pi(name,14,244,1)		i+=1	While(i<dimsize(file_name,0))	End	//********************************************************************************************************************************Proc Mk_nk_table_pi(number)	Variable number	Prompt number,"Enter the number of the table"	PauseUpdate	Silent 1	String tablename	tablename="norm_table"+num2str(number)	String index_wr="index_of_wr"+num2str(number)		if( !WaveExists( $index_wr) )			Make/N=1 $index_wr		endif		String index_nr="index_of_nr"+num2str(number)		if( !WaveExists( $index_nr) )			Make/N=1 $index_nr		endif		String energy_nk="energy_of_nk"+num2str(number)		if( !WaveExists( $energy_nk) )			Make/N=1  $energy_nk		endif		if( 2==winType(tablename))		DoWindow /F $tablename	endif	if(  0==wintype(tablename))		Edit $index_wr,$index_nr,$energy_nk		DoWindow /C $tablename	endif	End//********************************************************************************************************************************Proc norm_high_e_pi(number,e_start,e_end)	Variable number	Variable e_start	Variable e_end	Prompt number,"Enter the number of the normalization table"	Prompt e_start,"Range of normalization (positive value below the photon energy). From"	Prompt e_end,"to"	PauseUpdate	Silent 1				Variable i,j	Variable e_st,e_nd	Variable temp_val,total_edc	Variable number_of_data	Variable int_nk	String mat_name_data	String wrange,nrange,ephoton	wrange="index_of_wr"+num2str(number)	nrange="index_of_nr"+num2str(number)	ephoton="energy_of_nk"+num2str(number)	number_of_data=dimsize($wrange,0)//	i=5	i=0	Do 		gv_groupNum=$wrange[i]		DisplayMat()		mat_name_data="data"+num2str(gv_groupNum)		total_edc=dimsize($mat_name_data,0)		Showinfo		ModifyImage $mat_name_data ctab= {0,*,yellowhot,0}		sub_bline_pi(10)		e_st=$ephoton[i]-e_start		e_nd=$ephoton[i]-e_end		Make/O/N=(dimsize($mat_name_data,0)) nk		Make/O/N=(dimsize($mat_name_data,1)) temporarywave		SetScale/P x dimoffset($mat_name_data,1),dimdelta($mat_name_data,1),"",temporarywave		nk[]=0		j=0		Do			temporarywave[]=$mat_name_data[j][p]			temp_val=mean(temporarywave,e_nd,e_st)			nk[j]=temp_val			j+=1		While(j<total_edc)		int_nk=0		j=0		Do			int_nk+=nk[j]			j+=1		While(j<dimsize(nk,0))		int_nk/=1000		nk[]/=int_nk		$mat_name_data[][]/=nk[p]				gv_groupNum=$nrange[i]		DisplayMat()		mat_name_data="data"+num2str(gv_groupNum)		total_edc=dimsize($mat_name_data,0)		Showinfo		ModifyImage $mat_name_data ctab= {0,*,yellowhot,0}		sub_bline_pi(20)		j=0		$mat_name_data[][]/=nk[p]		i+=1	While(i<number_of_data)End//********************************************************************************************************************************Proc norm_above_ef_pi(data_number)	Variable data_number	Prompt data_number,"Enter the index number of the file"	PauseUpdate	Silent 1				Variable i,j	Variable num_average	Variable temp_val,total_edc,total_mdc	Variable number_of_data	String mat_name_data	num_average=15	gv_groupNum=data_number	mat_name_data="data"+num2str(data_number)	total_edc=dimsize($mat_name_data,0)	total_mdc=dimsize($mat_name_data,1)	DisplayMat()	Showinfo	ModifyImage $mat_name_data ctab= {0,*,yellowhot,0}	Make/O/N=(dimsize($mat_name_data,0)) nk	Make/O/N=(dimsize($mat_name_data,1)) temporarywave		j=0	Do		temporarywave=$mat_name_data[j][p]		temp_val=mean(temporarywave,pnt2x(temporarywave,(total_mdc-num_average)),pnt2x(temporarywave,(total_mdc-1)))		$mat_name_data[j][]/=temp_val		nk[j]=temp_val		j+=1	While(j<total_edc)	Killwaves temporarywaveEnd//********************************************************************************************************************************	Proc duplicatemat(oldname,newname)	String oldname	String newname	Prompt oldname,"Which matrix would you like to duplicate?"	Prompt newname,"Enter the new name"	PauseUpdate	Silent 1	Duplicate/O $oldname $newname	End//********************************************************************************************************************************Proc put_fermi_image(matname,energy)	String matname	Variable energy	Prompt matname,"Enter the name of the matrix"		Prompt energy,"Enter the energy"	PauseUpdate	Silent 1	String fermi	fermi=matname+"_fermi"	Make/O/N=2 $fermi	Setscale/p x, dimoffset($matname,0),dimdelta($matname,0)*(dimsize($matname,0)-1),"" $fermi		$fermi[]=energy	Appendtograph $fermiEnd//********************************************************************************************************************************Proc put_fermi_edc(matname,energy,last_intensity)	String matname	Variable energy	Variable last_intensity	Prompt matname,"Enter the name of the wave"		Prompt energy,"Enter the energy"	Prompt last_intensity,"Enter the lenght of the line"	PauseUpdate	Silent 1	String fermix,fermiy	fermix=matname+"_fermiedcx"	fermiy=matname+"_fermiedcy"		Make/O/N=2 $fermix	Make/O/N=2 $fermiy		$fermiy[0]=0	$fermiy[1]=last_intensity	$fermix[]=energy	Appendtograph $fermiy vs $fermix	ModifyGraph rgb($fermiy)=(0,0,0)	End	//********************************************************************************************************************************Proc renorm_pi(dataname,the_start,the_end)	String dataname	Variable the_end,the_start	Prompt dataname,"Enter the name of the wave"	Prompt the_start,"Enter the energy range. From:"	Prompt the_end,"To:"	PauseUpdate	Silent 1	Variable temp_val				temp_val=mean($dataname,the_start,the_end)	$dataname[]/=temp_valEnd//********************************************************************************************************************************Proc renormcut_k(matname,factor)	String matname	Variable factor	Prompt matname,"Enter the name of the cut"	Prompt factor,"Enter the convertion factor (to divide)"	PauseUpdate	Silent 1	Setscale/P x,dimoffset($matname,0)/factor,dimdelta($matname,0)/factor,""$matnameEnd//*******************************************************************************************************************************Proc adjust_all_to_fp(indexfrom,indexto,ferminame,Fermilevel)	variable indexfrom	Variable indexto	String ferminame	Variable Fermilevel	Prompt indexfrom,"Enter the first index"	Prompt indexto,"Enter the last index"	Prompt ferminame,"Enter the name of the Fermi profile"	Prompt Fermilevel,"Enter the value of the Fermi level"	PauseUpdate	Silent 1	String thisname	Variable i	i=indexfrom	Do		thisname="data"+num2str(i)		adjust_to_fp(thisname,ferminame,Fermilevel)		i+=1	While(i<indexto+1)End		//*******************************************************************************************************************************Proc adjust_to_fp(matname,ferminame,Fermilevel)	String matname	String ferminame	Variable Fermilevel	Prompt matname,"Enter the name of the matrix"	Prompt ferminame,"Enter the name of the Fermi profile"	Prompt Fermilevel,"Enter the value of the Fermi level"	PauseUpdate	Silent 1	Variable newmin,newmax,newsize	Wavestats/Q $ferminame	newmin=Dimoffset($matname,1)-(Fermilevel-V_min)	newmax=Dimoffset($matname,1)+Dimdelta($matname,1)*(Dimsize($matname,1)-1)-(V_max-Fermilevel)	Newsize=1+Ceil((Newmax-newmin)/Dimdelta($matname,1))	Make/O/N=(dimsize($matname,0),newsize) thenewmat	thenewmat[][]=NaN	Setscale/P x,dimoffset($matname,0),dimdelta($matname,0),""thenewmat	Setscale/P y,newmin,dimdelta($matname,1),""thenewmat	func_adjust_to_fp($matname,thenewmat,$ferminame,Fermilevel)	Duplicate/O thenewmat $matname	killwaves thenewmatEnd	//*******************************************************************************************************************************Function Func_adjust_to_fp(matname,thenewmat,ferminame,Fermilevel)	wave matname	wave thenewmat	wave ferminame	Variable Fermilevel	PauseUpdate	Silent 1	Variable i	i=0	Do		Make/O/N=(dimsize(matname,1)) ywave		Duplicate/O ywave xwave		ywave[]=matname[i][p]		xwave[]=dimoffset(matname,1)+p*dimdelta(matname,1)+(Fermilevel-ferminame[i])		thenewmat[i][]=interp(dimoffset(thenewmat,1)+q*dimdelta(thenewmat,1),xwave,ywave)		i+=1	While(i<dimsize(matname,0))	killwaves ywave,xwaveEnd//********************************************************************************************************************************		Proc fedorov_fact()	//To correct with the 1.388 factor	PauseUpdate	Silent 1	String thisdata	Variable newdelta,newstart	Variable i	i=1	Do		thisdata="data"+num2str(i)		newdelta=dimdelta($thisdata,0)/1.388		newstart=dimoffset($thisdata,0)/1.388				setscale/p x,newstart,newdelta,""$thisdata		i+=1	While(i<dimsize(file_name,0))	End//********************************************************************************************************************************Proc Constantoffset_n(Shift,number_of_same)	Variable Shift=1	Variable number_of_same=1	Prompt shift, "Input the amount of shift for offset"	Prompt number_of_same,"Enter the number of graphs with the same offset"	Pauseupdate; silent 1	Variable n=0,i	String WN0	Variable Y_Offset=0	Do		i=0		Do			WN0=WaveName("",n+i,1)			ModifyGraph offset($WN0)={0,Y_Offset}			i+=1		While(i<number_of_same)		Y_Offset+=shift		n+=number_of_same	while( WaveExists( $WaveName("",n,1) ) != 0 )End//********************************************************************************************************************************Proc color_digimage(matname,disp_or_not)	String matname	Variable disp_or_not	Prompt matname,"Enter the name of the image"	Prompt disp_or_not,"Do you want to display",popup,"Yes;No"	PauseUpdate	Silent 1	String redname,bluename,greenname	redname="red_"+matname	bluename="blue_"+matname	greenname="green_"+matname		Make/O/N=(dimsize($matname,0),dimsize($matname,1)) $redname	Make/O/N=(dimsize($matname,0),dimsize($matname,1)) $bluename	Make/O/N=(dimsize($matname,0),dimsize($matname,1)) $greenname		$redname[][]=$matname[p][q][0]	$bluename[][]=$matname[p][q][2]	$greenname[][]=$matname[p][q][1]	If(disp_or_not==1)			Display;appendimage $redname		Display;appendimage $bluename		Display;appendimage $greenname		EndifEnd		//********************************************************************************************************************************Proc Flip_digimage(matname)	String matname	Prompt matname,"Enter the name of the image"	PauseUpdate	Silent 1	Duplicate/O $matname Tempmat	func_Flip_digimage($matname)End	//********************************************************************************************************************************Function func_Flip_digimage(matname)	Wave matname	PauseUpdate	Silent 1	Duplicate/O matname Tempmat	matname[][][]=tempmat[p][dimsize(matname,1)-1-q][r]	killwaves tempmatEnd	//********************************************************************************************************************************Proc Intensity_digimage(matname,whichcolor,invornot,colorpixels,method,disp_or_not)	String matname	Variable whichcolor	Variable invornot	Variable colorpixels=256		Variable method=1	Variable disp_or_not	Prompt matname,"Enter the name of the image"	Prompt whichcolor,"Which color:",popup CTablist()	Prompt invornot,"",popup,"Normal;Inverse" 	Prompt colorpixels,"Number of color pixels"	Prompt method,"Enter the minimization degree"	Prompt disp_or_not,"Do you want to display",popup,"Yes;No"	PauseUpdate	Silent 1	String redname,bluename,greenname	String nameofcolor,fromcolorlist	String newname	newname=matname+"_I"	redname="red_"+matname	bluename="blue_"+matname	greenname="green_"+matname		If(exists(redname)==0)		color_digimage(matname,2)	Endif	Duplicate/O $redname $newname	$newname[][]=0//	Make/O/N=(num_intensity_pnts) intensity_wave	Make/O/N=(colorpixels) red_Iwave	Make/O/N=(colorpixels) blue_Iwave	Make/O/N=(colorpixels) green_Iwave	Setscale/I x,0,1,""red_Iwave	Setscale/I x,0,1,""blue_Iwave	Setscale/I x,0,1,""green_Iwave		//	intensity_wave[]=p/(num_intensity_pnts-1)	fromcolorlist=CTabList()	nameofcolor=Stringfromlist(whichcolor-1,fromcolorlist)	ColorTab2Wave $nameofcolor	Print nameofcolor	Setscale/I x,0,1,""M_colors	If(invornot==2)		Duplicate/O M_colors tempcmat		tempcmat[][]=M_colors[dimsize(M_colors,0)-1-p][q]		Duplicate/O tempcmat M_colors	Endif	Make/O/N=(dimsize(M_colors,0)) M_colorsx	M_colorsx[]=p/(dimsize(M_colors,0)-1)	Make/O/N=(dimsize(M_colors,0)) thiscolor	thiscolor[]=M_colors[p][0]	red_Iwave[]=Interp(p*dimdelta(red_Iwave,0),M_colorsx,thiscolor)	Make/O/N=(dimsize(M_colors,0)) thiscolor	thiscolor[]=M_colors[p][2]	blue_Iwave[]=Interp(p*dimdelta(blue_Iwave,0),M_colorsx,thiscolor)	Make/O/N=(dimsize(M_colors,0)) thiscolor	thiscolor[]=M_colors[p][1]	green_Iwave[]=Interp(p*dimdelta(green_Iwave,0),M_colorsx,thiscolor)		Imatrix_digimage($newname,$redname,$greenname,$bluename,red_Iwave,green_Iwave,blue_Iwave,colorpixels,method)	If(disp_or_not==1)			Display;appendimage $newname		ModifyImage $newname ctab= {*,*,$nameofcolor,invornot-1}	Endif	killwaves M_colors,thiscolor,red_Iwave,blue_Iwave,green_Iwave,M_colorsxEnd	//********************************************************************************************************************************Function Return_oneI_digimage(redwave,greenwave,bluewave,thisred,thisgreen,thisblue,method)	Wave redwave	Wave greenwave	Wave bluewave	Variable thisred	Variable thisgreen	Variable thisblue	Variable method	PauseUpdate	Silent 1		Variable thisintensity	Duplicate/O redwave deviationwave	deviationwave[]=(ABS(redwave[p]-thisred))^method+(ABS(greenwave[p]-thisgreen))^method+(ABS(bluewave[p]-thisblue))^method	Wavestats/Q deviationwave	thisintensity=V_minloc  //note that deviationwave scales like redwave, so thisintensity is between 0 and 1	Return thisintensityEnd//********************************************************************************************************************************Function Imatrix_digimage(newmat,matred,matgreen,matblue,redwave,greenwave,bluewave,colorpixels,method)	Wave newmat	Wave matred	Wave matgreen	Wave matblue	Wave redwave	Wave greenwave	Wave bluewave	Variable colorpixels	Variable method	PauseUpdate	Silent 1		Variable i,j	Variable thisred,thisgreen,thisblue	i=0	Do		IF(mod(i,50)==0)			Print i,"/",dimsize(newmat,0)-1		Endif		j=0		Do			thisred=matred[i][j]*(65535/(colorpixels-1))			thisgreen=matgreen[i][j]*(65535/(colorpixels-1))			thisblue=matblue[i][j]*(65535/(colorpixels-1))						newmat[i][j]=Return_oneI_digimage(redwave,greenwave,bluewave,thisred,thisgreen,thisblue,method)			j+=1		While(j<dimsize(newmat,1))		i+=1	While(i<dimsize(newmat,0))	End//********************************************************************************************************************************Proc bluetored()	Pauseupdate; silent 1	String WN	Variable color1,color2	Variable i	Variable num_of_curves	num_of_curves=0		Do		num_of_curves+=1	While(WaveExists( $WaveName("",num_of_curves,1) ) != 0)	num_of_curves-=1	i=0	Do		color1=Round(65535*i/(num_of_curves))		color2=65535-color1		WN=WaveName("",i,1)		ModifyGraph rgb($WN)=(color1,0,color2)		i+=1	while( WaveExists( $WaveName("",i,1) ) != 0 )End//********************************************************************************************************************************Proc bluegreenred()	Pauseupdate; silent 1	String WN	Variable color1,color2,color3	Variable i	Variable num_of_curves	num_of_curves=0		Do		num_of_curves+=1	While(WaveExists($WaveName("",num_of_curves,1) ) != 0)	num_of_curves-=1	i=0	Do		If(i<=Round(num_of_curves/2))			color3=Round(65535-2*65535*i/(num_of_curves))			Else				color3=0		Endif		If(i>=Round(num_of_curves/2))			color1=Round(2*65535*i/num_of_curves-65535)			Else				color1=0			Endif		If(i<=Round(num_of_curves/2))			color2=(65535-color3)					Else				color2=(65535-color1)		Endif				WN=WaveName("",i,1)		if(color1<0)			print i,"number1"		Endif		if(color2<0)			print "number2"		Endif		if(color3<0)			print "number3"		Endif		ModifyGraph rgb($WN)=(color1,color2,color3)		i+=1	while( WaveExists( $WaveName("",i,1) ) != 0 )End//*******************************************************************************************************************************Proc color_edc()	PauseUpdate	Silent 1	String WN	String fromcolorlist	String nameofcolor	Variable color1,color2,color0	Variable i	Variable num_of_curves	Variable xvalue	fromcolorlist=CTabList()	nameofcolor=Stringfromlist(colorsetedc-1,fromcolorlist)	num_of_curves=0		Do		num_of_curves+=1	While(WaveExists($WaveName("",num_of_curves,1) ) != 0)	num_of_curves-=1	ColorTab2Wave $nameofcolor	Setscale/I x,0,1,""M_colors	If(colorinverseedc==2)		Duplicate/O M_colors tempmatcolor		tempmatcolor[][]=M_colors[(dimsize(M_colors,0)-1)-p][q]		Duplicate/O tempmatcolor M_colors		Killwaves tempmatcolor	Endif	Make/O/N=(dimsize(M_colors,0)) xcolorwave	xcolorwave[]=0+p*dimdelta(M_colors,0)	i=0	Do		xvalue=i/num_of_curves		Duplicate/O xcolorwave ycolorwave		ycolorwave[]=M_colors[p][0]		color0=Round(interp(xvalue,xcolorwave,ycolorwave))		ycolorwave[]=M_colors[p][1]		color1=Round(interp(xvalue,xcolorwave,ycolorwave))		ycolorwave[]=M_colors[p][2]		color2=Round(interp(xvalue,xcolorwave,ycolorwave))		WN=WaveName("",i,1)				ModifyGraph rgb($WN)=(color0,color1,color2)		i+=1	while( WaveExists($WaveName("",i,1) ) != 0 )	Killwaves xcolorwave,ycolorwave	End	//********************************************************************************************************************************Proc appendthis(name)	String name	Prompt name,"Enter the name"	PauseUpdate	Silent 1	appendtograph $name		End	//********************************************************************************************************************************Proc combineall(name)	String name	Prompt name,"Enter the name of the matrix"	PauseUpdate	Silent 1	String thiswave	Variable i	thiswave="cb_all1_"+name	Make/O/N=(dimsize($name,1)) $thiswave	Setscale/P x,dimoffset($name,1),dimdelta($name,1),""$thiswave	$thiswave[]=0	i=0	Do		$thiswave[]+=$name[i][p]		i+=1	While(i<dimsize($name,0))	$thiswave[]/=dimsize($name,0)	Display $thiswaveEnd//********************************************************************************************************************************Proc combine_range(name,outputname,x_from,x_to)	String name	String outputname	Variable x_from=-pi/3.83-0.15	Variable x_to=-pi/3.83+0.15	Prompt name,"Enter the name of the matrix"	Prompt outputname,"Enter the name of the resulting wave"	Prompt x_from,"Combine from:"	Prompt x_to,"Combine to:"	PauseUpdate	Silent 1	Variable i,j	Make/O/N=(dimsize($name,1)) $outputname	Setscale/P x,dimoffset($name,1),dimdelta($name,1),""$outputname	$outputname[]=0	j=0	i=Round((x_from-dimoffset($name,0))/dimdelta($name,0))	Do		$outputname[]+=$name[i][p]		j+=1		i+=1	While(i<Round((x_to-dimoffset($name,0))/dimdelta($name,0))+1)	$outputname[]/=jEnd//********************************************************************************************************************************Proc normcut(name,index_from,index_to)	String name	Variable index_from=0 //75	Variable index_to=400   //885	Prompt name,"Enter the name of the matrix"	Prompt index_from,"Enter the lower index"	Prompt index_to,"Enter the upper index"	PauseUpdate	Silent 1	Variable x_from,x_to	x_from=dimoffset($name,1)+dimdelta($name,1)*(index_from)	x_to=dimoffset($name,1)+dimdelta($name,1)*(index_to)	func_normcut($name,x_from,x_to)End//********************************************************************************************************************************Function func_normcut(name,x_from,x_to)	Wave name	Variable x_from	Variable x_to	Variable i,mean_value	print x_from,x_to	i=0	Do		Make/O/N=(dimsize(name,1)) thiswave			Setscale/P x,dimoffset(name,1),dimdelta(name,1),""thiswave				thiswave[]=name[i][p]		mean_value=mean(thiswave,x_from,x_to)		thiswave[]/=mean_value		name[i][]=thiswave[q]		i+=1	While(i<dimsize(name,0))	killwaves thiswaveEnd//********************************************************************************************************************************Proc normwave(name,x_from,x_to)	String name	Variable x_from=-8.05 //75	Variable x_to=1   //885	Prompt name,"Enter the name of the matrix"	Prompt x_from,"Normalize from:"	Prompt x_to,"to:"	PauseUpdate	Silent 1	Variable mean_value	mean_value=mean($name,x_from,x_to)	$name[]/=mean_valueEnd//********************************************************************************************************************************Proc comb_krange(thisdata,outputname,x_center,x_wide)	String thisdata	String outputname	Variable x_center	Variable x_wide	Prompt thisdata,"Enter the name of the matrix"	Prompt outputname,"Enter the outputname"	Prompt x_center,"Enter the position"	Prompt x_wide,"Enter the full range to combine"		PauseUpdate	Silent 1	Make/O/N=(dimsize($thisdata,1)) $outputname	setscale/p x,dimoffset($thisdata,1),dimdelta($thisdata,1),""$outputname		Func_comb_krange($thisdata,$outputname,x_center,x_wide)End//********************************************************************************************************************************Function func_comb_krange(thisdata,outputname,x_center,x_wide)	Wave thisdata	Wave outputname	Variable x_center	Variable x_wide	PauseUpdate	Silent 1	Variable j	Variable i_left,i_right	Variable x_left,x_right	Variable y_left,y_right	Variable condition	Variable tocut	x_left=x_center-x_wide/2	x_right=x_center+x_wide/2	i_left=0	i_right=dimsize(thisdata,0)-1	tocut=0	j=0	Do			i_left=0		i_right=dimsize(thisdata,0)-1				Make/O/N=(dimsize(thisdata,0)) tempwave1		tempwave1[]=thisdata[p][j]		setscale/p x,dimoffset(thisdata,0),dimdelta(thisdata,0),""tempwave1		condition=0		Do			If(mod(Round(tempwave1[i_left]),1)==0)				condition=1				i_left-=1			Endif			i_left+=1		While(condition<1)		condition=0		Do			If(mod(Round(tempwave1[i_right]),1)==0)				condition=1				i_right+=1								Endif			i_right-=1		While(condition<1)			Duplicate/O/R=[i_left,i_right] tempwave1 tempwave				y_left=x_left		y_right=x_right						if(x_left<dimoffset(tempwave,0))			y_left=dimoffset(tempwave,0)		Endif		if(x_right>(dimoffset(tempwave,0)+(dimsize(tempwave,0)-1)*dimdelta(tempwave,0)))			y_right=dimoffset(tempwave,0)+(dimsize(tempwave,0)-1)*dimdelta(tempwave,0)		Endif		If((x_right<dimoffset(tempwave,0))||(x_left>(dimoffset(tempwave,0)+(dimsize(tempwave,0)-1)*dimdelta(tempwave,0))))			outputname[j]=0			tocut+=1			Else				outputname[j]=mean(tempwave,y_left,y_right)		Endif		j+=1	While(j<dimsize(thisdata,1))	If(tocut!=0)		Duplicate/O/R=[tocut,*] outputname bidon		Duplicate/O bidon outputname		Killwaves bidon	EndifEnd//********************************************************************************************************************************Proc comb_krange1(thisdata,outputname,x_center,x_wide)	String thisdata	String outputname	Variable x_center	Variable x_wide	Prompt thisdata,"Enter the name of the matrix"	Prompt outputname,"Enter the outputname"	Prompt x_center,"Enter the position"	Prompt x_wide,"Enter the full range to combine"		PauseUpdate	Silent 1	Variable j	Variable i_left,i_right	Variable x_left,x_right	Variable y_left,y_right	Variable condition	Variable tocut	x_left=x_center-x_wide/2	x_right=x_center+x_wide/2	i_left=0	i_right=dimsize($thisdata,0)-1	Make/O/N=(dimsize($thisdata,1)) $outputname	setscale/p x,dimoffset($thisdata,1),dimdelta($thisdata,1),""$outputname	tocut=0	j=0	Do			i_left=0		i_right=dimsize($thisdata,0)-1				Make/O/N=(dimsize($thisdata,0)) tempwave1		tempwave1[]=$thisdata[p][j]		setscale/p x,dimoffset($thisdata,0),dimdelta($thisdata,0),""tempwave1		condition=0		Do			If(mod(Round(tempwave1[i_left]),1)==0)				condition=1				i_left-=1			Endif			i_left+=1		While(condition<1)		condition=0		Do			If(mod(Round(tempwave1[i_right]),1)==0)				condition=1				i_right+=1								Endif			i_right-=1		While(condition<1)			Duplicate/O/R=[i_left,i_right] tempwave1 tempwave				y_left=x_left		y_right=x_right						if(x_left<dimoffset(tempwave,0))			y_left=dimoffset(tempwave,0)		Endif		if(x_right>(dimoffset(tempwave,0)+(dimsize(tempwave,0)-1)*dimdelta(tempwave,0)))			y_right=dimoffset(tempwave,0)+(dimsize(tempwave,0)-1)*dimdelta(tempwave,0)		Endif		If((x_right<dimoffset(tempwave,0))||(x_left>(dimoffset(tempwave,0)+(dimsize(tempwave,0)-1)*dimdelta(tempwave,0))))			$outputname[j]=0			tocut+=1			Else				$outputname[j]=mean(tempwave,y_left,y_right)		Endif		j+=1	While(j<dimsize($thisdata,1))	If(tocut!=0)		Duplicate/O/R=[tocut,*] $outputname bidon		Duplicate/O bidon $outputname		Killwaves bidon	EndifEnd//**********************************************************************************************************************Function Button_plot_all_edc_pi(ctrlName) : ButtonControl	String ctrlName	Execute "plot_all_edc_pi()"End//********************************************************************************************************************************Proc plot_all_edc_pi(MatrixName,Combined,one_each)//|---Plot EDCs selected by cursors---	String MatrixName	Variable Combined=5	Variable one_each=5	Prompt MatrixName,"Input the name of the matrix"	Prompt Combined, "Input the number of combined edc curves"	Prompt one_each, "Show one curve over each ..."	PauseUpdate	Silent 1		String EDCname,newedc	Variable edcstart,edcend,e_start,e_end	Variable EDCindex	edc_pi(MatrixName,Combined)	Display 	EDCindex=0	EDCend=dimsize($MatrixName,0)-1	Do 		If(mod(EDCindex,one_each)==0)			EDCname="E"+MatrixName+"_"+num2str(Combined)+"_"+num2istr(EDCindex)// "E"+num2str(gv_groupnum)+"_"+num2str(i)			AppendtoGraph $EDCname		EndIf		EDCindex+=1		While (EDCindex<(edcend+1))	Showinfo	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0		End//**********************************************************************************************************************Function Button_plot_all_mdc_pi(ctrlName) : ButtonControl	String ctrlName	Execute "plot_all_mdc_pi()"End//********************************************************************************************************************************Proc plot_all_mdc_pi(MatrixName,Combined,one_each)//|---Plot EDCs selected by cursors---	String MatrixName	Variable Combined=5	Variable one_each=5	Prompt MatrixName,"Input the name of the matrix"	Prompt Combined, "Input the number of combined mdc curves"	Prompt one_each, "Show one curve over each ..."	PauseUpdate	Silent 1		String MDCname,newmdc	Variable mdcstart,mdcend,m_start,m_end	Variable MDCindex	MDC_pi(MatrixName,Combined)	Display 	MDCindex=0	MDCend=dimsize($MatrixName,1)-1	Do 		If(mod(MDCindex,one_each)==0)			MDCname="M"+MatrixName+"_"+num2str(Combined)+"_"+num2istr(MDCindex)// "E"+num2str(gv_groupnum)+"_"+num2str(i)			AppendtoGraph $MDCname		EndIf		MDCindex+=1		While (MDCindex<(mdcend+1))	Showinfo	modifygraph width=150, height=150	ResumeUpdate		modifygraph width=0, height=0		End//*******************************************************************************************************************************Proc give_area(namex,namey,sizegrid)	String namex	String namey		Variable sizegrid	Prompt namex,"Enter the name of the wave in x: "		Prompt namey,"Enter the name of the wave in y: "			Prompt sizegrid,"Enter the number of rows and columns for the grid"		PauseUpdate		Silent 1	Variable i, j	Variable lattice		Variable griddelta	Variable thearea	Variable translation_x,translation_y	//Check if the surface is closed	If(($namex[0]!=$namex[dimsize($namex,0)-1])||($namey[0]!=$namey[dimsize($namey,0)-1]))		Insertpoints dimsize($namex,0), 1, $namex		Insertpoints dimsize($namey,0), 1, $namey		$namex[dimsize($namex,0)-1]=$namex[0]		$namey[dimsize($namey,0)-1]=$namey[0]			Endif	//Translation of the origin	Duplicate/O $namex tnamex	Duplicate/O $namey tnamey	Wavestats/Q $namex	translation_x=V_avg	tnamex[]-=V_avg	Wavestats/Q $namey	translation_y=V_avg	tnamey[]-=V_avg	//Determine the size of the square background grid	Wavestats/Q tnamex	If(abs(V_min)<abs(V_max))		lattice=abs(V_max)*2		Else		lattice=abs(V_min)*2	Endif	Wavestats/Q tnamey	If(abs(V_min)>lattice/2)		lattice=2*abs(V_min)	Endif	If(abs(V_max)>lattice/2)		lattice=2*abs(V_max)	Endif		lattice*=1.05			griddelta=lattice/(sizegrid-1)//	firstx=Round((tnamex[0]+lattice/2)/griddelta)//	firsty=Round((tnamey[0]+lattice/2)/griddelta)		//extrapolating the data for evenly spaced x.	Make/O/N=0 surfx_x	Make/O/N=0 surfx_y//	surfx_x[0]=-lattice/2+firstx*griddelta//	surfx_y[0]=-lattice/2+firsty*griddelta	Make/O/N=0 surfy_x	Make/O/N=0 surfy_y	func_give_area1(tnamex,tnamey,surfx_x,surfx_y,griddelta,lattice)	Make/O/N=(sizegrid,sizegrid) inside_out	Print "Calculating the area"	thearea=func_give_area2(surfx_x,surfx_y,inside_out,sizegrid,griddelta,lattice)	print "The area is: ", theareaEnd	//*******************************************************************************************************************************Function func_give_area1(namex,namey,surfx_x,surfx_y,griddelta,lattice)//extrapolates the curve on the x-grid and y-grid	Wave namex	Wave namey	Wave surfx_x	Wave surfx_y	Variable griddelta	Variable lattice	Variable i,j,ii	Variable num_of_new		Make/O/N=1 ttempx	Make/O/N=1 ttempy	ttempx[0]=Round((namex[0]+lattice/2)/griddelta)	ttempy[0]=Round((namey[0]+lattice/2)/griddelta)	j=1		i=1	Do			if((Round((namex[i]+lattice/2)/griddelta)!=Round((namex[i-1]+lattice/2)/griddelta))||(Round((namey[i]+lattice/2)/griddelta)!=Round((namey[i-1]+lattice/2)/griddelta)))			Insertpoints dimsize(ttempx,0), 1, ttempx					Insertpoints dimsize(ttempy,0), 1, ttempy			ttempx[j]=Round((namex[i]+lattice/2)/griddelta)			ttempy[j]=Round((namey[i]+lattice/2)/griddelta)			j+=1		Endif		i+=1	While(i<dimsize(namex,0))	i=0	ii=0	Do		Insertpoints dimsize(surfx_x,0), 1, surfx_x				Insertpoints dimsize(surfx_y,0), 1, surfx_y		surfx_x[ii]=ttempx[i]		surfx_y[ii]=ttempy[i]		if(ttempx[i+1]!=ttempx[i])			num_of_new=abs(ttempx[i+1]-ttempx[i])-1			if(num_of_new>0)				j=0				Do					Insertpoints dimsize(surfx_x,0), 1, surfx_x							Insertpoints dimsize(surfx_y,0), 1, surfx_y					If(ttempx[i+1]>ttempx[i])						surfx_x[ii+j+1]=ttempx[i]+(j+1)						surfx_y[ii+j+1]=Round(ttempy[i]+(j+1)*(ttempy[i+1]-ttempy[i])/(ttempx[i+1]-ttempx[i]))						Else							surfx_x[ii+j+1]=ttempx[i]-(j+1)							surfx_y[ii+j+1]=Round(ttempy[i]-(j+1)*(ttempy[i+1]-ttempy[i])/(ttempx[i+1]-ttempx[i]))															Endif					j+=1				While(j<num_of_new)				ii+=num_of_new			Endif			Endif					ii+=1		i+=1	While(i<dimsize(ttempx,0)-1)End		//*******************************************************************************************************************************Function func_give_area2(surfx_x,surfx_y,inside_out,sizegrid,griddelta,lattice)//calculates the area	Wave surfx_x	Wave surfx_y	Wave inside_out	Variable sizegrid	Variable griddelta	Variable lattice	Variable thearea	Variable condition_in	Variable i,j,jj	variable slope_before,slope_after	inside_out[][]=0		Make/O/N=(3*dimsize(surfx_x,0)) tempx	Make/O/N=(3*dimsize(surfx_y,0)) tempy	i=0	Do		tempx[i]=surfx_x[i]		tempx[i+dimsize(surfx_x,0)]=surfx_x[i]		tempx[i+2*dimsize(surfx_x,0)]=surfx_x[i]		tempy[i]=surfx_y[i]		tempy[i+dimsize(surfx_x,0)]=surfx_y[i]		tempy[i+2*dimsize(surfx_x,0)]=surfx_y[i]				i+=1	While(i<dimsize(surfx_x,0))			//defining the enclosed surface 	i=0		Do		if(mod(i,500)==0)			print "x ",i,"/",sizegrid		Endif		Make/O/N=0 intersectionx //y point on the grid. Means real intersection at constant x		Make/O/N=0 intersectionpnt				Make/O/N=0 samex //means all points with constant x		Make/O/N=0 pnt_on_curve //point along the curve. Comes with samex				j=dimsize(surfx_y,0)		Do			If(tempx[j]==i)				Insertpoints dimsize(samex,0), 1, samex				samex[dimsize(samex,0)-1]=tempy[j]				Insertpoints dimsize(pnt_on_curve,0), 1, pnt_on_curve				pnt_on_curve[dimsize(pnt_on_curve,0)-1]=j				inside_out[i][tempy[j]]=1			Endif			j+=1		While(j<2*dimsize(surfx_x,0))		If(dimsize(samex,0)>1)			j=0			Do				If(((tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]+1])*(tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]-1]))<0)					Insertpoints dimsize(intersectionx,0), 1, intersectionx					intersectionx[dimsize(intersectionx,0)-1]=samex[j]					Insertpoints dimsize(intersectionpnt,0), 1, intersectionpnt					intersectionpnt[dimsize(intersectionpnt,0)-1]=pnt_on_curve[j]				Endif				if(((tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]+1])*(tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]-1]))==0)					slope_before=tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]-1]					jj=0					Do						jj+=1					While(tempx[pnt_on_curve[j]+jj]==tempx[pnt_on_curve[j]+jj+1])					slope_after=tempx[pnt_on_curve[j]+jj]-tempx[pnt_on_curve[j]+1+jj]					If(slope_before*slope_after<0)						Insertpoints dimsize(intersectionx,0), 1, intersectionx						intersectionx[dimsize(intersectionx,0)-1]=samex[j]						Insertpoints dimsize(intersectionpnt,0), 1, intersectionpnt						intersectionpnt[dimsize(intersectionpnt,0)-1]=pnt_on_curve[j]										Endif					j+=jj				Endif								j+=1			While(j<dimsize(samex,0))			Sort intersectionx,intersectionx,intersectionpnt			j=0			Do				inside_out[i][intersectionx[j],intersectionx[j+1]]=1				j+=2			While(j<dimsize(intersectionx,0))			Endif		i+=1	While(i<sizegrid)	//defining the enclosed surface (y_way)	thearea=0	i=0	Do		Make/O/N=(dimsize(inside_out,1)) thistempwave		thistempwave[]=inside_out[i][p]		Wavestats/Q thistempwave		thearea+=V_avg		i+=1	While(i<dimsize(inside_out,0))	thearea*=(griddelta*griddelta)*dimsize(inside_out,1)	Killwaves thistempwave	return theareaEnd	//*******************************************************************************************************************************Proc give_area_old(namex,namey,sizegrid)	String namex	String namey		Variable sizegrid	Prompt namex,"Enter the name of the wave in x: "		Prompt namey,"Enter the name of the wave in y: "			Prompt sizegrid,"Enter the number of rows and columns for the grid"		PauseUpdate		Silent 1	Variable i, j	Variable lattice		Variable firstx,firsty	Variable griddelta	Variable oldx,nextx,oldy,nexty	Variable thearea	Variable ongridx,ongridy	//Check if the surface is closed	If(($namex[0]!=$namex[dimsize($namex,0)-1])||($namey[0]!=$namey[dimsize($namey,0)-1]))		Insertpoints dimsize($namex,0), 1, $namex		Insertpoints dimsize($namey,0), 1, $namey		$namex[dimsize($namex,0)-1]=$namex[0]		$namey[dimsize($namey,0)-1]=$namey[0]			Endif	//Determine the size of the square background grid	Wavestats/Q $namex	If(abs(V_min)<abs(V_max))		lattice=abs(V_max)*2		Else		lattice=abs(V_min)*2	Endif	Wavestats/Q $namey	If(abs(V_min)>lattice/2)		lattice=2*abs(V_min)	Endif	If(abs(V_max)>lattice/2)		lattice=2*abs(V_max)	Endif		lattice*=1.05			//extrapolating the data for evenly spaced x or y. We create one wave for each case.	griddelta=lattice/(sizegrid-1)	firstx=Round(($namex[0]+lattice/2)/griddelta)	firsty=Round(($namey[0]+lattice/2)/griddelta)	//First wave for x	Make/O/N=1 surfx_x	Make/O/N=1 surfx_y	surfx_x[0]=-lattice/2+firstx*griddelta	surfx_y[0]=-lattice/2+firsty*griddelta	Make/O/N=1 surfy_x	Make/O/N=1 surfy_y	surfy_x[0]=-lattice/2+firstx*griddelta	surfy_y[0]=-lattice/2+firsty*griddelta	func_give_area1_old($namex,$namey,surfx_x,surfx_y,surfy_x,surfy_y,griddelta,lattice,firstx,firsty)	thearea=func_give_area2_old(surfx_x,surfx_y,sizegrid,griddelta,lattice)	print thearea	Killwaves surfx_x,surfx_y,surfy_x,surfy_yEnd	//*******************************************************************************************************************************Function func_give_area1_old(namex,namey,surfx_x,surfx_y,surfy_x,surfy_y,griddelta,lattice,firstx,firsty)	Wave namex	Wave namey	Wave surfx_x	Wave surfx_y	Wave surfy_x	Wave surfy_y	Variable griddelta	Variable lattice	Variable firstx	Variable firsty	Variable oldx,oldy	Variable nextx,nexty	Variable i,j	j=1	i=1 //the first point is already copied	Do		oldx=surfx_x[dimsize(surfx_x,0)-1]		oldy=surfx_y[dimsize(surfx_y,0)-1]		Do			nextx=namex[i]			nexty=namey[i]			i+=1		While((abs(nextx-oldx)<griddelta)&&i<dimsize(namex,0))		if(i==dimsize(namex,0))			nextx=namex[0]			nexty=namey[0]		Endif		If(i<dimsize(namex,0)+1)// to prevent an infinite loop			Insertpoints dimsize(surfx_x,0), 1, surfx_x					Insertpoints dimsize(surfx_y,0), 1, surfx_y			If((nextx-oldx)>=0)				surfx_x[j]=oldx+griddelta				else					surfx_x[j]=oldx-griddelta			Endif			surfx_y[j]=oldy+griddelta*(nexty-oldy)/abs(nextx-oldx)			j+=1//Note we do not increase i because we want to test this same i value in case that griddelta is smaller than the dot spacing 				Endif		if((i!=dimsize(namex,0))||(abs(nextx-oldx)>2*griddelta))						i-=1		Endif		While(i<dimsize(namex,0))	//Then wave for y	Make/O/N=1 surfy_x	Make/O/N=1 surfy_y	surfy_x[0]=-lattice/2+firstx*griddelta	surfy_y[0]=-lattice/2+firsty*griddelta	j=1	i=1 //the first point is already copied	Do		oldx=surfy_x[dimsize(surfy_x,0)-1]		oldy=surfy_y[dimsize(surfy_y,0)-1]		Do			nextx=namex[i]			nexty=namey[i]			i+=1		While((abs(nexty-oldy)<griddelta)&&i<dimsize(namey,0))		if(i==dimsize(namey,0))			nextx=namex[0]			nexty=namey[0]		Endif		If(i<dimsize(namey,0)+1)// to prevent an infinite loop			Insertpoints dimsize(surfy_x,0), 1, surfy_x					Insertpoints dimsize(surfy_y,0), 1, surfy_y			If((nexty-oldy)>=0)				surfy_y[j]=oldy+griddelta				else					surfy_y[j]=oldy-griddelta			Endif			surfy_x[j]=oldx+griddelta*(nextx-oldx)/abs(nexty-oldy)			j+=1//Note we do not increase i because we want to test this same i value in case that griddelta is smaller than the dot spacing 				Endif		if((i!=dimsize(namey,0))||(abs(nexty-oldy)>2*griddelta))						i-=1		Endif		While(i<dimsize(namey,0))End	//*******************************************************************************************************************************Function func_give_area2_old(surfx_x,surfx_y,sizegrid,griddelta,lattice)	Wave surfx_x	Wave surfx_y	Variable sizegrid	Variable griddelta	Variable lattice	Variable thearea	Variable i,j	//Calculating the area using rectangles	thearea=0	i=0		Do		if(mod(i,200)==0)			print i,"/",sizegrid		Endif		Make/O/N=0 intersectionx //means at constant x		j=0		Do			If(Round((surfx_x[j]+lattice/2)/griddelta)==i)				Insertpoints dimsize(intersectionx,0), 1, intersectionx				intersectionx[dimsize(intersectionx,0)-1]=surfx_y[j]			Endif			j+=1		While(j<dimsize(surfx_x,0))			sort intersectionx, intersectionx		If((mod(dimsize(intersectionx,0),2)==0)&&(dimsize(intersectionx,0)!=0))			j=0			Do				thearea+=griddelta*(intersectionx[j+1]-intersectionx[j])				j+=2			While(j+1<dimsize(intersectionx,0))		Endif			i+=1	While(i<sizegrid)	return theareaEnd		//********************************************************************************************************************************Proc zeroNaN(matname)	String matname	Prompt matname,"Enter the name of the matrix"	PauseUpdate	Silent 1	func_zeroNaN($matname)End	//********************************************************************************************************************************Function func_zeroNaN(matname)	Wave matname	Variable i,j	i=0	Do		j=0		Do			if(matname[i][j]==0)				matname[i][j]=NaN			Endif			j+=1		While(j<dimsize(matname,1))		i+=1	While(i<dimsize(matname,0))End		//********************************************************************************************************************************Proc inf0(matname)	String matname	Prompt matname,"Enter the name of the matrix"	PauseUpdate	Silent 1	Variable i,j	i=0	Do		j=0		Do			if(($matname[i][j])==inf)||($matname[i][j])==-inf))				$matname[i][j]=0			Endif			j+=1		While(j<dimsize($matname,1))		i+=1	While(i<dimsize($matname,0))End	//********************************************************************************************************************************Proc SmoothMat_k(OldM,num,box,choice)//only for Vertical smooth at the moment	string OldM,	variable num,box,choice	prompt OldM,"Input the matrix Name"	prompt num,"how many times to be smoothed"	prompt box,"Input the box width"	prompt choice,"choose direciton",	popup "Vertical;Horizontal;Both"	pauseupdate 	silent 1	string mat,mat1	if(choice==1)		mat=OldM+"VS"		duplicate/o $OldM,$mat			func_SmoothMat_k($OldM,$mat,num,box,1)			Display		Appendimage $mat		Showinfo		ModifyImage $mat ctab= {*,*,Terrain,1}//		Show2DImageShow2DImage(mat)	endif	if(choice==2)		mat=OldM+"HS"		duplicate/o $OldM,$mat		func_SmoothMat_k($OldM,$mat,num,box,2)		Display		Appendimage $mat		Showinfo			ModifyImage $mat ctab= {*,*,Terrain,1}			//		show2dimage(mat)	endif	if(choice==3)		mat=OldM+"BS"		duplicate/o $OldM thistemp		func_SmoothMat_k($OldM,thistemp,num,box,1)		func_SmoothMat_k(thistemp,$mat,num,box,2)				Display		Appendimage $mat		Showinfo			ModifyImage $mat ctab= {*,*,Terrain,1}			//		show2dimage(mat)	endif	end//********************************************************************************************************************************function func_smoothmat_k(OldM,NewM,num,box,choice)	wave oldM,newM	variable num,box,choice	Variable i=0,j=0, l, m, k, x0, dx, y0, dy	Variable j1	l=dimsize(OldM,0)	m=dimsize(OldM,1)	x0=dimoffset(OldM,0)	dx=dimdelta(OldM,0)	y0=dimoffset(OldM,1)	dy=dimdelta(OldM,1)	make/o/n=(l) f0	make/o/n=(m) f1	setscale/p x x0,dx,"", f0	setscale/p x y0,dy,"", f1	if(choice==2)		i=0		do			f0=OldM[p][i]			Smooth/E=3/B=(num) box,f0						NewM[][i]=f0[p]			i+=1		while(i<m)	endif	if(choice==1)//for k-space cuts		i=0		DO			j=0			If(mod(Round(OldM[i][j]),1)!=0)				DO					j+=1				While((mod(Round(OldM[i][j]),1)!=0)&&(j<dimsize(OldM,1)+1))			Endif			If(j!=dimsize(OldM,1))				f1[]=OldM[i][p]				Duplicate/O/R=[j,*] f1 tempwave				Smooth/E=3/B=(num) box,tempwave							j1=j				Do					f1[j1]=tempwave[j1-j]					j1+=1				While(j1<dimsize(f1,0))				NewM[i][]=f1[q]			Endif			i+=1		while(i<l)	endifEnd	//********************************************************************************************************************************Proc NaN0(matname)	String matname	Prompt matname,"Enter the name of the matrix"	PauseUpdate	Silent 1	func_NaN0($matname)End	//********************************************************************************************************************************Function func_NaN0(matname)	Wave matname	Variable i,j	i=0	Do		j=0		Do			if(mod(Round(matname[i][j]),1)!=0)				matname[i][j]=0			Endif			j+=1		While(j<dimsize(matname,1))		i+=1	While(i<dimsize(matname,0))End	//********************************************************************************************************************************Proc NaN0mat3d()	PauseUpdate	Silent 1	Variable i,j	i=0	Do		j=0		Do			if(mod(Round(mat3d[i][0][j]),1)!=0)				mat3d[i][][j]=0			Endif			j+=1		While(j<dimsize(mat3d,2))		i+=1	While(i<dimsize(mat3d,0))End	//********************************************************************************************************************************Proc fsurf(matname,result_no)	String matname	Variable result_no=0	Prompt matname,"Enter the name of the matrix"	Prompt result_no,"Enter the number of the result"	PauseUpdate	Silent 1	String resname,yresname	Variable i,j	Variable left,right,delta,yoffset	left=xcsr(A)	right=xcsr(B)	yoffset=qcsr(A)	delta=(right-left)/2	resname="fsurf"+num2str(result_no)	yresname="yfsurf"+num2str(result_no)	Make/O/N=(qcsr(B)-qcsr(A)+1) $resname	Duplicate/O $resname $yresname	$yresname[]=vcsr(A)+p*dimdelta($matname,1)	i=0	Do		j=i+yoffset		Make/O/N=(dimsize($matname,0)) tempwave		Setscale/P x, dimoffset($matname,0),dimdelta($matname,0),""tempwave		tempwave[]=$matname[p][j]		Wavestats/Q/R=(left,right) tempwave		$resname[i]=V_minloc		left=V_minloc-delta		right=V_minloc+delta		i+=1	While(i<dimsize($resname,0))	Display $yresname vs $resname	Killwaves tempwaveEnd	//********************************************************************************************************************************Proc save_cuts()	PauseUpdate	Silent 1	String thiswave	Variable i	i=0	Do		thiswave="cut"+num2str(phiindex[i])		wave2filenokill(thiswave)		thiswave="cut"+num2str(phiindex[i])+"_k"		wave2filenokill(thiswave)				i+=1	While(i<dimsize(phiindex,0))End	//**********************************************************************************************************************Proc savegraph(name,number)	String name	Variable number	Prompt name,"Enter the name of the graph"	Prompt number,"Enter the resolution (1,2,4,5,8)"	PauseUpdate	Silent 1	String savename	Variable num_val	num_val=number*72	savename=name+".jpg"		SavePict/P=home/O/T="JPEG"/B=(num_val) as savenameEnd//*******************************************************************************************************************************Proc new_stepsize(mat,choice,newdelta,overwrite) //Given as homework2a	String mat	Variable choice	Variable newdelta=0.01	Variable overwrite	Prompt mat,"Enter the name of the matrix"	Prompt choice,"Choose the direction", popup "Vertical;Horizontal"	Prompt newdelta,"Enter the new stepsize"	Prompt overwrite,"Do you want to overwrite?", popup "No;Yes"		PauseUpdate	Silent 1	String newmat	Variable i	Variable thisxory,up_point,low_point,low_factor,up_factor	Variable olddelta	Variable oldsize	Variable newsize	newmat=mat+"_nres"	If(choice==1)		olddelta=dimdelta($mat,1)		oldsize=dimsize($mat,1)		newsize=floor(dimdelta($mat,1)*(oldsize-1)/newdelta+1)		Make/O/N=(dimsize($mat,0),newsize) $newmat		Setscale/P x,dimoffset($mat,0),dimdelta($mat,0),""$newmat		Setscale/P y,dimoffset($mat,1),newdelta,""$newmat		i=0		Do			thisxory=dimoffset($newmat,1)+i*newdelta			low_point=floor((thisxory-dimoffset($mat,1))/olddelta)			up_point=Ceil((thisxory-dimoffset($mat,1))/olddelta)			If(low_point!=up_point)				low_factor=((dimoffset($mat,1)+up_point*olddelta)-thisxory)/olddelta				up_factor=(thisxory-(dimoffset($mat,1)+low_point*olddelta))/olddelta  //note that low_factor+up_factor=1				Else					low_factor=0.5					up_factor=0.5			Endif			$newmat[][i]=low_factor*$mat[p][low_point]+up_factor*$mat[p][up_point]			i+=1		While(i<newsize)	Endif	If(choice==2)		olddelta=dimdelta($mat,0)		oldsize=dimsize($mat,0)		newsize=floor(dimdelta($mat,0)*(oldsize-1)/newdelta+1)		Make/O/N=(newsize,dimsize($mat,1)) $newmat		Setscale/P x,dimoffset($mat,0),newdelta,""$newmat		Setscale/P y,dimoffset($mat,1),dimdelta($mat,1),""$newmat		i=0		Do			thisxory=dimoffset($newmat,0)+i*newdelta			low_point=floor((thisxory-dimoffset($mat,0))/olddelta)			up_point=Ceil((thisxory-dimoffset($mat,0))/olddelta)			If(low_point!=up_point)				low_factor=((dimoffset($mat,0)+up_point*olddelta)-thisxory)/olddelta				up_factor=(thisxory-(dimoffset($mat,0)+low_point*olddelta))/olddelta  //note that low_factor+up_factor=1				Else					low_factor=0.5					up_factor=0.5			Endif			$newmat[i][]=low_factor*$mat[low_point][q]+up_factor*$mat[up_point][q]			i+=1		While(i<newsize)	Endif		If(overwrite==2)		Duplicate/O $newmat $mat		Killwaves $newmat		Else			Display 			Appendimage $newmat			ModifyImage $newmat ctab= {*,*,Terrain,0}	EndifEnd//**********************************************************************************************************************Proc Mkbad_slices()	PauseUpdate	Silent 1	String to_check	to_check="bad_slices"	if(WaveExists($to_check)==0)		Make/N=0 bad_slices	Endif		if(Wintype("badslices")==0)		Edit bad_slices		Dowindow/C badslices	Endif	if(Wintype("badslices")==2)		Dowindow/F badslices	Endif	End//********************************************************************************************************************************Function give_slope(x1,y1,x2,y2)	Variable x1,y1,x2,y2	return ((y2-y1)/(x2-x1))End//********************************************************************************************************************************Function give_b(m,x1,y1)	Variable m,x1,y1	return (y1-m*x1)End//*******************************************************************************************************************************Proc copy_circles(thename)	String thename	Prompt thename,"Enter the name for the circles"	PauseUpdate	Silent 1	String thisname,oldname	Variable i,j	oldname="upr_x"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="upr_y"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="upl_x"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="upl_y"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="lowr_x"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="lowr_y"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="lowl_x"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="lowl_y"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	End//*******************************************************************************************************************************Proc copy_circles_2f(thename)	String thename	Prompt thename,"Enter the name for the circles"	PauseUpdate	Silent 1	Variable/G aonb	String thisname,oldname	Variable i,j	oldname="upr_x"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="upr_y"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	$thisname[]/=aonb	oldname="upl_x"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="upl_y"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	$thisname[]/=aonb	oldname="lowr_x"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="lowr_y"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	$thisname[]/=aonb	oldname="lowl_x"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname	oldname="lowl_y"	thisname=thename+"_"+oldname	Duplicate/O $oldname $thisname		$thisname[]/=aonbEnd	//*******************************************************************************************************************************Proc append_circles(thename)	String thename	Prompt thename,"Enter the name for the circles"	PauseUpdate	Silent 1	String namex,namey	Variable i,j	namex=thename+"_upr_x"	namey=thename+"_upr_y"	Appendtograph $namey vs $namex	namex=thename+"_upl_x"	namey=thename+"_upl_y"	Appendtograph $namey vs $namex	namex=thename+"_lowr_x"	namey=thename+"_lowr_y"	Appendtograph $namey vs $namex	namex=thename+"_lowl_x"	namey=thename+"_lowl_y"	Appendtograph $namey vs $namexEnd	//**********************************************************************************************************************Proc norm_range(name,x_from,x_to)	String name	Variable x_from	Variable x_to	Prompt name,"Enter the name of the matrix"	Prompt x_from,"Normalize from:"	Prompt x_to,"to:"	PauseUpdate	Silent 1	Variable i,the_mean	If(dimoffset($name,0)>x_from)		x_from=dimoffset($name,0)	Endif	If((dimsize($name,0)-1)*dimdelta($name,0)+dimoffset($name,0)<x_to)		x_to=(dimsize($name,0)-1)*dimdelta($name,0)+dimoffset($name,0)	Endif	i=0	Do		the_mean=mean($name,x_from,x_to)		$name[]/=the_mean		i+=1	While(i<dimsize(hv,0))End//********************************************************************************************************************************Proc get_fermi_profile(matname,smooth1,smooth2,method,putongraph)	String matname	Variable smooth1	Variable smooth2	Variable method	Variable putongraph		Prompt matname,"Enter the name of the matrix" 	Prompt smooth1,"Enter the number of smooth operations"	Prompt smooth2,"Enter the smooth box width"	Prompt method, "Which method",popup "Simple;Lorenztian;Gaussian"		Prompt putongraph,"Do you want to append to the graph?",popup "Yes;No"		PauseUpdate	Silent 1	String thiscut_deriv	Variable i	Make/O/N=(dimsize($matname,0)) fermi_profile	Make/O/N=(dimsize($matname,0)) fermi_profile_x	Setscale/P x,dimoffset($matname,0),dimdelta($matname,0),""fermi_profile	Make/O/N=(dimsize($matname,1)) thiswave	Setscale/P x,dimoffset($matname,1),dimdelta($matname,1),""thiswave	fermi_profile_x[]=dimoffset($matname,0)+p*dimdelta($matname,0)	thiscut_deriv=matname+"_1D"	Duplicate/O $matname $thiscut_deriv	i=0	Do		Make/O/N=(dimsize($matname,1)) thiswave		Setscale/P x,dimoffset($matname,1),dimdelta($matname,1),""thiswave		thiswave[]=$matname[i][p]		Smooth/E=3/B=(smooth1) smooth2,thiswave			Differentiate thiswave//		Smooth/E=3/B=(smooth1) smooth2,thiswave					$thiscut_deriv[i][]=thiswave[q]		IF(method==1)			Wavestats/Q/R=[qcsr(A),qcsr(B)] thiswave			fermi_profile[i]=V_minloc		Endif		IF(method==2)			Smooth/E=3/B=(smooth1) smooth2,thiswave			CurveFit/Q/NTHR=0/TBOX=0 lor  thiswave[qcsr(A),qcsr(B)] /D			fermi_profile[i]=W_coef[2]  		Endif		IF(method==3)			Smooth/E=3/B=(smooth1) smooth2,thiswave			CurveFit/Q/NTHR=0/TBOX=0 gauss  thiswave[qcsr(A),qcsr(B)] /D			fermi_profile[i]=W_coef[2]  		Endif		i+=1	While(i<dimsize($thiscut_deriv,0))	If(putongraph==1)		Appendtograph fermi_profile vs fermi_profile_x	Endif	Killwaves thiswave,$thiscut_derivEnd//*******************************************************************************************************************************Proc GXMG(name)//Plot the tigh-binding band along Gamma-X-M-Gamma	String name	Prompt name,"Enter the name of the sample"	PauseUpdate	Silent 1	String e_fit,x_fit,para	Variable i	Variable kx,ky	e_fit="efitres_"+name	x_fit="xfitres_"+name	para=name+"_parameters"	Make/O/N=0 $e_fit	Make/O/N=0 $x_fit	i=0	Do		kx=i/100		ky=i/100		Insertpoints dimsize($e_fit,0),1,$e_fit		Insertpoints dimsize($x_fit,0),1,$x_fit		$e_fit[dimsize($e_fit,0)-1]=tbfunc($para,kx,ky)		$x_fit[dimsize($e_fit,0)-1]=i*sqrt(2)/100		i+=1	While(i<101)	i=0	Do		kx=1-i/100		ky=1		Insertpoints dimsize($e_fit,0),1,$e_fit		Insertpoints dimsize($x_fit,0),1,$x_fit		$e_fit[dimsize($e_fit,0)-1]=tbfunc($para,kx,ky)		$x_fit[dimsize($e_fit,0)-1]=sqrt(2)+i/100				i+=1	While(i<101)			i=0	Do		kx=0		ky=1-i/100		Insertpoints dimsize($e_fit,0),1,$e_fit		Insertpoints dimsize($x_fit,0),1,$x_fit		$e_fit[dimsize($e_fit,0)-1]=tbfunc($para,kx,ky)		$x_fit[dimsize($e_fit,0)-1]=1+sqrt(2)+i/100				i+=1	While(i<101)			Display $e_fit vs $x_fitEnd	//*******************************************************************************************************************************Proc rot_vector(xname,yname,angle,pivotx,pivoty)	String xname="NONE"	String yname	Variable angle	Variable pivotx	Variable pivoty	Prompt xname,"Enter the name of the vector x (optional)"	Prompt yname,"Enter the name of the vector y"	Prompt angle,"Enter the angle of rotation (counterclockwise)"	Prompt pivotx,"Pivot x=:"	Prompt pivoty,"Pivot y=:"	PauseUpdate	Silent 1	String newxname	Variable i	Variable condition	condition=ABS(cmpstr("NONE",xname))//0 if strings are equal	IF(condition==1)		Duplicate/O $xname xnamerot		Else			xname=yname+"_x"			Duplicate/O $yname $xname			Duplicate/O $yname xnamerot			$xname[]=dimoffset($yname,0)+p*dimdelta($yname,0)	Endif	Duplicate/O $yname ynamerot	xnamerot[]=($xname[p]-pivotx)*cos(angle*pi/180)-($yname[p]-pivoty)*sin(angle*pi/180)+pivotx	ynamerot[]=($xname[p]-pivotx)*sin(angle*pi/180)+($yname[p]-pivoty)*cos(angle*pi/180)+pivoty	Duplicate/O xnamerot $xname	Duplicate/O ynamerot $yname	Killwaves xnamerot,ynamerotEnd	//*******************************************************************************************************************************Proc sym_edc(cutname,fermi_level,numcombine,numshow)	String cutname	Variable fermi_level	Variable numcombine	Variable numshow	Prompt cutname,"Enter the name of the cut"	Prompt fermi_level,"Enter the Fermi energy"	Prompt numcombine,"Enter the number of EDCs to be combined (odd number)."	Prompt numshow,"Show one EDC every ... EDCs"	PauseUpdate	Silent 1	String thisedc,newmatname	Variable first_i,last_i,first_x,last_x	Variable i,j	Variable p1,p2	Variable xvalue	first_i=pcsr(A)	last_i=pcsr(B)	first_x=xcsr(A)	last_x=xcsr(B)	newmatname=cutname+"_symedc"	Display	i=first_i	Do		thisedc=cutname+"_edc"+num2str(i)		Make/O/N=(dimsize($cutname,1)) tempedc		Setscale/P x,dimoffset($cutname,1)-fermi_level,dimdelta($cutname,1),""tempedc		tempedc[]=0		j=-(numcombine-1)/2		Do			tempedc[]+=$cutname[i+j][p]			j+=1		While(j<(numcombine-1)/2+1)		tempedc[]/=numcombine		Duplicate/O tempedc tempedc1		Setscale/P x,-(((dimsize(tempedc,0)-1)*dimdelta(tempedc,0)+dimoffset(tempedc,0))),dimdelta(tempedc,0),""tempedc1		tempedc1[]=tempedc[dimsize($cutname,1)-1-p]//		appendtograph tempedc1		p1=x2pnt(tempedc,dimoffset(tempedc1,0))		p2=dimsize(tempedc,0)-1		Duplicate/O/R=[p1,p2] tempedc short_tempedc		Duplicate/O tempedc1 xtempedc1		Duplicate/O short_tempedc short_tempedc1		short_tempedc1[]=0		xtempedc1[]=dimoffset(tempedc1,0)+p*dimdelta(tempedc1,0)		j=0		Do			xvalue=dimoffset(short_tempedc,0)+j*dimdelta(short_tempedc,0)			short_tempedc1[j]=interp(xvalue,xtempedc1,tempedc1)			j+=1		While(j<dimsize(short_tempedc,0))		Duplicate/O short_tempedc $thisedc		$thisedc[]=0		$thisedc[]=short_tempedc[p]+short_tempedc1[p]		If(mod(i,numshow)==0)			appendtograph $thisedc		Endif		i+=1	While(i<last_i+1)	Killwaves tempedc,tempedc1,short_tempedc1,short_tempedc,xtempedc1	Make/O/N=(last_i+1-first_i,dimsize($thisedc,0)) $newmatname	Setscale/P x,first_x,dimdelta($cutname,0),""$newmatname	Setscale/P y, dimoffset($thisedc,0),dimdelta($thisedc,0),""$newmatname	i=0	Do		thisedc=cutname+"_edc"+num2str(i+first_i)		$newmatname[i][]=$thisedc[q]		i+=1	While(i<dimsize($newmatname,0))	Display	Appendimage $newmatname	End	//*******************************************************************************************************************************Proc sym_edc_far(edcname)	String edcname	Prompt edcname,"Enter the name of the EDC curvet"	PauseUpdate	Silent 1	String newname	Variable newlength,newsize	newname="sm_"+edcname	newlength=-2*dimoffset($edcname,0)	newsize=newlength/dimdelta($edcname,0)+1	Make/O/N=(newsize) new1	Setscale/P x, dimoffset($edcname,0),dimdelta($edcname,0),""new1	new1[]=0	Duplicate/O new1 new2	func_sym_edc_far($edcname,new1,new2)	Duplicate/O new1 $newname	$newname[]=new1[p]+interp(dimoffset(new1,0)+p*dimdelta(new1,0),new2x,new2)	killwaves new1,new2		End//*******************************************************************************************************************************Proc temp8()	Pauseupdate	Silent 1	String name1,name2	Variable i	i=410	Do		name1="cut"+num2str(i)		name2="cut"+num2str(i)+"a"		Duplicate/O $name2 $name1		i+=2	While(i<455)End//*******************************************************************************************************************************Function func_sym_edc_far(edcname,new1,new2)	Wave edcname	Wave new1	Wave new2	PauseUpdate	Silent 1	Variable i	i=0	Do		new1[i]=edcname[i]		i+=1	While(i<dimsize(edcname,0))	Duplicate/O new1 new2	i=0	Do		new2[i]=new1[dimsize(new1,0)-1-i]		i+=1	While(i<dimsize(new1,0))	Duplicate/O new2 new2x	new2x[]=-(dimoffset(new1,0)+(dimsize(new1,0)-1)*dimdelta(new1,0)-p*dimdelta(new1,0))End//*******************************************************************************************************************************Proc sym_edc_matrix_far(matname)	String matname	Prompt matname,"Enter the name of the matrix"	PauseUpdate	Silent 1	String newname	Variable i	newname=matname+"sym"	Make/O/N=(dimsize($matname,1)) thiswave	Setscale/P x,dimoffset($matname,1),dimdelta($matname,1),""thiswave	thiswave[]=$matname[0][p]	sym_edc_far("thiswave")	Make/O/N=(dimsize($matname,0),dimsize(sm_thiswave,0)) $newname	Setscale/P x,dimoffset($matname,0),dimdelta($matname,0),""$newname	Setscale/P y,dimoffset(sm_thiswave,0),dimdelta(sm_thiswave,0),""$newname			func_sym_edc_matrix_far($matname,$newname)	killwaves thiswave,sm_thiswave	Display; appendimage $newnameEnd	//*******************************************************************************************************************************Proc Shift_and_sym_edc_matrix_far(matname,Fermilevel)	String matname	VAriable Fermilevel	Prompt matname,"Enter the name of the matrix"	Prompt Fermilevel,"Enter the Fermi level"	PauseUpdate	Silent 1	String newname	Variable i	Duplicate/O $matname thistemp	Rescale_pi("thistemp",2,-Fermilevel)	newname=matname+"sym"	Make/O/N=(dimsize(thistemp,1)) thiswave	Setscale/P x,dimoffset(thistemp,1),dimdelta(thistemp,1),""thiswave	thiswave[]=thistemp[0][p]	sym_edc_far("thiswave")	Make/O/N=(dimsize(thistemp,0),dimsize(sm_thiswave,0)) $newname	Setscale/P x,dimoffset(thistemp,0),dimdelta(thistemp,0),""$newname	Setscale/P y,dimoffset(sm_thiswave,0),dimdelta(sm_thiswave,0),""$newname			func_sym_edc_matrix_far(thistemp,$newname)	killwaves thiswave,sm_thiswave,thistemp	Display; appendimage $newnameEnd	//*******************************************************************************************************************************Function func_sym_edc_matrix_far(matname,newname)	Wave matname	Wave newname	PauseUpdate	Silent 1	Wave sm_thiswave	Variable i	String toexecute	toexecute="sym_edc_far(\"thiswave\")"	i=0	Do		Make/O/N=(dimsize(matname,1)) thiswave		Setscale/P x,dimoffset(matname,1),dimdelta(matname,1),""thiswave		thiswave[]=matname[i][p]		Execute toexecute		newname[i][]=sm_thiswave[q]		i+=1	While(i<dimsize(matname,0))End	//*******************************************************************************************************************************Proc factor_src_all()	PauseUpdate	Silent 1	String thisdata		Variable factor	Variable i	//factor=0.047768//PF oct.2007 46 eV//	factor=0.0882356 // SRC Sep. U1NIM 22 eV	//factor=0.0797908	//SRC august2007		factor=0.0923081 //SRC december 2007 at 73.5 eV//	factor=0.0905224 //SRC december 2007 at 28 eV		//	factor=0.0882356 // SRC Sep. U1NIM 22 eV	//factor=0.0797908	//SRC august2007		i=1	Do		thisdata="data"+num2str(i)		Setscale/P x,dimoffset($thisdata,0)*factor/dimdelta($thisdata,0),factor,""$thisdata		i+=1	While(i<dimsize(File_Name,0))	End	//*******************************************************************************************************************************Proc PReader_switch_edit_mode()	PauseUpdate	Silent 1	Variable/G num_of_band	String wave4k,wave4e		Variable factor	wave4k="band_k"+num2str(num_of_band)	wave4e="band_e"+num2str(num_of_band)	GraphWaveEdit $wave4eEnd//*******************************************************************************************************************************Proc PReader_normal_mode()	PauseUpdate	Silent 1	GraphNormalEnd		//*******************************************************************************************************************************Proc PReader_draw_live()	PauseUpdate	Silent 1	Variable/G num_of_band	String wave4k,wave4e		Variable factor	wave4k="band_k"+num2str(num_of_band)	wave4e="band_e"+num2str(num_of_band)	GraphWaveDraw/F=3/O $wave4e,$wave4kEnd						//*******************************************************************************************************************************Proc factor_src_one(number)	Variable number	Prompt number,"Enter the data number"	PauseUpdate	Silent 1	Variable/G 	String thisdata		Variable factor	factor=global_cspacing//	factor=0.047768//PF oct.2007 46 eV//	factor=0.0882356 // SRC Sep. U1NIM 22 eV//	factor=0.0797908	//SRC august2007	//	factor=0.0923081 //SRC december 2007 at 73.5 eV//	factor=0.0905224 //SRC december 2007 at 28 eV		//	factor=0.0882356 // SRC Sep. U1NIM 22 eV	//factor=0.0797908	//SRC august2007		thisdata="data"+num2str(number)	Setscale/P x,dimoffset($thisdata,0)*factor/dimdelta($thisdata,0),factor,""$thisdataEnd//********************************************************************************************************************************Function ButtonProc_findEres(ctrlName) : ButtonControl	String ctrlName	Execute "findEres()"End//********************************************************************************************************************************Proc findEres(thiswave, Temperature, largest_res, choiceofrange,fitfrom,fitto, displayornot)	String thiswave	Variable Temperature	Variable largest_res	Variable choiceofrange	Variable fitfrom=16.8	Variable fitto=16.9	Variable displayornot	Prompt thiswave,"Name of the wave:"	Prompt Temperature, "Temperature (K)"	Prompt largest_res,"Largest resolution (meV):"	Prompt choiceofrange,"Do you use cursors?", popup "Yes;No"	Prompt fitfrom,"Fit from (eV):"	Prompt fitto, "Fit to (eV):"	prompt displayornot,"Do you want to display?",popup "Yes;No"	PauseUpdate;Silent 1	Variable T//	Make/O/N=5 W		Make/O/N=4 W	largest_res/=1000	If(choiceofrange==1)		fitfrom=xcsr(A)		fitto=xcsr(B)	Endif	T=Temperature/11604.51  //eV	W[0]=0.1	W[1]=$thiswave[x2pnt($thiswave,fitfrom)]	W[2]=1/T	W[3]=(fitfrom+fitto)/2//	W[4]=1//	FuncFit/Q/H="00100" fit_fermi5 w $thiswave(xcsr(A),xcsr(B))  /D	FuncFit/Q/H="0010" fit_fermi w $thiswave(xcsr(A),xcsr(B))  /D		func_findEres($thiswave, W, largest_res, fitfrom, fitto,displayornot)End//********************************************************************************************************************************Proc Au_DOS(datanumber,smoothf)	Variable datanumber	Variable smoothf=5	Prompt datanumber,"Data number"	Prompt smoothf,"Smooth factor"		PauseUpdate;Silent 1	Variable/G gv_groupnum	String thisname,dthisname,thisgraph	thisname="DOS"+num2str(datanumber)	dthisname="d"+thisname	thisgraph="graph_"+thisname	gv_groupnum=datanumber	If(Wintype("dataploter")==1)		Dowindow/F dataploter		setvarplot("varplot",gv_groupnum,num2str(gv_groupnum),"gv_groupnum")	Endif	Duplicate/O density_of_states $thisname	Duplicate/O density_of_states $dthisname	Display $thisname,$dthisname	ModifyGraph rgb($dthisname)=(0,0,65535)		Dowindow/C $thisgraph	ModifyGraph width=300,height=300	ModifyGraph tick=2,mirror=1	smooth/E=3/B=(smoothf) smoothf, $dthisname	ShowInfo	End//********************************************************************************************************************************Function func_findEres(thiswave, W, largest_res, fitfrom, fitto,displayornot)	Wave thiswave	Wave W	Variable largest_res	Variable fitfrom	Variable fitto	Variable displayornot	PauseUpdate;Silent 1	String toexecute	String tempstring1,tempstring2	Variable i	variable sigma,res	variable center	Variable avg1,avg2	Variable bestres	Variable resfrom,resto	Variable numofpnts	Duplicate/O/R=[x2pnt(thiswave,fitfrom),x2pnt(thiswave,fitto)] thiswave, thiswaveshort	Make/O/N=(3*dimsize(thiswaveshort,0)) theFermi	Setscale/P x,dimoffset(thiswaveshort,0)-1*dimsize(thiswaveshort,0)*dimdelta(thiswaveshort,0), dimdelta(thiswaveshort,0),""theFermi//	Duplicate/O thiswaveshort theFermi	Duplicate/O theFermi Gausscurve//	theFermi[]=fit_Fermi5(W,dimoffset(theFermi,0)+p*dimdelta(theFermi,0))	theFermi[]=fit_Fermi(W,dimoffset(theFermi,0)+p*dimdelta(theFermi,0))	center=(2*dimoffset(theFermi,0)+(dimsize(theFermi,0)-1)*dimdelta(theFermi,0))/2	Wavestats/Q thiswaveshort	avg1=V_avg	Make/O/N=(floor(largest_res*1000)) reswave	Make/O/N=(floor(largest_res*1000)) minsqwave		reswave[]=0 	minsqwave[]=0	i=1	Do		res=i/1000		reswave[i-1]=res*1000		sigma=res/sqrt(8*ln(2))		Gausscurve[]=exp(-((dimoffset(Gausscurve,0)+p*dimdelta(Gausscurve,0)-center)/sigma)^2/2)		Duplicate/O theFermi thisFermi				Convolve/A Gausscurve,thisFermi		toexecute="transform2equiv_waves(\"thiswaveshort\",\"thisFermi\")"		Execute toexecute		Wavestats/Q thisFermi		avg2=V_avg		thisFermi[]/=(avg2/avg1)		Duplicate/O thiswaveshort Diffwave		Diffwave[]=(thiswaveshort[p]-thisFermi[p])^2		Wavestats/Q Diffwave			minsqwave[i-1]=V_avg		i+=1	While(res<=largest_res)	Wavestats/Q minsqwave	bestres=reswave[V_minloc]	resfrom=bestres-1	resto=bestres+1	if(resfrom<=0)		resfrom=0.1	Endif	numofpnts=(resto-resfrom)/0.1+1	Make/O/N=(numofpnts) reswave	Make/O/N=(numofpnts) minsqwave		reswave[]=0 	minsqwave[]=0	i=0	Do		res=(resfrom+i*0.1)/1000		reswave[i]=res*1000		sigma=res/sqrt(8*ln(2))//		Setscale/P x, dimoffset(theFermi,0)-W[3],dimdelta(theFermi,0),""Gausscurve//		Gausscurve[]=(1/(sigma*sqrt(2*pi)))*exp(-((dimoffset(Gausscurve,0)+p*dimdelta(Gausscurve,0))/sigma)^2/2)		Gausscurve[]=exp(-((dimoffset(Gausscurve,0)+p*dimdelta(Gausscurve,0)-center)/sigma)^2/2)		Duplicate/O theFermi thisFermi				Convolve/A Gausscurve,thisFermi		toexecute="transform2equiv_waves(\"thiswaveshort\",\"thisFermi\")"		Execute toexecute		Wavestats/Q thisFermi		avg2=V_avg		thisFermi[]/=(avg2/avg1)		Duplicate/O thiswaveshort Diffwave		Diffwave[]=(thiswaveshort[p]-thisFermi[p])^2		Wavestats/Q Diffwave			minsqwave[i]=V_avg		i+=1	While(i<numofpnts)	Wavestats/Q minsqwave	bestres=reswave[V_minloc]	resfrom=bestres-0.1	resto=bestres+0.1	if(resfrom<=0)		resfrom=0.01	Endif	numofpnts=(resto-resfrom)/0.01+1	Make/O/N=(numofpnts) reswave	Make/O/N=(numofpnts) minsqwave		reswave[]=0 	minsqwave[]=0	i=0	Do		res=(resfrom+i*0.01)/1000		reswave[i]=res*1000		sigma=res/sqrt(8*ln(2))//		Setscale/P x, dimoffset(theFermi,0)-W[3],dimdelta(theFermi,0),""Gausscurve//		Gausscurve[]=(1/(sigma*sqrt(2*pi)))*exp(-((dimoffset(Gausscurve,0)+p*dimdelta(Gausscurve,0))/sigma)^2/2)		Gausscurve[]=exp(-((dimoffset(Gausscurve,0)+p*dimdelta(Gausscurve,0)-center)/sigma)^2/2)		Duplicate/O theFermi thisFermi				Convolve/A Gausscurve,thisFermi		toexecute="transform2equiv_waves(\"thiswaveshort\",\"thisFermi\")"		Execute toexecute		Wavestats/Q thisFermi		avg2=V_avg		thisFermi[]/=(avg2/avg1)		Duplicate/O thiswaveshort Diffwave		Diffwave[]=(thiswaveshort[p]-thisFermi[p])^2		Wavestats/Q Diffwave			minsqwave[i]=V_avg		i+=1	While(i<numofpnts)	Wavestats/Q minsqwave	bestres=reswave[V_minloc]	resfrom=bestres-0.01	resto=bestres+0.01	if(resfrom<=0)		resfrom=0.001	Endif	numofpnts=(resto-resfrom)/0.001+1	Make/O/N=(numofpnts) reswave	Make/O/N=(numofpnts) minsqwave		reswave[]=0 	minsqwave[]=0	i=0	Do		res=(resfrom+i*0.001)/1000		reswave[i]=res*1000		sigma=res/sqrt(8*ln(2))//		Setscale/P x, dimoffset(theFermi,0)-W[3],dimdelta(theFermi,0),""Gausscurve//		Gausscurve[]=(1/(sigma*sqrt(2*pi)))*exp(-((dimoffset(Gausscurve,0)+p*dimdelta(Gausscurve,0))/sigma)^2/2)		Gausscurve[]=exp(-((dimoffset(Gausscurve,0)+p*dimdelta(Gausscurve,0)-center)/sigma)^2/2)		Duplicate/O theFermi thisFermi				Convolve/A Gausscurve,thisFermi		toexecute="transform2equiv_waves(\"thiswaveshort\",\"thisFermi\")"		Execute toexecute		Wavestats/Q thisFermi		avg2=V_avg		thisFermi[]/=(avg2/avg1)		Duplicate/O thiswaveshort Diffwave		Diffwave[]=(thiswaveshort[p]-thisFermi[p])^2		Wavestats/Q Diffwave			minsqwave[i]=V_avg		i+=1	While(i<numofpnts)	Wavestats/Q minsqwave	bestres=reswave[V_minloc]	print "The resolution is ", bestres, " meV"	print "EF is ", W[3]," eV"	if(displayornot==1)		sigma=(bestres/1000)/sqrt(8*ln(2))		Gausscurve[]=exp(-((dimoffset(Gausscurve,0)+p*dimdelta(Gausscurve,0)-center)/sigma)^2/2)		Duplicate/O theFermi thisFermi				Convolve/A Gausscurve,thisFermi		toexecute="transform2equiv_waves(\"thiswaveshort\",\"thisFermi\")"		Execute toexecute		Wavestats/Q thisFermi		avg2=V_avg		thisFermi[]/=(avg2/avg1)		Display thiswaveshort,thisFermi		ModifyGraph rgb(thisFermi)=(1,4,52428)		sprintf tempstring1, "%3.3f\r", bestres 		sprintf tempstring2, "%5.5f", W[3] 				TextBox/C/N=text0/F=0/A=MC "Resolution (meV) = "+tempstring1+"EF (eV) = "+tempstring2	Endif	killwaves Gausscurve, theFermi, Diffwave, reswave, minsqwaveEnd//********************************************************************************************************************************Function fit_fermi(W,x)	wave W; Variable x	return ((W[0]*x+W[1])/(exp(W[2]*(x-W[3]))+1))End//********************************************************************************************************************************Function fit_fermi5(W,x)	wave W; Variable x	return ((W[4]*x^2+W[0]*x+W[1])/(exp(W[2]*(x-W[3]))+1))End//*******************************************************************************************************************************Proc dividewavebyfermieffectif(thisname,temperature,offset)	String thisname	Variable temperature	Variable offset=0.01	Prompt thisname,"Name of wave:"	Prompt temperature,"Effective temperature (meV):"	Prompt offset,"Y offset"	PauseUpdate	Silent 1	Variable height	height=(1-offset)	temperature/=1000//	T=Temperature/11604.51	Duplicate/O $thisname fermiwave	fermiwave[]=height/(exp((dimoffset(fermiwave,0)+p*dimdelta(fermiwave,0))/temperature)+1)+offset	$thisname[]/=fermiwave[p]	Killwaves fermiwaveEnd//*******************************************************************************************************************************Proc dividewavebyfermi(mode)	Variable mode	Prompt mode,"Method", popup "Convolution;Effective T"	PauseUpdate	Silent 1	IF(mode==2)		dividewavebyfermieffectif()		Else			dividewavebyfermiconv()	EndifEnd	//*******************************************************************************************************************************Proc dividematrixbyfermi(mode)	Variable mode	Prompt mode,"Method", popup "Convolution;Effective T"	PauseUpdate	Silent 1	IF(mode==2)		dividematrixbyfermieffectif()		Else			dividematrixbyfermiconv()	EndifEnd	//*******************************************************************************************************************************Proc dividewavebyfermiconv(thisname,temperatureK,resolution,offset)	String thisname	Variable temperatureK	Variable resolution	Variable offset=0.01	Prompt thisname,"Name of wave:"	Prompt temperatureK,"Temperature (K):"	Prompt resolution,"Enter the system resolution (meV):"	Prompt offset,"Y offset"	PauseUpdate	Silent 1	Variable height,i	Variable temperature	Variable sigma	height=(1-offset)	temperature=temperatureK/11604.51//	temperature/=1000	resolution/=1000	sigma=res/sqrt(8*ln(2))	Make/O/N=(10*dimsize($thisname,0)) fermiwave1	Setscale/I x,2*dimoffset($thisname,0),-2*dimoffset($thisname,0),""fermiwave1 //note dimoffset must be negative	fermiwave1[]=1/(exp((dimoffset(fermiwave1,0)+p*dimdelta(fermiwave1,0))/temperature)+1)	Duplicate/O fermiwave1 gausswave	gausswave[]=exp(-(dimoffset(gausswave,0)+p*dimdelta(gausswave,0))^2/(sigma)^2)	Convolve/A gausswave,fermiwave1//	Duplicate/O fermiwave1 tempwave1//	tempwave1[]=-p//	Sort tempwave1,fermiwave1	Wavestats/Q fermiwave1	fermiwave1[]/=(V_max/height)	fermiwave1[]+=offset	Make/O/N=(dimsize($thisname,0)) fermiwave	Setscale/P x,dimoffset($thisname,0),dimdelta($thisname,0),""fermiwave	Duplicate/O fermiwave1 xwave	xwave[]=dimoffset(fermiwave1,0)+p*dimdelta(fermiwave1,0)	fermiwave[]=interp(dimoffset($thisname,0)+p*dimdelta($thisname,0),xwave,fermiwave1)		$thisname[]/=fermiwave[p]	Killwaves Fermiwave,fermiwave1	Killwaves gausswave,xwaveEnd	//*******************************************************************************************************************************Proc dividematrixbyfermiconv(thisname,temperatureK,resolution,offset)	String thisname	Variable temperatureK	Variable resolution	Variable offset=0.01	Prompt thisname,"Name of matrix:"	Prompt temperatureK,"Temperature (K):"	Prompt resolution,"Enter the system resolution (meV):"	Prompt offset,"Y offset"	PauseUpdate	Silent 1	Variable height,i	Variable temperature	Variable sigma	height=(1-offset)	temperature=temperatureK/11604.51//	temperature/=1000	resolution/=1000	sigma=resolution/sqrt(8*ln(2))	Make/O/N=(10*dimsize($thisname,1)) fermiwave1	Setscale/I x,2*dimoffset($thisname,1),-2*dimoffset($thisname,1),""fermiwave1 //note dimoffset must be negative	fermiwave1[]=1/(exp((dimoffset(fermiwave1,0)+p*dimdelta(fermiwave1,0))/temperature)+1)	Duplicate/O fermiwave1 gausswave	gausswave[]=exp(-(dimoffset(gausswave,0)+p*dimdelta(gausswave,0))^2/(sigma)^2)	Convolve/A gausswave,fermiwave1//	Duplicate/O fermiwave1 tempwave1//	tempwave1[]=-p//	Sort tempwave1,fermiwave1	Wavestats/Q fermiwave1	fermiwave1[]/=(V_max/height)	fermiwave1[]+=offset	Make/O/N=(dimsize($thisname,1)) fermiwave	Setscale/P x,dimoffset($thisname,1),dimdelta($thisname,1),""fermiwave	Duplicate/O fermiwave1 xwave	xwave[]=dimoffset(fermiwave1,0)+p*dimdelta(fermiwave1,0)	fermiwave[]=interp(dimoffset($thisname,1)+p*dimdelta($thisname,1),xwave,fermiwave1)		$thisname[][]/=fermiwave[q]	Killwaves Fermiwave,fermiwave1	Killwaves gausswave,xwaveEnd	//*******************************************************************************************************************************Proc dividematrixbyfermieffectif(thisname,temperature,offset)	String thisname	Variable temperature	Variable offset=0.01	Prompt thisname,"Name of matrix:"	Prompt temperature,"Effective temperature (meV):"	Prompt offset,"Y offset"	PauseUpdate	Silent 1	Variable height,i	height=(1-offset)	temperature/=1000	Make/O/N=(dimsize($thisname,1)) fermiwave	Setscale/P x,dimoffset($thisname,1),dimdelta($thisname,1),""fermiwave	fermiwave[]=height/(exp((dimoffset(fermiwave,0)+p*dimdelta(fermiwave,0))/temperature)+1)+offset	$thisname[][]/=fermiwave[q]//	i=0//	DO//		$thisname[i][]/=fermiwave[q]//		i+=1//	While(i<dimsize($thisname,0))	Killwaves fermiwaveEnd	//*******************************************************************************************************************************Proc dividemat3dkbyfermiconv(temperatureK,resolution,offset)	Variable temperatureK	Variable resolution	Variable offset=0.01	Prompt temperatureK,"Temperature (K):"	Prompt resolution,"Enter the system resolution (meV):"	Prompt offset,"Y offset"	PauseUpdate	Silent 1	String thisname="mat3dk"	Variable height,i	Variable temperature	height=(1-offset)	temperature=temperatureK/11604.51//	temperature/=1000	resolution/=1000	sigma=res/sqrt(8*ln(2))		Make/O/N=(10*dimsize($thisname,2)) fermiwave1	Setscale/I x,2*dimoffset($thisname,2),-2*dimoffset($thisname,2),""fermiwave1 //note dimoffset must be negative	fermiwave1[]=1/(exp((dimoffset(fermiwave1,0)+p*dimdelta(fermiwave1,0))/temperature)+1)	Duplicate/O fermiwave1 gausswave	gausswave[]=exp(-(dimoffset(gausswave,0)+p*dimdelta(gausswave,0))^2/(sigma)^2)	Convolve/A gausswave,fermiwave1//	Duplicate/O fermiwave1 tempwave1//	tempwave1[]=-p//	Sort tempwave1,fermiwave1	Wavestats/Q fermiwave1	fermiwave1[]/=(V_max/height)	fermiwave1[]+=offset	Make/O/N=(dimsize($thisname,2)) fermiwave	Setscale/P x,dimoffset($thisname,2),dimdelta($thisname,2),""fermiwave	Duplicate/O fermiwave1 xwave	xwave[]=dimoffset(fermiwave1,0)+p*dimdelta(fermiwave1,0)	fermiwave[]=interp(dimoffset($thisname,2)+p*dimdelta($thisname,2),xwave,fermiwave1)		$thisname[][][]/=fermiwave[r]	Killwaves Fermiwave,fermiwave1	Killwaves gausswave,xwaveEnd	//*******************************************************************************************************************************Proc keep_negative(matname,Replaceby)	String matname	Variable replaceby	Prompt matname,"Enter the name of the matrix"	Prompt replaceby,"Replace by", popup "NAN;0"	PauseUpdate	Silent 1	func_keep_negative($matname,replaceby)End//*******************************************************************************************************************************Function func_keep_negative(mat,replaceby)	Wave mat	Variable replaceby	Variable i,j	i=0	DO		j=0		DO			If(mat[i][j]>0)				If(replaceby==1)					mat[i][j]=NaN					Else						mat[i][j]=0				Endif			Endif			j+=1		While(j<dimsize(mat,1))		i+=1	While(i<dimsize(mat,0))End	//*******************************************************************************************************************************Proc keep_positive(matname,replaceby)	String matname	Variable replaceby	Prompt matname,"Enter the name of the matrix"	Prompt replaceby,"Replace by", popup "NAN;0"	PauseUpdate	Silent 1	func_keep_positive($matname,replaceby)End//*******************************************************************************************************************************Function func_keep_positive(mat,replaceby)	Wave mat	Variable replaceby	Variable i,j	i=0	DO		j=0		DO			If(mat[i][j]<0)				If(replaceby==1)					mat[i][j]=NaN					Else						mat[i][j]=0				Endif			Endif			j+=1		While(j<dimsize(mat,1))		i+=1	While(i<dimsize(mat,0))End	//********************************************************************************************************************************		Proc add_this_data()	Pauseupdate	Silent 1	String thislist	String thisdataname	String resultname	Variable/G typeofdata		Variable/G gv_groupnum	Variable i,j,index	Variable initialgv_groupnum	initialgv_groupnum=gv_groupnum	index=NAN	i=0	Do		if(add_data_index[i]==gv_groupnum)			index=i		Endif		i+=1	While(i<dimsize(add_data_index,0))	If(mod(index,1)==0)		resultname="data"+num2str(add_data_index[index])		Duplicate/O $resultname tempmat		tempmat[][]=0		thislist=add_data_list[index]		j=0		Do			gv_groupnum=str2num(StringFromList(j, thislist,";"))			ConvtOne()			j+=1		While(j<itemsinlist(thislist,";"))				j=0		Do			thisdataname="data"+StringFromList(j, thislist,";")//			print thisdataname			tempmat[][]+=$thisdataname[p][q]			j+=1		While(j<itemsinlist(thislist,";"))		Duplicate/O tempmat $resultname		gv_groupnum=initialgv_groupnum		setvarplot("varplot",gv_groupnum,num2str(gv_groupnum),"gv_groupnum")			EndifEnd	//********************************************************************************************************************************		Proc add_data()	Pauseupdate	Silent 1	String thislist	String thisdataname	String resultname	Variable/G typeofdata		Variable/G gv_groupnum	Variable i,j	i=0	Do		resultname="data"+num2str(add_data_index[i])		Duplicate/O $resultname tempmat		tempmat[][]=0		thislist=add_data_list[i]		j=0		Do			gv_groupnum=str2num(StringFromList(j, thislist,";"))			ConvtOne()			j+=1		While(j<itemsinlist(thislist,";"))				j=0		Do			thisdataname="data"+StringFromList(j, thislist,";")			tempmat[][]+=$thisdataname[p][q]			j+=1		While(j<itemsinlist(thislist,";"))		Duplicate/O tempmat $resultname		i+=1	While(i<dimsize(add_data_index,0))	If(dimsize(add_data_list,0)>0)			thislist=add_data_list[0]		gv_groupnum=str2num(StringFromList(0, thislist,";"))			If(Wintype("dataploter")==1)			Dowindow/F dataploter			setvarplot("varplot",gv_groupnum,num2str(gv_groupnum),"gv_groupnum")		Endif		EndifEnd//********************************************************************************************************************************Proc makeadd_data_table()	Pauseupdate	Silent 1	If(Wintype("add_data_table")==0)		If(Exists("add_data_index")==0)			Make/O/N=0 add_data_index			Make/O/T/N=0 add_data_list			Edit add_data_index,add_data_list			Dowindow/C add_data_table			Else				Edit add_data_index,add_data_list				Dowindow/C add_data_table		Endif		Else		Dowindow/F add_data_table	Endif	End	//**********************************************************************************************************************Proc createbkgndremovedbkgnd()	Pauseupdate;Silent 1	String/G name2bkgndremoved	String newname	newname=name2bkgndremoved+"_bkgnd"	Duplicate/O $name2bkgndremoved $newname	$newname[]=interp(dimoffset($newname,0)+p*dimdelta($newname,0),pntsofbkgndx,pntsofbkgndy)	Display $newnameEnd//**********************************************************************************************************************Proc createresultremovedbkgnd()	Pauseupdate;Silent 1	String/G name2bkgndremoved	String waveresult	waveresult=name2bkgndremoved+"_bkgndless"	Duplicate/O bkgndremoved $waveresult	$waveresult[]=$name2bkgndremoved[p]-Interp(dimoffset($name2bkgndremoved,0)+p*dimdelta($name2bkgndremoved,0),pntsofbkgndx,pntsofbkgndy)		Display $waveresultEnd//**********************************************************************************************************************Proc addpntbkgndremover()	Pauseupdate;Silent 1	String/G name2bkgndremoved	func_addpntbkgndremover(pntsofbkgndx,pntsofbkgndy)	subbkgndremover(pntsofbkgndx,pntsofbkgndy,$name2bkgndremoved,bkgndremoved)End//**********************************************************************************************************************Proc wave2bkgndremoved(newname)	String newname	Pauseupdate;Silent 1	String/G name2bkgndremoved	String tracesongraph,traceith	variable numoftraces	Variable i	name2bkgndremoved=newname	Valdisplay valdisp0 Format=name2bkgndremoved	tracesongraph=TraceNameList("background_remover",";",1)	numoftraces=ItemsInList(tracesongraph)	If(numoftraces>0)		i=0		Do			traceith=StringFromList(i, tracesongraph,";")			Removefromgraph $traceith			i+=1		While(i<numoftraces)	Endif	Wavestats/Q $newname	Make/O/N=(750,750) blank_bkgndremover	Setscale/I x,dimoffset($newname,0),dimoffset($newname,0)+dimdelta($newname,0)*dimsize($newname,0),""blank_bkgndremover	Setscale/I y,V_min-0.1*(V_max-V_min),V_max+0.1*(V_max-V_min),""blank_bkgndremover	Duplicate/O $newname bkgndremoved	Make/O/N=2 pntsofbkgndx	Make/O/N=2 pntsofbkgndy	pntsofbkgndx[0]=dimoffset($newname,0)	pntsofbkgndx[1]=dimoffset($newname,0)+dimsize($newname,0)*dimdelta($newname,0)	pntsofbkgndy[0]=$newname[0]	pntsofbkgndy[1]=$newname[dimsize($newname,0)-1]	subbkgndremover(pntsofbkgndx,pntsofbkgndy,$newname,bkgndremoved)	Appendtograph pntsofbkgndy vs pntsofbkgndx	ModifyGraph mode(pntsofbkgndy)=4,marker(pntsofbkgndy)=8,lstyle(pntsofbkgndy)=3;DelayUpdate	ModifyGraph rgb(pntsofbkgndy)=(0,0,65535)	Appendtograph $newname	Appendtograph bkgndremoved	ModifyGraph rgb(bkgndremoved)=(16385,49025,65535)	ModifyGraph lsize(bkgndremoved)=2End//**********************************************************************************************************************Proc wave4bkgndremoval(newname)	String newname	Prompt newname,"Enter the name of the wave"	Pauseupdate;Silent 1	String/G name2bkgndremoved	Variable maxnew,maxold,minnew,minold	Variable condition1,condition2	condition1=0	condition2=0	print newname,name2bkgndremoved	IF(dimoffset($newname,0)==dimoffset($name2bkgndremoved,0))		condition1=1	Endif	IF((dimoffset($newname,0)+dimsize($newname,0)*dimdelta($newname,0))==(dimoffset($name2bkgndremoved,0)+dimsize($name2bkgndremoved,0)*dimdelta($name2bkgndremoved,0)))		condition2=1	Endif	print condition1,condition2	If(condition1==1&&condition2==1)		print "banane"		Duplicate/O $newname pntsofbkgndy		Duplicate/O $newname pntsofbkgndx		pntsofbkgndx[]=dimoffset($newname,0)+p*dimdelta($newname,0)		subbkgndremover(pntsofbkgndx,pntsofbkgndy,$name2bkgndremoved,bkgndremoved)	Endif	Wavestats/Q $newname	minold=dimoffset(blank_bkgndremover,1)	maxold=dimoffset(blank_bkgndremover,1)+dimsize(blank_bkgndremover,1)*dimdelta(blank_bkgndremover,1)	minnew=V_min	Maxnew=V_max	If(minold<V_min)		V_min=minold	Endif	If(maxold>V_max)		V_max=maxold	Endif	Setscale/I y,V_min-0.15*(V_max-V_min),V_max+0.15*(V_max-V_min),""blank_bkgndremoverEnd//**********************************************************************************************************************Proc delpntbkgndremover()	Pauseupdate;Silent 1	String/G name2bkgndremoved		func_delpntbkgndremover(pntsofbkgndx,pntsofbkgndy)	subbkgndremover(pntsofbkgndx,pntsofbkgndy,$name2bkgndremoved,bkgndremoved)End//**********************************************************************************************************************Function func_addpntbkgndremover(wavex,wavey)	Wave wavex,wavey	Pauseupdate; Silent 1	Insertpoints dimsize(wavex,0),1,wavex	Insertpoints dimsize(wavey,0),1,wavey	wavex[dimsize(wavex,0)-1]=xcsr(A)	wavey[dimsize(wavey,0)-1]=vcsr(A)	sort wavex,wavex,waveyEnd//**********************************************************************************************************************Function func_delpntbkgndremover(wavex,wavey)	Wave wavex,wavey	Pauseupdate; Silent 1	Variable thisindex	Variable lastindex		Make/O/N=(dimsize(wavex,0)) distance	Dowindow/F background_remover	distance[]=ABS(wavex[p]-xcsr(A))	Wavestats/Q distance	thisindex=V_minloc	lastindex=dimsize(wavex,0)-1	IF((thisindex!=0)&&(thisindex!=lastindex))		Deletepoints thisindex,1,wavex		Deletepoints thisindex,1,wavey	Endif	killwaves distanceEnd//**********************************************************************************************************************Function subbkgndremover(Wavex,wavey,waveoriginal,Waveresult)	Wave Wavex	Wave Wavey	Wave waveoriginal	Wave Waveresult	Pauseupdate;Silent 1	waveresult[]=Waveoriginal[p]-Interp(dimoffset(waveoriginal,0)+p*dimdelta(waveoriginal,0),wavex,wavey)End	//**********************************************************************************************************************Proc selectlistbkgndremover1()	Pauseupdate;Silent 1	String/G name2bkgndremoved	String/G listnameofallwaves	String listnameofallwaves1	variable i	Variable numoflist	listnameofallwaves1=wavelist("*",";","Dims:1,TEXT:0")	numoflist=Itemsinlist(listnameofallwaves1,";")	Make/O/T/N=(numoflist) temptextwave	i=0	Do		temptextwave[i]=StringFromList(i, listnameofallwaves1, ";") 		i+=1	While(i<numoflist)	sort temptextwave,temptextwave	listnameofallwaves=temptextwave[0]	i=1	Do		listnameofallwaves+=";"+temptextwave[i]		i+=1	While(i<numoflist)	killwaves temptextwave	name2bkgndremoved=StringFromList(0, listnameofallwaves, ";")	selectlistbkgndremover2()End//**********************************************************************************************************************Proc list4bkgndremoveral1()	Pauseupdate;Silent 1	String/G listnameofallwaves	String/G name2bkgndremoved	String Options	Options="Dims:1,TEXT:0,MAXROWS:"+num2str(dimsize($name2bkgndremoved,0))+",MINROWS:"+num2str(dimsize($name2bkgndremoved,0))	listnameofallwaves=wavelist("*",";",Options)	list4bkgndremoveral2()End//**********************************************************************************************************************Proc selectlistbkgndremover2(newname)	String newname	Prompt newname,"Wave in:",popup listnameofallwaves		Pauseupdate;Silent 1	String/G name2bkgndremoved	String/G listnameofallwaves	String tracesongraph,traceith	Variable numoftraces,i	Variable minold,maxold	name2bkgndremoved=newname	Valdisplay valdisp0 Format=name2bkgndremoved	tracesongraph=TraceNameList("background_remover",";",1)	numoftraces=ItemsInList(tracesongraph)	If(numoftraces>0)		i=0		Do			traceith=StringFromList(i, tracesongraph,";")			Removefromgraph $traceith			i+=1		While(i<numoftraces)	Endif//	Wavestats/Q $name2bkgndremoved	Make/O/N=(750,750) blank_bkgndremover	Setscale/I x,dimoffset($newname,0),dimoffset($newname,0)+dimdelta($newname,0)*dimsize($newname,0),""blank_bkgndremover	Wavestats/Q $newname	Setscale/I y,V_min-0.15*(V_max-V_min),V_max+0.15*(V_max-V_min),""blank_bkgndremover	Duplicate/O $newname bkgndremoved	Make/O/N=2 pntsofbkgndx	Make/O/N=2 pntsofbkgndy	pntsofbkgndx[0]=dimoffset($newname,0)	pntsofbkgndx[1]=dimoffset($newname,0)+dimsize($newname,0)*dimdelta($newname,0)	pntsofbkgndy[0]=$newname[0]	pntsofbkgndy[1]=$newname[dimsize($newname,0)-1]	subbkgndremover(pntsofbkgndx,pntsofbkgndy,$newname,bkgndremoved)	Appendtograph pntsofbkgndy vs pntsofbkgndx	ModifyGraph mode(pntsofbkgndy)=4,marker(pntsofbkgndy)=8,lstyle(pntsofbkgndy)=3;DelayUpdate	ModifyGraph rgb(pntsofbkgndy)=(0,0,65535)	Appendtograph $newname	Appendtograph bkgndremoved	ModifyGraph rgb(bkgndremoved)=(16385,49025,65535)	ModifyGraph lsize(bkgndremoved)=2End//**********************************************************************************************************************Proc list4bkgndremoveral2(newname)	String newname	Prompt newname,"Background in:",popup listnameofallwaves		Pauseupdate;Silent 1	String/G name2bkgndremoved	String/G listnameofallwaves	Variable minvalue,maxvalue	Wavestats/Q $newname	minvalue=V_min	maxvalue=V_max	Wavestats/Q $name2bkgndremoved	IF(minvalue<V_min)		V_min=minvalue	Endif	IF(maxvalue>V_max)		V_max=maxvalue	Endif			Make/O/N=(750,750) blank_bkgndremover	Setscale/I x,dimoffset($newname,0),dimoffset($newname,0)+dimdelta($newname,0)*dimsize($newname,0),""blank_bkgndremover	Setscale/I y,V_min-0.15*(V_max-V_min),V_max+0.15*(V_max-V_min),""blank_bkgndremover	Duplicate/O $name2bkgndremoved bkgndremoved	Duplicate/O $newname pntsofbkgndy	Duplicate/O $newname pntsofbkgndx		pntsofbkgndx[]=dimoffset($newname,0)+p*dimdelta($newname,0)	subbkgndremover(pntsofbkgndx,pntsofbkgndy,$name2bkgndremoved,bkgndremoved)End//**********************************************************************************************************************Window background_remover() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(723,298,1250,685)	AppendImage blank_bkgndremover	ModifyImage blank_bkgndremover ctab= {*,*,Grays,0}	ModifyGraph mirror=0	Cursor/P/I A blank_bkgndremover 120,603	ShowInfo	ControlBar 75	Button addpnt,pos={5,49},size={60,20},proc=ButtonProc_addpntbkgndremover,title="Add pnt"	Button delpnts,pos={67,49},size={75,20},proc=ButtonProc_delpntbkgndremover,title="Delete pnt"	Button button0,pos={5,3},size={60,20},proc=ButtonProc_wave2bkgndremoved,title="\\K(65535,0,0)Wave in"	Button button1,pos={492,5},size={25,20},proc=Button_HELPbackgroundremover,title="\\K(65535,65535,65535)\\Z15?"	Button button1,fSize=15,fStyle=17,fColor=(16385,16388,65535)	Button button2,pos={68,3},size={105,20},proc=Button_selectlistbkgndremover,title="\\K(65535,0,0)Select from list"	Button button3,pos={471,49},size={50,20},proc=ButtonProc_closethiswindow,title="Close"	Button button3,fStyle=16	Button button4,pos={179,49},size={130,20},proc=Button_createbkgndremovedbkgnd,title="\\K(65535,65535,65535)Save background"	Button button4,fStyle=1,fColor=(1,9611,39321)	Button button5,pos={179,26},size={130,20},proc=Button_createresultremovedbkgnd,title="\\K(65535,65535,65535)Save result"	Button button5,fStyle=1,fColor=(0,43690,65535)	Button button6,pos={4,26},size={60,20},proc=Button_wave4bkgndremoval,title="\\K(0,0,65535)Bkgnd in"	Button button7,pos={69,26},size={105,20},proc=Button_list4bkgndremoveral,title="\\K(1,12815,52428)Select from list"	ValDisplay valdisp0,pos={176,6},size={120,14},format="DOS6"	ValDisplay valdisp0,limits={0,0,0},barmisc={0,1000},value= #"0"EndMacro//**********************************************************************************************************************Window HELP_background_remover() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(401,96,701,571)	ModifyGraph width=300,height=475,wbRGB=(49151,65535,49151),gbRGB=(49151,65535,49151)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=3.37 "\\Z20\\F'Times'Background remover\r\r\\Z16The \\K(0,0,65535)Background remover\\K(0,0,0) is a window tool"	AppendText "whose purpuse is to substract a background\rcurve specified by the user from a reference\rwave. Simply insert a wave in or select from"	AppendText "the list and then put Cursor A (\\Z20\\W542\\Z16) at a\rposition where you want to add a point for"	AppendText "the background. The \\K(0,0,65535)Background remover\\K(0,0,0)\rwindow contains the following buttons:\r\r\\Z16\\W549Add pnt\t\t\t\t\r"	AppendText "\\Z16\\W549Bkgnd in --Select from list\t\t\r\r\\Z16\\W549Delete pnt\t\t\t\r\r\\Z16\\W549Save background\t\t\t\r\r\\Z16\\W549Save result\t\t\r"	AppendText "\\Z16\\W549Wave in --Select from list\r\r\\K(65535,0,0)\\F'Wingdings'J\\Z16\\K(0,0,0)\\W549\\F'Times': \\K(0,0,0)Put the cursor on \rblank_bkgndremover.\r"	Button buttonclose,pos={124,440},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button1,pos={248,188},size={25,20},proc=Button_Help_bkgndremoverAddpnt,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={248,220},size={25,20},proc=Button_HelpBkgndremoverBkgndin,title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={248,250},size={25,20},proc=Button_Help_bkgndremoverDelpnt,title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={248,284},size={25,20},proc=Button_Help_bkgndremSavebackgnd,title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button5,pos={248,316},size={25,20},proc=Button_Help_bkgndremSaveresult,title="\\K(65535,65535,65535)?"	Button button5,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button6,pos={248,350},size={25,20},proc=Button_Help_BkgndremoverWavein,title="\\K(65535,65535,65535)?"	Button button6,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//*******************************************************************************************************************************Proc transform2equiv_waves(nameref,name2)	String nameref	String name2	Prompt nameref,"Enter the name of the model wave"	Prompt name2,"Enter the name of the wave to modify"		PauseUpdate	Silent 1	Func_transform2equiv_waves($nameref,$name2)End		//*******************************************************************************************************************************Function Func_transform2equiv_waves(nameref,name2)	Wave nameref	Wave name2	Pauseupdate	Silent 1	Duplicate/O nameref newwave	Duplicate/O name2 name2x	name2x[]=dimoffset(name2x,0)+p*dimdelta(name2x,0)	newwave[]=Interp(dimoffset(nameref,0)+p*dimdelta(nameref,0),name2x,name2)	Duplicate/O newwave name2	Killwaves newwave,name2xEnd	//*******************************************************************************************************************************Proc transform2equiv_mat(nameref,name2)	String nameref	String name2	Prompt nameref,"Enter the name of the model matrix"	Prompt name2,"Enter the name of the matrix to modify"	PauseUpdate	Silent 1	Func_transform2equiv_mat($nameref,$name2)End		//*******************************************************************************************************************************Function Func_transform2equiv_mat(nameref,name2)	Wave nameref	Wave name2	Pauseupdate	Silent 1	Duplicate/O nameref newmat	newmat[][]=Interp2d(name2,dimoffset(nameref,0)+p*dimdelta(nameref,0),dimoffset(nameref,1)+q*dimdelta(nameref,1))	Duplicate/O newmat name2	Killwaves newmatEnd	//********************************************************************************************************************************Proc mainpanelinitalize()	Pauseupdate;silent 1	String/G colordefault	Variable/G global_cspacing	Variable/G typeofdata	Variable/G SRC_vs_BNL	Variable/G colorinverseedc	Variable/G colorsetedc	Variable/G smoothfactor	variable/G topgraphnum	Variable/G Mat3dcopy	Variable/G Mat3dVDcopy	Variable/G Mat3dHDcopy	Variable/G Mat3dkcopy	Variable/G Mat3dVDkcopy	Variable/G Mat3dHDkcopy	Variable/G colordefaultinv	Variable/G GV_Ramandata				Mat3dcopy=0	Mat3dVDcopy=0	Mat3dHDcopy=0	Mat3dkcopy=0	Mat3dVDkcopy=0	Mat3dHDkcopy=0	topgraphnum=0		smoothfactor=1	global_cspacing=-1	typeofdata=1	popupmenu Data_type mode=1	popupmenu popup0 mode=2	SRC_vs_BNL=1	Table_Notthesepoints()	FFTlist()	Mkbad_slices()	tabproc_main("tab_matrices",2)	popupmenu inversecoloredc mode=1	colorinverseedc=1	popupmenu edccolorset mode=40	colorsetedc=40	tabproc_main("tab_matrices",0)	tabcontrol tab_matrices value=0	tabcontrol tab4vs6 value=1	Tab4vs6("Tab4vs6",1)	popupmenu popup_colordefault_inv mode=1	colordefaultinv=0	popupmenu colordefault_menu mode=1	colordefault="Grays"	GV_Ramandata=1End	//********************************************************************************************************************************//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????//?????????????????????????????????????????????????????????????????????????????????????????????????????Window Help_raw_data() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(1081,227,1346,702)	ModifyGraph width=265,height=475,wbRGB=(49151,60031,65535),gbRGB=(49151,60031,65535)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=3.16 "\\Z20\\F'times'Raw data sub-panel help menu\r\r\\Z16\\W549Bad slices\r\r\\Z16\\W549Channel spacing\r"	AppendText "\\Z16\\W549Cmb. data; table\r\r\\Z16\\W549Convert All Data\r\r\\Z16\\W549Data ploter\r\r\\Z16\\W549Data type\r\r\\Z16\\W549FTT list\r\r\\Z16\\W549Initialize\r"	AppendText "\\Z16\\W549Load\r\r\\Z16\\W549Open data\r\r\\Z16\\W549Open select\r\r\\Z16\\W549Smooth factor\r"	Button button0,pos={171,42},size={25,20},proc=Button_Help_bad_slices,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={170,75},size={25,20},proc=Button_Help_ch_spacing,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={171,364},size={25,20},proc=Button_Help_Open_select,title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={171,333},size={25,20},proc=Button_Help_Open_data,title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={171,300},size={25,20},proc=Button_Help_Load,title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button5,pos={171,269},size={25,20},proc=Button_Help_Initialize,title="\\K(65535,65535,65535)?"	Button button5,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button6,pos={171,237},size={25,20},proc=Button_Help_FFT_list,title="\\K(65535,65535,65535)?"	Button button6,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button7,pos={171,207},size={25,20},proc=Button_Help_Data_type,title="\\K(65535,65535,65535)?"	Button button7,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button8,pos={170,173},size={25,20},proc=Button_Help_Data_ploter,title="\\K(65535,65535,65535)?"	Button button8,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button9,pos={171,141},size={25,20},proc=Button_help_convert_all_data,title="\\K(65535,65535,65535)?"	Button button9,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button01,pos={170,108},size={25,20},proc=Button_Help_Cmbdata,title="\\K(65535,65535,65535)?"	Button button01,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button02,pos={171,395},size={25,20},proc=Button_Help_Smooth_factor,title="\\K(65535,65535,65535)?"	Button button02,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button buttonclose,pos={107,441},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Function Button_set_auto_axis(ctrlName) : ButtonControl	String ctrlName	SetAxis/A left	SetAxis/A bottomEnd//**********************************************************************************************************************Function Button_Help_raw_data(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_raw_data")==0)		Execute "Help_raw_data()"		Else			Dowindow/F Help_raw_data	EndifEnd//**********************************************************************************************************************Function Button_Help_Rotate_image(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Rotate_image")==0)		Execute "Help_Rotate_image()"		Else			Dowindow/F Help_Rotate_image	EndifEnd//**********************************************************************************************************************Function Button_Help_Smooth_mat(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Smooth_mat")==0)		Execute "Help_Smooth_mat()"		Else			Dowindow/F Help_Smooth_mat	EndifEnd//**********************************************************************************************************************Function Button_Help_Data_type(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Data_type")==0)		Execute "Help_Data_type()"		Else			Dowindow/F Help_Data_type	EndifEnd//**********************************************************************************************************************Function Button_Help_PointreaderShowtbl(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Point_reader_Show_table")==0)		Execute "Help_Point_reader_Show_table()"		Else			Dowindow/F Help_Point_reader_Show_table	EndifEnd//**********************************************************************************************************************Function Button_Help_Combine_all(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Combine_all")==0)		Execute "Help_Combine_all()"		Else			Dowindow/F Help_Combine_all	EndifEnd//**********************************************************************************************************************Function Button_Help_0_to_NaN(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_0_to_NaN")==0)		Execute "Help_0_to_NaN()"		Else			Dowindow/F Help_0_to_NaN	EndifEnd//**********************************************************************************************************************Function Button_Help_tab_Misc(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_tab_Misc")==0)		Execute "Help_tab_Misc()"		Else			Dowindow/F Help_tab_Misc	EndifEnd//**********************************************************************************************************************Function Button_Help_Equiv_mat(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Equiv_mat")==0)		Execute "Help_Equiv_mat()"		Else			Dowindow/F Help_Equiv_mat	EndifEnd//**********************************************************************************************************************Function Button_Help_Delete_all(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Delete_all")==0)		Execute "Help_Delete_all()"		Else			Dowindow/F Help_Delete_all	EndifEnd//**********************************************************************************************************************Function Button_Help_Delete_last(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Delete_last")==0)		Execute "Help_Delete_last()"		Else			Dowindow/F Help_Delete_last	EndifEnd//**********************************************************************************************************************Function Button_Help_Divide_by_FD(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Divide_by_FD")==0)		Execute "Help_Divide_by_FD()"		Else			Dowindow/F Help_divide_by_FD	EndifEnd//**********************************************************************************************************************Function Button_Help_Ln_mat(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Ln_mat")==0)		Execute "Help_Ln_mat()"		Else			Dowindow/F Help_Ln_mat	EndifEnd//**********************************************************************************************************************Function Button_Help_mat_exp_n(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_mat_exp_n")==0)		Execute "Help_mat_exp_n()"		Else			Dowindow/F Help_mat_exp_n	EndifEnd//**********************************************************************************************************************Function Button_Help_Smooth_factor(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Smooth_factor")==0)		Execute "Help_Smooth_factor()"		Else			Dowindow/F Help_Smooth_factor	EndifEnd//**********************************************************************************************************************Function Button_Help_Open_select(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Open_select")==0)		Execute "Help_Open_select()"		Else			Dowindow/F Help_Open_select	EndifEnd//**********************************************************************************************************************Function Button_Help_NaN_to_0(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_NaN_to_0")==0)		Execute "Help_NaN_to_0()"		Else			Dowindow/F Help_NaN_to_0	EndifEnd//**********************************************************************************************************************Function Button_Help_bkgndremoverDelpnt(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_bkgndremover_Delete_pnt")==0)		Execute "Help_bkgndremover_Delete_pnt()"		Else			Dowindow/F Help_bkgndremover_Delete_pnt	EndifEnd//**********************************************************************************************************************Function Button_Help_NaN0mat3d(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_NaN0mat3d")==0)		Execute "Help_NaN0mat3d()"		Else			Dowindow/F Help_NaN0mat3d	EndifEnd//**********************************************************************************************************************Function Button_Help_Append_pnts(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Append_pnts")==0)		Execute "Help_Append_pnts()"		Else			Dowindow/F Help_Append_pnts	EndifEnd//**********************************************************************************************************************Function Button_Help_Plot_Point_reader(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Plot_Point_reader")==0)		Execute "Help_Plot_Point_reader()"		Else			Dowindow/F Help_Plot_Point_reader	EndifEnd//**********************************************************************************************************************Function Button_Help_Data(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Data")==0)		Execute "Help_Data()"		Else			Dowindow/F Help_Data	EndifEnd//**********************************************************************************************************************Function Button_Help_Keep_plus(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Keep_plus")==0)		Execute "Help_Keep_plus()"		Else			Dowindow/F Help_Keep_plus	EndifEnd//**********************************************************************************************************************Function Button_Help_Keep_minus(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Keep_minus")==0)		Execute "Help_Keep_minus()"		Else			Dowindow/F Help_Keep_minus	EndifEnd//**********************************************************************************************************************Function Button_Help_Open_data(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Open_data")==0)		Execute "Help_Open_data()"		Else			Dowindow/F Help_Open_data	EndifEnd//**********************************************************************************************************************Function Button_Help_New_band(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_New_band")==0)		Execute "Help_New_band()"		Else			Dowindow/F Help_New_band	EndifEnd//**********************************************************************************************************************Function Button_Help_SubtractEDCDploter(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Subtract_EDC_Dploter")==0)		Execute "Help_Subtract_EDC_Dploter()"		Else			Dowindow/F Help_Subtract_EDC_Dploter	EndifEnd//**********************************************************************************************************************Function Button_Help_2nd_derivative(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_2nd_derivative")==0)		Execute "Help_2nd_derivative()"		Else			Dowindow/F Help_2nd_derivative	EndifEnd//**********************************************************************************************************************Function Button_Help_Combine_this_data(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Combine_this_data")==0)		Execute "Help_Combine_this_data()"		Else			Dowindow/F Help_Combine_this_data	EndifEnd//**********************************************************************************************************************Function Button_Help_MDC(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_MDC")==0)		Execute "Help_MDC()"		Else			Dowindow/F Help_MDC	EndifEnd//**********************************************************************************************************************Function Button_Help_Cvt_data(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Cvt_data")==0)		Execute "Help_Cvt_data()"		Else			Dowindow/F Help_Cvt_data	EndifEnd//**********************************************************************************************************************Function Button_Help_Load(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Load")==0)		Execute "Help_Load()"		Else			Dowindow/F Help_Load	EndifEnd//**********************************************************************************************************************Function Button_Help_Initialize(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Initialize")==0)		Execute "Help_Initialize()"		Else			Dowindow/F Help_Initialize	EndifEnd//**********************************************************************************************************************Function Button_Help_FFT_list(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_FFT_list")==0)		Execute "Help_FFT_list()"		Else			Dowindow/F Help_FFT_list	EndifEnd//**********************************************************************************************************************Function Button_Help_Plot_MDC(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Plot_MDC")==0)		Execute "Help_Plot_MDC()"		Else			Dowindow/F Help_Plot_MDC	EndifEnd//**********************************************************************************************************************Function Button_Help_EDC_data(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_EDC_data")==0)		Execute "Help_EDC_data()"		Else			Dowindow/F Help_EDC_data	EndifEnd//**********************************************************************************************************************Function Button_Help_Symetrize_EDC_mat(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Symetrize_EDC_mat")==0)		Execute "Help_Symetrize_EDC_mat()"		Else			Dowindow/F Help_Symetrize_EDC_mat	EndifEnd//**********************************************************************************************************************Function Button_Help_Combine_krange(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Combine_krange")==0)		Execute "Help_Combine_krange()"		Else			Dowindow/F Help_Combine_krange	EndifEnd//**********************************************************************************************************************Function Button_help_convert_all_data(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("help_convert_all_data")==0)		Execute "help_convert_all_data()"		Else			Dowindow/F help_convert_all_data	EndifEnd//**********************************************************************************************************************Function Button_help_tab_traces(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("help_tab_traces")==0)		Execute "help_tab_traces()"		Else			Dowindow/F help_tab_traces	EndifEnd//**********************************************************************************************************************Function Button_Help_ch_spacing(ctrlName) : ButtonControl	String ctrlName	If(Wintype("Help_channel_spacing")==0)		Execute "Help_channel_spacing()"		Else			Dowindow/F Help_channel_spacing	EndifEnd//**********************************************************************************************************************Function Button_Help_bad_slices(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("help_bad_slices")==0)		Execute "help_bad_slices()"		Else			Dowindow/F help_bad_slices	EndifEnd//**********************************************************************************************************************Function Button_Help_MDC_EDC(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_MDC_EDC")==0)		Execute "Help_MDC_EDC()"		Else			Dowindow/F Help_MDC_EDC	EndifEnd//**********************************************************************************************************************Function Button_HELPbackgroundremover(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("HELP_background_remover")==0)		Execute "HELP_background_remover()"		Else			Dowindow/F HELP_background_remover	EndifEnd//**********************************************************************************************************************Proc sub_bline_pi_matrix(matname,numbpnts)	String matname	Variable numbpnts	Prompt matname,"Name of the matrix"	Prompt numbpnts,"Number of points"		PauseUpdate; Silent 1	Variable i	i=0	Do		Make/O/N=(dimsize($matname,1)) thiswave		setscale/P x,dimoffset($matname,1),dimdelta($matname,1),""thiswave		sub_bline_pi(thiswave,numbpnts)			i+=1	While(i<dimsize($matname,0))End//**********************************************************************************************************************Function Button_Help_Norm(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_Norm")==0)		Execute "Help_Norm()"		Else			Dowindow/F Help_Norm	EndifEnd//**********************************************************************************************************************Function Button_Help_tab_presentation(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_tab_presentation")==0)		Execute "Help_tab_presentation()"		Else			Dowindow/F Help_tab_presentation	EndifEnd//**********************************************************************************************************************Function Button_Help_bkgndremSaveresult(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("Help_bkgndremover_Save_result")==0)		Execute "Help_bkgndremover_Save_result()"		Else			Dowindow/F Help_bkgndremover_Save_result	EndifEnd//**********************************************************************************************************************Function Button_Help_Cmbdata(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Cmbdata")==0)		Execute "Help_Cmbdata()"		Else			Dowindow/F Help_Cmbdata	EndifEnd//**********************************************************************************************************************Function Button_Help_FFT_filter(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_FFT_filter")==0)		Execute "Help_FFT_filter()"		Else			Dowindow/F Help_FFT_filter	EndifEnd//**********************************************************************************************************************Function Button_Help_Fermi_profile(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Fermi_profile")==0)		Execute "Help_Fermi_profile()"		Else			Dowindow/F Help_Fermi_profile	EndifEnd//**********************************************************************************************************************Function Button_Help_Find_kF(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Find_kF")==0)		Execute "Help_Find_kF()"		Else			Dowindow/F Help_Find_kF	EndifEnd//**********************************************************************************************************************Function Button_Help_Data_ploter(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Data_ploter")==0)		Execute "Help_Data_ploter()"		Else			Dowindow/F Help_Data_ploter	EndifEnd//**********************************************************************************************************************Function Button_Help_Combine_range(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Combine_range")==0)		Execute "Help_Combine_range()"		Else			Dowindow/F Help_Combine_range	EndifEnd//**********************************************************************************************************************Function Button_HelpBkgndremoverBkgndin(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Bkgndremover_Bkgnd_in")==0)		Execute "Help_Bkgndremover_Bkgnd_in()"		Else			Dowindow/F Help_Bkgndremover_Bkgnd_in	EndifEnd//**********************************************************************************************************************Function Button_Help_Open_this_data(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Open_this_data")==0)		Execute "Help_Open_this_data()"		Else			Dowindow/F Help_Open_this_data	EndifEnd//**********************************************************************************************************************Function Button_Help_num_of_band(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_num_of_band")==0)		Execute "Help_num_of_band()"		Else			Dowindow/F Help_num_of_band	EndifEnd//**********************************************************************************************************************Function Button_Help_MDCfit(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_MDCfit")==0)		Execute "Help_MDCfit()"		Else			Dowindow/F Help_MDCfit	EndifEnd//**********************************************************************************************************************Function Button_Help_NK(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_NK")==0)		Execute "Help_NK()"		Else			Dowindow/F Help_NK	EndifEnd//**********************************************************************************************************************Function Button_Help_MDC_Data_ploter(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_MDC_Data_ploter")==0)		Execute "Help_MDC_Data_ploter()"		Else			Dowindow/F Help_MDC_Data_ploter	EndifEnd//**********************************************************************************************************************Function Button_Help_Plot_EDC(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Plot_EDC")==0)		Execute "Help_Plot_EDC()"		Else			Dowindow/F Help_Plot_EDC	EndifEnd//**********************************************************************************************************************Function Button_Help_Point_Reader_Sort(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Point_Reader_Sort")==0)		Execute "Help_Point_Reader_Sort()"		Else			Dowindow/F Help_Point_Reader_Sort	EndifEnd//**********************************************************************************************************************Function Button_Help_EDC(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_EDC")==0)		Execute "Help_EDC()"		Else			Dowindow/F Help_EDC	EndifEnd//**********************************************************************************************************************Function Button_Help_BkgndremoverWavein(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Bkgndremover_Wave_in")==0)		Execute "Help_Bkgndremover_Wave_in()"		Else			Dowindow/F Help_Bkgndremover_Wave_in	EndifEnd//**********************************************************************************************************************Function Button_Help_Change_stepsize(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Change_stepsize")==0)		Execute "Help_Change_stepsize()"		Else			Dowindow/F Help_Change_stepsize	EndifEnd//**********************************************************************************************************************Function Button_Help_Point_reader(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Point_reader")==0)		Execute "Help_Point_reader()"		Else			Dowindow/F Help_Point_reader	EndifEnd//**********************************************************************************************************************Function Button_Help_Tools(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Tools")==0)		Execute "Help_Tools()"		Else			Dowindow/F Help_Tools	EndifEnd//**********************************************************************************************************************Function Button_Help_bkgndremoverAddpnt(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_bkgndremover_Add_pnt")==0)		Execute "Help_bkgndremover_Add_pnt()"		Else			Dowindow/F Help_bkgndremover_Add_pnt	EndifEnd//**********************************************************************************************************************Function Button_Help_bkgndremSavebackgnd(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_bkgndremover_Save_backgnd")==0)		Execute "Help_bkgndremover_Save_backgnd()"		Else			Dowindow/F Help_bkgndremover_Save_backgnd	EndifEnd//**********************************************************************************************************************Function Button_Help_tab_matrices(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_tab_matrices")==0)		Execute "Help_tab_matrices()"		Else			Dowindow/F Help_tab_matrices	EndifEnd//**********************************************************************************************************************Function Button_Help_Norm_matrix(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Norm_matrix")==0)		Execute "Help_Norm_matrix()"		Else			Dowindow/F Help_Norm_matrix	EndifEnd//**********************************************************************************************************************Function Button_Help_Read_point(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Read_point")==0)		Execute "Help_Read_point()"		Else			Dowindow/F Help_Read_point	EndifEnd//**********************************************************************************************************************Function Button_Help_Not_these_points(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Not_these_points")==0)		Execute "Help_Not_these_points()"		Else			Dowindow/F Help_Not_these_points	EndifEnd//**********************************************************************************************************************Function Button_HelpMakeimageDataploter(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Make_image_Data_ploter")==0)		Execute "Help_Make_image_Data_ploter()"		Else			Dowindow/F Help_Make_image_Data_ploter	EndifEnd//**********************************************************************************************************************Function Button_Help_RemovebkgndDploter(ctrlName) : ButtonControl	String ctrlName	IF(WIntype("Help_Remove_background_Dploter")==0)		Execute "Help_Remove_background_Dploter()"		Else			Dowindow/F Help_Remove_background_Dploter	EndifEnd//**********************************************************************************************************************Window help_bad_slices() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(61,218,461,503)	ModifyGraph width=400,height=285,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.25/Y=7.02 "\\Z20\\F'Times'Bad slices\r\r\\Z16\\K(0,0,65535)Bad_slices \\K(0,0,0) is a wave that contains angle channels"	AppendText "with discontinus detector response. When normalizing \rabove E\\BF\\M\\Z16\\F'Times', these points are omitted from the normalization "	AppendText "response and replaced by a linear interpolation. If you\r keep the detector channels constant, \\K(0,0,65535)Bad_slices \\K(0,0,0) can be "	AppendText " used for every data. The wave may be empty.\r "	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549A good way to get \\K(0,0,65535)Bad_slices \\K(0,0,0) is to integrate MDCs "	AppendText "above E\\BF\\M\\Z16\\F'Times' using the \\K(0,0,65535)NK\\K(0,0,0) bottom in the \\K(0,0,65535)Data_ploter\\K(0,0,0) window "	AppendText "and selecting the bad channels.\r"	Button buttonclose,pos={165,248},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_channel_spacing() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(473,170,963,320)	ModifyGraph width=490,height=150,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=16.13 "\\Z20\\F'Times'Chanels spacing\r"	AppendText "\\Z16\\K(0,0,65535)Channel spacing \\K(0,0,0) forces the step between to channels to be different from "	AppendText "the value extracted from the software used. To use the predefined channel \rspacing value, keep the displayed value below zero."	Button buttonclose,pos={206,109},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Cmbdata() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(445,153,885,503)	ModifyGraph width=440,height=350,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=4.57 "\\Z20\\F'Times'Cmb. data; table\r"	AppendText "\\Z16\\K(0,0,65535)Combine data\\K(0,0,0) is used to combine different data of the "	AppendText "same spectra. When the \\K(0,0,65535)table\\K(0,0,0) button is first pressed, a "	AppendText "numerical (\\K(0,0,65535)add_data_index\\K(0,0,0)) and a text (\\K(0,0,65535)add_data_list\\K(0,0,0)) waves"	AppendText "are generated. The list of the data to add together is to be inserted "	AppendText "to in \\K(0,0,65535)add_data_list\\K(0,0,0) and separated by the semi-column sign (;). \rEx: 23;30;71 would combine data23, data30 and data71. The "	AppendText "result will overwritten one of these data, whose corresponding "	AppendText "index must be written in \\K(0,0,65535)add_data_list\\K(0,0,0). In our example, 23, 30 or "	AppendText "71 could be written in \\K(0,0,65535)add_data_index\\K(0,0,0). The data are combined "	AppendText "either when the data are normalized (in which case the user has \rto select the proper option) or before, using the  \\K(0,0,65535)Combine this"	AppendText "data\\K(0,0,0) from the \\K(0,0,65535)data ploter \\K(0,0,0)window. \r "	AppendText " \\K(65535,0,65535)\\F'Wingdings'L\\K(0,0,0)\\F'Times'\\W549Although it is technically possible, it is bad to combine "	AppendText " data after normalization because in that case the number of \r scans would not be taken into account."	Button buttonclose,pos={182,316},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window help_convert_all_data() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(514,159,804,279)	ModifyGraph width=290,height=120,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.69/Y=14.17 "\\Z20\\F'Times'Convert all data\r\r\\Z16This function allows to convert back ALL "	AppendText "the data to their unnormalized raw form. "	Button buttonclose,pos={110,87},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Data_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(732,44,1057,634)	ModifyGraph width=325,height=590,wbRGB=(61166,61166,61166),gbRGB=(49151,65535,49151)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.31/Y=3.22 "\\Z20\\F'Times'Data ploter help menu\r"	AppendText "\\Z16\\K(0,0,65535)Data ploter\\K(0,0,0) is the main tool of the \\K(0,0,65535)Raw data\\K(0,0,0) \rsub-panel. It allows to vizualize, one by one, "	AppendText "the raw data or the normalized data. It has its\rown control board with the following functions:\r\r\\Z16\\W549Combine this data\r\r\\Z16\\W549Cvt data\r"	AppendText "\\Z16\\W549Data\r\r\\Z16\\W549EDC\r\r\\Z16\\W549FFT filter\r\r\\Z16\\W549FFT list\r\r\\Z16\\W549Make image\r\r\\Z16\\W549MDC\r\r\\Z16\\W549NK\r\r\\Z16\\W549Norm\r"	AppendText "\\Z16\\W549Open this data\r\r\\Z16\\W549Remove background\r\r\\Z16\\W549Subtract EDC\r"	Button buttonclose,pos={142,553},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={214,129},size={25,20},proc=Button_Help_Combine_this_data,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={214,161},size={25,20},proc=Button_Help_Cvt_data,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={214,193},size={25,20},proc=Button_Help_Data,title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={214,221},size={25,20},proc=Button_Help_EDC_data,title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={214,254},size={25,20},proc=Button_Help_FFT_filter,title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button5,pos={214,286},size={25,20},proc=Button_Help_FFT_list,title="\\K(65535,65535,65535)?"	Button button5,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button6,pos={214,348},size={25,20},proc=Button_Help_MDC_Data_ploter,title="\\K(65535,65535,65535)?"	Button button6,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button7,pos={214,382},size={25,20},proc=Button_Help_NK,title="\\K(65535,65535,65535)?"	Button button7,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button8,pos={214,416},size={25,20},proc=Button_Help_Norm,title="\\K(65535,65535,65535)?"	Button button8,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button9,pos={214,444},size={25,20},proc=Button_Help_Open_this_data,title="\\K(65535,65535,65535)?"	Button button9,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button10,pos={214,477},size={25,20},proc=Button_Help_RemovebkgndDploter,title="\\K(65535,65535,65535)?"	Button button10,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button11,pos={215,507},size={25,20},proc=Button_Help_SubtractEDCDploter,title="\\K(65535,65535,65535)?"	Button button11,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button07,pos={214,318},size={25,20},proc=Button_HelpMakeimageDataploter,title="\\K(65535,65535,65535)?"	Button button07,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Data_type() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(522,226,802,356)	ModifyGraph width=280,height=130	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.36/Y=16.92 "\\Z20\\F'Times'Data type\r\r\\Z16Use this popup menu to select the type"	AppendText " of data (.pxt (default), .txt from A1,.dat)."	Button buttonclose,pos={107,87},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_FFT_list() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(429,246,964,526)	ModifyGraph width=535,height=280,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.19/Y=6.07 "\\Z20\\F'Times'FTT list\r"	AppendText "\\Z16\\K(0,0,65535)FFT list\\K(0,0,0) creates a wave (\\K(0,0,65535)FFTfilterlist\\K(0,0,0)) used in the Fast Fourier transform filtering "	AppendText "of the data. Such process is useful in the presence of a high frequency periodic "	AppendText "noise along the angle direction. The points entering \\K(0,0,65535)FFTfilterlist\\K(0,0,0) correspond to "	AppendText "points in the Fourier space, to which are assigned complex waves. The FFT is "	AppendText "modified by discarding the points in \\K(0,0,65535)FFTfilterlist\\K(0,0,0) and by a slight smoothing of "	AppendText "the high frequency range. This is complicated and should be used carefully only "	AppendText "if necessary. Data can be filtered when the data are opened (using \\K(0,0,65535)Open data\\K(0,0,0) or"	AppendText "\\K(0,0,65535)Open select\\K(0,0,0) from the \\K(0,0,65535)Main panel\\K(0,0,0) or \\K(0,0,65535)Open this data\\K(0,0,0) from the \\K(0,0,65535)Data Plo"	AppendText/NOCR "ter\\K(0,0,0) window) \ror independently, using the \\K(0,0,65535)FFT filter\\K(0,0,0) from the \\K(0,0,65535)Data Ploter\\K(0,0,0) window.\r"	AppendText " \\K(65535,0,65535)\\F'Wingdings'L\\K(0,0,0)\\F'Times'\\W549It is dangerous to put in \\K(0,0,65535)FFTfilterlist\\K(0,0,0) numbers smaller than 1/4 of t"	AppendText/NOCR "he size \r of the data along the angle direction."	Button buttonclose,pos={230,247},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Initialize() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(492,127,772,327)	ModifyGraph width=280,height=200,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=8.50 "\\Z20\\F'Times'Initialize\r\r\\Z16This button should be the first you press. "	AppendText "It will set various parameters to their\rdefault value: \\K(0,0,65535)Data_Type\\K(0,0,0)=.pxt; \\K(0,0,65535)Smooth "	AppendText "factor\\K(0,0,0)=1; \\K(0,0,65535)Channel spacing\\K(0,0,0)=-1;\\K(0,0,65535)Color for\rtraces\\K(0,0,0)=Spectrum, Normal;  \\K(0,0,65535)Detector "	AppendText "slit \\K(0,0,0)=V. It will also activate \\K(0,0,65535)Bad_slices\\K(0,0,0),"	AppendText "\\K(0,0,65535)FFTfilterlist\\K(0,0,0) and the \\K(0,0,65535)NTP table\\K(0,0,0)."	Button buttonclose,pos={107,167},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Load() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(540,131,870,446)	ModifyGraph width=330,height=315,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.30/Y=5.71 "\\Z20\\F'Times'Load\r\r\\Z16The \\K(0,0,65535)Load \\K(0,0,0)function load the .pxt files from the "	AppendText "root folder and write their name in \\K(0,0,65535)File_Name\\K(0,0,0). \rTo each file name will then correspond one "	AppendText "index. One has to use the proper file extension \rby using the \\K(0,0,65535)Data type\\K(0,0,0) popum menu.\r"	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549In order to prevent a mismatch between \rthe numbered name of the .pxt files and the "	AppendText "data index, it is better to start the numbering of \rthe .pxt files at 1. If it starts at 0, copy the 0th "	AppendText "file to ...001.pxt and then continue to take data. \rThen, discard the 0th file. If this is not possible, "	AppendText "load the 0th file only at the end by changing its \rsuffixe to the last index of all files."	Button buttonclose,pos={132,280},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Open_data() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(405,44,910,764)	ModifyGraph width=505,height=720,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=2.08 "\\Z20\\F'Times'Open data\r\r\\Z16This function is used to normalize the loaded raw data, starting with the "	AppendText "choosen indexed data (see \\K(0,0,65535)Open this data\\K(0,0,0) from the \\K(0,0,65535)Data ploter\\K(0,0,0) window to "	AppendText "normalize data one by one). This function has many options: \r\r\\Z18Normalization way? and normalization range:\\Z16\r"	AppendText "\\K(36873,14755,58982)Bottom\\K(0,0,0) = This uses the first 10 slices. No specification of energy to enter."	AppendText "\\K(36873,14755,58982)Above EF\\K(0,0,0) = You MUST specify from which energy you want to normalize. "	AppendText "The last energy corresponds to the maximum energy value. The \\K(0,0,65535)Bad_Slices\\K(0,0,0)\rwave MUST be activated."	AppendText "\\K(36873,14755,58982)Specific\\K(0,0,0) = You MUST specify BOTH the energies from which and to which\ryou want to use for normalization."	AppendText "\\K(36873,14755,58982)Normalization curve\\K(0,0,0) = Enter a wave with the same number of angle points. \rThis curve is used to normalize all data."	AppendText "\r\\Z18Which background? and Points for Background fitting:\\Z16\r\rThis is to correct some offset or linear background. The fit is performed"	AppendText "at the higher energy slices, above EF.\r\\K(36873,14755,58982)Flat\\K(0,0,0) = Corrects a simple offset. This should be used most of times. 10 "	AppendText "points for the fit are usually enough.\r\\K(36873,14755,58982)Linear\\K(0,0,0) = Extracts a linear background. This useful when the background"	AppendText "shows a prononced slope. When using this options, it is recommended to"	AppendText "have at least 20 or 30 points for the fitting, depending on the statistics.\r\r\\Z18FFT filter:\\Z16\r"	AppendText "This should be keeped to OFF unless the data present a high frequency "	AppendText "periodic noise along the angle direction. Consult the \\K(0,0,65535)FFT list\\K(0,0,0) help\rbefore using this option.  \r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Bad slices\r\r\\Z16\\W549FFT list\r\r\\Z16\\W549Open this data\r"	Button buttonclose,pos={207,689},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={186,584},size={25,20},proc=Button_Help_bad_slices,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={186,616},size={25,20},proc=Button_Help_FFT_list,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={186,647},size={25,20},title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Open_select() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(575,228,885,468)	ModifyGraph width=310,height=240,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.32/Y=7.50 "\\Z20\\F'Times'Open select\r\r\\Z16This function works exactly like \\K(0,0,65535)Open data\\K(0,0,0). "	AppendText "The only difference is that \\K(0,0,65535)Open select\\K(0,0,0) treats \ronly the data whose index appear in the wave"	AppendText "\\K(0,0,65535)Image_index\\K(0,0,0).\r\r\\Z18Complementary help:\r\r\\Z16\\W549Open data\r"	Button buttonclose,pos={120,205},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={133,163},size={25,20},proc=Button_Help_Open_data,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Smooth_factor() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(500,148,820,463)	ModifyGraph width=320,height=315,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=4.76 "\\Z20\\F'Times'Smooth factor\r"	AppendText "\\Z16\\K(0,0,65535)Smooth factor\\K(0,0,0) is the \\K(36873,14755,58982)number\\K(0,0,0) that is used during "	AppendText "the smoothing of the normalization curve \\K(0,0,65535)\\K(0,0,65535)NK\\K(0,0,0). \rIt corresponds to the command:\r"	AppendText "Smooth/E=3/B=\\K(36873,14755,58982)number number\\K(0,0,0), \\K(0,0,65535)NK\\K(0,0,0)\r"	AppendText "If you do not want to smooth \\K(0,0,65535)NK\\K(0,0,0), use \\K(0,0,65535)Smooth \rfactor\\K(0,0,0)<=0. If you want to smooth, \\K(0,0,65535)Smooth "	AppendText "factor\\K(0,0,0) = 3 or 5 is a good option. \r\r\\Z18Complementary help:\r\r\\Z16\\W549NK\r"	Button buttonclose,pos={118,283},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={114,242},size={25,20},title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Combine_this_data() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(516,152,841,397)	ModifyGraph width=325,height=245,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.31/Y=7.76 "\\Z20\\F'Times'Combine this data\r\r\\Z16This function works like the \\K(0,0,65535)Cmb. data\\K(0,0,0) function "	AppendText "from the \\K(0,0,65535)Raw data\\K(0,0,0) sub-panel, but it applies only\rto the data for which the \\K(0,0,65535)data index\\K(0,0,0) is active in"	AppendText "the \\K(0,0,65535)Data ploter\\K(0,0,0) window.\r\r\\Z18Complementary help:\r\r\\Z16\\W549Cmb. data\r "	Button buttonclose,pos={126,206},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={141,162},size={25,20},proc=Button_Help_Cmbdata,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Cvt_data() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,587,341)	ModifyGraph width=300,height=170,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.33/Y=10.59 "\\Z20\\F'Times'Cvt data\r\r\\Z16This function works like \\K(0,0,65535)Convert ALL data\\K(0,0,0), "	AppendText "but it applies only to the data whose index \ris active in the \\K(0,0,65535)Data Ploter\\K(0,0,0) window. Hence, "	AppendText "it will convert back the active index data to\rits unnormalized raw form. "	Button buttonclose,pos={110,136},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_data() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(415,136,790,401)	ModifyGraph width=375,height=265,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.27/Y=6.04 "\\Z20\\F'Times'Data\r"	AppendText "\\Z16Once they are loaded, the data are renamed \\K(0,0,65535)Data\\K(52428,1,41942)index\\K(0,0,0),"	AppendText "where \\K(52428,1,41942)index\\K(0,0,0) is the index corresponding to the wave "	AppendText "\\K(0,0,65535)File_name\\K(0,0,0) (data1, data2 etc...). The value displayed in"	AppendText "the top left of \\K(0,0,65535)Data Ploter\\K(0,0,0) is the active index, whose \rcorresponding image is shown in the window. This "	AppendText "index corresponds also to the data on which operations \rwill be performed when using the various functions of "	AppendText "the \\K(0,0,65535)Data Ploter\\K(0,0,0) panel. When the \\K(0,0,65535)data index\\K(0,0,0) is changed,"	AppendText "the window named \\K(0,0,65535)DOS\\K(0,0,0) will show up, with the angle-\rintegrated EDC of the new active data, called "	AppendText "\\K(0,0,65535)density_of_states\\K(0,0,0). "	Button buttonclose,pos={147,232},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_EDC_data() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(137,160,782,560)	ModifyGraph width=645,height=400,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.16/Y=4.50 "\\Z20\\F'Times'EDC data\r"	AppendText "\\Z16This function is used to plot the EDCs of the active index data. The first two values to enter"	AppendText "correspond respectively to the first and last slices we want to consider. If a negative number is "	AppendText "given as the last slice, the last slice number is automatically considered. You can then choose the "	AppendText "number of EDCs to combine (odd number, the middle index coinciding with the EDC x index) "	AppendText "and finally the last number indicates every \"how many EDCs\" you want to display one. Each "	AppendText "EDC will be called E\\K(52428,1,41942)index\\K(0,0,0)_\\K(1,26214,0)number\\K(0,0,0), where \\K(52428,1,41942)index\\K(0,0,0) refers to the active data "	AppendText/NOCR "in the \\K(0,0,65535)Data Ploter\\K(0,0,0), and \r\\K(1,26214,0)number\\K(0,0,0) corresponds to the x slice number of the corresponding EDC.\r"	AppendText "\\Z18Example:\r\r\\Z16You want to display the EDCs of data51 from x index 0 to 12.  You combine 5 EDCs and display "	AppendText "every 3 EDCs. The EDCs displayed will be called E51_0, E51_3, E51_6, E51_9 and E51_12.\r\rE51_0[]=(data51[0][p]+data51[1][p]+data51[2][p])/3"	AppendText "E51_3[]=(data51[1][p]+data51[2][p]+data51[3][p]+data51[4][p]+data51[5][p])/5"	AppendText "E51_6[]=(data51[4][p]+data51[5][p]+data51[6][p]+data51[7][p]+data51[8][p])/5"	AppendText "E51_9[]=(data51[7][p]+data51[8][p]+data51[9][p]+data51[10][p]+data51[11][p])/5"	AppendText "E51_12[]=(data51[10][p]+data51[11][p]+data51[12][p]+data51[13][p]+data51[14][p])/5\r"	Button buttonclose,pos={300,364},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_FFT_filter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(233,248,598,518)	ModifyGraph width=365,height=270,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.27/Y=6.30 "\\Z20\\F'Times'FFT filter\r\r\\Z16This function filters the data with the active index by"	AppendText "modifiying its Fourier transform. This is a dangerous\rfunction which should be used ONLY in the presence"	AppendText "of a high frequency periodic noise along the angle\rdirection. Please consult the \\K(0,0,65535)FFT list\\K(0,0,0) help for more \rdetails.\r "	AppendText "\\Z18Complementary help:\r\r\\Z16\\W549FFT list\r"	Button buttonclose,pos={145,235},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={117,193},size={25,20},proc=Button_Help_FFT_list,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(0,0,65535)EndMacro//**********************************************************************************************************************Window Help_Make_image_data_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(507,234,797,384)	ModifyGraph width=290,height=150,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=10.67 "\\Z20\\F'Times'Make image\r\r\\Z16This button simply opens a new window"	AppendText "called \\K(0,0,65535)Image_Data\\K(65535,16385,55749)index\\K(0,0,0)where is displayed"	AppendText "the image of \\K(0,0,65535)Data\\K(65535,16385,55749)index\\K(0,0,0) corresponding to"	AppendText "the active \\K(65535,16385,55749)index\\K(0,0,0) in the \\K(0,0,65535)Data ploter\\K(0,0,0) window."	Button buttonclose,pos={111,118},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_MDC_Data_ploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(208,198,863,598)	ModifyGraph width=655,height=400,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00 "\\Z20\\F'Times'Help MDC data\r"	AppendText "\\Z16This function is used to plot the MDCs of the active index data. The first two values to enter"	AppendText "correspond respectively to the first and last slices we want to consider. If a negative number is "	AppendText "given as the last slice, the last slice number is automatically considered. You can then choose the "	AppendText "number of MDCs to combine (odd number, the middle index coinciding with the MDC y index) "	AppendText "and finally the last number indicates every \"how many MDCs\" you want to display one. Each "	AppendText "MDC will be called M\\K(52428,1,41942)index\\K(0,0,0)_\\K(1,26214,0)number\\K(0,0,0), where \\K(52428,1,41942)index\\K(0,0,0) refers to the active data "	AppendText/NOCR "in the \\K(0,0,65535)Data Ploter\\K(0,0,0), and \r\\K(1,26214,0)number\\K(0,0,0) corresponds to the x slice number of the corresponding MDC.\r"	AppendText "\\Z18Example:\r\r\\Z16You want to display the MDCs of data51 from x index 0 to 12.  You combine 5 MDCs and display "	AppendText "every 3 MDCs. The MDCs displayed will be called M51_0, M51_3, M51_6, M51_9 and M51_12.\r\rM51_0[]=(data51[p][0]+data51[p][1]+data51[p][2])/3"	AppendText "M51_3[]=(data51[p][1]+data51[p][2]+data51[p][3]+data51[p][4]+data51[p][5])/5"	AppendText "M51_6[]=(data51[p][4]+data51[p][5]+data51[p][6]+data51[p][7]+data51[p][8])/5"	AppendText "M51_9[]=(data51[p][7]+data51[p][8]+data51[p][9]+data51[p][10]+data51[p][11])/5"	AppendText "M51_12[]=(data51[p][10]+data51[p][11]+data51[p][12]+data51[p][13]+data51[p][14])/5\r"	Button buttonclose,pos={286,364},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_NK() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(289,203,664,698)	ModifyGraph width=375,height=495,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=3.43 "\\Z20\\F'Times'NK\r\r\\Z16\\K(0,0,65535)NK\\K(0,0,0) is the name given to the wave use for normalization"	AppendText "the data. It has the same dimension than the dimension\rof the considered data along the angle direction. It is "	AppendText "constructed by averaging the MDCs considered for\rnormalization. When normalizing a data, each row of "	AppendText "this data is divided by \\K(0,0,65535)NK\\K(0,0,0). When using \\K(0,0,65535)Open data\\K(0,0,0) or"	AppendText "\\K(0,0,65535)Open select\\K(0,0,0) from the main panel, or \\K(0,0,65535)Open this data\\K(0,0,0)"	AppendText "from the \\K(0,0,65535)Data ploter\\K(0,0,0), \\K(0,0,65535)NK\\K(0,0,0) is overwritten for each data"	AppendText "and displayed in the window \\K(0,0,65535)Graph_nk\\K(0,0,0).\r"	AppendText "In the \\K(0,0,65535)Data ploter\\K(0,0,0), the \\K(0,0,65535)NK\\K(0,0,0) button allows to create a\rnormalization curve, or in other words, it will"	AppendText "average MDCs of the active data in a defined range.\rHowever, this button does not normalize the data. In"	AppendText "order to do that, one needs to use the \\K(0,0,65535)Norm\\K(0,0,0) button\rafterwards. That process may be useful if one wants"	AppendText "to normalize a data using the \\K(0,0,65535)NK\\K(0,0,0) curve of another data."	AppendText "However, in the general case the \\K(0,0,65535)NK\\K(0,0,0) and \\K(0,0,65535)Norm\\K(0,0,0) button "	AppendText "should not be use for normalization. Use \\K(0,0,65535)Open this data\\K(0,0,0)\rinstead.\r \r\\Z18Complementary help:\r\r\\Z16\\W549Norm\r"	Button buttonclose,pos={155,460},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={123,417},size={25,20},proc=Button_Help_Norm,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Norm() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(588,239,843,459)	ModifyGraph width=255,height=220,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=7.27 "\\Z20\\F'Times'Norm\r\r\\Z16The \\K(0,0,65535)Norm\\K(0,0,0) button normalizes the data"	AppendText "with the active index using the \\K(0,0,65535)NK\\K(0,0,0) \rcurve in memory.\r\r\\Z18Complementary help:\r\r\\Z16\\W549NK\r "	Button buttonclose,pos={96,187},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={111,146},size={25,20},proc=Button_Help_NK,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Open_this_data() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(317,184,617,404)	ModifyGraph width=300,height=220,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.33/Y=7.27 "\\Z20\\F'Times'Open this data\r\r\\Z16This function works exactly like \\K(0,0,65535)Open data\\K(0,0,0),"	AppendText "but it applies only to the data with the active\rindex in the \\K(0,0,65535)Data ploter\\K(0,0,0) window.\r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Open data\r"	Button buttonclose,pos={117,188},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={135,147},size={25,20},proc=Button_Help_Open_data,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Remove_background_Dploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,537,536)	ModifyGraph width=250,height=365,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=4.38 "\\Z20\\F'Times'Remove background\r\r\\Z16This option is also incorporated in "	AppendText "\\K(0,0,65535)Open data\\K(0,0,0) and \\K(0,0,65535)Open select\\K(0,0,0) from the \rmain panel as well as in \\K(0,0,65535)Open this "	AppendText "data\\K(0,0,0) from the \\K(0,0,65535)Data ploter\\K(0,0,0) window. \rIt will remove a flat or linear \rbackground from the active index"	AppendText "data, using a number of points \rstarting from the last EDC index.\r\r\\Z18Complementary help:\r\r\\Z16\\W549Open data\r\r\\Z16\\W549Open select\r"	AppendText "\\Z16\\W549Open this data\r "	Button buttonclose,pos={93,331},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={159,227},size={25,20},proc=Button_Help_Open_data,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={159,257},size={25,20},proc=Button_Help_Open_select,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={159,289},size={25,20},proc=Button_Help_Open_this_data,title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_subtract_EDC_Dploter() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,617,506)	ModifyGraph width=330,height=335,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=4.78 "\\Z20\\F'Times'Subtract EDC\r\r\\Z16When using this function, both cursors A (\\Z20\\W542\\Z16)"	AppendText "and B (\\Z20\\W512\\Z16) must be active in the \\K(0,0,65535)Data ploter\\K(0,0,0) \rwindow. The average EDC between these two "	AppendText "cursors will then be subtracted to every column\rof the data with the active index in the \\K(0,0,65535)Data"	AppendText "ploter\\K(0,0,0) window. Use this function to remove a \rnon trivial background approximated by a \rconstant EDC far from a band crossing.\r"	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549Although the function will work \rregardless of the relative position of cursor "	AppendText "A (\\Z20\\W542\\Z16) and B (\\Z20\\W512\\Z16), it is recommended, as\ra rule of thumb, to always put cursor A (\\Z20\\W542\\Z16)\ron the left.\r"	Button buttonclose,pos={126,302},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_MDC_EDC() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(660,267,940,587)	ModifyGraph width=280,height=320,wbRGB=(49151,60031,65535),gbRGB=(49151,60031,65535)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.36/Y=6.25 "\\Z20\\F'times'MDC-EDC subpanel help menu\r\r\\Z16\\W549E\r\r\\Z16\\W549EMDC\r\r\\Z16\\W549Find kF\r\r\\Z16\\W549M\r"	AppendText "\\Z16\\W549MDCfit\r\r\\Z16\\W549Plot (for E)\r\r\\Z16\\W549Plot (for M)\r"	Button button0,pos={143,47},size={25,20},proc=Button_Help_EDC,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={143,109},size={25,20},proc=Button_Help_Find_kF,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={143,139},size={25,20},proc=Button_Help_MDC,title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={143,173},size={25,20},proc=Button_Help_MDCfit,title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={143,204},size={25,20},proc=Button_Help_Plot_EDC,title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button5,pos={143,236},size={25,20},proc=Button_Help_Plot_MDC,title="\\K(65535,65535,65535)?"	Button button5,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button buttonclose,pos={110,282},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button6,pos={143,75},size={25,20},title="\\K(65535,65535,0)?",fSize=15	Button button6,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_EDC() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(822,192,1372,787)	ModifyGraph width=550,height=595,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.18/Y=2.86 "\\Z20\\F'Times'E\r"	AppendText "\\Z16This function is used to create ALL the EDCs of a given matrix  \\K(52428,1,41942)matname\\K(0,0,0) definded"	AppendText "by the user.  The user also choose the \\K(1,26214,0)number\\K(0,0,0) of EDCs to combine (odd number, "	AppendText "the middle index coinciding with the EDC x \\K(65535,21845,0)index\\K(0,0,0)). Each EDC will be called "	AppendText "E\\K(52428,1,41942)matname\\K(0,0,0)_\\K(1,26214,0)number\\K(0,0,0)_\\K(65535,21845,0)index\\K(0,0,0). To display the EDCs, use the function \\K(0,0,6553"	AppendText/NOCR "5)Plot EDC.\\K(0,0,0)\r\r\\Z18Example:\r\r\\Z16You want to create the EDCs of cut1 which has 300 columns.  "	AppendText "You combine 3 EDCs. The new EDCs will be:\r\rEcut1_3_0[]=(cut1[0][p]+cut1[1][p])/2\rEcut1_3_1[]=(cut1[0][p]+cut1[1][p]+cut1[2][p])/3"	AppendText "Ecut1_3_2[]=(cut1[1][p]+cut1[2][p]+cut1[3][p])/3\r....\rEcut1_3_297[]=(cut1[296][p]+cut1[297][p]+cut1[298][p])/3"	AppendText "Ecut1_3_298[]=(cut1[297][p]+cut1[298][p]+cut1[299][p])/3\rEcut1_3_299[]=(cut1[298][p]+cut1[299][p])/2\r"	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549Since EDCs may use a lot of memory, it is recommended, unless you really "	AppendText "want to keep the EDCs for a future use, to overwrite the EDCs, for example by "	AppendText "using ttemp the default name for the matrix. For cut1 for example, you can write \rthe command:\r\rDuplicate/O cut1 ttemp\r"	AppendText "and then create the corresponding EDCs.\r\r\\Z18Complementary help:\r\r\\Z16\\W549Plot (for E)\r "	Button buttonclose,pos={230,560},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={177,519},size={25,20},proc=Button_Help_Plot_EDC,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Find_kF() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(698,186,1378,736)	ModifyGraph width=680,height=550,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.15/Y=3.09 "\\Z20\\F'times'Find kF\r"	AppendText "\\Z16This function is used to determine the position of the Fermi vector k\\BF\\M\\F'Times'\\Z16. It selects the 10 \"best\" edcs of a "	AppendText "matrix and displays them in a window called \\K(0,0,65535)best_edcs\\K(0,0,0). The EDCs must have been created first using "	AppendText "the \\K(0,0,65535)EDC\\K(0,0,0) button of the \\K(0,0,65535)MDC-EDC sub-panel\\K(0,0,0), and the user must specify the number of EDCs combined "	AppendText "in this operation.\r"	AppendText "When performing the \\K(0,0,65535)Find kF\\K(0,0,0) function, both cursors A (\\Z20\\W542\\Z16) and B (\\Z20\\W512\\Z16) must be on the target "	AppendText "window, with cursor A at the left and lower than cursor B. The function first displays in the window "	AppendText "\\K(0,0,65535)find_EF_position\\K(0,0,0) the second derivative of the averaged EDC in the cursors x range, which is called "	AppendText "\\K(0,0,65535)find_EF\\K(0,0,0). The minimum value of \\K(0,0,65535)find_EF\\K(0,0,0) in the cursors y range is used as an approximation of the "	AppendText "leading edge, with the corresponding value printed in the command bar. The 10 EDCs with the highest "	AppendText "intensity at that point are sorted in such a way that the best one is put last in the window \\K(0,0,65535)best_edcs\\K(0,0,0).\r"	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549In order the get fast results and minimize the memory used, it is preferable to use the followin"	AppendText/NOCR "g\rprocedure when extractin k\\BF\\M\\F'Times'\\Z16 at various locations. First create and artificial cut called ttemp and "	AppendText "display it in a window called xttemp by typing the following in the command bar:\r"	AppendText "Duplicate/O cut0 ttemp;Display;appendimage ttemp;ModifyImage ttemp ctab= {*,*,RedWhiteBlue,1} \rDowindow/C xttemp\r"	AppendText "Then, create the EDCs for ttemp and extract k\\BF\\M\\F'Times'\\Z16 accordingly. Afterwards, for every new cut, use the\rcommand:\r"	AppendText "Duplicate/O newcut ttemp;Dowindow/F xttemp \r\r\\Z18Complementary help:\r\r\\Z16\\W549EDC\r "	Button buttonclose,pos={298,516},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={151,472},size={25,20},proc=Button_Help_EDC,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_MDC() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,837,766)	ModifyGraph width=550,height=595,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=3.19 "\\Z20\\F'Times'M\r"	AppendText "\\Z16This function is used to create ALL the MDCs of a given matrix  \\K(52428,1,41942)matname\\K(0,0,0) definded"	AppendText "by the user.  The user also choose the \\K(1,26214,0)number\\K(0,0,0) of MDCs to combine (odd number, "	AppendText "the middle index coinciding with the MDC x \\K(65535,21845,0)index\\K(0,0,0)). Each MDC will be called "	AppendText "M\\K(52428,1,41942)matname\\K(0,0,0)_\\K(1,26214,0)number\\K(0,0,0)_\\K(65535,21845,0)index\\K(0,0,0). To display the MDCs, use the function \\K(0,0,6553"	AppendText/NOCR "5)Plot MDC.\\K(0,0,0)\r\r\\Z18Example:\r\r\\Z16You want to create the MDCs of cut1 which has 300 rows.  \rYou combine 3 MDCs. The new MDCs will be:\r"	AppendText "Mcut1_3_0[]=(cut1[p][0]+cut1[p][1])/2\rMcut1_3_1[]=(cut1[p][0]+cut1[p][1]+cut1[p][2])/3\rMcut1_3_2[]=(cut1[p][1]+cut1[p][2]+cut1[p][3])/3\r...."	AppendText "Mcut1_3_297[]=(cut1[p][296]+cut1[p][297]+cut1[p][298])/3\rMcut1_3_298[]=(cut1[p][297]+cut1[p][298]+cut1[p][299])/3"	AppendText "Mcut1_3_299[]=(cut1[p][298]+cut1[p][299])/2\r"	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549Since MDCs may use a lot of memory, it is recommended, unless you really "	AppendText "want to keep the MDCs for a future use, to overwrite the MDCs, for example by "	AppendText "using ttemp the default name for the matrix. For cut1 for example, you can write \rthe command:\r\rDuplicate/O cut1 ttemp\r"	AppendText "and then create the corresponding MDCs.\r\r\\Z18Complementary help:\r\r\\Z16\\W549Plot (for M)\r "	Button buttonclose,pos={232,559},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={174,517},size={25,20},proc=Button_Help_Plot_MDC,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Plot_EDC() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,722,421)	ModifyGraph width=435,height=250,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=6.40 "\\Z20\\F'Times'Plot (for E)\r\r\\Z16This function is used to display the EDCs first created with the "	AppendText "\\K(0,0,65535)E\\K(0,0,0) button of the \\K(0,0,65535)MDC-EDC subpanel\\K(0,0,0). The user must indicate "	AppendText "the name of the matrix of interest as well as the number of EDCs"	AppendText "he combined when he created the EDCs. The last \\K(36873,14755,58982)number\\K(0,0,0) to enter"	AppendText "indicates that the EDCs will be displayed every \\K(36873,14755,58982)number\\K(0,0,0).\r \r \\Z18Complementary help:\r\r\\Z16\\W549E\r "	Button button0,pos={188,218},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button button0,fSize=16,fStyle=16	Button button1,pos={138,175},size={25,20},proc=Button_Help_EDC,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Plot_MDC() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(616,457,1051,707)	ModifyGraph width=435,height=250,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=6.40 "\\Z20\\F'Times'Plot (for M)\r\r\\Z16This function is used to display the MDCs first created with the "	AppendText "\\K(0,0,65535)M\\K(0,0,0) button of the \\K(0,0,65535)MDC-EDC subpanel\\K(0,0,0). The user must indicate "	AppendText "the name of the matrix of interest as well as the number of MDCs"	AppendText "he combined when he created the MDCs. The last \\K(36873,14755,58982)number\\K(0,0,0) to enter"	AppendText "indicates that the MDCs will be displayed every \\K(36873,14755,58982)number\\K(0,0,0).\r \r \\Z18Complementary help:\r\r\\Z16\\W549M\r "	Button buttonclose,pos={181,217},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={139,174},size={25,20},proc=Button_Help_MDC,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_MDCfit() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,170,692,760)	ModifyGraph width=405,height=590,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.25/Y=2.88 "\\Z20\\F'Times'MDCfit\r\r\\Z16The \\K(0,0,65535)MDCfit\\K(0,0,0) function is used to obtain information about the"	AppendText "dispersion and the lineshape of the MDCs. When using this\rfunction the corresponding MDCs must have been created"	AppendText "first for the considered matrix using the \\K(0,0,65535)MDC\\K(0,0,0) button of the"	AppendText "\\K(0,0,65535)MDC-EDC subpanel\\K(0,0,0). The user must specify the number of\rMDCs he combined in order to get the MDCs. The user "	AppendText "must also indicate the range of the fit using both cursors A \r(\\Z20\\W542\\Z16) and cursor B (\\Z20\\W512\\Z16) on the target window. Cursor A"	AppendText "MUST be placed at the left and lower than cursor B. A fit \rto a loentzian curve with y offset, whithin the x range "	AppendText "defined by the cursors, will be performed for every MDC in \rthe selected y range. The position of the lorentzian  as a "	AppendText "function of energy will be displayed directly on the target\rwindow while both the peak widths (half width at half "	AppendText "height, offset not included) and peak areas (offset not \rincluded) will be displayed in a separate window. \r"	AppendText "Note: fits well above the E\\BF\\M\\F'Times'\\Z16 cutoff have no physical \rmeaning.\r"	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549In you are interested only in the disperion of a band,"	AppendText "it is recommended to use the \\K(0,0,65535)Find dispersion\\K(0,0,0) options from"	AppendText "the \\K(0,0,65535)Miscellaneous tabpanel\\K(0,0,0) of the the \\K(0,0,65535)Tools subpanel\\K(0,0,0) in the \r\\K(0,0,65535)Main panel\\K(0,0,0).\r"	AppendText "\\Z18Complementary help:\r\r\\Z16\\W549Find dispersion\r\r\\Z16\\W549MDC\r "	Button button0close,pos={165,557},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button button0close,fSize=16,fStyle=16	Button button0,pos={188,519},size={25,20},proc=Button_Help_MDC,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={188,485},size={25,20},title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window background_remover_1() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(566,232,1093,619)	AppendImage blank_bkgndremover	ModifyImage blank_bkgndremover ctab= {*,*,Grays,0}	ModifyGraph mirror=0	Cursor/P/I A blank_bkgndremover 1,1	ShowInfo	ControlBar 75	Button addpnt,pos={4,50},size={60,20},proc=ButtonProc_addpntbkgndremover,title="Add pnt"	Button delpnts,pos={66,50},size={75,20},proc=ButtonProc_delpntbkgndremover,title="Delete pnt"	Button button0,pos={4,4},size={60,20},proc=ButtonProc_wave2bkgndremoved,title="\\K(65535,0,0)Wave in"	Button button1,pos={494,4},size={25,20},proc=Button_HELPbackgroundremover,title="\\K(65535,65535,65535)\\Z15?"	Button button1,fSize=15,fStyle=17,fColor=(16385,16388,65535)	Button button2,pos={67,4},size={105,20},proc=Button_selectlistbkgndremover,title="\\K(65535,0,0)Select from list"	Button button3,pos={472,49},size={50,20},proc=ButtonProc_closethiswindow,title="Close"	Button button3,fStyle=16	Button button4,pos={177,51},size={130,20},proc=Button_createbkgndremovedbkgnd,title="\\K(65535,65535,65535)Save background"	Button button4,fStyle=1,fColor=(1,9611,39321)	Button button5,pos={177,28},size={130,20},title="\\K(65535,65535,65535)Save result"	Button button5,fStyle=1,fColor=(0,43690,65535)	Button button6,pos={3,27},size={60,20},proc=Button_wave4bkgndremoval,title="\\K(0,0,65535)Bkgnd in"	Button button7,pos={68,27},size={105,20},proc=Button_list4bkgndremoveral,title="\\K(1,12815,52428)Select from list"	ValDisplay valdisp0,pos={175,7},size={120,14},format="EDC_kf12"	ValDisplay valdisp0,limits={0,0,0},barmisc={0,1000},value= #"0"EndMacro//**********************************************************************************************************************Window Help_Tools() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(693,75,953,355)	ModifyGraph width=260,height=280,wbRGB=(49151,60031,65535),gbRGB=(49151,60031,65535)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.38/Y=6.07 "\\Z20\\F'times'Tools subpanel help menu      \r\r\\Z16\\W549Matrices tabpanel\r\r\\Z16\\W549Miscellaneous tabpanel\r"	AppendText "\\Z16\\W549NTP\r\r\\Z16\\W549Point reader\r\r\\Z16\\W549Presentation tabpanel\r\r\\Z16\\W549Traces tabpanel\r"	Button buttonclose,pos={94,247},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={213,46},size={25,20},proc=Button_Help_tab_matrices,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={213,76},size={25,20},proc=Button_Help_tab_Misc,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={213,108},size={25,20},proc=Button_Help_Not_these_points,title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={213,139},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={213,171},size={25,20},proc=Button_Help_tab_presentation,title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button5,pos={213,203},size={25,20},proc=Button_help_tab_traces,title="\\K(65535,65535,65535)?"	Button button5,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_tab_matrices() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(409,44,864,534)	ModifyGraph width=455,height=490,wbRGB=(49151,65535,49151),gbRGB=(49151,65535,49151)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.22/Y=3.47 "\\Z20\\F'Times'Matrices tabpanel help menu\r"	AppendText "\\Z16The \\K(0,0,65535)Matrices tabpanel\\K(0,0,0) specializes in various operations on matrices. \rThe available functions are:\r"	AppendText "\\Z16\\W5490 to NaN\t\t\t\t\\Z16\\W549Ln(mat)\r\r\\Z16\\W5492nd derivative\t\t\t\\Z16\\W549(mat)^n\r\r\\Z16\\W549Change Stepsize\t\t\t\\Z16\\W549NaN0mat3d\r"	AppendText "\\Z16\\W549Combine all\t\t\t\t\\Z16\\W549NaN to 0\r\r\\Z16\\W549Combine krange\t\t\t\\Z16\\W549Norm matrix\r\r\\Z16\\W549Combine range\t\t\t\\Z16\\W549Rotate image\r"	AppendText "\\Z16\\W549Divide by FD\t\t\t\\Z16\\W549Smooth mat\r\r\\Z16\\W549Equiv. mat\t\t\t\t\\Z16\\W549Symetrize EDC mat\r\r\\Z16\\W549Fermi Profile\t\t\t\t\r\r\\Z16\\W549Keep +\t\t\t\t\t\r"	AppendText "\\Z16\\W549Keep -\r"	Button buttonclose,pos={197,456},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={165,94},size={25,20},proc=Button_Help_0_to_NaN,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={165,128},size={25,20},proc=Button_Help_2nd_derivative,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={165,158},size={25,20},proc=Button_Help_Change_stepsize,title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={165,189},size={25,20},proc=Button_Help_Combine_all,title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={165,221},size={25,20},proc=Button_Help_Combine_krange,title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button5,pos={165,253},size={25,20},proc=Button_Help_Combine_range,title="\\K(65535,65535,65535)?"	Button button5,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button6,pos={165,284},size={25,20},proc=Button_Help_divide_by_FD,title="\\K(65535,65535,65535)?"	Button button6,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button7,pos={165,318},size={25,20},proc=Button_Help_Equiv_mat,title="\\K(65535,65535,65535)?"	Button button7,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button8,pos={165,348},size={25,20},proc=Button_Help_Fermi_profile,title="\\K(65535,65535,65535)?"	Button button8,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button9,pos={165,380},size={25,20},proc=Button_Help_Keep_plus,title="\\K(65535,65535,65535)?"	Button button9,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button10,pos={165,412},size={25,20},proc=Button_Help_Keep_minus,title="\\K(65535,65535,65535)?"	Button button10,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button11,pos={412,284},size={25,20},proc=Button_Help_Smooth_mat,title="\\K(65535,65535,65535)?"	Button button11,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button12,pos={412,252},size={25,20},proc=Button_Help_Rotate_image,title="\\K(65535,65535,65535)?"	Button button12,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button15,pos={412,221},size={25,20},proc=Button_Help_Norm_matrix,title="\\K(65535,65535,65535)?"	Button button15,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button16,pos={412,189},size={25,20},proc=Button_Help_NaN_to_0,title="\\K(65535,65535,65535)?"	Button button16,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button17,pos={412,159},size={25,20},proc=Button_Help_NaN0mat3d,title="\\K(65535,65535,65535)?"	Button button17,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button18,pos={412,124},size={25,20},proc=Button_Help_mat_exp_n,title="\\K(65535,65535,65535)?"	Button button18,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button19,pos={412,92},size={25,20},proc=Button_Help_Ln_mat,title="\\K(65535,65535,65535)?"	Button button19,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button20,pos={412,315},size={25,20},proc=Button_Help_Symetrize_EDC_mat,title="\\K(65535,65535,65535)?"	Button button20,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window help_tab_traces() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(154,228,609,588)	ModifyGraph width=455,height=360,wbRGB=(49151,65535,49151),gbRGB=(49151,65535,49151)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=4.44 "\\Z20\\F'Times'Traces tabpanel help menu\r"	AppendText "\\Z16The \\K(0,0,65535)Traces tabpanel\\K(0,0,0) specializes in various operations on traces. The \ravailable functions are:\r"	AppendText "\\Z16\\W549Background remover\t\t\t\r\r\\Z16\\W549Copy all traces\t\t\t\t\r\r\\Z16\\W549Divide by FD\r\r\\Z16\\W549Equivalent waves\r\r\\Z16\\W549Normwave\r"	AppendText "\\Z16\\W549Rotate\r\r\\Z16\\W549Sym EDC\r"	Button buttonclose,pos={195,327},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={212,95},size={25,20},proc=Button_HELPbackgroundremover,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={212,126},size={25,20},title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={212,158},size={25,20},title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={212,188},size={25,20},title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={212,221},size={25,20},title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button5,pos={212,252},size={25,20},title="\\K(65535,65535,65535)?"	Button button5,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button6,pos={212,283},size={25,20},title="\\K(65535,65535,65535)?"	Button button6,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_tab_Presentation() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(302,192,747,552)	ModifyGraph width=445,height=360,wbRGB=(49151,65535,49151),gbRGB=(49151,65535,49151)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.22 "\\Z20\\F'Times'Presentation tabpanel help menu\r"	AppendText "\\Z16The \\K(0,0,65535)Presentation tabpanel\\K(0,0,0) specializes in presentation of traces and \rmatrices. The available functions are:\r"	AppendText "\\Z16\\W549Axis legend\t\t\t\r\r\\Z16\\W549ConstOff\r\r\\Z16\\W549EF line (EDC)\t\t\t\t\r\r\\Z16\\W549EF line (image)\r\r\\Z16\\W549Group of traces\r\r\\Z16\\W549Mirror axis\r"	AppendText "\\Z16\\W549Ticks\r"	Button buttonclose,pos={191,327},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={194,93},size={25,20},title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={194,125},size={25,20},title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={194,157},size={25,20},title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={194,191},size={25,20},title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={194,221},size={25,20},title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button5,pos={194,255},size={25,20},title="\\K(65535,65535,65535)?"	Button button5,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button6,pos={194,284},size={25,20},title="\\K(65535,65535,65535)?"	Button button6,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_tab_Misc() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(184,247,644,542)	ModifyGraph width=460,height=295,wbRGB=(49151,65535,49151),gbRGB=(49151,65535,49151)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.43/Y=5.42 "\\Z20\\F'Times'Miscellaneous tabpanel help menu\r"	AppendText "\\Z16The \\K(0,0,65535)Miscellaneous tabpanel\\K(0,0,0) specializes in operations not classified in\rother subpanels. The available functions are:\r"	AppendText "\\Z16\\W549Find dispersion\t\t\t\r\r\\Z16\\W549Give area\t\r\r\\Z16\\W549RGB image\t\t\t\r\r\\Z16\\W549Rm linear bkgnd\r\r\\Z16\\W549Save and load\r"	Button buttonclose,pos={194,263},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={197,95},size={25,20},title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={197,128},size={25,20},title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={197,158},size={25,20},title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={197,190},size={25,20},title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={197,222},size={25,20},title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_0_to_NaN() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,527,341)	ModifyGraph width=240,height=170,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.42/Y=10.00 "\\Z20\\F'Times'0 to NaN\r\r\\Z16This function replaces everywhere\rin a matrix the value 0 by NaN. "	AppendText "The result is overwritten on the\roriginal matrix.\r"	Button buttonclose,pos={87,135},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_2nd_derivative() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(74,75,454,615)	ModifyGraph width=380,height=540,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=3.33 "\\Z20\\F'Times'2nd derivative\r\r\\Z16This button computes the 2nd derivative functions of"	AppendText "a matrix. The result is displayed in a new window. The\ruser first indicates the name of a matrix to derivate. He"	AppendText "also enters the level of smoothing, that is to say the size\rof the boxcar smoothing box and the number of "	AppendText "smoothing pass. Finaly, the user has the choice to \rdispaly the vertical 2nd derivative (matrix nameVD), "	AppendText "the horizontal 2nd derivative (matrix nameHD), both\rthe vertical and horizontal 2nd derivative (in different"	AppendText "windows) or one of the mixtes 2nd derivatives (matrix \rnamedVdH and matrix namedHdV).\r\rNotes: the smoothing operation is performed only"	AppendText "before the first derivative except for the mixte \rderivatives, for which it is performed before the first \rAND the second derivative. \r"	AppendText "\\K(0,0,65535)2nd derivative\\K(0,0,0) is robust for horizontal 2nd derivative \rof matrices with NaN regions on the two sides, but it is "	AppendText "robust for for vertical 2nd derivatives only for matrices\rthat have no NaN region on the high index values of the \rEDCs.\r"	AppendText "\\K(0,0,65535)2nd derivative\\K(0,0,0) displays only the negative values of the\rsecond derivatives. The user must change the color "	AppendText "limits by himself if he wants to access to the positive\rones\r"	Button buttonclose,pos={155,505},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Change_stepsize() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(327,77,692,637)	ModifyGraph width=365,height=560,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.27/Y=3.04 "\\Z20\\F'Times'Change stepsize\r"	AppendText "\\Z16\\K(0,0,65535)Change stepsize\\K(0,0,0) is a set of 3 button allowing the user\rto modify the stepsize of a matrix. In any case, the "	AppendText "user can overwrite that matrix or save it with a new\rname. \r\r\\Z18New-stepsize:\\Z16"	AppendText "When using the \\K(0,0,65535)New-stepsize\\K(0,0,0) button, the user can\rchoose to change the stepsize either in the vertical or"	AppendText "the horizontal direction. \\K(0,0,65535)New-stepsize\\K(0,0,0) interpolates\rthe matrix intensity at each new point. If the user "	AppendText "wants to save the results with another name, this new\rname is formed by adding the suffixe _nres to the old\rname. \r\r\\Z18E-comb and M-comb:\\Z16"	AppendText "The \\K(0,0,65535)E-comb\\K(0,0,0) and \\K(0,0,65535)M-comb\\K(0,0,0) allows the user to combine\rEDCs and MDCs, respectively. The stepsize then "	AppendText "becomes an integer multiple of the original one. \rWhen the user decides to combine \\K(39321,1,1)n\\K(0,0,0) EDCs or MDCs "	AppendText "and to not overwrite the old matrix named \\K(65535,0,65535)Mat\\K(0,0,0), the"	AppendText "names \\K(65535,0,65535)Mat\\K(0,0,65535)combE\\K(39321,1,1)n\\K(0,0,0) and \\K(65535,0,65535)Mat\\K(0,0,65535)combM\\K(39321,1,1)n\\K(0,0,0) are given to"	AppendText/NOCR " the \rnew matrix, respectively.\r\r\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549When the stepsize is increased by more than a "	AppendText "factor of 2, it is recommended to first use the \\K(0,0,65535)E-comb\\K(0,0,0) \rand \\K(0,0,65535)M-comb\\K(0,0,0) buttons, and only then apply the "	AppendText "\\K(0,0,65535)New-stepsize\\K(0,0,0). In this way, you take advantage of the \rreduction of the noise level, which is otherwise not "	AppendText "improved by the \\K(0,0,65535)New-stepsize\\K(0,0,0) function."	Button buttonclose,pos={147,525},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Combine_all() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(431,170,766,455)	ModifyGraph width=335,height=285,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.60/Y=5.61 "\\Z20\\F'Times'Combine all\r"	AppendText "\\Z16This function returns the average \\K(0,0,65535)cb_all1_\\K(50000,5535,10000)name\\K(0,0,0)"	AppendText "of all the EDCs of a specified matrix \\K(50000,5535,10000)name\\K(0,0,0) and\rdisplay it in a new window. To combine EDC of"	AppendText "a specific range, use \\K(0,0,65535)Combine krange\\K(0,0,0) or \\K(0,0,65535)Combine\rrange\\K(0,0,0).\r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Combine krange\r\r\\Z16\\W549Combine range\r "	Button buttonclose,pos={132,250},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={199,178},size={25,20},proc=Button_Help_Combine_krange,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={199,211},size={25,20},proc=Button_Help_Combine_range,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Combine_krange() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(782,96,1172,576)	ModifyGraph width=390,height=480,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.26/Y=3.75 "\\Z20\\F'Times'Combine krange\r"	AppendText "\\Z16Like the function\\K(0,0,65535)Combine range\\K(0,0,0), the function \\K(0,0,65535)Combine"	AppendText "krange\\K(0,0,0) is used to average EDCs of specified matrix in a\rspecified x range. However, it differs from the former by "	AppendText "the following two details. First, the range is not \rdetermined by initial and final x values, but by a range "	AppendText "size centered on a specified position. This is more \rconvinient when dealing with matrices obtained at "	AppendText "different photon energies. Second, the \\K(0,0,65535)Combine krange\\K(0,0,0)\rfunction is robust for matrices with NaN regions on the "	AppendText "edges. In that case, the average is performed over every\rvalued point at the same energy (within the specified \rmomentum range).\r"	AppendText "To operate \\K(0,0,65535)Combine krange\\K(0,0,0), enter the name of the matrix\rof interest, the output of the averaged EDC, the full width"	AppendText "of the x range for averaging as well as the central x \rposition of the range.\r\r\\Z18Complementary help:\r\r\\Z16\\W549Combine all\r"	AppendText "\\Z16\\W549Combine range\r "	Button buttonclose,pos={146,444},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={188,371},size={25,20},proc=Button_Help_Combine_all,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={188,404},size={25,20},proc=Button_Help_Combine_range,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Combine_range() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,672,566)	ModifyGraph width=385,height=395,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.26/Y=4.05 "\\Z20\\F'Times'Combine krange\r"	AppendText "\\Z16Like the function\\K(0,0,65535)Combine krange\\K(0,0,0), the function \\K(0,0,65535)Combine"	AppendText "range\\K(0,0,0) is used to average EDCs of specified matrix in a\rspecified x range. However, it differs from the former by "	AppendText "the following two details. First, the range is determined\rby initial and final x values. Second, the \\K(0,0,65535)Combine range\\K(0,0,0)"	AppendText "is not robust for matrices with NaN regions on the edges. \rIn that case  \\K(0,0,65535)Combine krange \\K(0,0,0) should be used.\r"	AppendText "To operate \\K(0,0,65535)Combine range\\K(0,0,0), enter the name of the matrix\rof interest, the output name of the averaged EDC and the "	AppendText "boundaries of the x range for averaging. Note that the \rresult is not displayed. \r\r\\Z18Complementary help:\r\r\\Z16\\W549Combine all\r"	AppendText "\\Z16\\W549Combine krange\r "	Button buttonclose,pos={165,362},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={185,288},size={25,20},proc=Button_Help_Combine_all,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={185,321},size={25,20},proc=Button_Help_Combine_krange,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Divide_by_FD() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(347,158,677,408)	ModifyGraph width=330,height=250,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=6.80 "\\Z20\\F'Times'Divide by FD\r\r\\Z16This function allows the user to divide a specific"	AppendText "matrix by an offseted Fermi-Dirac function. The\ruser enters the name of the matrix, the effective\rtemperature (in meV), which takes into account "	AppendText "the resolution of the system, and a little offset in\rorder to avoid problems above the Fermi level\rcaused by a division by 0. The function is "	AppendText "normalized in such a way that its maximum is \ralways 1.  The function overwrites the result on\rthe old matrix."	Button buttonclose,pos={132,215},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Equiv_mat() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(534,189,814,374)	ModifyGraph width=280,height=185,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=9.19 "\\Z20\\F'Times'Equiv. mat\r\r\\Z16This function is used to change the size, "	AppendText "offset and stepsize of a specified matrix\rB in order to fit the format of a reference\rmatrix A. The result is overwriten on\rmatrix B. \r   "	Button buttonclose,pos={112,150},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Fermi_Profile() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,667,436)	ModifyGraph width=380,height=265,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=6.04 "\\Z20\\F'Times'Fermi Profile\r\r\\Z16This function is used to get the position of the Fermi"	AppendText "edge along one cut. The user specifies the name of the\rmatrix, as well as the smoothing box size and the "	AppendText "number of smooth pass. The result, \\K(65535,21845,0)fermi_profile vs\rfermi_profile_x\\K(0,0,0) may be appended or not on the target"	AppendText "window. When using this function, the user must make\rsure that both Cursors A (\\Z20\\W542\\Z16) and B (\\Z20\\W512\\Z16) are active"	AppendText "on the target window, Cursor A placed on the left side\rand lower than Cursor B. The cursors delemitate the "	AppendText "y range for the position of the Fermi edge.\r "	Button buttonclose,pos={156,232},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Keep_minus() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(323,441,638,676)	ModifyGraph width=315,height=235,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=6.81 "\\Z20\\F'Times'Keep -\r\r\\Z16The \\K(0,0,65535)Keep -\\K(0,0,0) function takes a matrix specified"	AppendText "by the user, and repalce every positive value\rby either NAN (not a number) or 0, depending\ron the user's choice.\r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Keep +\r "	Button buttonclose,pos={126,202},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={141,161},size={25,20},proc=Button_Help_Keep_plus,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Keep_plus() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(296,183,611,418)	ModifyGraph width=315,height=235,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.32/Y=6.81 "\\Z20\\F'Times'Keep +\r\r\\Z16The \\K(0,0,65535)Keep +\\K(0,0,0) function takes a matrix specified"	AppendText "by the user, and repalce every negative value\rby either NAN (not a number) or 0, depending\ron the user's choice.\r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Keep -\r "	Button buttonclose,pos={131,202},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={147,161},size={25,20},proc=Button_Help_Keep_minus,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Ln_mat() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,597,321)	ModifyGraph width=310,height=150,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.32/Y=10.00 "\\Z20\\F'Times'Ln(mat)\r\r\\Z16This function computes the natural logarithm "	AppendText "of a matrix \\K(65535,21845,0)A\\K(0,0,0) and displays the result \\K(0,26214,13293)ln_\\K(65535,21845,0)A\\K(0,0,0) in\ra new window.\r"	Button buttonclose,pos={118,118},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_mat_exp_n() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,577,321)	ModifyGraph width=290,height=150,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.69/Y=10.00 "\\Z20\\F'Times'(mat)^n\r\r\\Z16This function computes the nth power of a"	AppendText "matrix \\K(65535,21845,0)A\\K(0,0,0) and displays the result \\K(65535,21845,0)A\\K(0,26214,13293)_n\\K(0,0,0) in a \rnew window.\r"	Button buttonclose,pos={112,118},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_NaN0mat3d() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,527,356)	ModifyGraph width=240,height=185,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.42/Y=9.19 "\\Z20\\F'Times'NaN0Mat3d\r\r\\Z16This function replaces everywhere"	AppendText "in the matrix \\K(0,0,65535)mat3d\\K(0,0,0) the value NaN \rby 0. This may be important if the \ruser wants to take derivatives of "	AppendText "\\K(0,0,65535)mat3d\\K(0,0,0). \r"	Button buttonclose,pos={90,151},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_NaN_to_0() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,527,341)	ModifyGraph width=240,height=170,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.42/Y=10.59 "\\Z20\\F'Times'NaN to 0\r\r\\Z16This function replaces everywhere\rin a matrix the value NaN by 0. "	AppendText "The result is overwritten on the\roriginal matrix.\r"	Button buttonclose,pos={84,135},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Norm_matrix() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,597,326)	ModifyGraph width=310,height=155,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=10.97 "\\Z20\\F'Times'Norm matrix\r\r\\Z16This function is used to normalize a specified "	AppendText "matrix by dividing it by the MDC averaged in\ra region defined by an inferior and a superior\rindexes."	Button button0close,pos={124,120},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button button0close,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Not_these_points() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(150,58,645,583)	ModifyGraph width=495,height=525,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.20/Y=2.86 "\\Z20\\F'Times'Not these points (NTP)\r"	AppendText "\\Z16This tool is to be used in combination with the mapping tool \\K(0,0,65535)Making FS\\K(0,0,0)."	AppendText "When performing an operation on EDC along the Fermi surface, the \\K(0,0,65535)NTP\\K(0,0,0)"	AppendText "function is used to exclude points from the calculation. These points"	AppendText "correspond to the index of the points in \\K(0,0,65535)Table_Making_FS\\K(0,0,0). For example, "	AppendText "they could be related to a Fermi surface sheet different than the one of \rinterest.\r"	AppendText "The user can create as much of \\K(0,0,65535)NTP waves\\K(0,0,0) as he wants, called \\K(0,0,65535)NTP\\K(60000,0,35535)index\\K(0,0,0). "	AppendText "The active wave is the one whose \\K(60000,0,35535)index\\K(0,0,0) appears in the \\K(0,0,65535)NTP box\\K(0,0,0) of the "	AppendText "\\K(0,0,65535)Tools menu\\K(0,0,0), which can be changed by the user. To create a new \\K(0,0,65535)NTP "	AppendText "wave\\K(0,0,0), just press the \\K(0,0,65535)New\\K(0,0,0) botton in the \\K(0,0,65535)NTP box\\K(0,0,0). Furthermore, it is"	AppendText "recommended to use the \\K(0,0,65535)NTP_comments\\K(0,0,0) text wave in order to keep "	AppendText "record of the use of the corresponding \\K(0,0,65535)NTP wave\\K(0,0,0), by writing the use of "	AppendText "\\K(0,0,65535)NTP\\K(60000,0,35535)index\\K(0,0,0) in the \\K(60000,0,35535)index\\K(0,0,0)th cell of \\K(0,0,65535)NTP_comments\\K(0,0,0).\r"	AppendText "\\Z18Complementary help:\r\r\\Z16\\W549DOS at kF vs \\F'symbol'q\\F'Times'\r\r\\Z16\\W549Leading Edge kF\r\r\\Z16\\W549Making FS\r\r\\Z16\\W549Plot kF EDCs\r"	AppendText "\\Z16\\W549Sym kF EDCs\r "	Button buttonclose,pos={219,492},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={236,321},size={25,20},title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={236,353},size={25,20},title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={236,386},size={25,20},title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={236,418},size={25,20},title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={236,448},size={25,20},title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Point_reader() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(191,102,491,542)	ModifyGraph width=300,height=440,wbRGB=(65535,65532,16385),gbRGB=(65535,65532,16385)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.33/Y=3.64 "\\Z20\\F'Times'Point reader help menu\r\r\\Z16The Point reader panel is used to digitize or "	AppendText "draw curves.It has the following functions\rand buttons: \r\r\\Z16\\W549Append pnts\t\t\t\r\t\r\\Z16\\W549Delete all\t\t\r\r\\Z16\\W549Delete last\t\t\r"	AppendText "\\Z16\\W549New band\r\r\\Z16\\W549num_of_band\r\r\\Z16\\W549Plot\r\r\\Z16\\W549Read point\r\t\t\t\r\\Z16\\W549Show Table\r\r\\Z16\\W549Sort\r"	Button buttonclose,pos={118,406},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={184,109},size={25,20},proc=Button_Help_Append_pnts,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={184,139},size={25,20},proc=Button_Help_Delete_all,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button2,pos={184,171},size={25,20},proc=Button_Help_Delete_last,title="\\K(65535,65535,65535)?"	Button button2,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button3,pos={184,201},size={25,20},proc=Button_Help_New_band,title="\\K(65535,65535,65535)?"	Button button3,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button4,pos={184,235},size={25,20},proc=Button_Help_num_of_band,title="\\K(65535,65535,65535)?"	Button button4,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button5,pos={184,267},size={25,20},proc=Button_Help_Plot_Point_reader,title="\\K(65535,65535,65535)?"	Button button5,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button6,pos={184,298},size={25,20},proc=Button_Help_Read_point,title="\\K(65535,65535,65535)?"	Button button6,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button7,pos={184,330},size={25,20},proc=Button_Help_PointreaderShowtbl,title="\\K(65535,65535,65535)?"	Button button7,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button8,pos={184,362},size={25,20},proc=Button_Help_Point_Reader_Sort,title="\\K(65535,65535,65535)?"	Button button8,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Append_pnts() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(215,250,505,515)	ModifyGraph width=290,height=265,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=6.04 "\\Z20\\F'Times'Append pnts\r\r\\Z16When this button is pressed, the curve "	AppendText "\\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0) vs \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0), where \\K(65535,0,52428)n\\K(0,0,0) corresponds"	AppendText "to the index associated with \\K(0,0,65535)num_of_band\\K(0,0,0)\rin the \\K(0,0,65535)Point reader panel\\K(0,0,0), is appended on"	AppendText "the target window. \\K(0,0,65535)Band_e\\K(65535,0,52428)n\\K(0,0,0) and \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0)"	AppendText "are given in the table \\K(0,0,65535)Table_all_bands\\K(0,0,0).\r\r\\Z18Complementary help:\r\r\\Z16\\W549Point reader help menu\r "	Button buttonclose,pos={117,233},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={224,193},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Delete_all() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(601,162,896,447)	ModifyGraph width=295,height=285,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=5.61 "\\Z20\\F'Times'Delete all\r\r\\Z16When this function removes all the points "	AppendText "of the curve \\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0) vs \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0), where \\K(65535,0,52428)n\\K(0,0,0)"	AppendText "corresponds to the index associated with \r\\K(0,0,65535)num_of_band\\K(0,0,0) in the \\K(0,0,65535)Point reader panel\\K(0,0,0). "	AppendText "However, it does not kill the corresponding"	AppendText "waves. \\K(0,0,65535)Band_e\\K(65535,0,52428)n\\K(0,0,0) and \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0) are given"	AppendText "and remain in the table \\K(0,0,65535)Table_all_bands\\K(0,0,0).\r\r\\Z18Complementary help:\r\r\\Z16\\W549Point reader help menu\r "	Button buttonclose,pos={117,252},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={214,209},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Delete_last() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(298,163,593,448)	ModifyGraph width=295,height=285,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-1.02/Y=5.96 "\\Z20\\F'Times'Delete last\r\r\\Z16When this function removes the last point "	AppendText "of the curve \\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0) vs \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0), where \\K(65535,0,52428)n\\K(0,0,0)"	AppendText "corresponds to the index associated with \r\\K(0,0,65535)num_of_band\\K(0,0,0) in the \\K(0,0,65535)Point reader panel\\K(0,0,0). "	AppendText "Points can also be removed manually from"	AppendText "\\K(0,0,65535)Band_e\\K(65535,0,52428)n\\K(0,0,0) and \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0) which are given"	AppendText "in the table \\K(0,0,65535)Table_all_bands\\K(0,0,0).\r\r\\Z18Complementary help:\r\r\\Z16\\W549Point reader help menu\r "	Button button0,pos={211,209},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button buttonclose,pos={118,250},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_New_band() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(434,142,724,427)	ModifyGraph width=290,height=285,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=5.61 "\\Z20\\F'Times'New band\r\r\\Z16The \\K(0,0,65535)New band\\K(0,0,0) button of the \\K(0,0,65535)Point reader"	AppendText "panel\\K(0,0,0) is used to create two new waves of"	AppendText "size 0: \\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0) and \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0), where \\K(65535,0,52428)n\\K(0,0,0)"	AppendText "corresponds to the index associated with \r\\K(0,0,65535)num_of_band\\K(0,0,0) in the \\K(0,0,65535)Point reader panel\\K(0,0,0). "	AppendText "The new waves are autmatically appended \rin the table \\K(0,0,65535)Table_all_bands\\K(0,0,0).\r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Point reader help menu\r "	Button buttonclose,pos={117,251},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={204,210},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_num_of_band() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(535,174,840,554)	ModifyGraph width=305,height=380,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.33/Y=4.21 "\\Z20\\F'Times'num_of_band\r\r\\Z16 \\K(0,0,65535)num_of_band \\K(0,0,0) is an index that can be"	AppendText "changed by the user in order to specify on\rwhich waves he intends to perform\roperations such as adding or deleting"	AppendText "points, plotting curves, and more. When\rthe value \\K(65535,0,52428)n\\K(0,0,0) of  the  \\K(0,0,65535)num_of_band \\K(0,0,0) index is"	AppendText "active, operations are performed on the"	AppendText "waves  \\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0) and \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0). "	AppendText "However, the waves must exist in order to\ractivate these operations. To create these"	AppendText "waves, the user must first use the  \\K(0,0,65535)New band \\K(0,0,0)\rbutton. The new waves will also appear in"	AppendText "the table \\K(0,0,65535)Table_all_bands\\K(0,0,0).\r\r\\Z18Complementary help:\r\r\\Z16\\W549Point reader help menu\r "	Button buttonclose,pos={120,347},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={212,306},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Plot_Point_reader() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(759,143,1074,428)	ModifyGraph width=315,height=285,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.32/Y=5.96 "\\Z20\\F'Times'Plot\r"	AppendText "\\Z16The \\K(0,0,65535)Plot\\K(0,0,0) function of the \\K(0,0,65535)Point reader panel\\K(0,0,0)"	AppendText "displays in a new window \\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0) vs"	AppendText "\\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0), where \\K(65535,0,52428)n\\K(0,0,0) is the active index of"	AppendText "\\K(0,0,65535)num_of_band\\K(0,0,0). To append the plot in the target\rwindow, use \\K(0,0,65535)Append pnts\\K(0,0,0) instead.\r"	AppendText "\\Z18Complementary help:\r\r\\Z16\\W549Append pnts\r\r\\Z16\\W549Point reader help menu\r "	Button buttonclose,pos={126,250},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={212,176},size={25,20},proc=Button_Help_Append_pnts,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button button1,pos={212,208},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button1,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Read_point() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(506,59,936,574)	ModifyGraph width=430,height=515,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.23/Y=3.11 "\\Z20\\F'Times'Read point\r"	AppendText "\\Z16\\K(0,0,65535)Read point\\K(0,0,0) is the central function of the \\K(0,0,65535)Point reader panel\\K(0,0,0)."	AppendText "When the button \\K(0,0,65535)Read point\\K(0,0,0) is pressed, a point will be added"	AppendText "at the end of both \\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0) and \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0), where \\K(65535,0,52428)n\\K(0"	AppendText/NOCR ",0,0) corresponds\rto the index associated with \\K(0,0,65535)num_of_band\\K(0,0,0) in the \\K(0,0,65535)Point reader"	AppendText "panel\\K(0,0,0). The corresponding values given to these new points \rwill be the y-value and x-value of cursor A (\\Z20\\W542\\Z16) in the target"	AppendText "window. The user can delete his last entry by using the \\K(0,0,65535)Delete"	AppendText "last\\K(0,0,0) function. In order to work, the waves \\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0) and \\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0"	AppendText/NOCR ",0)\rmust have been created using the \\K(0,0,65535)New band\\K(0,0,0) function, and cursor\rA must be on the target window.\r"	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549It is a good idea to append the points on a graph will "	AppendText "using \\K(0,0,65535)Read Point\\K(0,0,0). Use the \\K(0,0,65535)Append pnts\\K(0,0,0) function.\r"	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\K(0,0,0)\\F'Times'\\W549It is sometime necessary to create a fictive matrix, filled"	AppendText "with 0 or NAN elements and to put the cursor on that matrix.\rIn this way, the cursor can move more freely.\r"	AppendText "\\K(65535,0,65535)\\F'Wingdings'L\\K(0,0,0)\\F'Times'\\W549While it is often a good thing to do to sort the data read,"	AppendText "the user should avoid this procedure when the curve is not a\rfunction.\r \r \\Z18Complementary help:\r\r\\Z16\\W549Point reader help menu\r "	Button buttonclose,pos={185,481},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={242,438},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Point_reader_Show_table() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(725,145,1065,430)	ModifyGraph width=340,height=285,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.59/Y=5.61 "\\Z20\\F'Times'Show table\r\r\\Z16This button of the \\K(0,0,65535)Point reader panel\\K(0,0,0) is use to send"	AppendText "to the front the table called \\K(0,0,65535)Table_all_bands\\K(0,0,0). This \rtable contains all the waves created with the\\K(0,0,65535)New"	AppendText "band\\K(0,0,0) function. These bands are of two types: the "	AppendText "first have the form \\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0), where \\K(65535,0,52428)n\\K(0,0,0) is an integer,"	AppendText "and correspond to y-waves. The others, called \r\\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0), are associated to x-waves.\r"	AppendText "\\Z18Complementary help:\r\r\\Z16\\W549Point reader help menu\r "	Button buttonclose,pos={137,251},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={219,209},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Point_reader_Sort() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(885,395,1180,645)	ModifyGraph width=295,height=250,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=6.40 "\\Z20\\F'Times'Sort\r\r\\Z16The sort function of the \\K(0,0,65535)Point reader\\K(0,0,0) panel"	AppendText "is use to sort the waves \\K(0,0,65535)band_e\\K(65535,0,52428)n\\K(0,0,0) and"	AppendText "\\K(0,0,65535)band_k\\K(65535,0,52428)n\\K(0,0,0), where \\K(65535,0,52428)n\\K(0,0,0) is the active index of"	AppendText "\\K(0,0,65535)num_of_band\\K(0,0,0) in the \\K(0,0,65535)Point reader panel\\K(0,0,0). "	AppendText "The sorting is performed with priority on \\K(65535,0,52428)n\\K(0,0,0).\r\r\\Z18Complementary help:\r\r\\Z16\\W549Point reader help menu\r"	Button buttonclose,pos={129,218},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={199,175},size={25,20},proc=Button_Help_Point_reader,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************Window Help_Rotate_image() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(548,135,863,510)	ModifyGraph width=315,height=375,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.32/Y=4.00 "\\Z20\\F'Times'Rotate image\r\r\\Z16When using this function, the user must first"	AppendText "specify the name of the matrix to rotate. Then,\rhe enters he rotation angle (in degrees,\rclockwise rotation), the x and y coordinates of"	AppendText "the pivot point around which the rotation is \rperformed. A last number to enter is the so-\rcalled quality factor. When a quality factor of"	AppendText "1 is used, a new grid with equivalent x and\ry stepsize will by created in such a way that\rthe total number of points is preserved. A "	AppendText "quality factor of n will reduce the stepsize by\ra factor of n and make the figure look nicer.\rHowever, a higher quality factor implies a"	AppendText "longer calculation time. The result of the\rrotation of the matrix \\K(29524,1,58982)A\\K(0,0,0) by \\K(2,39321,1)angle\\K(0,0,0) degrees"	AppendText "called \\K(29524,1,58982)A\\K(0,0,0)_rot_\\K(2,39321,1)angle\\K(0,0,0), is displayed in a new\rwindow. \r "	Button buttonclose,pos={126,343},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_Smooth_mat() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,632,436)	ModifyGraph width=345,height=265,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.29/Y=6.04 "\\Z20\\F'Times'Smooth mat\r"	AppendText "\\Z16\\K(0,0,65535)Smooth mat\\K(0,0,0) is used to smooth a specified matrix \\K(29524,1,58982)A\\K(0,0,0)\raccording to the command:\r"	AppendText "Smooth/E=3/B=\\K(2,39321,1)n_pass\\K(0,0,0) \\K(65535,0,52428)box_size\\K(0,0,0), \\K(29524,1,58982)A\\K(0,0,0)\r"	AppendText "where \\K(2,39321,1)n_pass\\K(0,0,0) and \\K(65535,0,52428)box_size\\K(0,0,0) are the number of pass"	AppendText "and the boxcar box size, respectivelly. Both are \rgiven by the user, who can also choose to smooth"	AppendText "in the vertical, horizontal or both directions. The\rresult is overwritten.\r"	Button buttonclose,pos={140,231},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//**********************************************************************************************************************Window Help_symetrize_EDC_mat() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,627,436)	ModifyGraph width=340,height=265,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=6.04 "\\Z20\\F'Times'Symetrize EDC mat\r\r\\Z16This function assumes the particule-hole symetry"	AppendText "around the Fermi vector to remove the Fermi\rfunction by symetrization with respect to the\rFermi level. The matrix MUST be scaled with the"	AppendText "chemical potential at 0. The user enters the name\r\\K(29524,1,58982)A\\K(0,0,0) of the matrix he wants to symetrize and the,"	AppendText "result, called \\K(29524,1,58982)A\\K(2,39321,1)sym\\K(0,0,0), is displayed in a new window.\r"	AppendText "\\K(65535,0,65535)\\F'Wingdings'L\\K(0,0,0)\\F'Times'\\W549This function has no real physical meaning\raway from the Fermi vector and should not be"	AppendText "used withouth good reason."	Button button0close,pos={139,232},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button button0close,fSize=16,fStyle=16EndMacro//*******************************************************************************************************************************Window Help_Bkgndremover_Wave_in() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(670,308,965,643)	ModifyGraph width=295,height=335,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.34/Y=5.07 "\\Z20\\F'Times'Wave in -- Select from list\r\r\\Z16When using the \\K(0,0,65535)Background remover\\K(0,0,0), the"	AppendText "first thing to do is to specify the name of\rthe wave from which a background has to\rbe extracted and there are two ways to "	AppendText "perform this operation. The first is the use\rthe\\K(0,0,65535) Wave In\\K(0,0,0) button and to type the name of\rthe wave. The second is to use the "	AppendText "corresponding \\K(0,0,65535)Select from list\\K(0,0,0) button and \rchoose the list of all the active numerical\rwaves.\r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Background remover\r "	Button buttonclose,pos={118,299},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={216,258},size={25,20},proc=Button_HELPbackgroundremover,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//*******************************************************************************************************************************Window Help_Bkgndremover_Add_pnt() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,572,446)	ModifyGraph width=285,height=275,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=6.91 "\\Z20\\F'Times'Add pnt\r\r\\Z16The \\K(0,0,65535)Add pnt\\K(0,0,0) button allows to enter a point"	AppendText "in the background curve at the position of\rcursor A (\\Z20\\W542\\Z16), which must be active.\r"	AppendText "\\K(65535,0,0)\\F'Wingdings'J\\Z16\\K(0,0,0)\\W549\\F'Times': \\K(0,0,0)Put the cursor on \rblank_bkgndremover.\r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Background remover\r "	Button buttonclose,pos={114,238},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={211,197},size={25,20},proc=Button_HELPbackgroundremover,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//*******************************************************************************************************************************Window Help_Bkgndremover_Bkgnd_in() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(24,83,434,368)	ModifyGraph width=410,height=285,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=0.00/Y=5.96 "\\Z20\\F'Times'Bkgnd in--Select from list\r"	AppendText "\\Z16The user can model the backgrnound curve using the \\K(0,0,65535)Add pnt\\K(0,0,0)"	AppendText "and \\K(0,0,65535)Delete pnt\\K(0,0,0) buttons, but he can also start with an existing"	AppendText "wave. In this case, he can use the \\K(0,0,65535)Bkgnd in\\K(0,0,0) button and type\rthe name of the wave he wants to use for background, or "	AppendText "use the corresponding \\K(0,0,65535)Select from list\\K(0,0,0), which show the list of"	AppendText "all the waves that have same limits and size as the wave from\rwhich the background has to be removed.\r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Background remover\r "	Button button0,pos={258,210},size={25,20},proc=Button_HELPbackgroundremover,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)	Button buttonclose,pos={175,252},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16EndMacro//*******************************************************************************************************************************Window Help_bkgndremover_Delete_pnt() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,567,406)	ModifyGraph width=280,height=235,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/H=8/B=1/A=MC/X=0.36/Y=6.38 "\\Z20\\F'Times'Delete pnt\r\r\\Z16The \\K(0,0,65535)Delete pnt\\K(0,0,0) button allows to remove a"	AppendText "point in the background curve at closest \rhorizontal position from cursor A (\\Z20\\W542\\Z16), \rwhich must be active.\r\r\\Z18Complementary help:\r"	AppendText "\\Z16\\W549Background remover\r "	Button buttonclose,pos={111,203},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={172,162},size={25,20},proc=Button_HELPbackgroundremover,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//*******************************************************************************************************************************Window Help_bkgndremover_Save_backgnd() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(287,171,607,426)	ModifyGraph width=320,height=255,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/H=8/B=1/A=MC/X=0.00/Y=6.67 "\\Z20\\F'Times'Save background\r"	AppendText "\\Z16This function will save with the name \\K(65535,0,52428)A\\K(2,39321,1)_bkgnd\\K(0,0,0)\rthe background curve associated with the active"	AppendText "wave \\K(65535,0,52428)A\\K(0,0,0). The background curve, which is built\rto have the same size and scaling as wave \\K(65535,0,52428)A\\K(0,0,0), is"	AppendText "displayed in a new window.\r\r\\Z18Complementary help:\r\r\\Z16\\W549Background remover\r "	Button buttonclose,pos={128,219},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={189,178},size={25,20},proc=Button_HELPbackgroundremover,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//*******************************************************************************************************************************Window Help_bkgndremover_Save_result() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(545,258,825,528)	ModifyGraph width=280,height=270,wbRGB=(61166,61166,61166),gbRGB=(61166,61166,61166)	TextBox/C/N=text0/S=1/M/B=1/A=MC/X=-0.71/Y=6.30 "\\Z20\\F'Times'Save result\r\r\\Z16This function will save with the name "	AppendText "\\K(65535,0,52428)A\\K(2,39321,1)_bkgndless\\K(0,0,0) the result of the subtraction\rof the background curve from the active"	AppendText "wave \\K(65535,0,52428)A\\K(0,0,0). The resulting curve, which is\rbuilt to have the same size and scaling as"	AppendText "wave \\K(65535,0,52428)A\\K(0,0,0), is displayed in a new window.\r\r\\Z18Complementary help:\r\r\\Z16\\W549Background remover\r "	Button buttonclose,pos={115,235},size={60,30},proc=ButtonProc_closethiswindow,title="Close"	Button buttonclose,fSize=16,fStyle=16	Button button0,pos={197,193},size={25,20},proc=Button_HELPbackgroundremover,title="\\K(65535,65535,65535)?"	Button button0,fSize=15,fStyle=16,fColor=(16385,16388,65535)EndMacro//**********************************************************************************************************************///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////End of Pierre's macros//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////"""""""""""""""""""""""""EMDC_Visualizer"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$Variable/G EMDC_EDCVariable/G EMDC_MDCVariable/G EMDC_SFVariable/G EMDC_combineVariable/G EMDC_ChoiceVariable/G EMDC_openfirstString/G EMDC_name//**********************************************************************************************************************Function ButtonProc_EMDC(ctrlName) : ButtonControl	String ctrlName	IF(Wintype("EMDC_Visualizer_Control")==0)		Execute "EMDC_ini()"		Execute "EMDC_Visualizer_Control()"		Else			Dowindow/F EMDC_Visualizer_Control	EndifEnd//**********************************************************************************************************************Function ButtonProc_EMDC_insertmat(ctrlName) : ButtonControl	String ctrlName	Execute "EMDC_insertmat()"End//**********************************************************************************************************************Function ButtonProc_EMDC_Showwave(ctrlName) : ButtonControl	String ctrlName	Execute "EMDC_Showwave()"End//**********************************************************************************************************************Function ButtonProc_selectlistEMDC(ctrlName) : ButtonControl	String ctrlName	Execute "selectlistEMDC()"End//**********************************************************************************************************************Proc selectlistEMDC()	Pauseupdate;Silent 1	String/G name4EMDC_name	String/G listnameofallmatricesEMDC	String listnameofallmatrices1	variable i	Variable numoflist	listnameofallmatrices1=wavelist("*",";","Dims:2,TEXT:0")	numoflist=Itemsinlist(listnameofallmatrices1,";")	Make/O/T/N=(numoflist) temptextwave	i=0	Do		temptextwave[i]=StringFromList(i, listnameofallmatrices1, ";") 		i+=1	While(i<numoflist)	sort temptextwave,temptextwave	listnameofallmatricesEMDC=temptextwave[0]	i=1	Do		listnameofallmatricesEMDC+=";"+temptextwave[i]		i+=1	While(i<numoflist)	killwaves temptextwave//	name4EMDC_name=StringFromList(0, listnameofallmatrices, ";")	selectlistEMDC2()End//**********************************************************************************************************************Proc selectlistEMDC2(newname)	String newname	Prompt newname,"Matrix in:",popup listnameofallmatricesEMDC		Pauseupdate;Silent 1	String/G listnameofallmatricesEMDC	EMDC_insertmat(newname)End//**********************************************************************************************************************Proc EMDC_ini()	Pauseupdate	Silent 1	Variable/G EMDC_EDC	Variable/G EMDC_MDC		Variable/G EMDC_SF	Variable/G EMDC_combine	Variable/G EMDC_Choice	Variable/G EMDC_openfirst	Variable/G EMDCmulti	Variable/G EMDCdivlast	String/G EMDC_name	EMDC_EDC=0	EMDC_MDC=0	EMDC_SF=0		EMDC_combine=1	EMDC_Choice=1	EMDC_openfirst=0	EMDCmulti=1	EMDCdivlast=0	EMDC_name="N/A"END//**********************************************************************************************************************Window EMDC_Visualizer_Control() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(464,225,937,644)	ShowInfo	ControlBar 101	SetVariable setvaredc,pos={138,4},size={120,18},disable=2,proc=SetVarProc_EMDC_changeEDC,title="EDC slice"	SetVariable setvaredc,fSize=12,limits={0,119,1},value= EMDC_EDC,live= 1	SetVariable setvarMDC,pos={138,26},size={120,18},disable=2,proc=SetVarProc_EMDC_changeMDC,title="MDC slice"	SetVariable setvarMDC,fSize=12,limits={0,425,1},value= EMDC_MDC,live= 1	SetVariable setvarsmooth,pos={265,4},size={100,18},disable=2,proc=SetVarProc_EMDC_change_SF,title="Smooth"	SetVariable setvarsmooth,fSize=12,limits={0,inf,1},value= EMDC_SF,live= 1	SetVariable setvarcombine,pos={9,26},size={120,18},disable=2,proc=SetVarProc_EMDC_changecmbine,title="Combine"	SetVariable setvarcombine,fSize=12,limits={1,inf,1},value= EMDC_combine,live= 1	PopupMenu popupEDCMDC,pos={103,52},size={51,20},disable=2,proc=PopMenuProc_EMDC_choice	PopupMenu popupEDCMDC,mode=1,popvalue="EDC",value= #"\"EDC;MDC\""	Button buttonInsert,pos={4,52},size={90,20},proc=ButtonProc_EMDC_insertmat,title="Insert Matrix"	Button buttonshow,pos={6,3},size={75,20},disable=2,proc=ButtonProc_EMDC_Showwave,title="\\K(65535,0,0)Show wave"	Button ButtontableEMDC,pos={272,27},size={50,20},disable=2,proc=Button_makeEMDCtable,title="Table"	PopupMenu multi_onoff,pos={160,53},size={138,20},disable=2,proc=PopMenuProc_EMDConoff,title="Multi-matrices"	PopupMenu multi_onoff,fSize=12,mode=1,popvalue="OFF",value= #"\"OFF;ON\""	Button displaymulti,pos={327,26},size={100,20},disable=2,proc=Button_EMDC_Showmulti,title="Display multi"	PopupMenu popupdiv,pos={324,53},size={100,20},disable=2,proc=PopMenuProc_EMDCdiv,title="/ by last"	PopupMenu popupdiv,fSize=12,mode=1,popvalue="NO",value= #"\"NO;YES\""	ValDisplay valdisp0,pos={103,77},size={200,14},format="N/A"	ValDisplay valdisp0,limits={0,0,0},barmisc={0,1000},value= #"0"	Button button0,pos={4,75},size={90,20},proc=ButtonProc_selectlistEMDC,title="\\K(65535,0,0)From list"EndMacro//**********************************************************************************************************************Proc EMDC_changeEDC()	Pauseupdate	Silent 1	Variable/G EMDC_EDC	Variable/G EMDC_SF	Variable/G EMDC_combine	Variable/G EMDC_choice	Variable/G EMDCmulti	Variable/G EMDCdivlast	String thismultiname,thismultiwave,multilast	Variable index_first,index_last	variable xfirst,xlast	variable i,j	Variable indexnormf,indexnormt	Make/O/N=(dimsize(EMDC_matrix,1)) EMDC_wave	Setscale/P x,dimoffset(EMDC_matrix,1),dimdelta(EMDC_matrix,1),""EMDC_wave	If(EMDC_choice==1)		index_first=EMDC_EDC-(EMDC_combine-1)/2		if(mod(index_first,1)!=0)			Index_first=Floor(index_first)		Endif		If(index_first<0)			index_first=0		Endif		index_last=EMDC_EDC+(EMDC_combine-1)/2		if(mod(index_last,1)!=0)			index_last=Floor(index_last)		Endif			If(index_last>dimsize(EMDC_matrix,0)-1)			index_last=dimsize(EMDC_matrix,0)-1		Endif		EMDC_wave[]=0		i=index_first		Do			EMDC_wave[]+=EMDC_matrix[i][p]					i+=1		While(i<index_last+1)		EMDC_wave[]/=EMDC_combine		IF(EMDC_SF>0)			Smooth/E=3/B=(EMDC_SF) EMDC_SF,EMDC_wave		Endif		xfirst=dimoffset(EMDC_matrix,0)+index_first*(dimdelta(EMDC_matrix,0))		xlast=dimoffset(EMDC_matrix,0)+index_last*(dimdelta(EMDC_matrix,0))			EMDC_adjustEDClines(EMDC_left,EMDC_right,xfirst,xlast)		EMDC_leftheight[0]=dimoffset(EMDC_matrix,1)		EMDC_leftheight[1]=dimoffset(EMDC_matrix,1)+(dimsize(EMDC_matrix,1)-1)*(dimdelta(EMDC_matrix,1))		Duplicate/O EMDC_leftheight EMDC_rightheight		IF(EMDCmulti==2)			j=0			Do				thismultiname=EMDClist[j]				thismultiwave="EMDCmulti"+num2str(j)				Make/O/N=(dimsize($thismultiname,1)) $thismultiwave				Setscale/P x,dimoffset($thismultiname,1),dimdelta($thismultiname,1),""$thismultiwave				$thismultiwave[]=0				index_first=EMDC_EDC-(EMDCcombinelist[j]-1)/2				if(mod(index_first,1)!=0)					Index_first=Floor(index_first)				Endif				If(index_first<0)					index_first=0				Endif				index_last=EMDC_EDC+(EMDCcombinelist[j]-1)/2				if(mod(index_last,1)!=0)					index_last=Floor(index_last)				Endif					If(index_last>dimsize($thismultiname,0)-1)					index_last=dimsize($thismultiname,0)-1				Endif				i=index_first				DO					$thismultiwave[]+=$thismultiname[i][p]					i+=1				While(i<index_last+1)				$thismultiwave[]/=EMDCcombinelist[j]				Wavestats/Q/R=(EMDCnormfrom[j],EMDCnormto[j]) $thismultiwave				$thismultiwave[]/=V_avg				IF(EMDCsmooth[j]>0)					Smooth/E=3/B=(EMDCsmooth[j]) EMDCsmooth[j],$thismultiwave				Endif								j+=1			While(j<dimsize(EMDClist,0))			If(EMDCdivlast==1)				multilast=	"EMDCmulti"+num2str(dimsize(EMDClist,0)-1)							j=0				Do					thismultiwave="EMDCmulti"+num2str(j)					Duplicate/O $multilast tttempwave					transform2equiv_waves(thismultiwave,"tttempwave")					$thismultiwave[]/=tttempwave[p]					killwaves tttempwave					j+=1				While(j<dimsize(EMDClist,0)-1)			Endif		Endif	EndifEnd//**********************************************************************************************************************Proc EMDC_changeMDC()	Pauseupdate	Silent 1	Variable/G EMDC_MDC	Variable/G EMDC_SF	Variable/G EMDC_combine	Variable/G EMDC_choice	Variable index_first,index_last	variable xfirst,xlast	variable i	Make/O/N=(dimsize(EMDC_matrix,0)) EMDC_wave	Setscale/P x,dimoffset(EMDC_matrix,0),dimdelta(EMDC_matrix,0),""EMDC_wave	If(EMDC_choice==2)		index_first=EMDC_MDC-(EMDC_combine-1)/2		if(mod(index_first,1)!=0)			Index_first=Floor(index_first)		Endif		If(index_first<0)			index_first=0		Endif		index_last=EMDC_MDC+(EMDC_combine-1)/2		if(mod(index_last,1)!=0)			index_last=Floor(index_last)		Endif			If(index_last>dimsize(EMDC_matrix,1)-1)			index_last=dimsize(EMDC_matrix,1)-1		Endif		EMDC_wave[]=0		i=index_first		Do			EMDC_wave[]+=EMDC_matrix[p][i]					i+=1		While(i<index_last+1)		EMDC_wave[]/=EMDC_combine		IF(EMDC_SF>0)			Smooth/E=3/B=(EMDC_SF) EMDC_SF,EMDC_wave		Endif		xfirst=dimoffset(EMDC_matrix,1)+index_first*(dimdelta(EMDC_matrix,1))		xlast=dimoffset(EMDC_matrix,1)+index_last*(dimdelta(EMDC_matrix,1))			EMDC_adjustMDClines(EMDC_leftheight,EMDC_rightheight,xfirst,xlast)		EMDC_left[0]=dimoffset(EMDC_matrix,0)		EMDC_left[1]=dimoffset(EMDC_matrix,0)+(dimsize(EMDC_matrix,0)-1)*(dimdelta(EMDC_matrix,0))		Duplicate/O EMDC_left EMDC_right	EndifEnd//**********************************************************************************************************************Function SetVarProc_EMDC_changeEDC(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	NVAR EMDC_EDC	EMDC_EDC=varNum	Execute "EMDC_changeEDC()"End//**********************************************************************************************************************Function SetVarProc_EMDC_changeMDC(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	NVAR EMDC_MDC	EMDC_MDC=varNum	Execute "EMDC_changeMDC()"End//**********************************************************************************************************************Function EMDC_adjustEDClines(Waveleft,Waveright,startvalue,endvalue)	Wave Waveleft	Wave Waveright	Variable startvalue	Variable endvalue	Pauseupdate;Silent 1	Waveleft[]=startvalue	Waveright[]=endvalueEND//**********************************************************************************************************************Function EMDC_adjustMDClines(Wavelow,Wavehigh,startvalue,endvalue)	Wave Wavelow	Wave Wavehigh	Variable startvalue	Variable endvalue	Pauseupdate;Silent 1	Wavelow[]=startvalue	Wavehigh[]=endvalueEND//**********************************************************************************************************************Function SetVarProc_EMDC_changecmbine(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	NVAR EMDC_Combine	NVAR EMDC_choice	EMDC_Combine=varNum	If(EMDC_choice==1)		Execute "EMDC_changeEDC()"		Else			Execute "EMDC_changeMDC()"	EndifEnd//**********************************************************************************************************************Function SetVarProc_EMDC_change_SF(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	NVAR EMDC_SF	NVAR EMDC_choice	EMDC_SF=varNum	If(EMDC_choice==1)		Execute "EMDC_changeEDC()"		Else			Execute "EMDC_changeMDC()"	EndifEnd//**********************************************************************************************************************Proc EMDC_insertmat(matname)	String matname	Prompt matname,"Insert the name of the matrix"	Pauseupdate;Silent 1	String/G EMDC_name		String/G colordefault	Variable/G colordefaultinv	Variable/G EMDC_openfirst	EMDC_name=matname	Valdisplay valdisp0 format=EMDC_name	Duplicate/O $matname EMDC_matrix	Setvariable setvarEDC limits={0,dimsize(EMDC_matrix,0)-1,1}	Setvariable setvarMDC limits={0,dimsize(EMDC_matrix,1)-1,1}		If(EMDC_openfirst==1)		EMDC_changeEDC()		Else				EMDC_putVline()			Appendimage EMDC_matrix			ModifyImage EMDC_matrix ctab= {*,*,$colordefault,colordefaultinv}			EMDC_changeEDC()			EMDC_openfirst=1			Setvariable setvaredc disable=0			Setvariable setvarmdc disable=0			Setvariable setvarsmooth disable=0			Setvariable setvarcombine disable=0			Button buttonshow disable=0			Button displaymulti disable=0			Button ButtontableEMDC disable=0			PopupMenu multi_onoff disable=0			PopupMenu popupdiv disable=0			PopupMenu PopupEDCMDC disable=0	EndifEnd//**********************************************************************************************************************Proc EMDC_putVline()	Pauseupdate;Silent 1	Make/O/N=2 EMDC_leftheight	Make/O/N=2 EMDC_rightheight	Make/O/N=2 EMDC_left	Make/O/N=2 EMDC_right	Appendtograph EMDC_leftheight vs EMDC_left	Appendtograph EMDC_rightheight vs EMDC_rightEnd//**********************************************************************************************************************Proc EMDC_Showwave()	Pauseupdate;Silent 1	If(Wintype("EMDC_Display")==0)		Display EMDC_wave;Dowindow/C EMDC_Display;Dowindow/F EMDC_Visualizer_control		Else			Dowindow/F EMDC_Display;Dowindow/F EMDC_Visualizer_control	EndifEnd//**********************************************************************************************************************Function PopMenuProc_EMDC_choice(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	NVAR EMDC_choice	EMDC_choice=popNum	IF(popnum==2)		Execute"EMDC_changeMDC()"		Else			Execute"EMDC_changeEDC()"	EndifEnd//********************************************************************************************************************************Proc makeEMDCtable()	Pauseupdate	Silent 1	If(Wintype("EMDC_table")==0)		If(Exists("EMDClist")==0)			Make/O/T/N=0 EMDClist			Make/O/T/N=0 EMDCname			Make/O/N=0 EMDCcombinelist			Make/O/N=0 EMDCsmooth			Make/O/N=0 EMDCnormfrom			Make/O/N=0 EMDCnormto						Edit EMDClist,EMDCname,EMDCcombinelist,EMDCsmooth,EMDCnormfrom,EMDCnormto			Dowindow/C EMDC_table			Else				Edit EMDClist,EMDCname,EMDCcombinelist,EMDCsmooth,EMDCnormfrom,EMDCnormto				Dowindow/C add_data_table		Endif		Else		Dowindow/F EMDC_table	Endif	End	//**********************************************************************************************************************Function Button_makeEMDCtable(ctrlName) : ButtonControl	String ctrlName	Execute "makeEMDCtable()"End//**********************************************************************************************************************Function Button_EMDC_Showmulti(ctrlName) : ButtonControl	String ctrlName	Execute "EMDC_Showmulti()"End//**********************************************************************************************************************Function PopMenuProc_EMDConoff(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G EMDCmulti	EMDCmulti=popNumEnd//**********************************************************************************************************************Proc EMDC_Showmulti()	Pauseupdate;Silent 1	Variable/G EMDCdivlast	String thiswavename,legendstr1,legendstr2	Variable i	If(Wintype("EMDC_multiDisplay")==0)				EMDC_multiDisplay() 		i=0		Do			thiswavename="EMDCmulti"+num2str(i)			if(i==0)				legendstr1="\\s("+thiswavename+") "+EMDCname[0]			Endif			if(i>0)				legendstr2=legendstr1+"\r\\s("+thiswavename+") "+EMDCname[i]				legendstr1=legendstr2			Endif			appendtograph $thiswavename			i+=1		While(i<dimsize(EMDClist,0)-EMDCdivlast)		color_edc()		Legend/C/N=text0/F=0/B=1/A=MC		Legend/C/N=text0/J legendstr1				ModifyGraph tick=2,mirror=1		Dowindow/F EMDC_Visualizer_control		Else			Dowindow/F EMDC_multiDisplay			killwindow EMDC_multiDisplay			EMDC_multiDisplay() 			i=0			Do				thiswavename="EMDCmulti"+num2str(i)				if(i==0)					legendstr1="\\s("+thiswavename+") "+EMDCname[0]				Endif				if(i>0)					legendstr2=legendstr1+"\r\\s("+thiswavename+") "+EMDCname[i]					legendstr1=legendstr2				Endif				appendtograph $thiswavename				i+=1			While(i<dimsize(EMDClist,0)-EMDCdivlast)			IF((dimsize(EMDClist,0)-EMDCdivlast)>1)				color_edc()			Endif			Legend/C/N=text0/F=0/B=1/A=MC			Legend/C/N=text0/J legendstr1					ModifyGraph tick=2,mirror=1			Dowindow/F EMDC_Visualizer_control	EndifEnd//**********************************************************************************************************************Function PopMenuProc_EMDCdiv(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G EMDCdivlast	EMDCdivlast=popNum-1End//**********************************************************************************************************************Window EMDC_multiDisplay() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(80,292,488,640)	ModifyGraph gbRGB=(52428,52428,52428)	ShowInfo	Legend/C/N=text0/J/F=0/B=1/A=MC/X=31.79/Y=-22.22 ""EndMacro//**********************************************************************************************************************//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$//********************************************************************************************************************************//********************************************************************************************************************************//Image color scale//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************Proc Capturename()	PauseUpdate	Silent 1		variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv			String thelist	string thewinlist	string iminfolist	string colorinfolist1,colorinfolist	string iminfo	string minsetstr,maxsetstr	Variable minsetvar,maxsetvar	thelist=ImageNameList("",";")	topgraphimage=StringFromList(topgraphnum, thelist , ";")	thewinlist=winlist("*",";","")	topgraphname=StringFromList(1, thewinlist , ";")	print topgraphname	print topgraphimage	imagestats/Q $topgraphimage	topimagemin=V_min	topimagemax=V_max	iminfolist=ImageInfo(topgraphname,topgraphimage,0) //	print iminfolist	iminfo=StringFromList(9, iminfolist , ";")	colorinfolist1=iminfo[18,strlen(iminfo)-2]	colorinfolist=colorinfolist1+","	minsetstr=StringFromList(0, colorinfolist , ",")	maxsetstr=StringFromList(1, colorinfolist , ",")	topgraphcolor=StringFromList(2, colorinfolist , ",")	topgraphcolorinv=StringFromList(3, colorinfolist , ",")	IF(cmpstr(minsetstr,"*")==0)		minsetvar=topimagemin		ELSE			minsetvar=str2num(minsetstr)	Endif	IF(cmpstr(maxsetstr,"*")==0)		maxsetvar=topimagemax		ELSE			maxsetvar=str2num(maxsetstr)	Endif	topimageminratio=(minsetvar-topimagemin)/(topimagemax-topimagemin)	topimagemaxratio=(maxsetvar-topimagemin)/(topimagemax-topimagemin)	slider topimagetop value=topimagemaxratio	slider topimagebot value=topimageminratio		IF(str2num(topgraphcolorinv)==0)		Popupmenu popupinvmatcolor mode=1		Else			Popupmenu popupinvmatcolor mode=2	EndifEnd//********************************************************************************************************************************Function SliderProc_topmax(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio//	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv		String toexecute1,toexecute2,toexecute	if(event %& 0x1)	// bit 0, value set	endif	toexecute1="Modifyimage/W= "+topgraphname+" "+topgraphimage+" ctab={"+num2str(topimageminratio*(topimagemax-topimagemin)+topimagemin)	toexecute2=","+num2str(sliderValue*(topimagemax-topimagemin)+topimagemin)+","+topgraphcolor+","+topgraphcolorinv+"}"	toexecute=toexecute1+toexecute2	Execute toexecute	return 0End//********************************************************************************************************************************Function SliderProc_topmin(ctrlName,sliderValue,event) : SliderControl	String ctrlName	Variable sliderValue	Variable event	// bit field: bit 0: value set, 1: mouse down, 2: mouse up, 3: mouse moved	variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar//	Variable/G topimageminratio	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv		String toexecute1,toexecute2,toexecute	if(event %& 0x1)	// bit 0, value set	endif	toexecute1="Modifyimage/W= "+topgraphname+" "+topgraphimage+" ctab={"+num2str(sliderValue*(topimagemax-topimagemin)+topimagemin)	toexecute2=","+num2str(topimagemaxratio*(topimagemax-topimagemin)+topimagemin)+","+topgraphcolor+","+topgraphcolorinv+"}"	toexecute=toexecute1+toexecute2		Execute toexecute	return 0End//********************************************************************************************************************************Function Button_image_auto_up(ctrlName) : ButtonControl	String ctrlName	variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv		String toexecute1,toexecute2,toexecute	toexecute1="Modifyimage/W= "+topgraphname+" "+topgraphimage+" ctab={"+num2str(topimageminratio*(topimagemax-topimagemin)+topimagemin)	toexecute2=",*,"+topgraphcolor+","+topgraphcolorinv+"}"	toexecute=toexecute1+toexecute2		Execute toexecute	topimagemaxratio=1	slider topimagetop value=topimagemaxratio//	slider topimagebot value=topimageminratio			return 0End//********************************************************************************************************************************Function Button_image_auto_both(ctrlName) : ButtonControl	String ctrlName	variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv		String toexecute1,toexecute2,toexecute	toexecute1="Modifyimage/W= "+topgraphname+" "+topgraphimage+" ctab={*"	toexecute2=",*,"+topgraphcolor+","+topgraphcolorinv+"}"	toexecute=toexecute1+toexecute2		Execute toexecute	topimageminratio=0	topimagemaxratio=1	slider topimagetop value=topimagemaxratio	slider topimagebot value=topimageminratio				return 0End//********************************************************************************************************************************Function Button_image_auto_down(ctrlName) : ButtonControl	String ctrlName	variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv		String toexecute1,toexecute2,toexecute	toexecute1="Modifyimage/W= "+topgraphname+" "+topgraphimage+" ctab={*"	toexecute2=","+num2str(topimagemaxratio*(topimagemax-topimagemin)+topimagemin)+","+topgraphcolor+","+topgraphcolorinv+"}"	toexecute=toexecute1+toexecute2		Execute toexecute	topimageminratio=0//	slider topimagetop value=topimagemaxratio	slider topimagebot value=topimageminratio					return 0End//********************************************************************************************************************************Function Button_image_0_up(ctrlName) : ButtonControl	String ctrlName	variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv		String toexecute1,toexecute2,toexecute	toexecute1="Modifyimage/W= "+topgraphname+" "+topgraphimage+" ctab={"+num2str(topimageminratio*(topimagemax-topimagemin)+topimagemin)	toexecute2=",0,"+topgraphcolor+","+topgraphcolorinv+"}"	toexecute=toexecute1+toexecute2		Execute toexecute	topimagemaxratio=-topimagemin/(topimagemax-topimagemin)	slider topimagetop value=topimagemaxratio//	slider topimagebot value=topimageminratio					return 0End//********************************************************************************************************************************Function Button_image_0_down(ctrlName) : ButtonControl	String ctrlName	variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv		String toexecute1,toexecute2,toexecute	toexecute1="Modifyimage/W= "+topgraphname+" "+topgraphimage+" ctab={0"	toexecute2=","+num2str(topimagemaxratio*(topimagemax-topimagemin)+topimagemin)+","+topgraphcolor+","+topgraphcolorinv+"}"	toexecute=toexecute1+toexecute2		Execute toexecute	topimageminratio=-topimagemin/(topimagemax-topimagemin)//	slider topimagetop value=topimagemaxratio	slider topimagebot value=topimageminratio					return 0End//********************************************************************************************************************************Function PopMenuProc_colormat(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv		String toexecute1,toexecute2,toexecute	topgraphcolor=popstr	toexecute1="Modifyimage/W= "+topgraphname+" "+topgraphimage+" ctab={"+num2str(topimageminratio*(topimagemax-topimagemin)+topimagemin)	toexecute2=","+num2str(topimagemaxratio*(topimagemax-topimagemin)+topimagemin)+","+topgraphcolor+","+topgraphcolorinv+"}"	toexecute=toexecute1+toexecute2		Execute toexecuteEnd//********************************************************************************************************************************Function PopMenuProc_colormatinv(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	variable/G topgraphnum	Variable/G topimagemin	Variable/G topimagemax		Variable/G minsetvar	Variable/G maxsetvar	Variable/G topimageminratio	Variable/G topimagemaxratio				String/G topgraphimage	String/G topgraphname	String/G topgraphcolor	String/G topgraphcolorinv	String toexecute1,toexecute2,toexecute	topgraphcolorinv=num2str(popNum-1)	toexecute1="Modifyimage/W= "+topgraphname+" "+topgraphimage+" ctab={"+num2str(topimageminratio*(topimagemax-topimagemin)+topimagemin)	toexecute2=","+num2str(topimagemaxratio*(topimagemax-topimagemin)+topimagemin)+","+topgraphcolor+","+topgraphcolorinv+"}"	toexecute=toexecute1+toexecute2		Execute toexecute	End//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************//Image color scale  end//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************//Curvature panel//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************Window Curvature_panel() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(81,124,505,628)	AppendImage Curvature_matrix	ModifyImage Curvature_matrix ctab= {*,0,Terrain,1}	ModifyGraph cbRGB=(32896,0,0)	ModifyGraph mirror=2	ControlBar 118	SetVariable setvar_box_xx,pos={6,25},size={85,15},title=" Box D2x"	SetVariable setvar_box_xx,labelBack=(61166,61166,61166),value= curv_box_x	SetVariable setvar_num_xx,pos={6,46},size={85,15},title=" Num D2x"	SetVariable setvar_num_xx,labelBack=(61166,61166,61166),value= curv_num_x	SetVariable setvar_box_yy,pos={95,25},size={85,15},title=" Box D2y"	SetVariable setvar_box_yy,labelBack=(61166,61166,61166),value= curv_box_y	SetVariable setvar_num_yy,pos={95,46},size={85,15},title=" Num D2y"	SetVariable setvar_num_yy,labelBack=(61166,61166,61166),value= curv_num_y	SetVariable setvar_box_xy,pos={183,25},size={125,15},title=" Box D2xy_yx (x)"	SetVariable setvar_box_xy,labelBack=(61166,61166,61166),value= curv_box_xy	SetVariable setvar_num_xy,pos={183,46},size={125,15},title=" Num D2xy_yx (x)"	SetVariable setvar_num_xy,labelBack=(61166,61166,61166),value= curv_num_xy	SetVariable setvar_box_yx,pos={309,25},size={60,15},title=" (y)"	SetVariable setvar_box_yx,labelBack=(61166,61166,61166),value= curv_box_yx	SetVariable setvar_num_yx,pos={309,46},size={60,15},title=" (y)"	SetVariable setvar_num_yx,labelBack=(61166,61166,61166),value= curv_num_yx	Button curve_mat_in,pos={4,2},size={50,20},proc=ButtonCurv_mat_in,title="\\K(0,0,65535)Mat in"	ValDisplay valdisp_name,pos={63,3},size={200,14},format="N/A"	ValDisplay valdisp_name,limits={0,0,0},barmisc={0,1000},value= #"0"	Button button_deriv,pos={7,70},size={85,20},proc=ButtonCurvature_deriv,title="\\K(65535,65535,65535)Derivatives"	Button button_deriv,fStyle=1,fColor=(0,0,65535)	PopupMenu popup_choice,pos={102,70},size={56,20},proc=PopMenuProc_curvchoice	PopupMenu popup_choice,mode=1,popvalue="Total",value= #"\"Total;EDC;MDC\""	SetVariable setvar_ifact,pos={167,68},size={105,15},proc=SetVarProc_ifact,title=" I_0 factor"	SetVariable setvar_ifact,labelBack=(61166,61166,61166)	SetVariable setvar_ifact,limits={0,inf,0.1},value= curv_ifact,live= 1	SetVariable setvar_ifact_inc,pos={167,87},size={105,15},proc=setvarincrement_ifact,title=" Increment"	SetVariable setvar_ifact_inc,labelBack=(61166,61166,61166)	SetVariable setvar_ifact_inc,limits={0,inf,1},value= curv_ifact_inc	Button curve_mat_in1,pos={3,95},size={55,20},proc=ButtonCurv_mat_out,title="\\K(65535,0,0)Save"	Button buttonmain,pos={288,1},size={85,20},proc=ButtonProc_showmain,title="Main Panel"	Button buttonmain,fStyle=17	Button button_close,pos={321,93},size={50,20},proc=ButtonProc_closethiswindow,title="Close"	Button button_close,fStyle=17EndMacro//********************************************************************************************************************************Proc Curv_panel_ini()	Pauseupdate;silent 1	Variable/G curv_box_x	Variable/G curv_box_y	Variable/G curv_num_x	Variable/G curv_num_y	Variable/G curv_box_xy	Variable/G curv_num_xy	Variable/G curv_box_yx	Variable/G curv_num_yx	Variable/G curv_choice	Variable/G curv_ifact	Variable/G curv_ifact_inc	String/G curv_name		curv_box_x=7	curv_num_x=7	curv_box_y=7	curv_num_y=7	curv_box_xy=5	curv_num_xy=5	curv_box_yx=5	curv_num_yx=5	curv_choice=1	curv_ifact=1	curv_ifact_inc=0.1	curv_name="N/A"End//********************************************************************************************************************************Proc Curv_mat_in(this_mat)	String this_mat	Prompt this_mat,"Enter the name of the matrix:"	Pauseupdate;silent 1	String/G curv_name	curv_name=this_mat	Valdisplay valdisp_name Format=curv_name	End		//**********************************************************************************************************************Function ButtonCurv_mat_in(ctrlName) : ButtonControl	String ctrlName	Execute "Curv_mat_in()"End//********************************************************************************************************************************Proc Curv_mat_out(this_mat,show_or_not)	String this_mat	Variable show_or_not	Prompt this_mat,"Save under:"	Prompt show_or_not, "Do you want to display the info?",popup "No;Yes"	Pauseupdate;silent 1	Variable/G curv_box_x	Variable/G curv_box_y	Variable/G curv_num_x	Variable/G curv_num_y	Variable/G curv_box_xy	Variable/G curv_num_xy	Variable/G curv_box_yx	Variable/G curv_num_yx	Variable/G curv_choice	Variable/G curv_ifact	String/G curv_name	String infoname	infoname=this_mat+"_info"	Duplicate/O curvature_matrix $this_mat		Make/O/T/N=(12,2) $infoname	$infoname[0][0]="Data source:"	$infoname[1][0]="Saved name:"	$infoname[2][0]="Mode:"		$infoname[3][0]="Box D2x:"	$infoname[4][0]="Num D2x:"	$infoname[5][0]="Box D2y:"	$infoname[6][0]="Num D2y:"	$infoname[7][0]="Box D2xy_yx(x):"	$infoname[8][0]="Num D2xy_yx(x):"	$infoname[9][0]="Box D2xy_yx(y):"	$infoname[10][0]="Num D2xy_yx(y):"	$infoname[11][0]="I_0 factor:"	$infoname[0][1]=curv_name	$infoname[1][1]=this_mat	If(curv_choice==1)		$infoname[2][1]="Total"		Endif	If(curv_choice==2)		$infoname[2][1]="EDC"		Endif	If(curv_choice==3)		$infoname[2][1]="MDC"		Endif		$infoname[3][1]=num2str(curv_box_x)	$infoname[4][1]=num2str(curv_num_x)	$infoname[5][1]=num2str(curv_box_y)	$infoname[6][1]=num2str(curv_num_y)	$infoname[7][1]=num2str(curv_box_xy)	$infoname[8][1]=num2str(curv_num_xy)	$infoname[9][1]=num2str(curv_box_yx)	$infoname[10][1]=num2str(curv_num_yx)	$infoname[11][1]=num2str(curv_ifact)	Display;appendimage $this_mat	ModifyImage $this_mat ctab= {*,0,Terrain,1}	If(show_or_not==2)		Edit $infoname	Endif	End		//**********************************************************************************************************************Function ButtonCurv_mat_out(ctrlName) : ButtonControl	String ctrlName	Execute "Curv_mat_out()"End//**********************************************************************************************************************Function ButtonCurv_panel(ctrlName) : ButtonControl	String ctrlName	String/G curv_name	If(Wintype("Curvature_panel")==0) 		Execute "Curv_panel_ini()"		Execute "Curvature_panel()"		Make/O/N=(1,1) Curvature_matrix		appendimage Curvature_matrix		ModifyImage Curvature_matrix ctab= {*,0,Terrain,1}			Valdisplay valdisp_name Format=curv_name			else			Dowindow/F Curvature_panel	EndifEnd//**********************************************************************************************************************Function ButtonCurvature_deriv(ctrlName) : ButtonControl	String ctrlName	Execute "Curvature_deriv()"End//********************************************************************************************************************************Proc Curvature_deriv()	Pauseupdate;silent 1	Variable/G curv_box_x	Variable/G curv_box_y	Variable/G curv_num_x	Variable/G curv_num_y	Variable/G curv_box_xy	Variable/G curv_num_xy	Variable/G curv_box_yx	Variable/G curv_num_yx	String/G curv_name		String matname=curv_name	Duplicate/O $matname Curv_matx	Duplicate/O $matname Curv_matxx	Duplicate/O $matname Curv_maty		Duplicate/O $matname Curv_matyy	Duplicate/O $matname Curv_matxy	Duplicate/O $matname Curv_matyx			func_Curvaturex($matname,Curv_matx,Curv_matxx,curv_num_x,curv_box_x)	func_Curvaturey($matname,Curv_maty,Curv_matyy,curv_num_y,curv_box_y)	func_Curvaturexy_yx($matname,Curv_matxy,Curv_matyx,curv_num_xy,curv_box_xy,curv_num_yx,curv_box_yx)	Duplicate/O Curv_matyy Curvature_matrix  // to be changedEnd	//********************************************************************************************************************************	function func_Curvaturexy_yx(oldmat,matxy,matyx,numxy,boxxy,numyx,boxyx)	wave oldmat,matxy,matyx	variable numxy,boxxy,numyx,boxyx	PauseUpdate 	Silent 1	Variable i,j	Variable startofwave,endofwave	matxy[][]=NaN	matyx[][]=NaN	Duplicate/O oldmat tempmat 	tempmat[][]=NaN	i=0	Do		make/O/N=(dimsize(oldmat,0)) thiswave 		setscale/P x dimoffset(oldmat,0),dimdelta(oldmat,0),"", thiswave		thiswave[]=oldmat[p][i]		startofwave=0		If(mod(Round(oldmat[startofwave][i]),1)!=0)			DO				startofwave+=1			While((mod(Round(oldmat[startofwave][i]),1)!=0)&&(startofwave<dimsize(oldmat,0)+1))		Endif		endofwave=dimsize(oldmat,0)-1		If(mod(Round(oldmat[endofwave][i]),1)!=0)			DO				endofwave-=1			While((mod(Round(oldmat[endofwave][i]),1)!=0)&&(endofwave>0))		Endif		Duplicate/O/R=[startofwave,endofwave] thiswave tempwave					Smooth/E=3/B=(numxy) boxxy,tempwave					differentiate tempwave		tempmat[startofwave,endofwave][i]=tempwave[p-startofwave]		i+=1	while(i<dimsize(oldmat,1))	i=0	Do		make/O/N=(dimsize(tempmat,1)) thiswave 		setscale/P x dimoffset(tempmat,1),dimdelta(tempmat,1),"", thiswave		thiswave[]=tempmat[i][p]		startofwave=0		If(mod(Round(tempmat[i][startofwave]),1)!=0)			DO				startofwave+=1			While((mod(Round(tempmat[i][startofwave]),1)!=0)&&(startofwave<dimsize(tempmat,1)+1))		Endif		endofwave=dimsize(tempmat,1)-1		If(mod(Round(tempmat[i][endofwave]),1)!=0)			DO				endofwave-=1			While((mod(Round(tempmat[i][endofwave]),1)!=0)&&(endofwave>0))		Endif		Duplicate/O/R=[startofwave,endofwave] thiswave tempwave					Smooth/E=3/B=(numyx) boxyx,tempwave					differentiate tempwave		matxy[i][startofwave,endofwave]=tempwave[q-startofwave]		i+=1	while(i<dimsize(tempmat,0))	Duplicate/O oldmat tempmat 	tempmat[][]=NaN	i=0	Do		make/O/N=(dimsize(oldmat,1)) thiswave 		setscale/P x dimoffset(oldmat,1),dimdelta(oldmat,1),"", thiswave		thiswave[]=oldmat[i][p]		startofwave=0		If(mod(Round(oldmat[i][startofwave]),1)!=0)			DO				startofwave+=1			While((mod(Round(oldmat[i][startofwave]),1)!=0)&&(startofwave<dimsize(oldmat,1)+1))		Endif		endofwave=dimsize(oldmat,1)-1		If(mod(Round(oldmat[i][endofwave]),1)!=0)			DO				endofwave-=1			While((mod(Round(oldmat[i][endofwave]),1)!=0)&&(endofwave>0))		Endif		Duplicate/O/R=[startofwave,endofwave] thiswave tempwave					Smooth/E=3/B=(numyx) boxyx,tempwave					differentiate tempwave		tempmat[i][startofwave,endofwave]=tempwave[q-startofwave]		i+=1	while(i<dimsize(oldmat,0))	i=0	Do		make/O/N=(dimsize(tempmat,0)) thiswave 		setscale/P x dimoffset(tempmat,0),dimdelta(tempmat,0),"", thiswave		thiswave[]=tempmat[p][i]		startofwave=0		If(mod(Round(tempmat[startofwave][i]),1)!=0)			DO				startofwave+=1			While((mod(Round(oldmat[tempmat][i]),1)!=0)&&(startofwave<dimsize(tempmat,0)+1))		Endif		endofwave=dimsize(tempmat,0)-1		If(mod(Round(tempmat[endofwave][i]),1)!=0)			DO				endofwave-=1			While((mod(Round(tempmat[endofwave][i]),1)!=0)&&(endofwave>0))		Endif		Duplicate/O/R=[startofwave,endofwave] thiswave tempwave					Smooth/E=3/B=(numxy) boxxy,tempwave					differentiate tempwave		matyx[startofwave,endofwave][i]=tempwave[p-startofwave]		i+=1	while(i<dimsize(tempmat,1))	Killwaves thiswave,tempwave,tempmatEnd	//********************************************************************************************************************************	function func_Curvaturex(oldmat,matx,matxx,num,box)	wave oldmat,matx,matxx	variable num,box	PauseUpdate 	Silent 1	Variable i,j	Variable startofwave,endofwave	matx[][]=NaN	matxx[][]=NaN	i=0	Do		make/O/N=(dimsize(oldmat,0)) thiswave 		setscale/P x dimoffset(oldmat,0),dimdelta(oldmat,0),"", thiswave		thiswave[]=oldmat[p][i]		startofwave=0		If(mod(Round(oldmat[startofwave][i]),1)!=0)			DO				startofwave+=1			While((mod(Round(oldmat[startofwave][i]),1)!=0)&&(startofwave<dimsize(oldmat,0)+1))		Endif		endofwave=dimsize(oldmat,0)-1		If(mod(Round(oldmat[endofwave][i]),1)!=0)			DO				endofwave-=1			While((mod(Round(oldmat[endofwave][i]),1)!=0)&&(endofwave>0))		Endif		Duplicate/O/R=[startofwave,endofwave] thiswave tempwave					Smooth/E=3/B=(num) box,tempwave					differentiate tempwave		matx[startofwave,endofwave][i]=tempwave[p-startofwave]		differentiate tempwave		matxx[startofwave,endofwave][i]=tempwave[p-startofwave]		i+=1	while(i<dimsize(oldmat,1))	Killwaves thiswave,tempwaveEnd	//********************************************************************************************************************************	function func_Curvaturey(oldmat,maty,matyy,num,box)	wave oldmat,maty,matyy	variable num,box	PauseUpdate 	Silent 1	Variable i,j	Variable startofwave,endofwave	maty[][]=NaN	matyy[][]=NaN	i=0	Do		make/O/N=(dimsize(oldmat,1)) thiswave 		setscale/P x dimoffset(oldmat,1),dimdelta(oldmat,1),"", thiswave		thiswave[]=oldmat[i][p]		startofwave=0		If(mod(Round(oldmat[i][startofwave]),1)!=0)			DO				startofwave+=1			While((mod(Round(oldmat[i][startofwave]),1)!=0)&&(startofwave<dimsize(oldmat,1)+1))		Endif		endofwave=dimsize(oldmat,1)-1		If(mod(Round(oldmat[i][endofwave]),1)!=0)			DO				endofwave-=1			While((mod(Round(oldmat[i][endofwave]),1)!=0)&&(endofwave>0))		Endif		Duplicate/O/R=[startofwave,endofwave] thiswave tempwave					Smooth/E=3/B=(num) box,tempwave					differentiate tempwave		maty[i][startofwave,endofwave]=tempwave[q-startofwave]		differentiate tempwave		matyy[i][startofwave,endofwave]=tempwave[q-startofwave]		i+=1	while(i<dimsize(oldmat,0))	Killwaves thiswave,tempwaveEnd//********************************************************************************************************************************	Proc curv_update()	PauseUpdate 	Silent 1	Variable/G curv_choice	Variable/G curv_ifact	If(curv_choice==1)		print "Not available yet!"	Endif	If(curv_choice==2)		Duplicate/O curv_matyy curvature_matrix 		curvature_matrix[][]=0		curv_calc_EDC(curv_maty,curv_matyy,curvature_matrix,curv_ifact)	Endif	If(curv_choice==3)		Duplicate/O curv_matxx curvature_matrix 		curvature_matrix[][]=0		curv_calc_MDC(curv_matx,curv_matxx,curvature_matrix,curv_ifact)	EndifEnd	//********************************************************************************************************************************Function PopMenuProc_curvchoice(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Pauseupdate;silent 1	Variable/G curv_choice	curv_choice=popNum		Execute "curv_update()"End//********************************************************************************************************************************function curv_calc_EDC(maty,matyy,thematrix,ifact)	wave maty,matyy,thematrix	Variable ifact	PauseUpdate 	Silent 1	Variable imax2	Duplicate/O maty maty2	maty2[][]=(maty[p][q])^2	Imagestats/Q maty2	imax2=V_max	thematrix[][]=matyy[p][q]/(0.1*ifact^2*imax2+maty2[p][q])^(2/3)	killwaves maty2End//********************************************************************************************************************************function curv_calc_MDC(matx,matxx,thematrix,ifact)	wave matx,matxx,thematrix	Variable ifact	PauseUpdate 	Silent 1	Variable imax2	Duplicate/O matx matx2	matx2[][]=(matx[p][q])^2	Imagestats/Q matx2	imax2=V_max	thematrix[][]=matxx[p][q]/(ifact^2*imax2+matx2[p][q])^(2/3)	killwaves matx2End//********************************************************************************************************************************Function SetVarProc_ifact(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	PauseUpdate;Silent 1	Execute "curv_update()"End//********************************************************************************************************************************	Proc SetVarProc_ifact_inc()	PauseUpdate	Silent 1	Variable/G curv_ifact_inc	SetVariable setvar_ifact,limits={0,inf,curv_ifact_inc},value= curv_ifact	End	//********************************************************************************************************************************	Function setvarincrement_ifact(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "SetVarProc_ifact_inc()"End//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************//End of Curvature panel//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************//**************************************Average tools********************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************Variable/G AVG_CirccenterxVariable/G AVG_CirccenteryVariable/G AVG_CircsizeVariable/G AVG_Circcenterx_incVariable/G AVG_Circcentery_incVariable/G AVG_Circsize_incVariable/G AVG_inoutString/G AVG_nameWindow AVG_graph() : Graph	PauseUpdate; Silent 1		// building window...	Display /W=(125,173,552,634)	ShowInfo	ControlBar 88	SetVariable setvarcircx,pos={37,27},size={125,15},proc=SetVarAVG_UpdateCirc,title="Center x:"	SetVariable setvarcircx,limits={-inf,inf,0.01},value= AVG_Circcenterx,live= 1	SetVariable setvarcircy,pos={165,27},size={125,15},proc=SetVarAVG_UpdateCirc,title="Center y:"	SetVariable setvarcircy,limits={-inf,inf,0.01},value= AVG_Circcentery,live= 1	Button AVGcircfix,pos={18,61},size={110,20},proc=ButtonProc_AVG_CirccenterCsr,title="Center at cursor"	SetVariable setvarAVGcircsize,pos={294,27},size={100,15},proc=SetVarAVG_UpdateCirc,title="Size"	SetVariable setvarAVGcircsize,limits={-inf,inf,0.01},value= AVG_Circsize,live= 1	SetVariable setvarcircx_inc,pos={62,44},size={100,15},proc=setvarAVG_circcenterx,title="Inc:"	SetVariable setvarcircx_inc,value= AVG_Circcenterx_inc	SetVariable setvarcircy_inc,pos={190,44},size={100,15},proc=setvarAVG_circcentery,title="Inc:"	SetVariable setvarcircy_inc,value= AVG_Circcentery_inc	SetVariable setvarAVGcircsizeinc,pos={294,43},size={100,15},proc=setvarAVG_circsize,title="Inc"	SetVariable setvarAVGcircsizeinc,value= AVG_Circsize_inc	Button buttonwavein,pos={7,5},size={65,20},proc=ButtonProc_AVG_namein,title="\\K(65535,0,0)Image in"	Button buttonwavein,fStyle=1	ValDisplay valdispwavein,pos={85,8},size={180,14},format="NaN"	ValDisplay valdispwavein,limits={0,0,0},barmisc={0,1000},value= #"0"	Button buttonres,pos={275,4},size={95,20},proc=ButtonProcAVG_Showres,title="Show results"	Button buttonres,fStyle=1	PopupMenu popupinout,pos={133,62},size={61,20},proc=PopMenuProcAVG_inout	PopupMenu popupinout,mode=1,popvalue="Inside",value= #"\"Inside;Outside\""EndMacro//*******************************************************************************************************************************Function ButtonProcAVG_tool(ctrlName) : ButtonControl	String ctrlName	IF(WinType("AVG_graph")==0)		Execute "AVG_ini()"		Execute "AVG_graph()"		Execute "AVG_Appendimage()"		Execute "AVG_MakeCirc()"		Execute "AVG_Editresults()"				Else			Dowindow/F AVG_graph	EndifEnd//*******************************************************************************************************************************Proc AVG_CirccenterCsr()	PauseUpdate;Silent 1	Variable/G AVG_Circcenterx	Variable/G AVG_Circcentery	AVG_Circcenterx=xcsr(A)	AVG_Circcentery=vcsr(A)	AVG_Calc_avgcirc()	End//*******************************************************************************************************************************Function PopMenuProcAVG_inout(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr	Variable/G AVG_inout	AVG_inout=popNum	Execute "AVG_Calc_avgcirc()"	End//*******************************************************************************************************************************Proc AVG_Appendimage()	PauseUpdate;Silent 1	Appendimage AVG_image	ModifyImage AVG_image ctab= {*,*,PlanetEarth,0}End//*******************************************************************************************************************************Proc AVG_Editresults()	PauseUpdate;Silent 1	Edit AVG_resultstext,AVG_results	Dowindow/C AVG_Results_table	Dowindow/F AVG_graphEnd//*******************************************************************************************************************************Proc AVG_ini()	PauseUpdate;Silent 1	Variable/G AVG_Circcenterx	Variable/G AVG_Circcentery	Variable/G AVG_Circsize	Variable/G AVG_Circcenterx_inc	Variable/G AVG_Circcentery_inc	Variable/G AVG_Circsize_inc	Variable/G AVG_inout	String/G AVG_name	Make/O/N=(1,1) AVG_image	Make/O/N=6 AVG_results	Make/O/T/N=6 AVG_resultstext	AVG_results[]=0	AVG_resultstext[0]="Nb points"		AVG_resultstext[1]="Average"	AVG_resultstext[2]="Volume"	AVG_resultstext[3]="Volume plus"	AVG_resultstext[4]="Volume minus"	AVG_resultstext[5]="Ratio plus/minus"	AVG_Circcenterx=0	AVG_Circcentery=0	AVG_Circsize=0	AVG_Circcenterx_inc=1	AVG_Circcentery_inc=1	AVG_Circsize_inc=1	AVG_inout=1	AVG_name="NAN"		End//*******************************************************************************************************************************Function AVG_Calc_avgcirc()	PauseUpdate;Silent 1	Wave AVG_image	Wave AVG_results	Variable/G AVG_Circcenterx	Variable/G AVG_Circcentery	Variable/G AVG_Circsize	Variable/G AVG_inout		Variable i,j	Variable valuex	Variable valuey	variable condition	AVG_results[]=0	i=0	IF(AVG_inout==1)		Do			valuex=dimoffset(AVG_image,0)+i*dimdelta(AVG_image,0)			j=0			Do				valuey=dimoffset(AVG_image,1)+j*dimdelta(AVG_image,1)				condition=(valuex-AVG_Circcenterx)^2+(valuey-AVG_Circcentery)^2-AVG_Circsize^2				If(condition<=0)					AVG_results[0]+=1					AVG_results[1]+=AVG_image[i][j]					IF(AVG_image[i][j]>0)						AVG_results[3]+=AVG_image[i][j]					Endif					IF(AVG_image[i][j]<0)						AVG_results[4]-=AVG_image[i][j]					Endif									Endif				j+=1			While(j<dimsize(AVG_image,1))			i+=1		While(i<dimsize(AVG_image,0))		Else			Do				valuex=dimoffset(AVG_image,0)+i*dimdelta(AVG_image,0)				j=0				Do					valuey=dimoffset(AVG_image,1)+j*dimdelta(AVG_image,1)					condition=(valuex-AVG_Circcenterx)^2+(valuey-AVG_Circcentery)^2-AVG_Circsize^2					If(condition>=0)						AVG_results[0]+=1						AVG_results[1]+=AVG_image[i][j]						IF(AVG_image[i][j]>0)							AVG_results[3]+=AVG_image[i][j]						Endif						IF(AVG_image[i][j]<0)							AVG_results[4]-=AVG_image[i][j]						Endif										Endif					j+=1				While(j<dimsize(AVG_image,1))				i+=1			While(i<dimsize(AVG_image,0))	Endif			AVG_results[2]=AVG_results[1]*dimdelta(AVG_image,0)*dimdelta(AVG_image,1)	IF(AVG_results[0]!=0)		AVG_results[1]/=AVG_results[0]	Endif	AVG_results[3]*=(dimdelta(AVG_image,0)*dimdelta(AVG_image,1))	AVG_results[4]*=(dimdelta(AVG_image,0)*dimdelta(AVG_image,1))	IF(AVG_results[4]!=0)		AVG_results[5]=AVG_results[3]/AVG_results[4]	Endif	End//*******************************************************************************************************************************Function ButtonProc_AVG_CirccenterCsr(ctrlName) : ButtonControl	String ctrlName	Execute "AVG_CirccenterCsr()"	Execute "AVG_UpdateCirc()"End//*******************************************************************************************************************************Function AVG_UpdateCirc()	PauseUpdate;Silent 1	Wave AVG_Circx	Wave AVG_Circy	Variable/G AVG_Circcenterx	Variable/G AVG_Circcentery	Variable/G AVG_Circsize	AVG_Circx[]=AVG_Circsize*cos(2*pi*p/(dimsize(AVG_Circx,0)-1))+AVG_Circcenterx	AVG_Circy[]=AVG_Circsize*sin(2*pi*p/(dimsize(AVG_Circy,0)-1))+AVG_Circcentery	End//*******************************************************************************************************************************Function ButtonProc_AVG_namein(ctrlName) : ButtonControl	String ctrlName	PauseUpdate;Silent 1		Execute "AVG_wavein()"End//*******************************************************************************************************************************Proc AVG_wavein(namein)	String namein	Prompt namein,"Name of the image"	PauseUpdate;Silent 1	String/G AVG_name	Variable/G AVG_Circcenterx	Variable/G AVG_Circcentery	Variable/G AVG_Circsize	AVG_name=namein	ValDisplay valdispwavein format=AVG_name	Duplicate/O $AVG_name AVG_image	AVG_Circcenterx=(2*dimoffset(AVG_image,0)+dimsize(AVG_image,0)*dimdelta(AVG_image,0))/2	AVG_Circcentery=(2*dimoffset(AVG_image,1)+dimsize(AVG_image,1)*dimdelta(AVG_image,1))/2	If((dimsize(AVG_image,0)*dimdelta(AVG_image,0))>(dimsize(AVG_image,1)*dimdelta(AVG_image,1)))		AVG_Circsize=(dimsize(AVG_image,1)*dimdelta(AVG_image,1))/4		Else		AVG_Circsize=(dimsize(AVG_image,0)*dimdelta(AVG_image,0))/4			Endif		AVG_UpdateCirc()	AVG_Calc_avgcirc()End//*******************************************************************************************************************************Proc AVG_showtable()	PauseUpdate;Silent 1	If(Wintype("AVG_Results_table")==0)		Edit AVG_resultstext,AVG_results		Dowindow/C AVG_Results_table		Else			Dowindow/F AVG_Results_table	EndifEnd//*******************************************************************************************************************************Function ButtonProcAVG_Showres(ctrlName) : ButtonControl	String ctrlName	Execute "AVG_showtable()"End//*******************************************************************************************************************************Proc AVG_MakeCirc()	PauseUpdate;Silent 1	Variable/G AVG_Circcenterx	Variable/G AVG_Circcentery	Variable/G AVG_Circsize	Make/O/N=200 AVG_Circx	Make/O/N=200 AVG_Circy		AVG_Circx[]=AVG_Circsize*cos(2*pi*p/(dimsize(AVG_Circx,0)-1))+AVG_Circcenterx	AVG_Circy[]=AVG_Circsize*sin(2*pi*p/(dimsize(AVG_Circy,0)-1))+AVG_Circcentery	Appendtograph AVG_Circy vs AVG_Circx	End//*******************************************************************************************************************************Function SetVarAVG_UpdateCirc(ctrlName,varNum,varStr,varName) : SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Execute "AVG_UpdateCirc()"	Execute "AVG_Calc_avgcirc()"	End//*******************************************************************************************************************************Function setvarAVG_circcenterx(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G AVG_Circcenterx	Variable/G AVG_Circcenterx_inc	SetVariable setvarcircx,limits={-Inf,inf,AVG_Circcenterx_inc},value= AVG_CirccenterxEnd//*******************************************************************************************************************************Function setvarAVG_circcentery(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G AVG_Circcentery	Variable/G AVG_Circcentery_inc	SetVariable setvarcircy,limits={-Inf,inf,AVG_Circcentery_inc},value= AVG_CirccenteryEnd//*******************************************************************************************************************************Function setvarAVG_circsize(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	Variable/G AVG_Circsize	Variable/G AVG_Circsize_inc	SetVariable setvarAVGcircsize,limits={0,inf,AVG_Circsize_inc},value= AVG_CircsizeEnd//*******************************************************************************************************************************//**************************************Average tools  end*****************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//**************************************Peng Zhang curvature**************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************function Deriv(OldM,num,box,choice) //command line of 2nd derivative, the same as main panel.	wave OldM	variable num,box,choice	string matname,graphname	if(choice==1)		matname=nameofwave(OldM)+"VD"		duplicate/o OldM,$matname		DM(OldM,$matname,num,box,1)		//graphname=matname+"_plot"		//if(wintype(graphname)==1)		//	dowindow/f $graphname		//	else		//		display/n=$graphname; appendimage $matname		//		Showinfo			//		ModifyImage $matname,ctab= {*,0,Terrain,1}		//endif	endif	if(choice==2)		matname=nameofwave(OldM)+"HD"		duplicate/o OldM,$matname		DM(OldM,$matname,num,box,2)		//graphname=matname+"_plot"		//if(wintype(graphname)==1)		//	dowindow/f $graphname		//	else		//		display/n=$graphname; appendimage $matname		//		Showinfo			//		ModifyImage $matname,ctab= {*,0,Terrain,1}		//endif			endifendfunction curvature(mat,num,box,choice,factor) //curvature. 1 is EDC, 2 is MDC, 3 is 2D with unit problem, 4 is the method that using the max between EDC and MDC(not efficient).	wave mat	variable num,box,choice,factor	string diff1mat,diff2mat,matcurv,graphcurv	variable avg,avgv,avgh	if(choice==1)		matcurv=nameofwave(mat)+"_CurvV"		diff1mat=nameofwave(mat)+"dy"; diff2mat=nameofwave(mat)+"dy2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num,box,1)		DM1($diff1mat,$diff2mat,num,box,1)		avg=abs(wavemin($diff1mat))		duplicate/o mat T_temp		duplicate/o $diff2mat T_diff2mat; duplicate/o $diff1mat T_diff1mat		T_temp=T_diff2mat/(avg*avg*factor+T_diff1mat*T_diff1mat)^1.5		duplicate/o T_temp $matcurv//		graphcurv=matcurv+"_plot"//		if(wintype(graphcurv)==1)//			dowindow/f $graphcurv//			else//				display/n=$graphcurv; appendimage $matcurv//				Showinfo	//				ModifyImage $matcurv,ctab= {*,0,Terrain,1}//		endif	endif	if(choice==2)		matcurv=nameofwave(mat)+"_CurvH"		diff1mat=nameofwave(mat)+"dx"; diff2mat=nameofwave(mat)+"dx2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num,box,2)		DM1($diff1mat,$diff2mat,num,box,2)		avg=abs(wavemin($diff1mat))		duplicate/o mat T_temp		duplicate/o $diff2mat T_diff2mat; duplicate/o $diff1mat T_diff1mat		T_temp=T_diff2mat/(avg*avg*factor+T_diff1mat*T_diff1mat)^1.5		duplicate/o T_temp $matcurv//		graphcurv=matcurv+"_plot"//		if(wintype(graphcurv)==1)//			dowindow/f $graphcurv//			else//				display/n=$graphcurv; appendimage $matcurv//				Showinfo	//				ModifyImage $matcurv,ctab= {*,0,Terrain,1}//		endif	endif	if(choice==3)		matcurv=nameofwave(mat)+"_Curv2D"				diff1mat=nameofwave(mat)+"dy"; diff2mat=nameofwave(mat)+"dy2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num,box,1)		DM1($diff1mat,$diff2mat,num,box,1)		avgv=abs(wavemin($diff1mat))		duplicate/o $diff2mat T_diff2matV; duplicate/o $diff1mat T_diff1matV				diff1mat=nameofwave(mat)+"dx"; diff2mat=nameofwave(mat)+"dx2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num,box,2)		DM1($diff1mat,$diff2mat,num,box,2)		avgh=abs(wavemin($diff1mat))		duplicate/o $diff2mat T_diff2matH; duplicate/o $diff1mat T_diff1matH			diff2mat=nameofwave(mat)+"dy"+"dx"		duplicate/o mat $diff2mat		DM1(mat,$diff2mat,num,box,4)		duplicate/o mat T_temp,T_maxcurv		duplicate/o $diff2mat T_diff2matVH				avg=max(avgv,avgh)		T_temp=((avg*avg*factor+t_diff1math*t_diff1math)*t_diff2matv-2*t_diff1math*t_diff1matv*t_diff2matvh+(avg*avg*factor+t_diff1matv*t_diff1matv)*t_diff2math)/(avg*avg*factor+t_diff1math*t_diff1math+t_diff1matv*t_diff1matv)^1.5		duplicate/o T_temp $matcurv		graphcurv=matcurv+"_plot"		if(wintype(graphcurv)==1)			dowindow/f $graphcurv			else				display/n=$graphcurv; appendimage $matcurv				Showinfo					ModifyImage $matcurv,ctab= {*,0,Terrain,1}		endif	endif			if(choice==4)		matcurv=nameofwave(mat)+"_Deriv2DMax"				diff1mat=nameofwave(mat)+"dy"; diff2mat=nameofwave(mat)+"dy2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num,box,1)		DM1($diff1mat,$diff2mat,num,box,1)		avgv=abs(wavemin($diff1mat))		duplicate/o $diff2mat T_diff2matV; duplicate/o $diff1mat T_diff1matV				diff1mat=nameofwave(mat)+"dx"; diff2mat=nameofwave(mat)+"dx2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num,box,2)		DM1($diff1mat,$diff2mat,num,box,2)		avgh=abs(wavemin($diff1mat))		duplicate/o $diff2mat T_diff2matH; duplicate/o $diff1mat T_diff1matH			diff2mat=nameofwave(mat)+"dy"+"dx"		duplicate/o mat $diff2mat		DM1(mat,$diff2mat,num,box,4)		duplicate/o mat T_temp		duplicate/o $diff2mat T_diff2matVH				avg=max(avgv,avgh)		T_temp=t_diff2math+t_diff2matv-sqrt((t_diff2math-t_diff2matv)*(t_diff2math-t_diff2matv)+4*t_diff2matvh*t_diff2matvh)		duplicate/o T_temp $matcurv		graphcurv=matcurv+"_plot"		if(wintype(graphcurv)==1)			dowindow/f $graphcurv			else				display/n=$graphcurv; appendimage $matcurv				Showinfo					ModifyImage $matcurv,ctab= {*,0,Terrain,1}		endif	endifendfunction curvature2(mat,num,box,num2,box2,choice,factor) //there are two groups of smooth parameters compared to curvature(). choice are 3 and 4.	wave mat	variable num,box,num2,box2,choice,factor	string diff1mat,diff2mat,matcurv,graphcurv	variable avg,avgv,avgh	variable dx,dy,weight	variable/g t_twoDW	dx=dimdelta(mat,0)	dy=dimdelta(mat,1)	weight=(dx/dy)*(dx/dy)	if(choice==3)		matcurv=nameofwave(mat)+"_Curv2D"				diff1mat=nameofwave(mat)+"dy"; diff2mat=nameofwave(mat)+"dy2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num,box,1)		DM1($diff1mat,$diff2mat,num,box,1)		avgv=abs(wavemin($diff1mat))		duplicate/o $diff2mat T_diff2matV; duplicate/o $diff1mat T_diff1matV				diff1mat=nameofwave(mat)+"dx"; diff2mat=nameofwave(mat)+"dx2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num2,box2,2)		DM1($diff1mat,$diff2mat,num,box,2)		avgh=abs(wavemin($diff1mat))		duplicate/o $diff2mat T_diff2matH; duplicate/o $diff1mat T_diff1matH			diff2mat=nameofwave(mat)+"dy"+"dx"		duplicate/o mat $diff2mat		DM1(mat,$diff2mat,num,box,4)		duplicate/o mat T_temp,T_maxcurv		duplicate/o $diff2mat T_diff2matVH				if(t_twoDW>0)			weight*=t_twodW		endif		if(t_twoDW<0)			weight/=abs(t_twodW)		endif				avg=max(avgv*avgv,weight*avgh*avgh)				T_temp=((factor*avg+weight*t_diff1math*t_diff1math)*t_diff2matv-2*weight*t_diff1math*t_diff1matv*t_diff2matvh+weight*(factor*avg+t_diff1matv*t_diff1matv)*t_diff2math)/(factor*avg+weight*t_diff1math*t_diff1math+t_diff1matv*t_diff1matv)^1.5		duplicate/o T_temp $matcurv//		graphcurv=matcurv+"_plot"//		if(wintype(graphcurv)==1)//			dowindow/f $graphcurv//			else//				display/n=$graphcurv; appendimage $matcurv//				Showinfo	//				ModifyImage $matcurv,ctab= {*,0,Terrain,1}//		endif	endif			if(choice==4)		matcurv=nameofwave(mat)+"_Deriv2D"				diff1mat=nameofwave(mat)+"dy"; diff2mat=nameofwave(mat)+"dy2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num,box,1)		DM1($diff1mat,$diff2mat,num,box,1)		duplicate/o $diff2mat T_diff2matV; duplicate/o $diff1mat T_diff1matV				diff1mat=nameofwave(mat)+"dx"; diff2mat=nameofwave(mat)+"dx2"		duplicate/o mat $diff1mat,$diff2mat		DM1(mat,$diff1mat,num,box,2)		DM1($diff1mat,$diff2mat,num,box,2)		duplicate/o $diff2mat T_diff2matH; duplicate/o $diff1mat T_diff1matH			diff2mat=nameofwave(mat)+"dy"+"dx"		duplicate/o mat $diff2mat		DM1(mat,$diff2mat,num,box,4)		duplicate/o mat T_temp		duplicate/o $diff2mat T_diff2matVH				if(t_twoDW>0)			weight*=t_twodW		endif		if(t_twoDW<0)			weight/=abs(t_twodW)		endif				T_temp=t_diff2matV+t_diff2matH*weight//		print avg*avg//		print wavemax(T_diff2matV)/wavemax(T_diff2matH)		duplicate/o T_temp $matcurv		//graphcurv=matcurv+"_plot"		//if(wintype(graphcurv)==1)		//	dowindow/f $graphcurv		//	else		//		display/n=$graphcurv; appendimage $matcurv		//		Showinfo			//		ModifyImage $matcurv,ctab= {*,0,Terrain,1}		//endif	endifendfunction DM1(OldM,NewM,num,box,choice)	wave oldM,newM	variable num,box,choice	Variable i=0,j=0, l, m, k, x0, dx, y0, dy	Variable j1	Variable startofwave,endofwave	l=dimsize(OldM,0)	m=dimsize(OldM,1)	x0=dimoffset(OldM,0)	dx=dimdelta(OldM,0)	y0=dimoffset(OldM,1)	dy=dimdelta(OldM,1)	make/o/n=(l) f0	make/o/n=(m) f1	setscale/p x x0,dx,"", f0	setscale/p x y0,dy,"", f1	NewM[][]=NaN	if(choice==2) //Horizontal derivative for k-space cuts		i=0		do			f0[]=OldM[p][i]			startofwave=0			If(mod(Round(OldM[startofwave][i]),1)!=0)				DO					startofwave+=1				While((mod(Round(OldM[startofwave][i]),1)!=0)&&(startofwave<dimsize(OldM,0)+1))			Endif			endofwave=dimsize(OldM,0)-1			If(mod(Round(OldM[endofwave][i]),1)!=0)				DO					endofwave-=1				While((mod(Round(OldM[endofwave][i]),1)!=0)&&(endofwave>0))			Endif			Duplicate/O/R=[startofwave,endofwave] f0 tempwave						Smooth/E=3/B=(num) box,tempwave						differentiate tempwave//			differentiate tempwave			j=0			Do				NewM[startofwave+j][i]=tempwave[j]								j+=1			While(j<dimsize(tempwave,0))			i+=1		while(i<dimsize(OldM,1))		Killwaves f0,f1,tempwave	endif	if(choice==1)//Vertical derivative for k-space cuts		i=0		DO			j=0			If(mod(Round(OldM[i][j]),1)!=0)				DO					j+=1				While((mod(Round(OldM[i][j]),1)!=0)&&(j<dimsize(OldM,1)+1))			Endif			If(j!=dimsize(OldM,1))				f1[]=OldM[i][p]				Duplicate/O/R=[j,*] f1 tempwave				Smooth/E=3/B=(num) box,tempwave			//				differentiate tempwave				differentiate tempwave				j1=j				Do					f1[j1]=tempwave[j1-j]					j1+=1				While(j1<dimsize(f1,0))				NewM[i][]=f1[q]			Endif			i+=1		while(i<l)		Killwaves f1,f0	endif	if(choice==4)		Duplicate/O OldM intermediatemat		intermediatemat[][]=NaN		NewM[][]=NaN		i=0				//first derivative (V)		DO			j=0			If(mod(Round(OldM[i][j]),1)!=0)				DO					j+=1				While((mod(Round(OldM[i][j]),1)!=0)&&(j<dimsize(OldM,1)+1))			Endif			If(j!=dimsize(OldM,1))				f1[]=OldM[i][p]				Duplicate/O/R=[j,*] f1 tempwave				Smooth/E=3/B=(num) box,tempwave							differentiate tempwave				j1=j				Do					f1[j1]=tempwave[j1-j]					j1+=1				While(j1<dimsize(f1,0))				intermediatemat[i][]=f1[q]			Endif			i+=1		while(i<l)				i=0                //Second derivative (H)		do			f0[]=intermediatemat[p][i]			startofwave=0			If(mod(Round(intermediatemat[startofwave][i]),1)!=0)				DO					startofwave+=1				While((mod(Round(intermediatemat[startofwave][i]),1)!=0)&&(startofwave<dimsize(intermediatemat,0)+1))			Endif			endofwave=dimsize(intermediatemat,0)-1			If(mod(Round(intermediatemat[endofwave][i]),1)!=0)				DO					endofwave-=1				While((mod(Round(intermediatemat[endofwave][i]),1)!=0)&&(endofwave>0))			Endif			Duplicate/O/R=[startofwave,endofwave] f0 tempwave						Smooth/E=3/B=(num) box,tempwave						differentiate tempwave			j=0			Do				NewM[startofwave+j][i]=tempwave[j]								j+=1			While(j<dimsize(tempwave,0))			i+=1		while(i<dimsize(intermediatemat,1))		Killwaves f0,f1,tempwave			endif			if(choice==5)		Duplicate/O OldM intermediatemat		intermediatemat[][]=NaN		NewM[][]=NaN		i=0                //first derivative (H)		do			f0[]=OldM[p][i]			startofwave=0			If(mod(Round(OldM[startofwave][i]),1)!=0)				DO					startofwave+=1				While((mod(Round(OldM[startofwave][i]),1)!=0)&&(startofwave<dimsize(OldM,0)+1))			Endif			endofwave=dimsize(OldM,0)-1			If(mod(Round(OldM[endofwave][i]),1)!=0)				DO					endofwave-=1				While((mod(Round(OldM[endofwave][i]),1)!=0)&&(endofwave>0))			Endif			Duplicate/O/R=[startofwave,endofwave] f0 tempwave						Smooth/E=3/B=(num) box,tempwave						differentiate tempwave			j=0			Do				intermediatemat[startofwave+j][i]=tempwave[j]								j+=1			While(j<dimsize(tempwave,0))			i+=1		while(i<dimsize(OldM,1))		i=0				//second derivative (V)		DO			j=0			If(mod(Round(intermediatemat[i][j]),1)!=0)				DO					j+=1				While((mod(Round(intermediatemat[i][j]),1)!=0)&&(j<dimsize(intermediatemat,1)+1))			Endif			If(j!=dimsize(intermediatemat,1))				f1[]=intermediatemat[i][p]				Duplicate/O/R=[j,*] f1 tempwave				Smooth/E=3/B=(num) box,tempwave							differentiate tempwave				j1=j				Do					f1[j1]=tempwave[j1-j]					j1+=1				While(j1<dimsize(f1,0))				NewM[i][]=f1[q]			Endif			i+=1		while(i<l)				Killwaves f0,f1,tempwave			endif	End	//***********************************************************************************function disp(mat) //disp a matrix	wave mat	string graphname,wavenam	wavenam=nameofwave(mat)	graphname=nameofwave(mat)+"_plot"		if(wintype(graphname)==1)		dowindow/f $graphname		else			display/n=$graphname; appendimage mat			Showinfo				ModifyImage $wavenam,ctab= {*,*,Terrain}	endifendfunction idisp(mat)	wave mat	string graphname,wavenam	wavenam=nameofwave(mat)	graphname=nameofwave(mat)+"_plot"		if(wintype(graphname)==1)		dowindow/f $graphname		else			display/n=$graphname; appendimage mat			Showinfo				ModifyImage $wavenam,ctab= {*,0,Terrain,1}	endif	end//***********************************************************************************//***********************************************************************************macro curv_ini()variable/g T_EDCT=3variable/g T_EDCW=3variable/g T_EDCF=.1variable/g t_EDCFi=.01variable/g T_MDCT=3variable/g T_MDCW=3variable/g T_MDCF=.1variable/g t_MDCFi=.01variable/g T_twoDF=.01variable/g T_twoDFi=.001variable/g T_twoDW=1variable/g T_2dUPdate=0string/g T_curv_data_STRcurv_data()execute "Curv_Panel()"end//***********************************************************************************function curv_data()string/g T_curv_data_STRstring tempprompt temp, "Enter the wave"doprompt "Curvature",tempT_curv_data_STR=tempEDCCurv()MDCcurv()twoDcurv()end//***********************************************************************************function EDCcurv()variable/g T_EDCTvariable/g T_EDCWvariable/g T_EDCFstring/g T_curv_data_STRcurvature($t_curv_data_str,T_edct,T_edcw,1,T_edcf)Deriv($t_curv_data_str,T_edct,T_edcw,1)end//*************function MDCcurv()variable/g T_MDCTvariable/g T_MDCWvariable/g T_MDCFstring/g T_curv_data_STRcurvature($t_curv_data_str,T_mdct,T_mdcw,2,T_mdcf)	Deriv($t_curv_data_str,T_mdct,T_mdcw,2)	end//*************function twoDcurv()variable/g T_EDCTvariable/g T_EDCWvariable/g T_MDCTvariable/g T_MDCWvariable/g T_twoDFstring/g T_curv_data_STRcurvature2($t_curv_data_str,T_edct,T_edcw,T_mdct,T_mdcw,3,T_twoDf)	curvature2($t_curv_data_str,T_edct,T_edcw,T_mdct,T_mdcw,4,1)	end//***********************************************************************************//***********************************************************************************//***********************************************************************************Window Curv_Panel() : Graph	PauseUpdate; Silent 1		// building window...	NewPanel /W=(139,568,680,720)	ModifyPanel cbRGB=(32768,40777,65535)	ShowTools/A	SetDrawLayer UserBack	DrawRect 122,30,430,128	DrawText 141,72,"EDC"	DrawText 141,97,"MDC"	DrawText 181,48,"St. Times"	DrawText 258,47,"St. Width"	DrawText 339,47,"Factor"	DrawText 141,120,"2D"		Button button_EDCDisp,pos={435,55},size={30,22},proc=buttonProc_dispEDCcurv,title="C"	Button button_MDCDisp,pos={435,80},size={30,22},proc=buttonProc_dispMDCcurv,title="C"	Button button_2DDisp,pos={435,105},size={30,22},proc=buttonProc_disp2Dcurv,title="C"	Button button_EDCDisp1,pos={475,55},size={30,22},proc=buttonProc_dispEDCDeriv,title="D"	Button button_MDCDisp1,pos={475,80},size={30,22},proc=buttonProc_dispMDCDeriv,title="D"	Button button_2DDisp1,pos={475,105},size={30,22},proc=buttonProc_disp2DDeriv,title="D"	Button button_EDCDisp2,pos={435,28},size={66,22},proc=buttonProc_dispData,title="Disp"			SetVariable setvar_EDCT,pos={189,57},size={50,15},proc=setvarEDCt,title=" "	SetVariable setvar_EDCT,limits={1,inf,1},value= T_edct	SetVariable setvar_EDCW,pos={264,57},size={50,15},proc=setvarEDCw,title=" "	SetVariable setvar_EDCW,limits={1,inf,2},value= T_edcW	SetVariable setvar_EDCF,pos={339,57},size={80,15},proc=setvarEDCF,title=" "	SetVariable setvar_EDCF,limits={0,inf,0.01},value= T_EDCF	SetVariable setvar_MDCT,pos={189,82},size={50,15},proc=setvarmDCt,title=" "	SetVariable setvar_MDCT,limits={1,inf,1},value= T_MdcT	SetVariable setvar_MDCW,pos={264,82},size={50,15},proc=setvarmDCw,title=" "	SetVariable setvar_MDCW,limits={1,inf,2},value= T_MdcW	SetVariable setvar_MDCF,pos={339,82},size={80,15},proc=setvarmDCF,title=" "	SetVariable setvar_MDCF,limits={0,inf,0.01},value= T_MDCF	SetVariable setvar_TwoDF,pos={337,105},size={80,15},proc=setvartwoDF,title=" "	SetVariable setvar_TwoDF,limits={0,inf,1e-06},value= T_twoDF		CheckBox check_2d,pos={9,107},size={96,19},title="\\Z142D UPDATE"	CheckBox check_2d,variable= T_2dupdate	Button button_2dCurv,pos={23,69},size={72,27},proc=buttonProc_2dCurv,title="2D Curv"	Button button_data,pos={21,29},size={75,30},proc=buttonProc_curv_data,title="DATA"	SetVariable setvar_twoDW,pos={190,105},size={125,15},proc=setvartwodW,title=" MDC Weight"	SetVariable setvar_twoDw,limits={-inf,inf,1},value= T_twodW	EndMacro//***********************************************************************************Function setvarEDCt(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName		edccurv()			variable/g t_2dupdate	if(t_2dupdate==1)		twoDcurv()	endif	End//**********************Function setvarEDCw(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	edccurv()	variable/g t_2dupdate	if(t_2dupdate==1)		twoDcurv()	endifEnd//**********************Function setvarEDCF(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName		variable/g t_edcf	variable/g T_EDCFI	t_edcf=ceil(t_EDCF/10^(floor(log(t_EDCF)))-1e-9)*10^(floor(log(t_EDCF)))	t_edcfi=10^(floor(log(t_EDCF)))	if(log(t_EDCF)==round(log(t_edcf)))		t_EDCFI/=10	endif	SetVariable setvar_EDCF,limits={0,inf,t_edcfi },value= T_edcF		edccurv()	End//**********************Function setvarmDCt(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	mdccurv()	variable/g t_2dupdate	if(t_2dupdate==1)		twoDcurv()	endif	End//**********************Function setvarmDCw(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName	mdccurv()	variable/g t_2dupdate	if(t_2dupdate==1)		twoDcurv()	endif	End//**********************Function setvarmDCF(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName		variable/g t_mdcf	variable/g T_mDCFI		t_mdcf=ceil(t_mDCF/10^(floor(log(t_mDCF)))-1e-9)*10^(floor(log(t_mDCF)))	t_mdcfi=10^(floor(log(t_mDCF)))	if(log(t_mDCF)==round(log(t_mdcf)))		t_mDCFI/=10	endif		SetVariable setvar_MDCF,limits={0,inf,t_mdcfi },value= T_MdcF		mdccurv()	End//**********************Function setvartwoDF(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName		variable/g t_twodf	variable/g T_twodFI	t_twodf=ceil(t_twodF/10^(floor(log(t_twodF)))-1e-10)*10^(floor(log(t_twodF)))	t_twodfi=10^(floor(log(t_twodF)))	if(log(t_twodF)==round(log(t_twodf)))		t_twodFI/=10	endif	SetVariable setvar_TwoDF,limits={0,inf,t_twoDFi },value= T_twoDF		twodcurv()	End//**********************Function setvartwoDW(ctrlName,varNum,varStr,varName): SetVariableControl	String ctrlName	Variable varNum	String varStr	String varName		twoDcurv()End//***********************************************************************************Function ButtonProc_dispData(ctrlName) : ButtonControl	string ctrlName	string/g t_curv_data_str	string data=t_curv_data_str	disp($data)endFunction ButtonProc_dispEDCcurv(ctrlName) : ButtonControl	string ctrlName	string/g t_curv_data_str	string data=t_curv_data_str+"_curvv"	idisp($data)endFunction ButtonProc_dispMDCcurv(ctrlName) : ButtonControl	string ctrlName	string/g t_curv_data_str	string data=t_curv_data_str+"_curvh"	idisp($data)endFunction ButtonProc_disp2Dcurv(ctrlName) : ButtonControl	string ctrlName	string/g t_curv_data_str	string data=t_curv_data_str+"_curv2d"	idisp($data)endFunction ButtonProc_dispEDCDeriv(ctrlName) : ButtonControl	string ctrlName	string/g t_curv_data_str	string data=t_curv_data_str+"VD"	idisp($data)endFunction ButtonProc_dispMDCDeriv(ctrlName) : ButtonControl	string ctrlName	string/g t_curv_data_str	string data=t_curv_data_str+"HD"	idisp($data)endFunction ButtonProc_disp2DDeriv(ctrlName) : ButtonControl	string ctrlName	string/g t_curv_data_str	string data=t_curv_data_str+"_Deriv2D"	idisp($data)end//***********************************************************************************Function PopMenuProc_curvcolor(ctrlName,popNum,popStr) : PopupMenuControl	String ctrlName	Variable popNum	String popStr//	dowindow/f curv_panel	SetActiveSubwindow curv_panel#G0	ModifyImage ''#0 ctab= {*,0,$popstr,1}	SetActiveSubwindow curv_panel#G1	ModifyImage ''#0 ctab= {*,0,$popstr,1}	SetActiveSubwindow curv_panel#G2	ModifyImage ''#0 ctab= {*,0,$popstr,1}	SetActiveSubwindow curv_panel#G3	ModifyImage ''#0 ctab= {*,*,$popstr,0}		End//***********************************************************************************Function ButtonProc_2dCurv(ctrlName) : ButtonControl	string ctrlName	twoDcurv()end//***********************************************************************************Function CheckProc_2dupdate(ctrlName) : CheckBoxControl //problem!!	string ctrlName	variable/g t_2dupdate	if(t_2dupdate==1)		twoDcurv()	endifEnd//***********************************************************************************//***********************************************************************************Function ButtonProc_curv_data(ctrlName) : ButtonControl	string ctrlName	curv_data()	refresh_disp()endFunction ButtonProc_curv_Zhang(ctrlName) : ButtonControl	string ctrlName	If(Wintype("Curv_Panel")==0)		variable/g T_EDCT=3		variable/g T_EDCW=3		variable/g T_EDCF=.1		variable/g t_EDCFi=.01		variable/g T_MDCT=3		variable/g T_MDCW=3		variable/g T_MDCF=.1		variable/g t_MDCFi=.01		variable/g T_twoDF=.01		variable/g T_twoDFi=.001		variable/g T_twoDW=1		variable/g T_2dUPdate=0		string/g T_curv_data_STR		curv_data()		Execute "Curv_Panel()"		Else			Dowindow/F Curv_Panel	EndifendFunction refresh_disp()	string/g t_curv_data_str	string edcname=t_curv_data_str+"_curvv"	string mdcname=t_curv_data_str+"_curvh"	string twodname=t_curv_data_str+"_curv2d"		string graphnameEnd//**************************************Peng Zhang curvature end***********************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************Function ButtonProc_legend_int_vs_BE(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	Label left "\\Z18\F'times'Intensity (arb. units)";DelayUpdate	Label bottom "\\Z18\F'times'\f02E - E\BF\f00\M\F'times'\Z18 (eV)"EndFunction ButtonProc_legend_BE_vs_angle(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	Label left "\\Z18\F'times'\f02E - E\BF\f00\M\F'times'\Z18 (eV)"	Label bottom "\Z18\F'times'Angle (degrees)"EndFunction ButtonProc_legendKyvsKx(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	Label left "\\Z18\\F'times'\\f02k\\By \\M\\Z18\\F'times'(\\F'symbol'p\\F'times'/\\f02a\\f00)"	Label bottom "\\Z18\\F'times'\\f02k\\Bx \\M\\Z18\\F'times'(\\F'symbol'p\\F'times'/\\f02a\\f00)"EndFunction ButtonProc_legendBEvsmompia(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	ModifyGraph margin(left)=60	Label left "\\Z18\F'times'\f02E - E\BF\f00\M\F'times'\Z18 (eV)"	Label bottom "\\Z18\\F'times'\\f02k\\B// \\M\\Z18\\F'times'(\\F'symbol'p\\F'times'/\\f02a\\f00)"EndFunction ButtonProc_legendBEvshv(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	Label left "\\Z18\F'times'\f02E - E\BF\f00\M\F'times'\Z18 (eV)"	Label bottom "\\Z18\F'times'h\F'Symbol'n\F'times' (eV)"EndFunction ButtonProc_legendBEvsmomang(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	Label left "\\Z18\F'times'\f02E - E\BF\f00\M\F'times'\Z18 (eV)";DelayUpdate	Label bottom "\Z18\F'times'Momentum (\S-1\M\F'times'\Z18)"	EndFunction ButtonProc_legend_KE_vs_angle(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	Label left "\\Z18\F'times'Kinetic energy (eV)";DelayUpdate	Label bottom "\Z18\F'times'Angle (degrees)"	EndFunction ButtonProc_Roughmapping_zlk(ctrlName) : ButtonControl	String ctrlName	Execute "RoughMapping_zlk()"EndFunction ButtonProc_dwavefit_zlk(ctrlName) : ButtonControl	String ctrlName	Execute "dwavefit_zlk()"EndFunction ButtonProc_dataformat_zlk(ctrlName) : ButtonControl	String ctrlName	Execute "dataformat_zlk()"End//Function ButtonProc_appendcalculation(ctrlName) : ButtonControl	//String ctrlName	//Execute "appendcalculation()"//EndFunction ButtonProc_makewave_zlk(ctrlName) : ButtonControl	String ctrlName	Execute "makewave_zlk()"EndFunction ButtonProc_MDCfig(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	ModifyGraph width=85.0394,height=141.732	ModifyGraph tick(bottom)=2    ModifyGraph fSize=16,axisEnab(left)={0,0.999},axisEnab(bottom)={0,0.999}EndFunction ButtonProc_auto(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	ModifyGraph width=0,height=0EndFunction ButtonProc_merge(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	ModifyGraph mirror=0,nticks=0,noLabel(top)=2,standoff=1,axRGB=(65535,65535,65535)EndFunction ButtonProc_layout(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1       //Layout as "fig_"	DrawLine 72,28,587,28	DrawLine 72,174,587,174	DrawLine 72,28,72,569	DrawLine 352,28,352,569	DrawLine 72,225,589,225	DrawLine 72,422,589,422EndFunction ButtonProc_Figformat(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	//ModifyImage data210_k ctab= {*,*,Terrain,1};DelayUpdate	//ModifyGraph width=141.732,height=141.732;DelayUpdate       //ModifyGraph zero(left)=4,fSize=12,font="Times";DelayUpdate       ModifyLayout frame=0,trans=1	ModifyGraph fSize=16,font="Times"	ModifyGraph zero(left)=4	//SetAxis left -1.7,0.2	ModifyGraph tick=2,fSize=12,font="Arial"	ModifyGraph width=113.386,height=141.732	ModifyGraph axisEnab(left)={0,0.999},axisEnab(bottom)={0,0.999}EndFunction ButtonProc_legend_int_vs_KE(ctrlName) : ButtonControl  	String ctrlName	PauseUpdate	Silent 1	Label left "\\Z12\F'times'Intensity (a.u)";DelayUpdate	Label bottom "\Z12\F'times'\f02k\B// \M\Z12\F'times'(\F'symbol'p\F'times'/\f02a\f00)"End