#pragma rtGlobals=1		// Use modern global access method.//templates//********************************************************************************************************************************Proc not_dv()	PauseUpdate	Silent 1	String name_of_graph,	Variable i,j	j=0	i=100	Do		name_of_graph="graph"+num2str(i)		Dowindow/F $name_of_graph//		TextBox/C/N=text0/F=0/S=3/M/H={0,1,10}/A=MC "\Z12\F'Symbol'G\F'Arial'-Y "+num2str(od71energy_of_data3[j])+" eV"		TextBox/C/N=text0/F=0/S=3/M/H={0,1,10}/A=MC "\Z12M-Y "+num2str(od71energy_of_data4[j])+" eV"		i+=1		j+=1	While(i<115)	End	//********************************************************************************************************************************	Proc resize2() //	PauseUpdate	Silent 1	String name	Variable i	i=68	Do		name="graph"+num2str(i)		Dowindow/F $name		ModifyGraph/W=$name width =110		ModifyGraph/W=$name height=150				SetAxis/W=$name bottom -1.2,-0.1				If(mod(i,2)==0)			SetAxis/W=$name left -4.5,-1			Else			SetAxis/W=$name left 0.0,0.2		Endif		i+=1	While(i<122)	End	//********************************************************************************************************************************	Proc polybackgnd(name,xstart,xend,order,cutstart,cutend,number)	String name	Variable xstart,xend,order,cutstart,cutend	Variable number=0	Prompt name,"Enter the name of the curve"	Prompt xstart,"Fit from:"	Prompt xend,"To:"	Prompt order,"Enter the order of the polynomial"	Prompt cutstart,"Remove weigth from:"	Prompt cutend,"To:"	Prompt number,"Number of the region"	PauseUpdate	Silent 1	String fittedname,newname	Variable x_val,igor_order	Variable nxstart,nxend,ncutstart,ncutend//fit_st,fit_end	Variable i,j	igor_order=order+1	fittedname="bgnd"+num2str(number)+name	newname="with_bgnd"+num2str(number)+name	Duplicate/O/R=(xstart,xend) $name $fittedname	Duplicate/O/R=(xstart,xend) $name weightwave	Duplicate/O/R=(xstart,xend) $name $newname	nxend=dimsize($newname,0)-1	ncutstart=Round((cutstart-dimoffset($newname,0))/dimdelta($newname,0))	ncutend=Round((cutend-dimoffset($newname,0))/dimdelta($newname,0))	weightwave[]=1	i=ncutstart	Do		weightwave[i]=0		i+=1	While(i<ncutend+1)	CurveFit/Q poly igor_order, $newname[0,nxend]/D /W=weightwave /I=1	$fittedname[]=0	i=0	Do 		x_val=dimoffset($fittedname,0)+i*dimdelta($fittedname,0)		j=0		Do			$fittedname[i]+=W_coef[j]*(x_val)^j			j+=1		While(j<igor_order)		i+=1	While(i<dimsize($fittedname,0))	Display	Appendtograph $newname,$fittedname	ModifyGraph rgb($fittedname)=(0,0,52224)	Label bottom "\\Z10Binding Energy (eV)"	Label left "\\Z10Intensity (arbitrary units)"	ModifyGraph width=125	ModifyGraph height=125	Resumeupdate	Modifygraph height=0,width=0	End			//********************************************************************************************************************************//********************************************************************************************************************************		//unchecked		//********************************************************************************************************************************Proc fit_vb_gen(name_wave,total_peaks,xstart,xend)	String name_wave="od71vb77_28"	Variable total_peaks	Variable xstart=-7.5		Variable xend=-1.1	Prompt name_wave,"Enter the name of the wave"	Prompt total_peaks,"Enter the number of peaks"	Prompt xstart,"Fit from: "	Prompt xstart,"Fit to: "	PauseUpdate	Silent 1	String fitted_name	String peak	Variable nval	Variable nmax	Variable x_value	Variable i	fitted_name="fit"+name_wave	Duplicate/O $name_wave $fitted_name	Make/O/N=(total_peaks) peak_type	Make/O/N=(total_peaks) peak_position_ini	Make/O/N=(total_peaks) peak_width_ini	Make/O/N=(total_peaks) peak_height_ini		i=0	Do		Define_pk()		peak_type[i]=peak_parameters[0]		peak_position_ini[i]=peak_parameters[1]		peak_width_ini[i]=peak_parameters[2]		peak_height_ini[i]=peak_parameters[3]		i+=1	While(i<total_peaks)	Make/O/N=(total_peaks*3+2) coeff	coeff[0]=0.05	coeff[1]=-0.05	i=0	Do		nmax=Round((peak_position_ini[i]-dimoffset($name_wave,0))/dimdelta($name_wave,0))		coeff[i*3+3]=peak_position_ini[i]				coeff[i*3+4]=peak_width_ini[i]+1000*peak_type[i]	//trick to transfer the peak_type information in the fit				coeff[i*3+2]=sqrt($name_wave[nmax]*peak_width_ini[i]*peak_width_ini[i]/peak_height_ini[i])		i+=1	While(i<total_peaks)	FuncFit/N/Q/H="00000" lorgauss coeff $name_wave (xstart,xend)	i=0	Do		x_value=i*dimdelta($name_wave,0)+dimoffset($name_wave,0)		$fitted_name[i]=lorgauss(coeff,x_value)		i+=1	While(i<dimsize($name_wave,0))	Display $name_wave	Appendtograph $fitted_name	End	//********************************************************************************************************************************Proc fit_vb_bl_fixed(name_wave,xstart,xend)	String name_wave="od71vb77_28"	Variable xstart=-7.5		Variable xend=-1.05	Prompt name_wave,"Enter the name of the wave"	Prompt xstart,"Fit from: "	Prompt xstart,"Fit to: "	PauseUpdate	Silent 1	String fitted_name	String peak,peak_c,peak_w,peak_s	String constraints_name	String constraints_name1,constraints_name2,constraints_name3,constraints_name4,constraints_name5		String constraints_name6,constraints_name7,constraints_name8,constraints_name9,constraints_name10	String constraints_name11,constraints_name12,constraints_name13,constraints_name14,constraints_name15		Variable nmax	Variable x_value	Variable total_peaks	Variable nline1,nline2	Variable line1,line2	Variable i,j	fitted_name="fit"+name_wave	Duplicate/O $name_wave $fitted_name	total_peaks=dimsize(pk_type,0)	Make/O/N=(total_peaks*3) coeff	peak_c=name_wave+"pk"+"_c"	peak_w=name_wave+"pk"+"_w"	peak_s=name_wave+"pk"+"_s"	Make/O/N=(total_peaks) $peak_c	Make/O/N=(total_peaks) $peak_w	Make/O/N=(total_peaks) $peak_s	Make/O/T/N=(2*total_peaks) T_Constraints	i=0	Do		constraints_name="K"+num2str(3*i+1)+">"+num2str(pk_position_ini[i]-3*pk_width_ini[i])		T_Constraints[2*i]={constraints_name}		constraints_name="K"+num2str(3*i+1)+"<"+num2str(pk_position_ini[i]+3*pk_width_ini[i])				T_Constraints[2*i+1]={constraints_name}		i+=1	While(i<total_peaks)	i=0	Do		peak=name_wave+"pk"+num2str(i)		Duplicate/O $name_wave $peak		i+=1	While(i<total_peaks)			i=0	Do		nmax=Round((pk_position_ini[i]-dimoffset($name_wave,0))/dimdelta($name_wave,0))		coeff[i*3+1]=pk_position_ini[i]				coeff[i*3+2]=pk_width_ini[i]+1000*pk_type[i]	//trick to transfer the peak_type information in the fit				coeff[i*3]=sqrt($name_wave[nmax]*pk_width_ini[i]*pk_width_ini[i]/pk_height_ini[i])		i+=1	While(i<total_peaks)	nline1=(-14.3-dimoffset($name_wave,0))/dimdelta($name_wave,0)	nline2=(-8.6-dimoffset($name_wave,0))/dimdelta($name_wave,0)	line1=($name_wave[nline2]-$name_wave[nline1])/(-8.6+14.3)	line2=$name_wave[nline1]+line1*14.3	FuncFit/N/Q/H="00000" lorgauss_bl_fixed coeff $name_wave (xstart,xend)/C=T_Constraints	i=0	Do			$peak_c[i]=coeff[3*i+1]		If(pk_type[i]==1)			$peak_w[i]=abs(coeff[3*i+2]-1000)			Else			$peak_w[i]=abs(coeff[3*i+2]-2000)		Endif		If(pk_type[i]==1)			$peak_s[i]=pi*(coeff[3*i])^2/$peak_w[i]			Else			$peak_s[i]=sqrt(pi)*$peak_w[i]*coeff[3*i]^2		Endif		i+=1	While(i<total_peaks)	edit $peak_c,$peak_w,$peak_s		i=0	Do		x_value=i*dimdelta($name_wave,0)+dimoffset($name_wave,0)		$fitted_name[i]=lorgauss_bl_fixed(coeff,x_value)		j=0		Do			peak=name_wave+"pk"+num2str(j)			if(pk_type[j]==1)				$peak[i]=line1*x_value+line2+($peak_s[j]*$peak_w[j]/pi)/((x_value-$peak_c[j])^2+$peak_w[j]^2)				Else					$peak[i]=line1*x_value+line2+$peak_s[j]/(sqrt(pi)*$peak_w[j])*exp(-(x_value-$peak_c[j])^2/$peak_w[j]^2)			Endif			j+=1		While(j<total_peaks)		i+=1	While(i<dimsize($name_wave,0))	Display $name_wave	Appendtograph $fitted_name	i=0	Do		peak=name_wave+"pk"+num2str(i)		Appendtograph $peak		i+=1	While(i<total_peaks)	End	//********************************************************************************************************************************Proc fit_peaks(name_wave,xstart,xend)	String name_wave="od71vb77_28"	Variable xstart=-7.5		Variable xend=-1.05	Prompt name_wave,"Enter the name of the wave"	Prompt xstart,"Fit from: "	Prompt xstart,"Fit to: "	PauseUpdate	Silent 1	String fitted_name	String peak,peak_c,peak_w,peak_s	String constraints_name	String constraints_name1,constraints_name2,constraints_name3,constraints_name4,constraints_name5		String constraints_name6,constraints_name7,constraints_name8,constraints_name9,constraints_name10	String constraints_name11,constraints_name12,constraints_name13,constraints_name14,constraints_name15		Variable nmax	Variable x_value	Variable total_peaks	Variable nline1,nline2	Variable line1,line2	Variable i,j	fitted_name="fit"+name_wave	Duplicate/O $name_wave $fitted_name	total_peaks=dimsize(pk_type,0)	Make/O/N=(total_peaks*3+2) coeff	peak_c=name_wave+"pk"+"_c"	peak_w=name_wave+"pk"+"_w"	peak_s=name_wave+"pk"+"_s"	Make/O/N=(total_peaks) $peak_c	Make/O/N=(total_peaks) $peak_w	Make/O/N=(total_peaks) $peak_s	Make/O/T/N=(2*total_peaks) T_Constraints	i=0	Do		constraints_name="K"+num2str(3*i+1+2)+">"+num2str(pk_position_ini[i]-3*pk_width_ini[i])		T_Constraints[2*i]={constraints_name}		constraints_name="K"+num2str(3*i+1+2)+"<"+num2str(pk_position_ini[i]+3*pk_width_ini[i])				T_Constraints[2*i+1]={constraints_name}		i+=1	While(i<total_peaks)	i=0	Do		peak=name_wave+"pk"+num2str(i)		Duplicate/O $name_wave $peak		i+=1	While(i<total_peaks)			i=0	Do		nmax=Round((pk_position_ini[i]-dimoffset($name_wave,0))/dimdelta($name_wave,0))		coeff[i*3+1+2]=pk_position_ini[i]				coeff[i*3+2+2]=pk_width_ini[i]+1000*pk_type[i]	//trick to transfer the peak_type information in the fit				coeff[i*3+2]=sqrt($name_wave[nmax]*pk_width_ini[i]*pk_width_ini[i]/pk_height_ini[i])		i+=1	While(i<total_peaks)//	nline1=(-14.3-dimoffset($name_wave,0))/dimdelta($name_wave,0)//	nline2=(-8.6-dimoffset($name_wave,0))/dimdelta($name_wave,0)//	line1=($name_wave[nline2]-$name_wave[nline1])/(-8.6+14.3)//	line2=$name_wave[nline1]+line1*14.3	FuncFit/N/Q/H="00000" lorgauss coeff $name_wave (xstart,xend)/C=T_Constraints	i=0	Do			$peak_c[i]=coeff[3*i+1+2]		If(pk_type[i]==1)			$peak_w[i]=abs(coeff[3*i+2+2]-1000)			Else			$peak_w[i]=abs(coeff[3*i+2+2]-2000)		Endif		If(pk_type[i]==1)			$peak_s[i]=pi*(coeff[3*i+2])^2/$peak_w[i]			Else			$peak_s[i]=sqrt(pi)*$peak_w[i]*coeff[3*i+2]^2		Endif		i+=1	While(i<total_peaks)	edit $peak_c,$peak_w,$peak_s		i=0	Do		x_value=i*dimdelta($name_wave,0)+dimoffset($name_wave,0)		$fitted_name[i]=lorgauss(coeff,x_value)		j=0		Do			peak=name_wave+"pk"+num2str(j)			if(pk_type[j]==1)				$peak[i]=coeff[1]*x_value+coeff[0]+($peak_s[j]*$peak_w[j]/pi)/((x_value-$peak_c[j])^2+$peak_w[j]^2)				Else					$peak[i]=coeff[1]*x_value+coeff[0]+$peak_s[j]/(sqrt(pi)*$peak_w[j])*exp(-(x_value-$peak_c[j])^2/$peak_w[j]^2)			Endif			j+=1		While(j<total_peaks)		i+=1	While(i<dimsize($name_wave,0))	Display $name_wave	Appendtograph $fitted_name	i=0	Do		peak=name_wave+"pk"+num2str(i)		Appendtograph $peak		i+=1	While(i<total_peaks)	End						//********************************************************************************************************************************Proc mkfit_ini_tbl()	PauseUpdate	Silent 1	Make/O/N=1 pk_type	Make/O/N=1 pk_position_ini	Make/O/N=1 pk_width_ini	Make/O/N=1 pk_height_ini	edit pk_type,pk_position_ini,pk_width_ini,pk_height_ini		End//********************************************************************************************************************************Proc fitwithbgnd(name_wave,xstart,xend,number)//not finished yet	String name_wave="od71vb88_75"	Variable xstart=1000		Variable xend=1000	Variable number	Prompt name_wave,"Enter the name of the wave"	Prompt xstart,"Fit from (1000=automatic): "	Prompt xstart,"Fit to (1000=automatic): "	Prompt number,"Number of the fitted range"	PauseUpdate	Silent 1	String fitted_name	String bgnd,with_bgnd	String peak,peak_c,peak_w,peak_s	String constraints_name	String constraints_name1,constraints_name2,constraints_name3,constraints_name4,constraints_name5		String constraints_name6,constraints_name7,constraints_name8,constraints_name9,constraints_name10	String constraints_name11,constraints_name12,constraints_name13,constraints_name14,constraints_name15		Variable nmax	Variable x_value	Variable total_peaks	Variable i,j	with_bgnd="with_bgnd"+num2str(number)+name_wave	bgnd="bgnd"+num2str(number)+name_wave	If(xstart==1000)		xstart=dimoffset($with_bgnd,0)	Endif	If(xend==1000)		xend=dimoffset($with_bgnd,0)+(dimsize($with_bgnd,0)-1)*dimdelta($with_bgnd,0)	Endif	fitted_name="fit"+num2str(number)+name_wave	Duplicate/O $with_bgnd $fitted_name	Duplicate/O $with_bgnd no_bgnd	no_bgnd[]=$with_bgnd[p]-$bgnd[p]	total_peaks=dimsize(pk_type,0)	Make/O/N=(total_peaks*3+2) coeff	coeff[]=0	peak_c=name_wave+num2str(number)+"pk"+"_c"	peak_w=name_wave+num2str(number)+"pk"+"_w"	peak_s=name_wave+num2str(number)+"pk"+"_s"	Make/O/N=(total_peaks) $peak_c	Make/O/N=(total_peaks) $peak_w	Make/O/N=(total_peaks) $peak_s	Make/O/T/N=(2*total_peaks) T_Constraints	i=0	Do		constraints_name="K"+num2str(3*i+1+2)+">"+num2str(pk_position_ini[i]-3*pk_width_ini[i])		T_Constraints[2*i]={constraints_name}		constraints_name="K"+num2str(3*i+1+2)+"<"+num2str(pk_position_ini[i]+3*pk_width_ini[i])				T_Constraints[2*i+1]={constraints_name}		i+=1	While(i<total_peaks)	i=0	Do		peak=name_wave+num2str(number)+"pk"+num2str(i)		Duplicate/O $with_bgnd $peak		i+=1	While(i<total_peaks)			i=0	Do		nmax=Round((pk_position_ini[i]-dimoffset(no_bgnd,0))/dimdelta(no_bgnd,0))		coeff[i*3+1+2]=pk_position_ini[i]				coeff[i*3+2+2]=pk_width_ini[i]+1000*pk_type[i]	//trick to transfer the peak_type information in the fit				coeff[i*3+2]=sqrt($with_bgnd[nmax]*pk_width_ini[i]*pk_width_ini[i]/pk_height_ini[i])		i+=1	While(i<total_peaks)	FuncFit/N/Q/H="00000" lorgauss coeff no_bgnd (xstart,xend)/C=T_Constraints	i=0	Do			$peak_c[i]=coeff[3*i+1+2]		If(pk_type[i]==1)			$peak_w[i]=abs(coeff[3*i+2+2]-1000)			Else			$peak_w[i]=abs(coeff[3*i+2+2]-2000)		Endif		If(pk_type[i]==1)			$peak_s[i]=pi*(coeff[3*i+2])^2/$peak_w[i]			Else			$peak_s[i]=sqrt(pi)*$peak_w[i]*coeff[3*i+2]^2		Endif		i+=1	While(i<total_peaks)	edit $peak_c,$peak_w,$peak_s		i=0	Do		x_value=i*dimdelta($name_wave,0)+dimoffset($name_wave,0)		$fitted_name[i]=lorgauss(coeff,x_value)+$bgnd[i]		j=0		Do			peak=name_wave+num2str(number)+"pk"+num2str(j)			if(pk_type[j]==1)				$peak[i]=coeff[0]+coeff[1]*x_value+($peak_s[j]*$peak_w[j]/pi)/((x_value-$peak_c[j])^2+$peak_w[j]^2)+$bgnd[i]				Else					$peak[i]=coeff[0]+coeff[1]*x_value+$peak_s[j]/(sqrt(pi)*$peak_w[j])*exp(-(x_value-$peak_c[j])^2/$peak_w[j]^2)+$bgnd[i]			Endif			j+=1		While(j<total_peaks)		i+=1	While(i<dimsize($with_bgnd,0))	Display $with_bgnd	Appendtograph $fitted_name	ModifyGraph rgb($fitted_name)=(0,0,52224)	i=0	Do		peak=name_wave+num2str(number)+"pk"+num2str(i)		Appendtograph $peak		ModifyGraph lsize($peak)=2,rgb($peak)=(0,39168,19712)		i+=1	While(i<total_peaks)End	//********************************************************************************************************************************Proc fitbilayer(name,num)	String name	Variable num=3	Prompt name,"Enter the name of the sample"	Prompt num,"Enter the number of the table"	PauseUpdate	Silent 1	String thiswave,name_of_energy	String peak,fitwave	Variable i,j,num_of_peaks,xstart,xend,xval	num_of_peaks=3		Make/O/N=(num_of_peaks) range_down	Make/O/N=(num_of_peaks) range_up	Make/O/N=(3*num_of_peaks+1) W_coeff//	Make/O/T/N=(2) T_Constraints//	T_Constraints[0]={"K0>-1","K0<1"}			W_coeff[]=0		xstart=-4.1	xend=-1.12	range_down[0]=-1.47	range_up[0]=-0.96	range_down[1]=-2.3	range_up[1]=-1.76	range_down[2]=-4.4		range_up[2]=-2.8	name_of_energy=name+"energy_of_data"+num2str(num)	j=0	Do		peak=name+num2str(num)+"_peak"+num2str(j)		Make/O/N=(dimsize($name_of_energy,0)) $peak		j+=1	While(j<num_of_peaks)			i=0	Do		thiswave=name+"vb"+num2str(num)+"_"+num2str($name_of_energy[i])		Duplicate/O $thiswave tempwave		SNT(tempwave,5,5)		Differentiate tempwave		SNT(tempwave,5,5)		Differentiate tempwave		j=0		Do			peak=name+num2str(num)+"_peak"+num2str(j)			Wavestats/Q/R=(range_down[j],range_up[j]) tempwave						$peak[i]=V_minloc			j+=1		While(j<num_of_peaks)				i+=1	While(i<dimsize($name_of_energy,0))	Display	j=0	Do		peak=name+num2str(num)+"_peak"+num2str(j)			Appendtograph $peak vs $name_of_energy			j+=1	While(j<num_of_peaks)		i=0	Do		print i			thiswave=name+"vb"+num2str(num)+"_"+num2str($name_of_energy[i])			fitwave="fitbi_"+thiswave		Duplicate/O $thiswave $fitwave		W_coeff[0]=0		W_coeff[3]=sqrt(0.2)		W_coeff[6]=sqrt(0.4)			W_coeff[9]=1		j=0		Do			peak=name+num2str(num)+"_peak"+num2str(j)			Wavestats/Q/R=(range_down[j],range_up[j]) $thiswave						W_coeff[3*j+1]=sqrt(V_max*W_coeff[3*j+3]^2)			W_coeff[3*j+2]=$peak[i]			j+=1		While(j<num_of_peaks)			xstart=$peak[i]-0.5		FuncFit/N/Q/H="1010010010" funclorentz3 W_coeff $fitwave (xstart,xend)//[x2pnt($fitwave,xstart),x2pnt($fitwave,xend)] 		print "banane",fit_coeff[0]		j=0		Do			xval=dimoffset($thiswave,0)+j*dimdelta($thiswave,0)			$fitwave[j]=funclorentz3(fit_coeff,xval)			j+=1		while(j<dimsize($thiswave,0))		Display		Appendtograph $thiswave				Appendtograph $fitwave						i+=1	While(i<dimsize($name_of_energy,0))		End	//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************//********************************************************************************************************************************Function lorgauss(m,x)	wave m; variable x	Variable i,num_pks,partial_sum	Nvar peak_type	num_pks=(dimsize(m,0)-2)/3	Make/O/N=(num_pks) the_type	i=0	Do		If(m[3*i+4]>2000)			the_type[i]=2			Else				the_type[i]=1		Endif		i+=1	While(i<num_pks)	partial_sum=0	partial_sum+=m[0]+m[1]*x	i=0	Do		If(the_type[i]==1)			partial_sum+=m[3*i+2]^2/((x-m[3*i+3])^2+(m[3*i+4]-1000)^2)			Else			partial_sum+=m[3*i+2]^2*exp(-(x-m[3*i+3])^2/(m[3*i+4]-2000)^2)		Endif		i+=1	While(i<num_pks)		return (partial_sum)End//********************************************************************************************************************************Function lorgauss_strait(m,x)	wave m; variable x	Variable i,num_pks,partial_sum	Nvar peak_type	num_pks=(dimsize(m,0))/3	Make/O/N=(num_pks) the_type	i=0	Do		If(m[3*i+2]>2000)			the_type[i]=2			Else				the_type[i]=1		Endif		i+=1	While(i<num_pks)	partial_sum=0	i=0	Do		If(the_type[i]==1)			partial_sum+=m[3*i]^2/((x-m[3*i+1])^2+(m[3*i+2]-1000)^2)			Else			partial_sum+=m[3*i]^2*exp(-(x-m[3*i+1])^2/(m[3*i+2]-2000)^2)		Endif		i+=1	While(i<num_pks)		return (partial_sum)End//********************************************************************************************************************************Function lorgauss_bl_fixed(m,x)	wave m; variable x	Variable i,num_pks,partial_sum	Nvar line1,line2	num_pks=(dimsize(m,0))/3	Make/O/N=(num_pks) the_type	i=0	Do		If(m[3*i+2]>2000)			the_type[i]=2			Else				the_type[i]=1		Endif		i+=1	While(i<num_pks)	partial_sum=0	partial_sum+=line1*x+line2	i=0	Do		If(the_type[i]==1)			partial_sum+=m[3*i]^2/((x-m[3*i+1])^2+(m[3*i+2]-1000)^2)			Else			partial_sum+=m[3*i]^2*exp(-(x-m[3*i+1])^2/(m[3*i+2]-2000)^2)		Endif		i+=1	While(i<num_pks)		return (partial_sum)End//********************************************************************************************************************************Proc savebulkim()	PauseUpdate	Silent 1	String name	Variable i	i=0	Do 		name="bulk_left_m0_"+num2str(5*i)+"right"		bulk_im[][]=leftpol[p][q]-(i*0.05)*rightpol[p][q]		dowindow/F bulk_graph		savegraph(name,4)		i+=1	While(i<9)End		//********************************************************************************************************************************Function funclorentz3(m,x) : fitfunc	Wave m;	Variable x//	return (m[0]^2+m[1]^2/((x-m[2])^2+m[3]^2)+m[4]^2/((x-m[5])^2+m[6]^2)+m[7]^2/((x-m[8])^2+m[9]^2))	return (m[0]^2+m[1]^2*exp(-m[3]^2*(x-m[2])^2)+m[4]^2*exp(-m[6]^2*(x-m[5])^2)+m[7]^2*exp(-m[9]^2*(x-m[8])^2))End//********************************************************************************************************************************Proc mdc_profile(matname,slice_low,slice_high)	String matname	Variable slice_low	Variable slice_high		Prompt matname,"Enter the name of the matrix"	Prompt slice_low,"Enter the first slice"	Prompt slice_high,"Enter the last slice"	PauseUpdate	Silent 1				Variable i	Make/O/N=(dimsize($matname,0)) tempvector	Setscale/p x, dimoffset($matname,0),dimdelta($matname,0),"" tempvector	tempvector[]=0	i=slice_low	Do		tempvector[]+=$matname[p][i]		i+=1	While(i<slice_high+1)	tempvector[]/=(slice_high-slice_low+1)	Display tempvectorEnd//********************************************************************************************************************************Proc unstore_edc_ef(number)	Variable number	Prompt number,"Enter the number of the list"	PauseUpdate	Silent 1	String thiswave,the_list	Variable i	the_list="list_edc_ef"+num2str(number)	i=0	Do		thiswave="ecut"+$the_list[i]+".ibw"		Loadwave/O/P=home thiswave				i+=1	While(i<dimsize($the_list,0))End//********************************************************************************************************************************Proc save_edckfname(numcbm)	Variable numcbm	Prompt numcbm,"Enter the number of combined EDCs"	PauseUpdate	Silent 1	String thiswave	Variable i	i=0	Do		thiswave="ecut"+num2str(oldphiedckf[i])+"_k_"+num2str(numcbm)+"_"+num2str(edckfindex[i])		wave2filenokill(thiswave)		i+=1	While(i<dimsize(edckfindex,0))End	//********************************************************************************************************************************Proc normcut2one()	PauseUpdate	Silent 1	String thiswave	Variable i	Variable newdelta	Variable newoffset	i=0	Do		thiswave="cut"+num2str(phiindex[i])+"_k"//		newdelta=3.8*dimdelta($thiswave,0)/Pi//		newoffset=3.8*dimoffset($thiswave,0)/Pi		Setscale/P x,newoffset,newdelta,""$thiswave		wave2filenokill(thiswave)		i+=1	While(i<dimsize(phiindex,0))End	//********************************************************************************************************************************Proc derive_all()	PauseUpdate	Silent 1	String thiswave	Variable the_size	Variable i,j	i=0	Do		thiswave="cut"+num2str(phiindex[i])+"_k"		DerivMatrix(thiswave,7,7,1)		i+=1	While(i<dimsize(phiindex,0))End	//********************************************************************************************************************************Proc plot_and_adjust2dv()	PauseUpdate	Silent 1	String thiswave,name,phiname	Variable the_size	Variable i,j	j=34	i=0	Do		thiswave="cut"+num2str(phiindex[i])+"_k"		DerivMatrix(thiswave,7,7,1)		thiswave="cut"+num2str(phiindex[i])+"_kVD"		the_size=(dimsize($thiswave,0)-1)*dimdelta($thiswave,0)		name="graph"+num2str(j)		phiname=num2str(realkphi[i])		Dowindow/F $name//		ModifyImage $thiswave ctab= {*,0,Terrain,1}						ModifyGraph/W=$name width =300*the_size		ModifyGraph/W=$name height=300	//		Label bottom "\Z12\F'Symbol'q\F'Arial' (degrees)"		Label bottom "\Z12k (\F'Symbol'p\F'Arial'/a)"		Label left "\Z12Binding energy (eV)"		TextBox/C/N=text1/F=0/S=3/H={0,1,10}/A=LT "\Z12\F'Symbol'j\F'Arial' = "+phiname		j+=1		i+=1	While(i<dimsize(phiindex,0))End	//**********************************************************************************************************************Proc savecuts()	PauseUpdate	Silent 1	Variable i,j	String name,thiswave	i=0	Do		thiswave="cut"+num2str(phiindex[i])		wave2filenokill(thiswave)		thiswave="cut"+num2str(phiindex[i])+"_k"		wave2filenokill(thiswave)				i+=1	While(i<dimsize(phiindex,0))End			//**********************************************************************************************************************Proc Tdep_temp(num_to_combine)	Variable num_to_combine	PauseUpdate	Silent 1	String thisdata	String thiswave	String symname	Variable i,j	Variable position	Display	i=0	Do		thisdata="data"+num2str(Tdep1_index[i])		thiswave="Tdep1_"+num2str(Tdep1[i])		symname="sym_"+thiswave		position=Round((Tdep1_angle[i]-dimoffset($thisdata,0))/dimdelta($thisdata,0))		Make/O/N=(dimsize($thisdata,1)) $thiswave		Setscale/P x,dimoffset($thisdata,1),dimdelta($thisdata,1),""$thiswave		$thiswave[]=0		j=position-(num_to_combine-1)		Do			$thiswave[]+=$thisdata[j][p]			j+=1		While(j<position+(num_to_combine-1)+1)		$thiswave[]/=num_to_combine		Remove_simplebgnd_edc(thiswave,2,60)		sym_one_edc(thiswave,4.0424)		appendtograph $symname		i+=1	While(i<dimsize(Tdep1_index,0))End	//**********************************************************************************************************************Proc Tdep_temp1()	PauseUpdate	Silent 1	String thisdata	String thiswave	String newwave	String symname	Variable i,j	Variable position	Display	i=0	Do		thiswave="Tdep1_"+num2str(Tdep1[i])		symname="sym_"+thiswave		newwave="flat"+symname		Duplicate/O $symname $newwave		$newwave[]-=banane[p]		appendtograph $newwave		i+=1	While(i<dimsize(Tdep1_index,0))End	//**********************************************************************************************************************Proc getslopes()	PauseUpdate	Silent 1	String newwave	Variable i,j	Make/O/N=11 slopesabove	Make/O/N=11 b_above	Make/O/N=11 slopesabove_err	Make/O/N=11 b_above_err	Setscale/P x,3,1,""slopesabove	Setscale/P x,3,1,""b_above		i=3	Do		newwave="DOSabove"+num2str(i)		CurveFit/Q/NTHR=0 line  $newwave[0,90] /D 				slopesabove[i-3]=W_coef[1]		b_above[i-3]=W_coef[0]		slopesabove_err[i-3]=W_sigma[1]		b_above_err[i-3]=W_sigma[0]				i+=1	While(i<dimsize(File_name,0)-2)End	//**********************************************************************************************************************Proc norm_transmission_above()	PauseUpdate	Silent 1	String thisdata	String newwave	Variable i,j	Variable position	Display	i=3	Do		thisdata="data"+num2str(i)		newwave="DOSabove"+num2str(i)		Make/O/N=(dimsize($thisdata,1)) $newwave		$newwave[]=$thisdata[0][p]		Setscale/P x,dimoffset($thisdata,1)-16.855,dimdelta($thisdata,1),""$newwave						Wavestats/Q/R=(17.14-16.855,(dimsize($thisdata,1)-1)*dimdelta($thisdata,1)+dimoffset($thisdata,1)-16.855) $newwave		$newwave[]-=V_avg		$newwave[]/=V_avg		appendtograph $newwave		i+=1	While(i<dimsize(File_name,0)-2)End			//********************************************************************************************************************************Proc text_to_pxt(datanumber)	Variable datanumber	Prompt datanumber,"Enter the number of the data"	PauseUpdate	Silent 1	String matname,thiswave	Variable i	thiswave="wave"+num2str(0)		matname="data"+num2str(datanumber)	Make/O/N=(20,dimsize($thiswave,0)) $matname	Setscale/P y,$thiswave[0],$thiswave[1]-$thiswave[0],""$matname	Setscale/P x,bidon[0],bidon[1]-bidon[0],""$matname	i=1	Do		thiswave="wave"+num2str(i)		$matname[i-1][]=$thiswave[q]		Killwaves $thiswave		i+=1	While(i<21)	Killwaves wave0	Display	Appendimage $matname//	i=0//	Do	End		//********************************************************************************************************************************Proc au_temp(datanumber)	Variable datanumber	Prompt datanumber,"Enter the number of the data"	PauseUpdate	Silent 1	String matname,thiswave	Variable i	matname="data"+num2str(datanumber)	i=0	Display	Do		thiswave=matname+"wave"+num2str(i)		Make/O/N=(dimsize($matname,1)) $thiswave		$thiswave[]=$matname[i][p]		Setscale/P x,dimoffset($matname,1),dimdelta($matname,1),""$thiswave		Appendtograph $thiswave		i+=1	While(i<dimsize($matname,0))	thiswave="cb_all1_data"+num2str(datanumber)	$thiswave/=dimsize($matname,0)	Appendtograph $thiswave	ModifyGraph rgb($thiswave)=(0,0,0)		End		//********************************************************************************************************************************Proc copycut_hv(hv)	Variable hv	Prompt hv,"Enter the photon energy" 	PauseUpdate	Silent 1	String cutname,newname	Variable i	i=0	Do		cutname="cut"+num2str(phiindex[i])		newname=cutname+"hv"+num2str(hv)		Duplicate/O $cutname $newname		i+=1	While(i<dimsize(phiindex,0))	End		//********************************************************************************************************************************Proc fermi_au(thiswave)	String thiswave	Prompt thiswave,"Enter the name of the wave" 	PauseUpdate	Silent 1	Variable ef_guess,px1,px2,py1,py2	Make/O/N=4 W	Make/O/N=2 slope	slope[0]=-1	slope[1]=1	CurveFit line $thiswave[pcsr(A),pcsr(A)+10] /D //	FuncFit/Q fit_slope slope $thiswave(xcsr(A),xcsr(A)+10*dimdelta($thiswave,0))  /D		Duplicate/O $thiswave tempwave	Smooth 4, tempwave	px1=xcsr(A)	px2=xcsr(A)+15*dimdelta($thiswave,0)	py1=Vcsr(A)	py2=$thiswave[pcsr(A)+15]	Differentiate tempwave	Smooth 4, tempwave	Wavestats/Q/R=[pcsr(A),pcsr(B)] tempwave	ef_guess=V_minloc	//	W[0]=(py2-py1)/(px2-px1)	W[0]=k1	W[1]=k0	W[2]=1/0.012	W[3]=ef_guess*W[2]	FuncFit/Q fit_fermi w $thiswave(xcsr(A),xcsr(B))  /D	Print W[0],W[1],W[2],W[3]	Print W[3]/W[2]		Killwaves W,slopeEnd	//********************************************************************************************************************************Function fit_slope(slope,x)	wave slope; Variable x	return (slope[0]*x+slope[1])End//*******************************************************************************************************************************Proc doallkvd()	PauseUpdate	Silent 1	String matname,matname1	Variable i	i=0	Do		matname="cut"+num2str(phiindex[i])+"_k"		derivmat(matname,7,7,1)		matname1=matname+"VD"		wave2filenokill(matname1)		i+=1	While(i<dimsize(phiindex,0))End	//*******************************************************************************************************************************Proc normwithvb()	PauseUpdate	Silent 1	String dataname,vbname	Variable i,j	i=0	Do		dataname="data"+num2str(tonorm[i])		vbname="data"+num2str(vbnorm[i])		Make/O/N=(dimsize($dataname,0)) nk		j=0		Do			nk[]+=$vbname[p][j]			j+=1		While(j<dimsize($vbname,0))		nk[]/=dimsize($vbname,1)		Smooth/E=3 4, NK				gv_groupNum=efnorm[i]		sub_bline_pi(10)		$dataname[][]/=nk[p]		i+=1	While(i<dimsize(vbnorm,0))	End	//*******************************************************************************************************************************Proc convertforzrs(sample,gamma,work,first_energy)	String sample	Variable gamma	Variable work=4.333	Variable first_energy=8	Prompt sample,"Enter the name of the sample"	Prompt gamma,"Enter the position of gamma"	Prompt work,"Enter the work potentiel"	Prompt first_energy,"Energy (below Ef) from which you start normalization"	PauseUpdate	Silent 1	String energy_name,wr_name,nr_name,newname,oldname	Variable i	Variable first_index,last_index	energy_name=sample+"energy_of_data"	wr_name=sample+"wr"	nr_name=sample+"nr"	i=0	Do		newname=sample+num2str($energy_name[i])		oldname="data"+num2str($wr_name[i])		Duplicate/O  $oldname $newname		first_index=Round(($energy_name[i]-work-first_energy-dimoffset($oldname,1))/dimdelta($oldname,1))		last_index=dimsize($oldname,1)-1		normcut(newname,first_index,last_index)		rescale_pi(newname,1,initialtheta[i]-gamma)		cvt2ek_pi(newname,1,$energy_name[i]-work,0)		killwaves $newname		i+=1	While(i<dimsize($energy_name,0))	End		//*******************************************************************************************************************************Proc savekcuts(sample)	String sample	Prompt sample,"Enter the name of the sample"	PauseUpdate	Silent 1	Variable i	String energywave,cutkmat	energywave=sample+"energy_of_data"	i=0	Do		cutkmat=sample+num2str($energywave[i])+"_k"		wave2filenokill(cutkmat)		i+=1	While(i<dimsize($energywave,0))	End		//*******************************************************************************************************************************Proc cutdata()	PauseUpdate	Silent 1	Variable i,j	String dataname,newname	i=0	Do		dataname="data"+num2str(imageindex[i])		newname="data"+num2str(imageindex[i]+500)		Make/O/N=(dimsize($dataname,0),141) $newname		Setscale/P x,dimoffset($dataname,0),dimdelta($dataname,0),""$newname		Setscale/P y,17.24,dimdelta($dataname,1),""$newname		j=85		Do			$newname[][j-85]=$dataname[p][j]			j+=1		While(j<dimsize($dataname,1))		i+=1	While(i<10)End		//*******************************************************************************************************************************Proc find_ycomp(name,angle,ef,factor)	String name	Variable angle	Variable ef	Variable factor	Prompt name,"Enter the name of the vector"	Prompt angle,"Enter the phi angle"	Prompt ef,"Enter the kinetic energy at Ef"	Prompt factor,"Enter the conversion factor"//   pi/a	PauseUpdate	Silent 1	String xname,yname	xname="x_"+name	yname="y_"+name	Duplicate/O $xname $yname	$yname[]=sin(angle*pi/180)*sqrt(0.51231^2*($name[p]+ef)-($xname[p]*factor)^2)/factor	End		//*******************************************************************************************************************************Proc tosave()	PauseUpdate	Silent 1	String thiswave	Variable i	i=180	Do		thiswave="mpi94_GX_sym_5_"+num2str(i)+"_0_516"		wave2filenokill(thiswave)		i+=10	While(i<401)	End		//******************************************************************************************************************************Proc symright(name)	String name	Prompt name,"Enter the name of the matrix"	PauseUpdate	Silent 1	String newname	Variable i,j	Variable lastvalue,lastpoint	Variable newsize,newdelta	Variable xvalue,interpval	newname=name+"_sym"	lastpoint=dimsize($name,0)-1	lastvalue=dimoffset($name,0)+lastpoint*dimdelta($name,0)	newsize=2*Ceil(lastvalue/dimdelta($name,0))+2	newdelta=2*lastvalue/(newsize-1)	Make/O/N=(newsize,dimsize($name,1)) $newname	Setscale/P x,-lastvalue,newdelta,""$newname	Setscale/P y,dimoffset($name,1),dimdelta($name,1),""$newname	i=0	Do			if(mod(i,10)==0)			Print i,"/",dimsize($name,1)		Endif		Make/O/N=(dimsize($name,0)) xwave		Make/O/N=(dimsize($name,0)) ywave		xwave[]=dimoffset($name,0)+p*dimdelta($name,0)		ywave[]=$name[p][i]		j=0		Do			xvalue=lastvalue-j*newdelta			interpval=Interp(xvalue,xwave,ywave)			$newname[newsize-1-j][i]=interpval			$newname[j][i]=interpval			j+=1		While(j<(dimsize($newname,0)-1)/2+1)		i+=1	While(i<dimsize($newname,1))	Killwaves xwave,ywave	Display	Appendimage $newname	End		//********************************************************************************************************************************Proc openalldif(e_from) //normalize above EF	Variable e_from	Prompt e_from,"Normalize from (E):"	PauseUpdate	Silent 1	String mat_name_data,this_bad	Variable i,j,k	Variable first_slice,last_slice	i=0	Do			gv_groupNum=Imageindex[i]		mat_name_data="data"+num2str(Imageindex[i])		this_bad="bds"+num2str(Imageindex[i])		duplicate/O $this_bad bad_slices				first_slice=Round((e_from-dimoffset($mat_name_data,1))/dimdelta($mat_name_data,1))		last_slice=dimsize($mat_name_data,1)-1		MatNKPlot(first_slice,last_slice)		Make/O/N=0 nktemp		Make/O/N=0 nktempx		k=0		j=0		Do			if(j!=bad_slices[k])				Insertpoints dimsize(nktemp,0),1,nktemp				Insertpoints dimsize(nktempx,0),1,nktempx				nktemp[dimsize(nktemp,0)-1]=NK[j]				nktempx[dimsize(nktempx,0)-1]=dimoffset(NK,0)+j*dimdelta(NK,0)				Else					k+=1			Endif			j+=1		While(j<dimsize($mat_name_data,0))		Smooth/E=3/B=7 7, nktemp		j=0		Do			NK[j]=Interp(dimoffset(NK,0)+j*dimdelta(NK,0),nktempx,nktemp)			j+=1		While(j<dimsize(NK,0))		Smooth/E=3/B=5 5, nk				Killwaves nktemp,nktempx						sub_bline_pi(10)		MatNorm()//		killwaves tempmatcalc,tempwavecalc		i+=1	While(i<dimsize(Imageindex,0))									End		//********************************************************************************************************************************Proc mkallbds()	PauseUpdate	Silent 1	String bds	Variable i	Edit	i=0	Do		bds="bds"+num2str(imageindex[i])		Make/O/N=0 $bds		Appendtotable $bds		i+=1	While(i<dimsize(imageindex,0))	End		//*******************************************************************************************************************************Proc mkallfp()	PauseUpdate	Silent 1	String fp,fpx	Variable i	Edit	i=0	Do		fp="fp"+num2str(phiindex[i])		fpx="fpx"+num2str(phiindex[i])		Make/O/N=0 $fpx		Make/O/N=0 $fp		Appendtotable $fpx,$fp		i+=1	While(i<dimsize(phiindex,0))	End	//********************************************************************************************************************************Proc funimage()	PauseUpdate	Silent 1	Variable i	Make/N=(dimsize(Pierre1,0),dimsize(Pierre1,1)) red_Pierre	Make/N=(dimsize(Pierre1,0),dimsize(Pierre1,1)) blue_Pierre	Make/N=(dimsize(Pierre1,0),dimsize(Pierre1,1)) green_Pierre		red_Pierre[][]=Pierre1[p][q][0]	blue_Pierre[][]=Pierre1[p][q][1]	green_Pierre[][]=Pierre1[p][q][2]		Display;appendimage red_Pierre	Display;appendimage blue_Pierre	Display;appendimage green_Pierre	End	//********************************************************************************************************************************Proc funimage1()	PauseUpdate	Silent 1	Variable i	Duplicate/O Pierre Pierre1	i=0	Do		Pierre1[i][]=Pierre[i][dimsize(Pierre,1)-1-q]		i+=1	While(i<dimsize(Pierre,0))End//*******************************************************************************************************************************Proc adjust_fp()	PauseUpdate	Silent 1	String thiscut	Variable newmin,newmax,newsize	Variable thismin,thismax	Variable i,j,k	newmin=-999999	newmax=999999	//Finding the new bondaries	i=0	Do		thiscut="cut"+num2str(phiindex[i])		thismin=dimoffset($thiscut,1)		thismax=dimoffset($thiscut,1)+(dimsize($thiscut,1)-1)*dimdelta($thiscut,1)		If(thismax<newmax)			newmax=thismax		Endif		If(thismin>newmin)			newmin=thismin		Endif		i+=1	While(i<dimsize(phiindex,0))	print newmin,newmax,thiscut	newsize=Floor((newmax-newmin)/dimdelta($thiscut,1))	print newsize	//Readjusting the matrices	i=0	Do		thiscut="cut"+num2str(phiindex[i])			Print thiscut		Make/O/N=(dimsize($thiscut,1)) tempwave		Make/O/N=(dimsize($thiscut,1)) tempwavex		Make/O/N=(dimsize($thiscut,0),newsize) tempmat		Setscale/P x,dimoffset($thiscut,0),dimdelta($thiscut,0),""tempmat		Setscale/P y,newmin,dimdelta($thiscut,1),""tempmat		j=0		Do			tempwave[]=$thiscut[j][p]			tempwavex[]=dimoffset($thiscut,1)+p*dimdelta($thiscut,1)			k=0			Do				tempmat[j][k]=Interp(newmin+k*dimdelta(tempmat,1),tempwavex,tempwave)				k+=1			While(k<newsize)			j+=1		While(j<dimsize($thiscut,0))		Duplicate/O tempmat $thiscut					i+=1	While(i<dimsize(phiindex,0))	Killwaves tempwave,tempwavex,tempmatEnd			//*******************************************************************************************************************************Proc correct_fp(fermil)	Variable fermil	Prompt fermil,"Enter the Fermi level position"	PauseUpdate	Silent 1	String fp,thiscut	Variable i,j,k	Variable newmax,newmin,newsize	i=0	Do		Print phiindex[i]		fp="fp"+num2str(phiindex[i])		thiscut="cut"+num2str(phiindex[i])		If(dimsize($fp,0)!=0)			Wavestats/Q $fp			newmin=dimoffset($thiscut,1)+fermil-V_min			newmax=dimoffset($thiscut,1)+fermil-V_max+(dimsize($thiscut,1)-1)*dimdelta($thiscut,1)			newsize=Floor((newmax-newmin)/dimdelta($thiscut,1))			Make/O/N=(dimsize($thiscut,0),newsize) tempmat			Setscale/P x,dimoffset($thiscut,0),dimdelta($thiscut,0),""tempmat			Setscale/P y,newmin,dimdelta($thiscut,1),""tempmat			j=0			Do				Make/O/N=(dimsize($thiscut,1)) tempwave				Make/O/N=(dimsize($thiscut,1)) tempwavex				tempwave[]=$thiscut[j][p]				tempwavex[]=dimoffset($thiscut,1)+p*dimdelta($thiscut,1)+fermil-$fp[j]				k=0				Do					tempmat[j][k]=Interp(newmin+k*dimdelta($thiscut,1),tempwavex,tempwave)					k+=1				While(k<newsize)				j+=1			While(j<dimsize($thiscut,0))			Duplicate/O tempmat $thiscut		Endif		i+=1	While(i<dimsize(phiindex,0))	Killwaves tempmat,tempwave,tempwavex	End		//*******************************************************************************************************************************Proc makekfedc()	PauseUpdate	Silent 1	Variable i,j,num_x	String thiscut,thisedc	Display	i=0	Do		thiscut="cut"+num2str(fs_y13[i])		thisedc="fs13_edc"+num2str(i)		Duplicate/O $thiscut thetempcut		Matrixfilter/N=3/P=3 gauss thetempcut		Make/O/N=(dimsize(thetempcut,1)) addedc		num_x=Round((fs_x13[i]-dimoffset(thetempcut,0))/dimdelta(thetempcut,0))		Make/O/N=(dimsize(thetempcut,1)) $thisedc		Setscale/P x,dimoffset(thetempcut,1),dimdelta(thetempcut,1),""$thisedc		$thisedc[]=0		j=num_x-1		Do			$thisedc[]+=thetempcut[j][p]			j+=1		While(j<num_x+1+1)		$thisedc[]/=3		appendtograph $thisedc		i+=1	While(i<dimsize(fs_x13,0))	Killwaves thetempcut	End		//*******************************************************************************************************************************Proc putplus()	PauseUpdate	Silent 1	String xgapwave	Variable i	xgapwave="thexilargepic"	i=0	Do		if($xgapwave[i]<0)			$xgapwave[i]*=-1		Endif		i+=1	While(i<dimsize($xgapwave,0))	End		//*******************************************************************************************************************************Proc put45()	PauseUpdate	Silent 1	Variable i,banane	Duplicate/O red104gm_angle red104gm_angle45	i=0	Do		if(red104gm_angle[i]>45)			banane=45-(red104gm_angle[i]-45)			red104gm_angle45[i]=banane		Endif		i+=1	While(i<dimsize(red104gm_angle45,0))	End		//*******************************************************************************************************************************Proc comp_symedc(sample1,cutname1,first_edc1,sample2,cutname2,first_edc2,total_number,showevery)	String sample1	String cutname1	Variable first_edc1	String sample2	String cutname2	Variable first_edc2		Variable total_number	Variable showevery	Prompt sample1,"Enter the name of the first sample"		Prompt cutname1,"Enter the name of the cut"	Prompt first_edc1,"Enter the numer of the first edc"	Prompt sample2,"Enter the name of the second sample"		Prompt cutname2,"Enter the name of the cut"	Prompt first_edc2,"Enter the numer of the first edc"			Prompt total_number,"Enter the number of EDCs to load."	Prompt showevery,"Show one EDC every ... :"		PauseUpdate	Silent 1	String thisedc1,thisedc2	Variable i,j,index	Display	i=first_edc1	j=first_edc2	index=0	Do		thisedc1=sample1+"_"+cutname1+"_edc"+num2str(i)		thisedc2=sample2+"_"+cutname2+"_edc"+num2str(j)		$thisedc1[][]*=3		If(Mod(index,showevery)==0)			Appendtograph $thisedc1			Appendtograph $thisedc2			ModifyGraph rgb($thisedc2)=(0,0,65535)		Endif		j+=1		i+=1		index+=1	While(index<total_number)	End	//*******************************************************************************************************************************Proc GXMG_image()	PauseUpdate	Silent 1	String matGX,matXM,matMG	String matfinal	Variable i,j,deltak,deltae	Variable newsize	Variable thisk	Variable index_old	Variable factor_up,factor_down	matGX="pccoGX735"	matXM="pccoMX735"	matMG="pccoGM735"	matfinal="pcco735GXMG"	deltak=dimdelta($matGX,0)	deltae=dimdelta($matGX,1)	newsize=Round((2+sqrt(2))/deltak)+1	deltak=(2+sqrt(2))/(newsize-1)	Make/O/N=(newsize,dimsize($matGX,1)) $matfinal	Setscale/P x,0,deltak,"" $matfinal	Setscale/P y,dimoffset($matGX,1),deltae,""$matfinal	i=0	Do		thisk=i*deltak		index_old=Floor((thisk-dimoffset($matGX,0))/(dimdelta($matGX,0)))		factor_up=(thisk-dimoffset($matGX,0)-index_old*dimdelta($matGX,0))/dimdelta($matGX,0)		factor_down=1-factor_up		$matfinal[i][]=factor_down*$matGX[index_old][q]+factor_up*$matGX[index_old+1][q]			i+=1	While(thisk<=sqrt(2))	Print "GX done",thisk	Do		thisk=i*deltak		index_old=Floor((1-(thisk-sqrt(2))-dimoffset($matXM,0))/(dimdelta($matXM,0)))		factor_up=(1-(thisk-sqrt(2))-dimoffset($matXM,0)-index_old*dimdelta($matXM,0))/dimdelta($matXM,0)		factor_down=1-factor_up		$matfinal[i][]=factor_down*$matXM[index_old][q]+factor_up*$matXM[index_old+1][q]					i+=1	While(thisk<=1+sqrt(2))	Print "XM done",thisk	Do		thisk=i*deltak		index_old=Floor((1-(thisk-sqrt(2)-1)-dimoffset($matMG,0))/(dimdelta($matMG,0)))		factor_up=(1-(thisk-sqrt(2)-1)-dimoffset($matMG,0)-index_old*dimdelta($matMG,0))/dimdelta($matMG,0)		factor_down=1-factor_up		$matfinal[i][]=factor_down*$matMG[index_old][q]+factor_up*$matMG[index_old+1][q]					i+=1	While(thisk<=2+sqrt(2))		Display	Appendimage $matfinal	End				//*******************************************************************************************************************************Proc XGMX_image()	PauseUpdate	Silent 1	String matGX,matMX,matGM	String matfinal	Variable i,j,deltak,deltae	Variable newsize	Variable thisk	Variable index_old	Variable factor_up,factor_down	matGX="pccoGX735"	matMX="pccoMX735"	matGM="pccoGM735"	matfinal="pcco735XGMX"	deltak=dimdelta($matGX,0)	deltae=dimdelta($matGX,1)	newsize=Round((2+sqrt(2))/deltak)+1	deltak=(2+sqrt(2))/(newsize-1)	Make/O/N=(newsize,dimsize($matGX,1)) $matfinal	Setscale/P x,0,deltak,"" $matfinal	Setscale/P y,dimoffset($matGX,1),deltae,""$matfinal	i=0	Do		thisk=i*deltak		index_old=Floor((sqrt(2)-thisk-dimoffset($matGX,0))/(dimdelta($matGX,0)))		factor_up=(sqrt(2)-thisk-dimoffset($matGX,0)-index_old*dimdelta($matGX,0))/dimdelta($matGX,0)		factor_down=1-factor_up		$matfinal[i][]=factor_down*$matGX[index_old][q]+factor_up*$matGX[index_old+1][q]			i+=1	While(thisk<=sqrt(2))	Print "XG done",thisk	Do		thisk=i*deltak		index_old=Floor(((thisk-sqrt(2))-dimoffset($matGM,0))/(dimdelta($matGM,0)))		factor_up=((thisk-sqrt(2))-dimoffset($matGM,0)-index_old*dimdelta($matGM,0))/dimdelta($matGM,0)		factor_down=1-factor_up		$matfinal[i][]=factor_down*$matGM[index_old][q]+factor_up*$matGM[index_old+1][q]					i+=1	While(thisk<=1+sqrt(2))	Print "GM done",thisk	Do		thisk=i*deltak		index_old=Floor(((thisk-sqrt(2)-1)-dimoffset($matMX,0))/(dimdelta($matMX,0)))		factor_up=((thisk-sqrt(2)-1)-dimoffset($matMX,0)-index_old*dimdelta($matMX,0))/dimdelta($matMX,0)		factor_down=1-factor_up		$matfinal[i][]=factor_down*$matMX[index_old][q]+factor_up*$matMX[index_old+1][q]					i+=1	While(thisk<=2+sqrt(2))		Display	Appendimage $matfinal	End//*******************************************************************************************************************************Proc XGM_image()	PauseUpdate	Silent 1	String matGX,matGM	String matfinal	Variable i,j,deltak,deltae	Variable newsize	Variable thisk	Variable index_old	Variable factor_up,factor_down	matGX="Bi2212GX28"//"pccoGX38"	matGM="Bi2212GM28"//"pccoGM38"	matfinal="Bi2212XGM28"//"pcco38XGM"	deltak=dimdelta($matGX,0)	deltae=dimdelta($matGX,1)	newsize=Round((1+sqrt(2))/deltak)+1	deltak=(1+sqrt(2))/(newsize-1)	Make/O/N=(newsize,dimsize($matGX,1)) $matfinal	Setscale/P x,0,deltak,"" $matfinal	Setscale/P y,dimoffset($matGX,1),deltae,""$matfinal	i=0	Do		thisk=i*deltak		index_old=Floor(((sqrt(2)-thisk)-dimoffset($matGX,0))/(dimdelta($matGX,0)))		factor_down=((sqrt(2)-thisk)-dimoffset($matGX,0)-index_old*dimdelta($matGX,0))/dimdelta($matGX,0)		factor_up=1-factor_down		$matfinal[i][]=factor_down*$matGX[index_old][q]+factor_up*$matGX[index_old+1][q]			i+=1	While(thisk<=sqrt(2))	Print "XG done",thisk	Do		thisk=i*deltak		index_old=Floor(((thisk-sqrt(2))-dimoffset($matGM,0))/(dimdelta($matGM,0)))		factor_up=((thisk-sqrt(2))-dimoffset($matGM,0)-index_old*dimdelta($matGM,0))/dimdelta($matGM,0)		factor_down=1-factor_up		$matfinal[i][]=factor_down*$matGM[index_old][q]+factor_up*$matGM[index_old+1][q]					i+=1	While(i<dimsize($matfinal,0))	Display	Appendimage $matfinal	End									//*******************************************************************************************************************************Proc total_edcarea(matname)	String matname	Prompt matname,"Enter the name of the matrix"		PauseUpdate	Silent 1	String intensity	Variable i,j	Variable x1,x2	Variable m,b,tempvalue	m=(2.6861-3.8121)/(-0.46344+1.3436)	b=3.8121+m*1.3436	Make/O/N=(dimsize($matname,0)) ecstfct	Setscale/P x,dimoffset($matname,0)+dimdelta($matname,0),dimdelta($matname,0),""ecstfct	ecstfct[]=m*pnt2x(ecstfct,p)+b	tempvalue=ecstfct[191]	ecstfct[]/=tempvalue		Intensity="I_"+matname	Make/O/N=82 $intensity	Setscale/P x,dimoffset($matname,0)+82*dimdelta($matname,0),dimdelta($matname,0),""$intensity	$intensity[]=0	x1=dimoffset($matname,1)	x2=dimoffset($matname,1)+(dimsize($matname,1)-1)*dimdelta($matname,1)	i=110	j=0	Do		Make/O/N=(dimsize($matname,1)) thiswave		thiswave[]=$matname[i][q]		thiswave[]-=ecstfct[i]*ecst[p]		$Intensity[j]=mean(thiswave,x1,x2)/2		j+=1		i+=1	While(i<191)	Killwaves thiswave,ecstfct	Display $Intensity	End	//*******************************************************************************************************************************Proc calc_xpos()//	String matname//	Prompt matname,"Enter the name of the matrix"		PauseUpdate	Silent 1	String name,namex,namey	Variable i,j,x1	Variable A,B	Variable factor,angle	Variable shift_theta,shift_phi	shift_theta=1.684	shift_phi=0.6	name="pi93gxx"	namex=name+"_x"	namey=name+"_y"	Make/O/N=4 $namex	Make/O/N=4 $namey	Duplicate/O $namex tempx		Duplicate/O $namey tempy		factor=0.824	angle=-42	A=asin(factor/(0.51231*sqrt(69.106)))	B=asin(factor/(0.51231*sqrt(69.106)*cos(A)))	tempx[0]=A	tempy[0]=B	tempx[1]=A	tempy[1]=-B	tempx[2]=-A	tempy[2]=B	tempx[3]=-A	tempy[3]=-B		$namex[]=(cos(angle*pi/180)*tempx[p]-sin(angle*pi/180)*tempy[p])*180/pi-shift_theta	$namey[]=(sin(angle*pi/180)*tempx[p]+cos(angle*pi/180)*tempy[p])*180/pi-shift_phi		End		//*******************************************************************************************************************************Proc plot_vk()	PauseUpdate	Silent 1	String intensity	Variable i,j	Variable x1,x2	Intensity="I_nodal_symedc"	Duplicate/O $Intensity vk_y	Duplicate/O $Intensity vk_x	Duplicate/O y_edcleft y_deltak	Duplicate/O x_edcleft x_deltak	Duplicate/O y_edcleft y_vkcalc	Duplicate/O x_edcleft x_vkcalc						vk_x[0]=0	vk_y[0]=0	x1=dimoffset($Intensity,0)	x2=dimoffset($Intensity,0)+(dimsize($Intensity,0)-0)*dimdelta($Intensity,0)	i=0	j=x2pnt(leftslope,x1)	Do		vk_y[i]=$Intensity[i]		vk_x[i]=leftslope[j]		i+=1		j+=1	While(i<dimsize($Intensity,0))	Display vk_y vs vk_x	i=0	j=x2pnt(leftslope,x_edcleft[0])		Do		y_deltak[i]=sqrt((y_edcleft[i])^2-(leftslope[j])^2)		j+=1		i+=1	While(i<dimsize(x_edcleft,0))	Display y_deltak vs x_deltak	i=0	j=x2pnt(leftslope,x_edcleft[0])			Do		y_vkcalc[i]=0.5*(1+leftslope[j]/y_edcleft[i])		x_vkcalc[i]=leftslope[j]		i+=1		j+=1	While(i<dimsize(x_edcleft,0))	Display y_vkcalc vs x_vkcalc	End	//*******************************************************************************************************************************Proc plot_vk1()	PauseUpdate	Silent 1	String intensity	Variable i,j	Variable x1,x2	Intensity="I_nodal"	Duplicate/O $Intensity vk1_y	Duplicate/O $Intensity vk1_x				vk1_x[0]=0	vk1_y[0]=0	x1=dimoffset($Intensity,0)	x2=dimoffset($Intensity,0)+(dimsize($Intensity,0)-0)*dimdelta($Intensity,0)	i=0	j=x2pnt(leftslope,x1)	Do		vk1_y[i]=$Intensity[i]		vk1_x[i]=leftslope[j]		i+=1		j+=1	While(i<dimsize($Intensity,0))	Display vk1_y vs vk1_x	End		//*******************************************************************************************************************************Proc putlegend()//	String matname//	Prompt matname,"Enter the name of the matrix"		PauseUpdate	Silent 1	Label left "\\Z14Kenetic energy (eV)"	Label bottom "\\Z14\\F'symbol'q\\F'arial' (deg.)"	ModifyGraph manTick(bottom)={0,10,0,0},manMinor(bottom)={4,0}	ModifyGraph manTick(left)={0,0.2,0,1},manMinor(left)={4,0}	End//*******************************************************************************************************************************Proc plottin()//	String matname//	Prompt matname,"Enter the name of the matrix"		PauseUpdate	Silent 1	Label left "\\Z14Kenetic energy (eV)"	Label bottom "\\Z14\\F'symbol'q\\F'arial' (deg.)"	ModifyGraph manTick(bottom)={0,10,0,0},manMinor(bottom)={4,0}	ModifyGraph manTick(left)={0,0.2,0,1},manMinor(left)={4,0}	End											//*******************************************************************************************************************************Proc mayalu(matname,firstweight0,lastweight0)	String matname	Variable firstweight0=245	Variable lastweight0=320		Prompt matname,"Enter the name of the matrix"		Prompt firstweight0,"Enter the first index for weight=0"	Prompt lastweight0,"Enter the last index for weight=0"						PauseUpdate	Silent 1	String newname	Variable i,j	Variable first_no0,last_no0,condition	newname=matname+"_minus_b"	Duplicate/O $matname $newname	$newname[][]=0	Make/O/N=(dimsize($matname,1)) wedc	wedc[]=1	wedc[firstweight0,lastweight0]=0//	wedc[lastweight0+1,dimsize(wedc,0)-1]=1	first_no0=0	condition=0	Do		If(mod(Round($matname[first_no0][0]),1)!=0)			first_no0+=1			else				condition=1		endif		While(condition!=1)	last_no0=dimsize($matname,0)-1	condition=0	Do		If(mod(Round($matname[last_no0][0]),1)!=0)			last_no0-=1			else				condition=1		endif		While(condition!=1)	print "start"		i=first_no0	Do		If(mod(i,50)==0)			print i		Endif		Make/O/N=(dimsize($matname,1)) thiswave		Setscale/P x, dimoffset($matname,1),dimdelta($matname,1),""thiswave		Duplicate/O thiswave fitwave		thiswave[]=$matname[i][p]		smooth/B=7 7,thiswave		CurveFit/Q poly 7, thiswave /W=wedc /I=1/D		fitwave=poly(W_coef,x)		Duplicate/O thiswave thiswave2		thiswave2[]=$matname[i][p]//		smooth/B=3 3,thiswave2		j=lastweight0		Do			fitwave[j]=(0.1*fitwave[j]+0.9*thiswave2[j])			j+=1		While(j<dimsize(fitwave,0))		Smooth/B=5 5,fitwave		Duplicate/O fitwave thiswave3		thiswave2[]=1/(exp((dimoffset($matname,1)+p*dimdelta($matname,1))/0.025)+1)		fitwave[]*=thiswave2[p]		If(i==225)				duplicate/O thiswave wave225			duplicate/O fitwave fitwave225			wave225[]=$matname[i][p]//			display wave225,fitwave225		Endif		If(i==150)			duplicate/O thiswave wave150			duplicate/O fitwave fitwave150			wave150[]=$matname[i][p]//			display wave150,fitwave150		Endif				If(i==59)			duplicate/O thiswave wave59			duplicate/O fitwave fitwave59			wave59[]=$matname[i][p]//			display wave59,fitwave59		Endif				//		$newname[i][]=$matname[i][q]-fitwave[q]		thiswave[]=$matname[i][p]		smooth/B=2 3,thiswave				$newname[i][]=thiswave[q]-fitwave[q]			j=0		Do			If($newname[i][j]<0)			$newname[i][j]/=10			Endif			j+=1		While(j<dimsize($newname,1))			i+=1	While(i<last_no0+1)//	print slope,b,xvalue//	Display thiswave	Display	Appendimage $newname	End	//*******************************************************************************************************************************Proc mayalu2(matname,fitfrom,fitto)	String matname	Variable fitfrom=17.378	Variable fitto=17.492	Prompt matname,"Enter the name of the matrix"		Prompt fitfrom,"Fit from:"	Prompt fitto,"Fit to:"	PauseUpdate	Silent 1	String newname	Variable i,j	Variable jstart,jend		Variable slope,b	Variable y1,y2,xvalue	newname=matname+"_minus_b2"	Duplicate/O $matname $newname	jstart=Round((fitfrom-dimoffset($matname,1))/dimdelta($matname,1))	jend=Round((fitto-dimoffset($matname,1))/dimdelta($matname,1))	$newname[][]=0	Make/O/N=(dimsize($matname,1)) weightwave	Setscale/P x, dimoffset($matname,1),dimdelta($matname,1),""weightwave	weightwave[]=0	i=jstart-30	Do		weightwave[i]=1		i+=1	While(i<jstart+1)	i=jend	Do		weightwave[i]=1		i+=1	While(i<jend+20)	i=Round((jstart+jend)/2)-3	Do		weightwave[i]=1				I+=1	While(i<Round((jstart+jend)/2)+3)	i=0	Do		If(mod(i,20)==0)			print i		Endif		Make/O/N=(dimsize($matname,1)) thiswave		Setscale/P x, dimoffset($matname,1),dimdelta($matname,1),""thiswave		thiswave[]=$matname[i][p]		smooth/B=5 5, thiswave		y1=thiswave[jstart]		y2=thiswave[jend]		slope=(y2-y1)/(fitto-fitfrom)		b=y1-slope*fitfrom		j=jstart		Do			xvalue=dimoffset($matname,1)+j*dimdelta($matname,1)			thiswave[j]=slope*xvalue+b			j+=1		While(j<jend+1)		Duplicate/O thiswave thiswave2		CurveFit/Q poly 3, thiswave /W=weightwave /I=1		thiswave2[]=W_coef[0]		j=1		Do			thiswave2[]+=W_coef[j]*(dimoffset(thiswave,0)+p*dimdelta(thiswave,0))^j			j+=1		While(j<dimsize(W_coef,0))		$newname[i][]=$matname[i][q]-thiswave2[q]		i+=1	While(i<dimsize($matname,0))	Killwaves thiswave,weightwave,thiswave2	Display	Appendimage $newname	End																			//*******************************************************************************************************************************Proc fittemp()	PauseUpdate	Silent 1	String theedc,theedcfit	Variable x1,x2,n1,n2	Variable i,j,iter	x1=xcsr(A)	x2=xcsr(B)	n1=pcsr(A)	n2=pcsr(B)	Make/O/N=(n2+1-n1) edcvk1	Make/O/N=(n2+1-n1) edcposition1	Make/O/N=(n2+1-n1) edcenergy1	Make/O/N=5 m	edcvk[]=NaN	edcposition[]=NaN	edcenergy[]=NaN	m[]=0	i=n1	j=0	Do		Make/O/N=(dimsize(cut116_k,1)) thiswave		thiswave[]=cut116_k[i][p]		Setscale/P x,dimoffset(cut116_k,1),dimdelta(cut116_k,1),""thiswave		Wavestats/Q/R=(vcsr(A),vcsr(B)) thiswave		Duplicate/O thiswave sthiswave		smooth/B=7 7,sthiswave//		m[2]=V_maxloc		m[0]=thiswave[0]		m[1]=V_max			m[3]=abs(vcsr(A)-vcsr(B))/6		m[4]=0.04	//		m[5]=-16		Wavestats/Q/R=(vcsr(A),vcsr(B)) sthiswave				m[2]=V_maxloc			FuncFit/N/Q/H="00000" Lorentzfermi m thiswave (vcsr(A),vcsr(B))//  /D		edcposition[j]=m[2]		edcvk[j]=Pi*abs(m[1]/m[3])		edcenergy[j]=dimoffset(cut116_k,1)+i*dimdelta(cut116_k,1)		if(mod(i,5)==0)			print i			theedc="ecut116_k_3_"+num2str(i)			theedcfit=theedc+"f"			Duplicate/O $theedc $theedcfit			iter=0			Do				$theedcfit[iter]=lorentzfermi(m,dimoffset($theedc,0)+iter*dimdelta($theedc,0))				iter+=1			While(iter<dimsize($theedc,0))				Display $theedc			Appendtograph $theedcfit		Endif		Dowindow/F nodalgraph				j+=1		i+=1	While(i<n2+1)	Display edcenergy vs edcposition	Display edcvk vs edcenergy	End	//*******************************************************************************************************************************	Function Lorentzfermi(m,x) : fitfunc	wave m; variable x		return ((m[0]+m[1]/((x-m[2])^2+m[3]^2))*(1/(exp(x/m[4])+1)))End//*******************************************************************************************************************************	Function fitvk(m,x,y) : fitfunc	wave m; variable x;Variable y		return (m[0]*(1-(m[1]*x+m[2])/y)/2+m[3])End																				//*******************************************************************************************************************************Proc liste_hazard(nombre_a_prendre,nombre_total,nomliste)	Variable nombre_a_prendre	Variable nombre_total	String nomliste	Prompt nombre_a_prendre,"Nombre  prendre :"	Prompt nombre_total,"Nombre total"	Prompt nomliste,"Nom de la liste"	PauseUpdate	Silent 1	Variable i,j	Variable cenombre	Variable condition	Make/O/N=(nombre_a_prendre) listetemp	Make/O/N=(nombre_total) $nomliste	$nomliste[]=nombre_total+10	i=0	Do		cenombre=Round(abs(enoise(nombre_total-1)))		condition=1		j=0		Do			if(cenombre==listetemp[j])				condition=0			Endif			j+=1		While(j<i)		If(condition==1)			listetemp[i]=cenombre			$nomliste[cenombre]=i+1			i+=1		Endif	While(i<nombre_a_prendre)	Killwaves listetempEnd			//*******************************************************************************************************************************Proc drawkline(linename,mat)	String linename	String mat	Prompt linename,"Enter the name of the new line"	Prompt mat,"Enter the name of the cut"	PauseUpdate	Silent 1	String linename_x,linename_y	Variable i	Variable thistheta,thisphi	Variable thisdelta,shifttheta,rotangle	linename_x=linename+"_x"	linename_y=linename+"_y"		rotangle=2.8//44.5,42	shifttheta=-1.1	thisdelta=dimdelta($mat,0)	Make/O/N=((0+14)/thisdelta+1) temp_x//7.5	Make/O/N=((0+14)/thisdelta+1) temp_y	thisphi=8.5//9.1,8.6	temp_x[]=0.51231*sqrt(70.695)*sin((-14+shifttheta+p*thisdelta)*pi/180)	temp_y[]=0.51231*sqrt(70.695)*sin(thisphi*pi/180)*cos((-14+shifttheta+p*thisdelta)*pi/180)	Duplicate/O temp_x $linename_x 		Duplicate/O temp_y $linename_y	$linename_x[]=temp_x[p]*cos(rotangle*pi/180)-temp_y[p]*sin(rotangle*pi/180) 		$linename_y[]=temp_x[p]*sin(rotangle*pi/180)+temp_y[p]*cos(rotangle*pi/180)	$linename_x[]/=0.817//0.824	$linename_y[]/=0.817//=0.824	 //	Appendtograph $linename_y vs	$linename_x	Killwaves temp_x,temp_y	End																												//*******************************************************************************************************************************Proc temp4()//	String matname//	Prompt matname,"Enter the name of the matrix"		PauseUpdate	Silent 1	Variable i,xvalue	Duplicate/O yedc116k newvk	Duplicate/O yedc116k xedc116k	xedc116k[]=dimoffset(yedc116k,0)+p*dimdelta(yedc116k,0)	Duplicate/O I_cut116k tempwave	tempwave[]=dimoffset(I_cut116k,0)+p*dimdelta(I_cut116k,0)	i=0	Do		xvalue=dimoffset(yedc116k,0)+i*dimdelta(yedc116k,0)		newvk[i]=Interp(xvalue,tempwave,I_cut116k)		i+=1	While(i<dimsize(yedc116k,0))	Killwaves tempwave		End			//*******************************************************************************************************************************Proc goldfermiall()	PauseUpdate	Silent 1	String thisdata	Variable i,x1,x2	Make/O/N=(dimsize(file_name,0)) fermivalues	fermivalues[0]=NaN	fermivalues[1]=NaN	x1=dimoffset(data2,0)+39*dimdelta(data2,0)	x2=dimoffset(data2,0)+102*dimdelta(data2,0)	i=2	Do		thisdata="data"+num2str(i)		combine_range(thisdata,"thiswave",x1,x2)		smooth/B=5 5, thiswave		differentiate thiswave		smooth/B=5 5, thiswave		wavestats/Q thiswave		Fermivalues[i]=V_minloc		i+=1	While(i<dimsize(file_name,0))	Killwaves thiswave	Display Fermivalues	End																																						//*******************************************************************************************************************************Proc simul1(gap,igap,dosgap)	Variable gap=0.2	Variable igap=0.2	Variable dosgap=0	Prompt gap,"Enter the hybridization gap"	Prompt igap,"Enter the impurity gap (gap method)"	Prompt dosgap,"Enter the impurity gap (DOS method)"	PauseUpdate	Silent 1	Variable m,b,new_b	Variable gamma0, alpha	Variable Ek,epsilon,Eki	Variable coeff_u,coeff_v	Variable k	Variable i	Variable v_shift 	v_shift=0.193487	Make/O/N=(600,1000) Akw	Setscale/P x,-sqrt(2),sqrt(2)/(600-1),""Akw	Setscale/P y,-2-v_shift,4/(1000-1),""Akw	Make/O/N=(dimsize(Akw,1)) gammawave	Setscale/P x, dimoffset(Akw,1), dimdelta(Akw,1),""gammawave	Make/O/N=(dimsize(Akw,0)) tempx	Make/O/N=(dimsize(Akw,0)) tempy	Akw[][]=0	m=2.78107	b=2.16	new_b=b-v_shift	alpha=0.3	gamma0=0.05	gammawave[]=alpha*pnt2x(gammawave,p)^2+gamma0	i=0	Do		k=dimoffset(Akw,0)+i*dimdelta(Akw,0)		epsilon=m*k+new_b		tempx[i]=k		tempy[i]=epsilon+v_shift		Ek=sqrt(epsilon^2+gap^2)		coeff_v=0.5*(1-epsilon/Ek)		coeff_u=1-coeff_v		Eki=sqrt(epsilon^2+gap^2+igap^2)		Akw[i][]=(1/pi)*(coeff_u*gammawave[q]/((pnt2x(gammawave,q)-Eki)^2+gammawave[q]^2)+coeff_v*gammawave[q]/((pnt2x(gammawave,q)+Eki)^2+gammawave[q]^2))		i+=1	While(i<dimsize(Akw,0))	Setscale/P y,dimoffset(Akw,1)+v_shift,dimdelta(Akw,1),""Akw			Setscale/P x,dimoffset(Akw,1),dimdelta(Akw,1),""gammawave	Duplicate/O gammawave fw	fw[]=1/(exp(pnt2x(fw,p)/0.3)+1)	Akw[][]*=fw[q]		Make/O/N=5 coeff	coeff[0]=0	coeff[1]=1	coeff[2]=-dosgap/2	coeff[3]=dosgap/2	coeff[4]=dosgap/40	fw[]=0	fw[]=fermigap(coeff,dimoffset(fw,0)+p*dimdelta(fw,0))	Akw[][]*=fw[q]	Killwaves gammawave,fw	End	//*******************************************************************************************************************************Proc simul1WPI(gap,igap,dosgap)	Variable gap=0.2	Variable igap=0.2	Variable dosgap=0	Prompt gap,"Enter the hybridization gap"	Prompt igap,"Enter the impurity gap (gap method)"	Prompt dosgap,"Enter the impurity gap (DOS method)"	PauseUpdate	Silent 1	Variable m,b,new_b	Variable gamma0, alpha	Variable Ek,epsilon,Eki	Variable coeff_u,coeff_v	Variable k	Variable i	Variable v_shift 	v_shift=0.193487	Make/O/N=(600,1000) Akw	Setscale/P x,-sqrt(2),sqrt(2)/(600-1),""Akw	Setscale/P y,-2-v_shift,4/(1000-1),""Akw	Make/O/N=(dimsize(Akw,1)) gammawave	Setscale/P x, dimoffset(Akw,1), dimdelta(Akw,1),""gammawave	Make/O/N=(dimsize(Akw,0)) tempx	Make/O/N=(dimsize(Akw,0)) tempy	Akw[][]=0	m=2.78107	b=2.16	new_b=b-v_shift	alpha=0.3	gamma0=0.05	gammawave[]=alpha*pnt2x(gammawave,p)^2+gamma0	i=0	Do		k=dimoffset(Akw,0)+i*dimdelta(Akw,0)		epsilon=m*k+new_b		tempx[i]=k		tempy[i]=epsilon+v_shift		Ek=sqrt(epsilon^2+gap^2)		coeff_v=0.5*(1-epsilon/Ek)		coeff_u=1-coeff_v		Eki=sqrt(epsilon^2+gap^2+igap^2)		Akw[i][]=(1/pi)*(coeff_u*gammawave[q]/((pnt2x(gammawave,q)-Eki)^2+gammawave[q]^2)+coeff_v*gammawave[q]/((pnt2x(gammawave,q)+Eki)^2+gammawave[q]^2))		i+=1	While(i<dimsize(Akw,0))	Setscale/P y,dimoffset(Akw,1)+v_shift,dimdelta(Akw,1),""Akw			Setscale/P x,dimoffset(Akw,1),dimdelta(Akw,1),""gammawave	Duplicate/O gammawave fw	fw[]=1/(exp(pnt2x(fw,p)/0.3)+1)	Akw[][]*=fw[q]		Make/O/N=5 coeff	coeff[0]=0	coeff[1]=1	coeff[2]=-dosgap/2	coeff[3]=dosgap/2	coeff[4]=dosgap/40	fw[]=0	fw[]=fermigap(coeff,dimoffset(fw,0)+p*dimdelta(fw,0))	Akw[][]*=fw[q]	print new_b,b,v_shift	Killwaves gammawave,fw	End		//*******************************************************************************************************************************Proc simul3(gap,igap,dosgap)	Variable gap=0.11	Variable igap=0	Variable dosgap=0	Prompt gap,"Enter the hybridization gap"	Prompt igap,"Enter the impurity gap (gap method)"	Prompt dosgap,"Enter the impurity gap (DOS method)"	PauseUpdate	Silent 1	String thisname	Variable gamma0, alpha	Variable Ek,epsilon,Eki	Variable coeff_u,coeff_v	Variable k	Variable i,j	Variable thiskx,thisky,thiskphi	Variable v_shift 	Variable thistemp	Make/O/N=(600,600) FSmat	Setscale/I x,-sqrt(2),sqrt(2),""FSmat	Setscale/I y,-sqrt(2),sqrt(2),""FSmat	j=0	Do		if(mod(j,10)==0)			print j,"/",dimsize(FSmat,1)-1		Endif		thiskphi=dimoffset(FSmat,1)+j*2*sqrt(2)/((dimsize(FSmat,1)-1))		thiskx=0.5-thiskphi/sqrt(2)		thisky=0.5+thiskphi/sqrt(2)		v_shift=tbfunc(tb_parameters,thiskx,thisky)		thistemp=0		Make/O/N=(dimsize(FSmat,1),3) Akw		Setscale/I x,-sqrt(2),sqrt(2),""Akw		Setscale/P y,-0.001-v_shift,0.001,""Akw		Make/O/N=(dimsize(Akw,1)) gammawave		Setscale/P x, dimoffset(Akw,1), dimdelta(Akw,1),""gammawave		Make/O/N=(dimsize(Akw,0)) tempx		Make/O/N=(dimsize(Akw,0)) tempy		Akw[][]=0		alpha=0.2		gamma0=0.005		//		alpha=0.7//		gamma0=0.06		gammawave[]=alpha*(pnt2x(gammawave,p)+v_shift)^2+gamma0	//		thisname="cut"+num2str(j)						//		thisname="sim"+num2str(j)		//		thisname="simno_u"+num2str(j)		Akw[][]=0		i=0		Do			k=dimoffset(Akw,0)+i*dimdelta(Akw,0)			thiskx=k/sqrt(2)-thiskphi/sqrt(2)			thisky=k/sqrt(2)+thiskphi/sqrt(2)			epsilon=tbfunc(tb_parameters,thiskx,thisky)-v_shift			Ek=sqrt(epsilon^2+gap^2)			coeff_v=0.5*(1-epsilon/Ek)			coeff_u=1-coeff_v			Eki=sqrt(epsilon^2+gap^2+igap^2)			Akw[i][]=(1/pi)*(coeff_u*gammawave[q]/((pnt2x(gammawave,q)-Eki)^2+gammawave[q]^2)+coeff_v*gammawave[q]/((pnt2x(gammawave,q)+Eki)^2+gammawave[q]^2))			i+=1		While(i<dimsize(Akw,0))		Setscale/P y,dimoffset(Akw,1)+v_shift,dimdelta(Akw,1),""Akw				Setscale/P x,dimoffset(Akw,1),dimdelta(Akw,1),""gammawave		Duplicate/O gamma fw//		fw[]=1/(exp(pnt2x(fw,p)/0.01)+1)			//		Akw[][]*=fw[q]//		If(mod(Round(Akw[0][1]),1)!=0)//			print "this is the value", j//			Display fw//			thistemp=1//		Endif							Make/O/N=5 coeff		coeff[0]=0		coeff[1]=1		coeff[2]=-dosgap/2		coeff[3]=dosgap/2		coeff[4]=dosgap/40//		fw[]=0//		fw[]=fermigap(coeff,dimoffset(fw,0)+p*dimdelta(fw,0))//		Akw[][]*=fw[q]		FSmat[][j]=Akw[p][1]//		print dimoffset(Akw,1)		j+=1	While(j<dimsize(FSmat,1))	Killwaves gammawave,fw//	Display;appendimage FSmat	rot2d_pi("FSmat",-45,0,0)	End//*******************************************************************************************************************************Proc simul4(gap,igap,dosgap)	Variable gap=0.11	Variable igap=0	Variable dosgap=0	Prompt gap,"Enter the hybridization gap"	Prompt igap,"Enter the impurity gap (gap method)"	Prompt dosgap,"Enter the impurity gap (DOS method)"	PauseUpdate	Silent 1	String thisname	Variable gamma0, alpha	Variable Ek,epsilon,Eki	Variable coeff_u,coeff_v	Variable k	Variable i,j	Variable thiskx,thisky,thiskphi	Variable v_shift 	Variable thistemp	Make/O/N=(300,300) FSmat	Setscale/I x,0,sqrt(2),""FSmat	Setscale/I y,0,sqrt(2),""FSmat	FSmat[][]=0	j=0	Do		if(mod(j,10)==0)			print j,"/",dimsize(FSmat,1)-1		Endif		thiskphi=dimoffset(FSmat,1)+j*sqrt(2)/((dimsize(FSmat,1)-1))		thiskx=0.5-thiskphi/sqrt(2)		thisky=0.5+thiskphi/sqrt(2)		v_shift=tbfunc(tb_parameters,thiskx,thisky)		thistemp=0		Make/O/N=(dimsize(FSmat,1),3) Akw		Setscale/I x,0,sqrt(2),""Akw		Setscale/P y,-0.001-v_shift,0.001,""Akw		Make/O/N=(dimsize(Akw,1)) gamma		Setscale/P x, dimoffset(Akw,1), dimdelta(Akw,1),""gamma		Make/O/N=(dimsize(Akw,0)) tempx		Make/O/N=(dimsize(Akw,0)) tempy		Akw[][]=0		alpha=0.2		gamma0=0.005		//		alpha=0.7//		gamma0=0.06		gamma[]=alpha*(pnt2x(gamma,p)+v_shift)^2+gamma0	//		thisname="cut"+num2str(j)						//		thisname="sim"+num2str(j)		//		thisname="simno_u"+num2str(j)		Akw[][]=0		i=0		Do			k=dimoffset(Akw,0)+i*dimdelta(Akw,0)			thiskx=k/sqrt(2)-thiskphi/sqrt(2)			thisky=k/sqrt(2)+thiskphi/sqrt(2)			epsilon=tbfunc(tb_parameters,thiskx,thisky)-v_shift			Ek=sqrt(epsilon^2+gap^2)			coeff_v=0.5*(1-epsilon/Ek)			coeff_u=1-coeff_v			Eki=sqrt(epsilon^2+gap^2+igap^2)			Akw[i][]=(1/pi)*(coeff_u*gamma[q]/((pnt2x(gamma,q)-Eki)^2+gamma[q]^2)+coeff_v*gamma[q]/((pnt2x(gamma,q)+Eki)^2+gamma[q]^2))			i+=1		While(i<dimsize(Akw,0))		Setscale/P y,dimoffset(Akw,1)+v_shift,dimdelta(Akw,1),""Akw				Setscale/P x,dimoffset(Akw,1),dimdelta(Akw,1),""gamma		Duplicate/O gamma fw//		fw[]=1/(exp(pnt2x(fw,p)/0.01)+1)			//		Akw[][]*=fw[q]//		If(mod(Round(Akw[0][1]),1)!=0)//			print "this is the value", j//			Display fw//			thistemp=1//		Endif							Make/O/N=5 coeff		coeff[0]=0		coeff[1]=1		coeff[2]=-dosgap/2		coeff[3]=dosgap/2		coeff[4]=dosgap/40//		fw[]=0//		fw[]=fermigap(coeff,dimoffset(fw,0)+p*dimdelta(fw,0))//		Akw[][]*=fw[q]		i=j		Do					FSmat[i][j]=Akw[i][1]			FSmat[j][i]=Akw[i][1]			i+=1		While(i<dimsize(FSmat,1))//		print dimoffset(Akw,1)		j+=1	While(j<dimsize(FSmat,1))	Killwaves gamma,fw//	Display;appendimage FSmat	rot2d_pi("FSmat",-45,0,0)	End	//*******************************************************************************************************************************	Proc simul2(gap,igap,dosgap)	Variable gap=0.11	Variable igap=0	Variable dosgap=0	Prompt gap,"Enter the hybridization gap"	Prompt igap,"Enter the impurity gap (gap method)"	Prompt dosgap,"Enter the impurity gap (DOS method)"	PauseUpdate	Silent 1	String thisname	Variable gamma0, alpha	Variable Ek,epsilon,Eki	Variable coeff_u,coeff_v	Variable k	Variable i,j	Variable thiskx,thisky,thiskphi	Variable v_shift 	j=0	Do		thiskphi=j/(sqrt(2)*80)		thiskx=0.5-thiskphi/sqrt(2)		thisky=0.5+thiskphi/sqrt(2)		v_shift=tbfunc(tb_parameters,thiskx,thisky)		If(v_shift<0)			print j,"banane"			Else				print j		Endif			Make/O/N=(800,1000) Akw		Setscale/I x,sqrt(2)/2-0.3,sqrt(2)/2+0.3,""Akw		Setscale/P y,-0.5-v_shift,1/(1000-1),""Akw		Make/O/N=(dimsize(Akw,1)) gamma		Setscale/P x, dimoffset(Akw,1), dimdelta(Akw,1),""gamma		Make/O/N=(dimsize(Akw,0)) tempx		Make/O/N=(dimsize(Akw,0)) tempy		Akw[][]=0		alpha=0.4		gamma0=0.02		//		alpha=0.7//		gamma0=0.06		gamma[]=alpha*pnt2x(gamma,p)^2+gamma0			thisname="simno_f"+num2str(j)//		thisname="cut"+num2str(j)						//		thisname="sim"+num2str(j)		//		thisname="simno_u"+num2str(j)		Akw[][]=0		i=0		Do			k=dimoffset(Akw,0)+i*dimdelta(Akw,0)			thiskx=k/sqrt(2)-thiskphi/sqrt(2)			thisky=k/sqrt(2)+thiskphi/sqrt(2)			epsilon=tbfunc(tb_parameters,thiskx,thisky)-v_shift			Ek=sqrt(epsilon^2+gap^2)			coeff_v=0.5*(1-epsilon/Ek)			coeff_u=1-coeff_v			Eki=sqrt(epsilon^2+gap^2+igap^2)			Akw[i][]=(1/pi)*(coeff_u*gamma[q]/((pnt2x(gamma,q)-Eki)^2+gamma[q]^2)+coeff_v*gamma[q]/((pnt2x(gamma,q)+Eki)^2+gamma[q]^2))			i+=1		While(i<dimsize(Akw,0))		Setscale/P y,dimoffset(Akw,1)+v_shift,dimdelta(Akw,1),""Akw				Setscale/P x,dimoffset(Akw,1),dimdelta(Akw,1),""gamma		Duplicate/O gamma fw		fw[]=1/(exp(pnt2x(fw,p)/0.02)+1)//		Akw[][]*=fw[q]			Make/O/N=5 coeff		coeff[0]=0		coeff[1]=1		coeff[2]=-dosgap/2		coeff[3]=dosgap/2		coeff[4]=dosgap/40		fw[]=0		fw[]=fermigap(coeff,dimoffset(fw,0)+p*dimdelta(fw,0))		Akw[][]*=fw[q]		Duplicate/O Akw $thisname		Display;appendimage $thisname		ModifyImage $thisname ctab={*,*,Terrain,0}		j+=1	While(j<1)//81	Killwaves gamma,fw	End					//*******************************************************************************************************************************Proc findmaxonedc()	PauseUpdate	Silent 1	String name,thiswave	String storemax_y,storemax_x	Variable i,j	Variable offset_y	offset_y=-1.5	name="pi104"	storemax_x=name+"edc_xloc"	storemax_y=name+"edc_yloc"	Make/O/N=0 $storemax_x	Make/O/N=0 $storemax_y		j=0	i=81	//	i=117	Do		thiswave="e"+name+"nodal_k_3_"+num2str(i)				Duplicate/O $thiswave thiswaveVD				Smooth/B=11 11, thiswaveVD		Duplicate/O $thiswave tempwave		Differentiate thiswaveVD		Smooth/B=9 9,thiswaveVD		Differentiate thiswaveVD										Wavestats/Q thiswaveVD		Insertpoints dimsize($storemax_x,0),1,$storemax_x		$storemax_x[dimsize($storemax_x,0)-1]=V_minloc		Insertpoints dimsize($storemax_y,0),1,$storemax_y		$storemax_y[dimsize($storemax_y,0)-1]=$thiswave[x2pnt($thiswave,V_minloc)]+j*offset_y				j+=1				i+=3	While(i<144+1)//	While(i<180+1)	Killwaves tempwave,thiswaveVD	End//*******************************************************************************************************************************Proc pi102_1()	PauseUpdate	Silent 1	String thiswave	Variable i,j	Make/O/N=(dimsize(edctantinode,0)) antinodeshift	i=0	Do		thiswave="edcAN"+num2str(edctantinode[i])		Duplicate/O $thiswave tempwave1		smooth/B=9 9,tempwave1		Differentiate tempwave1		smooth/B=9 9,tempwave1		Wavestats/Q tempwave1		antinodeshift[i]=17.494-V_minloc		i+=1	While(i<dimsize(edctantinode,0))	Killwaves tempwave1	End	//*******************************************************************************************************************************Proc compare2()	PauseUpdate	Silent 1	String thiswave1,thiswave2	String newwave1,newwave2	Variable i,j	Variable offset_y	Display	j=81	i=117	Do		thiswave1="epi93nodal_k_3_"+num2str(i)		thiswave2="epi104nodal_k_3_"+num2str(j)		newwave1="cp"+thiswave1		newwave2="cp"+thiswave2		Duplicate/O $thiswave1 $newwave1		Duplicate/O $thiswave2 $newwave2 		$newwave2[]*=2.99		Appendtograph $newwave1		ModifyGraph rgb($newwave1)=(0,0,0)	//65535			Appendtograph $newwave2						j+=3				i+=3	While(i<174+1)	End	//*******************************************************************************************************************************Proc extract_exp_res(subs,fitpnts)	Variable subs	Variable fitpnts	Prompt subs,"Enter the substitution factor"	Prompt fitpnts,"Enter the number of points to use in the fit"	PauseUpdate	Silent 1	String namewave	String Temp_exponentfit	String exponentfit	String oldT	String Tempforfit	Variable i	namewave="lnrB"+num2str(subs)	oldT="t_"+num2str(subs)	Tempforfit="t3_"+num2str(subs)	exponentfit="exponentfit"+num2str(subs)	Temp_exponentfit="Texponentfit"+num2str(subs)	Make/O/N=(dimsize($namewave,0)-fitpnts+1) $Temp_exponentfit	Make/O/N=(dimsize($namewave,0)-fitpnts+1) $exponentfit	Duplicate/O $namewave swave	Smooth/B=7 7, swave	i=0	Do		if(mod(i,25)==0)			print i,"/",dimsize($Temp_exponentfit,0)		Endif		$Temp_exponentfit[i]=$oldT[round((2*i+fitpnts)/2)]		CurveFit/Q Power swave[i,i+fitpnts-1] /X=$Tempforfit /D		 $exponentfit[i]=W_coef[2]/3		i+=1	While(i<dimsize($Temp_exponentfit,0))	Display $exponentfit vs $Temp_exponentfit	End		//*******************************************************************************************************************************Proc symG_on_M(matname)	String matname	Prompt matname,"Enter the name of the matrix"	PauseUpdate	Silent 1	String newname	Variable i,j	Variable approxdelta	Variable matsize	Variable xgrid,ygrid	Variable oldidown,oldiup	Variable factup,factdown	Variable intensity	newname="SGM_"+matname	If(dimdelta($matname,0)<dimdelta($matname,1))		approxdelta=dimdelta($matname,0)		Else			approxdelta=dimdelta($matname,1)	Endif	matsize=Round(2/approxdelta)	If(mod(matsize,2)==0)		matsize+=1	Endif	Make/O/N=(matsize,matsize) $newname	Setscale/I x,-2,0,""$newname	Setscale/I y,-1,1,""$newname	i=(matsize-1)/2	Do			If(mod(i,10)==0)			Print i,"/",matsize-1		Endif		xgrid=dimoffset($newname,0)+i*dimdelta($newname,0)			oldidown=Floor((xgrid-dimoffset($matname,0))/dimdelta($matname,0))		oldiup=oldidown+1		factdown=(xgrid-dimoffset($matname,0)-oldiup*dimdelta($matname,0))/dimdelta($matname,0)		factup=1-factdown		Make/O/N=(dimsize($matname,1)) interwave		interwave[]=factdown*$matname[oldidown][p]+factup*$matname[oldiup][p]		Duplicate/O interwave ywave		ywave[]=dimoffset($matname,1)+p*dimdelta($matname,1)		j=i-(matsize-1)/2		Do			ygrid=dimoffset($newname,1)+j*dimdelta($newname,1)			intensity=interp(ygrid,ywave,interwave)			$newname[i][j]=intensity			$newname[i][matsize-1-j]=intensity			$newname[matsize-1-i][j]=intensity			$newname[matsize-1-i][matsize-1-j]=intensity			$newname[Round((matsize-1)/2)+j][i-Round((matsize-1)/2)]=intensity			$newname[Round((matsize-1)/2)+j][matsize-1-(i-Round((matsize-1)/2))]=intensity			$newname[Round((matsize-1)/2)-j][i-Round((matsize-1)/2)]=intensity			$newname[Round((matsize-1)/2)-j][matsize-1-(i-Round((matsize-1)/2))]=intensity			j+=1		While(j<(matsize-1)/2+1)		i+=1	While(i<matsize)		Killwaves interwave,ywave	Display	Appendimage $newname	End//*******************************************************************************************************************************Proc plot_the_max()	PauseUpdate	Silent 1	String namewave	Variable i,j	Make/O/N=0 maxposition	Make/O/N=0 maxval	i=117	j=0	Do		Insertpoints dimsize(maxposition,0),1,maxposition		Insertpoints dimsize(maxval,0),1,maxval				namewave="agedc"+num2str(i)		Duplicate/O $namewave thiswave		Smooth/B=9 9,thiswave		Differentiate thiswave		Smooth/B=9 9,thiswave		Differentiate thiswave		Wavestats/Q thiswave		maxposition[dimsize(maxposition,0)-1]=V_minloc		maxval[dimsize(maxposition,0)-1]=$namewave[x2pnt($namewave,V_minloc)]-4*j				i+=3		j+=1	While(i<175)	Appendtograph maxval vs maxposition	End//*******************************************************************************************************************************Proc put_pts_in_theta(kxwave,kywave,hnenergy)	String kxwave	String kywave	Variable hnenergy	Prompt kxwave,"Enter the name for the kx wave"	Prompt kywave,"Enter the name for the ky wave"		Prompt hnenergy,"Enter the name of the photon energy"	PauseUpdate	Silent 1	String wavetheta,wavephi	Variable i	Variable workf	wavetheta="wavetheta"+num2str(hnenergy)	wavephi="wavephi"+num2str(hnenergy)		Duplicate/O $kxwave $wavetheta	Duplicate/O $kxwave $wavephi	workf=4.4	$wavetheta[]=asin($kxwave[p]/(0.51231*sqrt(hnenergy-workf)))	$wavephi[]=	asin($kywave[p]/(0.51231*sqrt(hnenergy-workf)*cos($wavetheta[p])))	$wavetheta[]*=180/pi	$wavephi[]*=180/pi	Display $wavephi vs $wavetheta	ModifyGraph mode=3,marker=19	ModifyGraph width={perUnit,3,bottom},height={perUnit,3,left}	End			//*******************************************************************************************************************************Proc vb_vs_hv(normvaluelow,normvaluehigh)	Variable normvaluelow=-9.046//=-8.75	Variable normvaluehigh=0.449//=0.8	Prompt normvaluelow,"Low E of normalization"	Prompt normvaluehigh,"High E of normalization"		PauseUpdate	Silent 1	String namewave,dataname,matname	Variable i	Variable work_f,the_average	matname="mathv_vs_VB"	Work_f=4.354	Display	i=0	Do//		print "this is ",i		dataname="data"+num2str(indexforVB[i])		namewave="VB"+num2str(hvforVB[i])//		print dataname,namewave		combine_range(dataname,namewave,-0.3,0.3)		Setscale/P x,dimoffset($namewave,0)-hvforVB[i]+Work_f,dimdelta($namewave,0),""$namewave		the_average=mean($namewave,normvaluelow,normvaluehigh)		$namewave[]/=the_average				Appendtograph $namewave			i+=1	While(i<dimsize(indexforVB,0))	bluetored()	Make/O/N=(dimsize($namewave,0),dimsize(indexforVB,0)) $matname	Setscale/P x, dimoffset($namewave,0),dimdelta($namewave,0),""$matname	Setscale/I y, hvforVB[0],hvforVB[dimsize(indexforVB,0)-1],""$matname		i=0	Do		namewave="VB"+num2str(hvforVB[i])			$matname[][i]=$namewave[p]		i+=1	While(i<dimsize(indexforVB,0))	Display	Appendimage $matnameEnd	//*******************************************************************************************************************************Proc temphv()	PauseUpdate	Silent 1	String thisname	Variable i,j	i=0	j=100	Do		thisname="hv"+num2str(j)		Setscale/P x,dimoffset($thisname,0)-j+4.3,dimdelta($thisname,0),""$thisname		j-=5	While(j>39)End	//*******************************************************************************************************************************Proc temphv2()	PauseUpdate	Silent 1	String thisname	Variable i,j	Display	i=0	j=40	Do		thisname="hv"+num2str(j)		Appendtograph $thisname		j+=5	While(j<101)End		//*******************************************************************************************************************************Proc temphv1()	PauseUpdate	Silent 1	String thisname	Variable i,j	Make/O/N=(12,dimsize(hv100,0)) mathv	Setscale/I x,40,100,""mathv	Setscale/P y,dimoffset(hv100,0),dimdelta(hv100,0),""mathv	i=0	j=40	Do		thisname="hv"+num2str(j)		mathv[i][]=$thisname[q]		j+=5		i+=1	While(j<101)	Display; appendimage mathvEnd		//*******************************************************************************************************************************Proc pickupedc(sample,hvenergy)//Designed for YBCO	String sample	Variable hvenergy	Prompt sample,"Enter the name of the sample"	Prompt hvenergy,"Enter the photon energy"	PauseUpdate	Silent 1	String thiscut,thisedc	Variable thisindex	Variable i,j	i=0	Do		thiscut="cut"+num2str(phiedc[i])		thisindex=Round((thetaedc[i]-dimoffset($thiscut,0))/dimdelta($thiscut,0))		thisedc=sample+"_"+num2str(hvenergy)+commentedc[i]+"_3"		Make/O/N=(dimsize($thiscut,1)) $thisedc		Setscale/P x,dimoffset($thiscut,1),dimdelta($thiscut,1),""$thisedc		j=-1		Do			$thisedc[]=$thiscut[thisindex+j][p]			j+=1		While(j<2)			$thisedc[]/=3		wave2filenokill(thisedc)		thisedc=sample+"_"+num2str(hvenergy)+commentedc[i]+"_5"					Make/O/N=(dimsize($thiscut,1)) $thisedc		Setscale/P x,dimoffset($thiscut,1),dimdelta($thiscut,1),""$thisedc		j=-2		Do			$thisedc[]=$thiscut[thisindex+j][p]			j+=1		While(j<3)					$thisedc[]/=5		wave2filenokill(thisedc)		thisedc=sample+"_"+num2str(hvenergy)+commentedc[i]+"_7"		Make/O/N=(dimsize($thiscut,1)) $thisedc		Setscale/P x,dimoffset($thiscut,1),dimdelta($thiscut,1),""$thisedc		j=-3		Do			$thisedc[]=$thiscut[thisindex+j][p]			j+=1		While(j<4)					$thisedc[]/=7		wave2filenokill(thisedc)					i+=1	While(i<dimsize(thetaedc,0))	End		//*******************************************************************************************************************************Proc normall()	PauseUpdate	Silent 1	String thiscut	Variable i,	i=0	Do		thiscut="cut"+num2str(phiindex[i])		normcut(thiscut,0,dimsize($thiscut,1)-1)		i+=1	While(i<dimsize(phiindex,0))	End	//*******************************************************************************************************************************Proc plotatG()	PauseUpdate	Silent 1	String thisdata,newname	Variable i	thisdata="data"+num2str(indexcut[0])	Make/O/N=(dimsize(phicut,0),dimsize($thisdata,1)) evolutionGvsphi	Setscale/P x, phicut[0],phicut[1]-phicut[0],""evolutionGvsphi	Setscale/P y, dimoffset($thisdata,1),dimdelta($thisdata,1),""evolutionGvsphi	Display	i=0	Do		thisdata="data"+num2str(indexcut[i])		normcut(thisdata,0,dimsize($thisdata,1)-1)		newname="atG"+num2str(phicut[i])		comb_krange(thisdata,newname,1,4)		//		comb_krange(thisdata,newname,0,6)		Appendtograph $newname		evolutionGvsphi[i][]=$newname[q]		i+=1	While(i<dimsize(phicut,0))	ln_mat_pi("evolutionGvsphi")	NaN0("ln_evolutionGvsphi")	derivmat("ln_evolutionGvsphi",5,5,1)	Label left "KE (eV)"	Label bottom "\\Z16\\F'symbol'j\\F'arial' (deg)"End			//*******************************************************************************************************************************Proc minus_background(temperature)	Variable temperature	Prompt temperature,"Enter the effective temperature"	PauseUpdate	Silent 1	String newwave,thiswave,name	Variable i,j,edcnumber	name="pi104"	edcnumber=x2pnt(pi104nodal_k,-1)	Make/O/N=(dimsize(pi104nodal_k,1)) tempwave	Setscale/P x, dimoffset(pi104nodal_k,1), dimdelta(pi104nodal_k,-1),""tempwave	Duplicate/O tempwave tempwavex	tempwave[]=0	j=0	Do		tempwave[]+=pi104nodal_k[j+edcnumber][p]		j+=1	While(j<5)	tempwave[]/=j	tempwavex[]=dimoffset(pi104nodal_k,1)+p*dimdelta(pi104nodal_k,1)		i=81	thiswave="e"+name+"nodal_k_3_"+num2str(i)+"_81_146"	Duplicate/O $thiswave backg	Duplicate/O $thiswave fermiwave	fermiwave[]=1/(exp((dimoffset($thiswave,0)+p*dimdelta($thiswave,0))/temperature)+1)+0.05		backg[]=Interp(dimoffset($thiswave,0)+p*dimdelta($thiswave,0),tempwavex,tempwave)	j=0		Do		thiswave="e"+name+"nodal_k_3_"+num2str(i)+"_81_146"		newwave=thiswave+"dF"		Duplicate/O $thiswave $newwave		$newwave[]-=backg[p]		Smooth/B=7 7, $newwave		$newwave[]/=fermiwave[p]//		Appendtograph $newwave						j+=1		i+=3	While(i<138+1)	Killwaves tempwave,tempwavex	End				//*******************************************************************************************************************************Proc pseudogap_profile(gap,temperature)	Variable gap=0.2	Variable temperature=0.01	Prompt gap,"Enter the impurity gap"	Prompt temperature,"Enter the temperature of the profile"	PauseUpdate	Silent 1	Make/O/N=5 coeff	Make/O/N=(dimsize(Akw,1)) pg_profile	Setscale/P x, dimoffset(Akw,1),dimdelta(Akw,1),""pg_profile	coeff[0]=0	coeff[1]=1	coeff[2]=-gap/2	coeff[3]=gap/2	coeff[4]=temperature	pg_profile[]=fermigap(coeff,dimoffset(pg_profile,0)+p*dimdelta(pg_profile,0))	End	//*******************************************************************************************************************************Proc plot2()	PauseUpdate	Silent 1	String thiswave,sname	Variable i,hv_value	sname="Y3GX"	hv_value=73	Display	i=0	Do		if((cmpstr(sname,name_of_sample[i])==0)&&(hv_value==hv_of_wave[i])&&(average_of_wave[i]==3))//(cmpstr(origin_of_wave[i],"B")==0)&&			if(cmpstr(location_of_wave[i],"nodal")==0)				thiswave=name_of_wave[i]				appendtograph $thiswave			Endif		Endif		i+=1	While(i<dimsize(name_of_wave,0))	Legend/C/N=text0/F=0/S=2/M/H={12,1,10}/A=MC	ShowInfo	Bluetored()End	//*******************************************************************************************************************************Proc subEF1()	PauseUpdate	Silent 1	String thiswave,thisname	Variable i	i=0	Do		thisname=name_of_sample[i]		if(hv_of_wave[i]==55)			thiswave=name_of_wave[i]			Setscale/P x,dimoffset($thiswave,0)-50.615,dimdelta($thiswave,0),""$thiswave		Endif		if(hv_of_wave[i]==67)			thiswave=name_of_wave[i]			Setscale/P x,dimoffset($thiswave,0)-62.58,dimdelta($thiswave,0),""$thiswave		Endif		if(hv_of_wave[i]==71)			thiswave=name_of_wave[i]			Setscale/P x,dimoffset($thiswave,0)-66.575,dimdelta($thiswave,0),""$thiswave		Endif		if(hv_of_wave[i]==73)			thiswave=name_of_wave[i]			Setscale/P x,dimoffset($thiswave,0)-68.565,dimdelta($thiswave,0),""$thiswave		Endif		if((hv_of_wave[i]==75)&&(cmpstr(thisname[1],"p")==0))			thiswave=name_of_wave[i]			Setscale/P x,dimoffset($thiswave,0)-70.674,dimdelta($thiswave,0),""$thiswave		Endif		if((hv_of_wave[i]==75)&&(cmpstr(thisname[1],"p")!=0))			thiswave=name_of_wave[i]			Setscale/P x,dimoffset($thiswave,0)-70.57,dimdelta($thiswave,0),""$thiswave		Endif				i+=1	While(i<dimsize(name_of_wave,0))End		//*******************************************************************************************************************************Proc loadallibw()	PauseUpdate	Silent 1	String tempPath, PathName	String tempstring	Variable numoffiles	Variable i	NewPath/o tempPath	PathName="tempPath"		numoffiles=ItemsInList(IndexedFile($PathName,-1,".ibw"))	Make/O/T/N=(numoffiles) name_of_wave	i=0	Do		tempstring=IndexedFile($PathName,i,".ibw")		name_of_wave[i]=tempstring[0,strlen(tempstring)-5]		file2wave(name_of_wave[i])		i+=1	While(i<numoffiles)	edit name_of_waveEnd	//*******************************************************************************************************************************Proc finddetails()//for YBCO	PauseUpdate	Silent 1	String thisname,namesample,tempstring	Variable i,j,number1,number2	Make/O/T/N=(dimsize(name_of_wave,0)) name_of_sample	Make/O/N=(dimsize(name_of_wave,0)) hv_of_wave	Make/O/T/N=(dimsize(name_of_wave,0)) origin_of_wave		Make/O/N=(dimsize(name_of_wave,0)) zone_of_wave	Make/O/T/N=(dimsize(name_of_wave,0)) location_of_wave		Make/O/N=(dimsize(name_of_wave,0)) average_of_wave		i=0	Do		thisname=name_of_wave[i]		j=0//finding the name and the photon energy		DO						j+=1		While(cmpstr(thisname[j],"_")!=0)		name_of_sample[i]=thisname[0,j-1]		hv_of_wave[i]=str2num(thisname[j+1,j+2])		//finding the band and the zone, and also the position		If(cmpstr(thisname[j+3],"M")==0)			origin_of_wave[i]="M"			zone_of_wave[i]=-1			location_of_wave[i]="M"		Endif		If(cmpstr(thisname[j+3],"A")==0)			origin_of_wave[i]="AB"			zone_of_wave[i]=str2num(thisname[j+5])			if(cmpstr(thisname[j+6],"a")==0)				location_of_wave[i]="anodal"				Else					location_of_wave[i]="nodal"			Endif		Endif		If(cmpstr(thisname[j+3],"B")==0)			origin_of_wave[i]="B"			zone_of_wave[i]=str2num(thisname[j+4])			if(cmpstr(thisname[j+5],"a")==0)				location_of_wave[i]="anodal"				Else					location_of_wave[i]="nodal"			Endif								Endif		average_of_wave[i]=str2num(thisname[strlen(thisname)-1])		i+=1	While(i<dimsize(name_of_wave,0))End			//*******************************************************************************************************************************Proc homework2b(mat)	String mat	Prompt mat,"Enter the name of the matrix"	PauseUpdate	Silent 1	String newmat	Variable i	Variable newsize,newdelta	Variable first_newx,last_newx	Variable thisx,oldx	Variable lowpnt,uppnt	Variable low_factor,up_factor	newmat=mat+"_hw2b"	//Definning the properties of the new matrix (limits, size ....)	If(dimoffset($mat,0)<0)		first_newx=-(dimoffset($mat,0))^2		Else			first_newx=dimoffset($mat,0)	Endif	If((dimoffset($mat,0)+(dimsize($mat,0)-1)*dimdelta($mat,0))<0)		last_newx=-(dimoffset($mat,0)+(dimsize($mat,0)-1)*dimdelta($mat,0))^2		Else			last_newx=(dimoffset($mat,0)+(dimsize($mat,0)-1)*dimdelta($mat,0))^2	Endif		newsize=dimsize($mat,0)*2	newdelta=(last_newx-first_newx)/(newsize-1)	Make/O/N=(newsize,dimsize($mat,1)) $newmat	Setscale/P x,first_newx,newdelta,"" $newmat	Setscale/P y,dimoffset($mat,1),dimdelta($mat,1),"" $newmat		//Filling the new matrix	i=0	Do		thisx=first_newx+i*newdelta		if(thisx<0)			oldx=-(sqrt(-thisx))			Else				oldx=sqrt(thisx)		Endif		lowpnt=Floor((oldx-dimoffset($mat,0))/dimdelta($mat,0))		uppnt=Ceil((oldx-dimoffset($mat,0))/dimdelta($mat,0))		If(lowpnt!=uppnt)			low_factor=((dimoffset($mat,0)+uppnt*dimdelta($mat,0))-oldx)/dimdelta($mat,0)			up_factor=(oldx-(dimoffset($mat,0)+lowpnt*dimdelta($mat,0)))/dimdelta($mat,0)  //note that low_factor+up_factor=1			Else				low_factor=0.5				up_factor=0.5		Endif		$newmat[i][]=low_factor*$mat[lowpnt][q]+up_factor*$mat[uppnt][q]				i+=1	While(i<newsize)	Display	Appendimage $newmat	ModifyImage $newmat ctab= {*,*,Terrain,0}End//*******************************************************************************************************************************Proc homework3a(boxwidth,boxheight,boxoffset,boxcenter,pourcentage_noise) // must have noise_fct	Variable boxwidth=2	Variable boxheight=3	Variable boxoffset=0.5	Variable boxcenter=2	Variable pourcentage_noise=10	Prompt boxwidth,"Enter the width of the box"	Prompt boxheight,"Enter the heigth of the box"	Prompt boxoffset,"Enter the vertical offset"	Prompt boxcenter,"Enter the horizontal offset"	Prompt pourcentage_noise,"Enter the % of noise"	PauseUpdate	Silent 1	Variable i	Variable firstx,lastx,firstbox,lastbox,ifirstbox,ilastbox	If((pourcentage_noise<0)||(pourcentage_noise>100))		pourcentage_noise=0		Print "You are very stupid!!!!!"	Endif		Make/O/N=400 thebox	thebox[]=0	//Find a reasonable scaling	firstx=boxcenter-1.5*boxwidth	lastx=boxcenter+1.5*boxwidth	Setscale/I x,firstx,lastx,""thebox	//Generating noise	If(Waveexists(noise_fct)==0)		file2wave("noise_fct")	Endif	Wavestats/Q noise_fct	Duplicate/O noise_fct newnoise	newnoise[]/=(V_sdev)/(pourcentage_noise*boxheight/100)	Duplicate/O newnoise newnoisex	newnoisex[]=p	//Creating thebox with noise	ifirstbox=Round((boxcenter-0.5*boxwidth-firstx)/dimdelta(thebox,0)-1)	ilastbox=Round((boxcenter+0.5*boxwidth-firstx)/dimdelta(thebox,0)-1)	thebox[]=boxoffset+Interp(p*dimsize(newnoise,0)/dimsize(thebox,0),newnoisex,newnoise)		i=ifirstbox	Do		thebox[i]+=boxheight		i+=1	While(i<(ilastbox+1))	Display thebox	Killwaves newnoise,newnoisexEnd	//*******************************************************************************************************************************Proc homework3b(name,boxwidth,boxheight,boxoffset,boxcenter)	String name	Variable boxwidth=2	Variable boxheight=3	Variable boxoffset=0.5	Variable boxcenter=2	Prompt name,"Enter the name of the wave to fit"		Prompt boxwidth,"Enter the width of the box"	Prompt boxheight,"Enter the heigth of the box"	Prompt boxoffset,"Enter the vertical offset"	Prompt boxcenter,"Enter the horizontal offset"	PauseUpdate	Silent 1	String coeff,coeffname,fitted	Variable i	Variable xstart,xend	Variable thisx	coeff=name+"_coeff"	coeffname=name+"_coeffname"	fitted=name+"_boxfit"	Make/O/N=5 fitcoeff	xstart=xcsr(A)	xend=xcsr(B)	fitcoeff[0]=boxoffset	fitcoeff[1]=boxheight	fitcoeff[2]=boxcenter+boxwidth/2	fitcoeff[3]=boxcenter-boxwidth/2	fitcoeff[4]=boxwidth/1000	FuncFit/N/Q/H="00001" boxfunc fitcoeff $name (xstart,xend)	Make/O/T/N=4 $coeffname	$coeffname[0]="Offset"	$coeffname[1]="Height"	$coeffname[2]="Center"	$coeffname[3]="Width"	Make/O/N=4 $coeff	$coeff[0]=fitcoeff[0]	$coeff[1]=fitcoeff[1]	$coeff[2]=(fitcoeff[2]+fitcoeff[3])/2	$coeff[3]=fitcoeff[2]-fitcoeff[3]	edit $coeffname,$coeff	Duplicate/O $name $fitted	Duplicate/O $name thistest1		i=0	Do		thisx=dimoffset($fitted,0)+i*dimdelta($fitted,0)		$fitted[i]=boxfunc(fitcoeff,thisx)		i+=1	While(i<dimsize($fitted,0))	Appendtograph	$fitted	ModifyGraph rgb($fitted)=(0,0,0)End				//*******************************************************************************************************************************Proc homework5a(namex,namey,sizegrid,thenumber)	String namex	String namey		Variable sizegrid	Variable thenumber	Prompt namex,"Enter the name of the wave in x: "		Prompt namey,"Enter the name of the wave in y: "			Prompt sizegrid,"Enter the number of rows and columns for the grid"		Prompt thenumber,"Enter the number of pnts for calc."	PauseUpdate		Silent 1	Variable i, j	Variable lattice	Variable firstx,firsty	Variable griddelta	Variable oldx,nextx,oldy,nexty	Variable number_in	Variable xfloor,yfloor	Variable thearea	//Check if the surface is closed	If(($namex[0]!=$namex[dimsize($namex,0)-1])||($namey[0]!=$namey[dimsize($namey,0)-1]))		Insertpoints dimsize($namex,0), 1, $namex		Insertpoints dimsize($namey,0), 1, $namey		$namex[dimsize($namex,0)-1]=$namex[0]		$namey[dimsize($namey,0)-1]=$namey[0]			Endif	//Determine the size of the square background grid	Wavestats/Q $namex	If(abs(V_min)<abs(V_max))		lattice=abs(V_max)*2		Else		lattice=abs(V_min)*2	Endif	Wavestats/Q $namey	If(abs(V_min)>lattice/2)		lattice=2*abs(V_min)	Endif	If(abs(V_max)>lattice/2)		lattice=2*abs(V_max)	Endif		lattice*=1.05		//extrapolating the data for evenly spaced x or y. We create one wave for each case.	griddelta=lattice/(sizegrid-1)	firstx=Round(($namex[0]+lattice/2)/griddelta)	firsty=Round(($namey[0]+lattice/2)/griddelta)	//First wave for x	Make/O/N=1 surfx_x	Make/O/N=1 surfx_y	surfx_x[0]=-lattice/2+firstx*griddelta	surfx_y[0]=-lattice/2+firsty*griddelta	j=1	i=1 //the first point is already copied	Do		oldx=surfx_x[dimsize(surfx_x,0)-1]		oldy=surfx_y[dimsize(surfx_y,0)-1]		Do			nextx=$namex[i]			nexty=$namey[i]			i+=1		While((abs(nextx-oldx)<griddelta)&&i<dimsize($namex,0))		if(i==dimsize($namex,0))			nextx=$namex[0]			nexty=$namey[0]		Endif		If(i<dimsize($namex,0)+1)// to prevent an infinite loop			Insertpoints dimsize(surfx_x,0), 1, surfx_x					Insertpoints dimsize(surfx_y,0), 1, surfx_y			If((nextx-oldx)>=0)				surfx_x[j]=oldx+griddelta				else					surfx_x[j]=oldx-griddelta			Endif			surfx_y[j]=oldy+griddelta*(nexty-oldy)/abs(nextx-oldx)			j+=1//Note we do not increase i because we want to test this same i value in case that griddelta is smaller than the dot spacing 				Endif		if((i!=dimsize($namex,0))||(abs(nextx-oldx)>2*griddelta))						i-=1		Endif		While(i<dimsize($namex,0))	//Then wave for y	Make/O/N=1 surfy_x	Make/O/N=1 surfy_y	surfy_x[0]=-lattice/2+firstx*griddelta	surfy_y[0]=-lattice/2+firsty*griddelta	j=1	i=1 //the first point is already copied	Do		oldx=surfy_x[dimsize(surfy_x,0)-1]		oldy=surfy_y[dimsize(surfy_y,0)-1]		Do			nextx=$namex[i]			nexty=$namey[i]			i+=1		While((abs(nexty-oldy)<griddelta)&&i<dimsize($namey,0))		if(i==dimsize($namey,0))			nextx=$namex[0]			nexty=$namey[0]		Endif		If(i<dimsize($namey,0)+1)// to prevent an infinite loop			Insertpoints dimsize(surfy_x,0), 1, surfy_x					Insertpoints dimsize(surfy_y,0), 1, surfy_y			If((nexty-oldy)>=0)				surfy_y[j]=oldy+griddelta				else					surfy_y[j]=oldy-griddelta			Endif			surfy_x[j]=oldx+griddelta*(nextx-oldx)/abs(nexty-oldy)			j+=1//Note we do not increase i because we want to test this same i value in case that griddelta is smaller than the dot spacing 				Endif		if((i!=dimsize($namey,0))||(abs(nexty-oldy)>2*griddelta))						i-=1		Endif		While(i<dimsize($namey,0))	//Calculating the area using a random process	Make/O/N=0 xnoise 	Make/O/N=0 ynoise	number_in=func_homework5a($namex,$namey,surfx_x,surfx_y,surfy_x,surfy_y,xnoise,ynoise,sizegrid,thenumber,griddelta,lattice)			thearea=lattice*lattice*number_in/thenumber	print thearea		Display $namey vs $namex	Appendtograph ynoise vs xnoise	ModifyGraph mode(ynoise)=3,marker(ynoise)=8,msize(ynoise)=1,rgb(ynoise)=(4369,4369,4369)		print number_in	Killwaves surfx_x,surfx_y,surfy_x,surfy_yEnd	//*******************************************************************************************************************************Function func_homework5a(namex,namey,surfx_x,surfx_y,surfy_x,surfy_y,xnoise,ynoise,sizegrid,thenumber,griddelta,lattice)	Wave namex	Wave namey	Wave surfx_x	Wave surfx_y	Wave surfy_x	Wave surfy_y	Wave xnoise	Wave ynoise		Variable sizegrid	Variable thenumber	Variable griddelta	Variable lattice	Variable number_in	Variable randomx	Variable randomy	Variable ongridx	Variable ongridy	Variable i,j	Variable xfloor,yfloor	//Calculating the area using a random process	number_in=0	i=0		Do		If(mod(i,100)==0)			print i,"/",thenumber		Endif		randomx=enoise(lattice/2)		randomy=enoise(lattice/2)		ongridx=Round((randomx+lattice/2)/griddelta)		ongridy=Round((randomy+lattice/2)/griddelta)		Insertpoints dimsize(xnoise,0), 1, xnoise		Insertpoints dimsize(xnoise,0), 1, ynoise		xnoise[dimsize(xnoise,0)-1]=randomx		ynoise[dimsize(ynoise,0)-1]=randomy				Make/O/N=0 intersectionx //means at constant x		Make/O/N=0 intersectiony		j=0		Do			if(Round((surfx_x[j]+lattice/2)/griddelta)==ongridx)				Insertpoints dimsize(intersectionx,0), 1, intersectionx				intersectionx[dimsize(intersectionx,0)-1]=surfx_y[j]			Endif			j+=1		While(j<dimsize(surfx_x,0))			j=0		Do			if(Round((surfy_y[j]+lattice/2)/griddelta)==ongridy)				Insertpoints dimsize(intersectiony,0), 1, intersectiony				intersectiony[dimsize(intersectiony,0)-1]=surfy_x[j]			Endif			j+=1		While(j<dimsize(surfy_y,0))		sort intersectionx, intersectionx		sort intersectiony, intersectiony		xfloor=0		j=0		Do			If(intersectionx[j]<randomy)				xfloor+=1			Endif			j+=1		While(j<dimsize(intersectionx,0))		yfloor=0		j=0		Do			If(intersectiony[j]<randomx)				yfloor+=1			Endif			j+=1		While(j<dimsize(intersectiony,0))		If((mod(xfloor,2)==1)&&(mod(yfloor,2)==1))			number_in+=1		Endif											i+=1	While(i<thenumber)	Return number_inEnd	//*******************************************************************************************************************************Proc give_vol_lac(namex,namey,sizegrid,measure_x,measure_y,measure_deep)	String namex	String namey		Variable sizegrid	String measure_x	String measure_y	String measure_deep		Prompt namex,"Enter the name of the wave in x: "		Prompt namey,"Enter the name of the wave in y: "			Prompt sizegrid,"Enter the number of rows and columns for the grid"		Prompt measure_x,"Enter the position x-wave name:"	Prompt measure_y,"Enter the position y-wave name:"	Prompt measure_deep,"Enter the deepness wave name:"			PauseUpdate		Silent 1	Variable i, j	Variable lattice		Variable firstx,firsty	Variable griddelta	Variable oldx,nextx,oldy,nexty	Variable thearea, thevolume,theperimeter	Variable ongridx,ongridy	Variable boundary_factor	Variable translation_x,translation_y	//Check if the surface is closed	If(($namex[0]!=$namex[dimsize($namex,0)-1])||($namey[0]!=$namey[dimsize($namey,0)-1]))		Insertpoints dimsize($namex,0), 1, $namex		Insertpoints dimsize($namey,0), 1, $namey		$namex[dimsize($namex,0)-1]=$namex[0]		$namey[dimsize($namey,0)-1]=$namey[0]			Endif	//perimeter calculation	theperimeter=func_vol_lac0($namex,$namey)	//Translation of the origin	Duplicate/O $namex tnamex	Duplicate/O $namey tnamey	Duplicate/O $measure_x tmeasure_x	Duplicate/O $measure_y tmeasure_y	Duplicate/O $measure_deep tmeasure_deep		Wavestats/Q $namex	translation_x=V_avg	tnamex[]-=V_avg	tmeasure_x[]-=V_avg		Wavestats/Q $namey	translation_y=V_avg	tnamey[]-=V_avg	tmeasure_y[]-=V_avg		//Determine the size of the square background grid	Wavestats/Q tnamex	If(abs(V_min)<abs(V_max))		lattice=abs(V_max)*2		Else		lattice=abs(V_min)*2	Endif	Wavestats/Q tnamey	If(abs(V_min)>lattice/2)		lattice=2*abs(V_min)	Endif	If(abs(V_max)>lattice/2)		lattice=2*abs(V_max)	Endif		lattice*=1.05			griddelta=lattice/(sizegrid-1)//	firstx=Round((tnamex[0]+lattice/2)/griddelta)//	firsty=Round((tnamey[0]+lattice/2)/griddelta)		//extrapolating the data for evenly spaced x.	Make/O/N=0 surfx_x	Make/O/N=0 surfx_y//	surfx_x[0]=-lattice/2+firstx*griddelta//	surfx_y[0]=-lattice/2+firsty*griddelta	Make/O/N=0 surfy_x	Make/O/N=0 surfy_y	func_vol_lac1(tnamex,tnamey,surfx_x,surfx_y,griddelta,lattice)	Make/O/N=(sizegrid,sizegrid) inside_out	Print "Calculating the area"	thearea=func_vol_lac2(surfx_x,surfx_y,inside_out,sizegrid,griddelta,lattice)	//Faking additionnal measurement points	func_vol_lac3(tnamex,tnamey,sizegrid,griddelta,lattice,tmeasure_x,tmeasure_y,tmeasure_deep,inside_out)	////////////////////	//defining the deepness_matrix	Duplicate/O inside_out deepness_matrix	Setscale/P x,-lattice/2,griddelta,""deepness_matrix	Setscale/P y,-lattice/2,griddelta,""deepness_matrix	deepness_matrix[][]=0	Print "Calculating the volume"	thevolume=func_vol_lac4(surfx_x,surfx_y,sizegrid,griddelta,lattice,deepness_matrix,tmeasure_x,tmeasure_y,tmeasure_deep,inside_out)	Print "Le primtre du lac est : ",theperimeter, "m"	print "La surface du lac est : ", thearea, " m^2"	WaveStats/Q $measure_deep	print "Surface x profondeur_max : ",thearea*V_max, " m^3"		Print "Le volume du lac est : ",thevolume, " m^3"End	//*******************************************************************************************************************************Function func_vol_lac0(namex,namey)//extrapolates the curve on the x-grid and y-grid	Wave namex	Wave namey	Variable i	Variable theperimeter	theperimeter=0	i=1	Do		theperimeter+=sqrt((namex[i]-namex[i-1])^2+(namey[i]-namey[i-1])^2)		i+=1	While(i<dimsize(namex,0))	Return theperimeterEnd		//*******************************************************************************************************************************Function func_vol_lac1(namex,namey,surfx_x,surfx_y,griddelta,lattice)//extrapolates the curve on the x-grid and y-grid	Wave namex	Wave namey	Wave surfx_x	Wave surfx_y	Variable griddelta	Variable lattice	Variable i,j,ii	Variable num_of_new		Make/O/N=1 ttempx	Make/O/N=1 ttempy	ttempx[0]=Round((namex[0]+lattice/2)/griddelta)	ttempy[0]=Round((namey[0]+lattice/2)/griddelta)	j=1		i=1	Do			if((Round((namex[i]+lattice/2)/griddelta)!=Round((namex[i-1]+lattice/2)/griddelta))||(Round((namey[i]+lattice/2)/griddelta)!=Round((namey[i-1]+lattice/2)/griddelta)))			Insertpoints dimsize(ttempx,0), 1, ttempx					Insertpoints dimsize(ttempy,0), 1, ttempy			ttempx[j]=Round((namex[i]+lattice/2)/griddelta)			ttempy[j]=Round((namey[i]+lattice/2)/griddelta)			j+=1		Endif		i+=1	While(i<dimsize(namex,0))	print dimsize(namex,0),dimsize(ttempx,0),dimsize(surfx_x,0),"orange"	i=0	ii=0	Do		Insertpoints dimsize(surfx_x,0), 1, surfx_x				Insertpoints dimsize(surfx_y,0), 1, surfx_y		surfx_x[ii]=ttempx[i]		surfx_y[ii]=ttempy[i]		if(ttempx[i+1]!=ttempx[i])			num_of_new=abs(ttempx[i+1]-ttempx[i])-1			if(num_of_new>0)				j=0				Do					Insertpoints dimsize(surfx_x,0), 1, surfx_x							Insertpoints dimsize(surfx_y,0), 1, surfx_y					If(ttempx[i+1]>ttempx[i])						surfx_x[ii+j+1]=ttempx[i]+(j+1)						surfx_y[ii+j+1]=Round(ttempy[i]+(j+1)*(ttempy[i+1]-ttempy[i])/(ttempx[i+1]-ttempx[i]))						Else							surfx_x[ii+j+1]=ttempx[i]-(j+1)							surfx_y[ii+j+1]=Round(ttempy[i]-(j+1)*(ttempy[i+1]-ttempy[i])/(ttempx[i+1]-ttempx[i]))															Endif					j+=1				While(j<num_of_new)				ii+=num_of_new			Endif			Endif					ii+=1		i+=1	While(i<dimsize(ttempx,0)-1)	print i, ii,num_of_newEnd		//*******************************************************************************************************************************Function func_vol_lac2(surfx_x,surfx_y,inside_out,sizegrid,griddelta,lattice)//calculates the area	Wave surfx_x	Wave surfx_y	Wave inside_out	Variable sizegrid	Variable griddelta	Variable lattice	Variable thearea	Variable condition_in	Variable i,j,jj	variable slope_before,slope_after	inside_out[][]=0		Make/O/N=(3*dimsize(surfx_x,0)) tempx	Make/O/N=(3*dimsize(surfx_y,0)) tempy	i=0	Do		tempx[i]=surfx_x[i]		tempx[i+dimsize(surfx_x,0)]=surfx_x[i]		tempx[i+2*dimsize(surfx_x,0)]=surfx_x[i]		tempy[i]=surfx_y[i]		tempy[i+dimsize(surfx_x,0)]=surfx_y[i]		tempy[i+2*dimsize(surfx_x,0)]=surfx_y[i]				i+=1	While(i<dimsize(surfx_x,0))			//defining the enclosed surface 	i=0		Do		if(mod(i,500)==0)			print "x ",i,"/",sizegrid		Endif		Make/O/N=0 intersectionx //y point on the grid. Means real intersection at constant x		Make/O/N=0 intersectionpnt				Make/O/N=0 samex //means all points with constant x		Make/O/N=0 pnt_on_curve //point along the curve. Comes with samex				j=dimsize(surfx_y,0)		Do			If(tempx[j]==i)				Insertpoints dimsize(samex,0), 1, samex				samex[dimsize(samex,0)-1]=tempy[j]				Insertpoints dimsize(pnt_on_curve,0), 1, pnt_on_curve				pnt_on_curve[dimsize(pnt_on_curve,0)-1]=j				inside_out[i][tempy[j]]=1			Endif			j+=1		While(j<2*dimsize(surfx_x,0))		If(dimsize(samex,0)>1)			j=0			Do				If(((tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]+1])*(tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]-1]))<0)					Insertpoints dimsize(intersectionx,0), 1, intersectionx					intersectionx[dimsize(intersectionx,0)-1]=samex[j]					Insertpoints dimsize(intersectionpnt,0), 1, intersectionpnt					intersectionpnt[dimsize(intersectionpnt,0)-1]=pnt_on_curve[j]				Endif				if(((tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]+1])*(tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]-1]))==0)					slope_before=tempx[pnt_on_curve[j]]-tempx[pnt_on_curve[j]-1]					jj=0					Do						jj+=1					While(tempx[pnt_on_curve[j]+jj]==tempx[pnt_on_curve[j]+jj+1])					slope_after=tempx[pnt_on_curve[j]+jj]-tempx[pnt_on_curve[j]+1+jj]					If(slope_before*slope_after<0)						Insertpoints dimsize(intersectionx,0), 1, intersectionx						intersectionx[dimsize(intersectionx,0)-1]=samex[j]						Insertpoints dimsize(intersectionpnt,0), 1, intersectionpnt						intersectionpnt[dimsize(intersectionpnt,0)-1]=pnt_on_curve[j]										Endif					j+=jj				Endif								j+=1			While(j<dimsize(samex,0))			Sort intersectionx,intersectionx,intersectionpnt			j=0			Do				inside_out[i][intersectionx[j],intersectionx[j+1]]=1				j+=2			While(j<dimsize(intersectionx,0))			Endif		i+=1	While(i<sizegrid)	//defining the enclosed surface (y_way)	thearea=0	i=0	Do		j=0		Do			thearea+=inside_out[i][j]			j+=1		While(j<dimsize(inside_out,1))		i+=1	While(i<dimsize(inside_out,0))	thearea*=(griddelta*griddelta)	return theareaEnd	//*******************************************************************************************************************************Function func_vol_lac3(tsurfx_x,tsurfx_y,sizegrid,griddelta,lattice,px,py,pdeep,inside_out)	Wave tsurfx_x	Wave tsurfx_y	Variable sizegrid	Variable griddelta	Variable lattice	Wave px	Wave py	Wave pdeep	Wave inside_out	Variable i,j	Variable newx,newy	Variable dist1,dist2,point1	Variable condition_loop	Duplicate/O px mxtemp	Duplicate/O py mytemp	Duplicate/O pdeep mdeeptemp	i=dimsize(mxtemp,0)	Do		condition_loop=0		Do			newx=enoise(lattice/2)			newy=enoise(lattice/2)			if(inside_out[Round((newx+lattice/2)/griddelta)][Round((newy+lattice/2)/griddelta)]==1)				Duplicate/O mxtemp sq_distance1				Duplicate/O tsurfx_x sq_distance2				sq_distance1[]=(mxtemp[p]-newx)^2+(mytemp[p]-newy)^2				sq_distance2[]=(tsurfx_x[p]-newx)^2+(tsurfx_y[p]-newy)^2				WaveStats/Q sq_distance2				dist2=V_min				WaveStats/Q sq_distance1				dist1=V_min				If(dist1<dist2)					Insertpoints dimsize(px,0), 1, px					Insertpoints dimsize(py,0), 1, py					Insertpoints dimsize(px,0), 1, pdeep					px[dimsize(px,0)-1]=newx					py[dimsize(py,0)-1]=newy					pdeep[dimsize(pdeep,0)-1]=mdeeptemp[V_minloc]					condition_loop=1				Endif						Endif				While(condition_loop==0)		i+=1	While(i<250*dimsize(mxtemp,0))		Killwaves mxtemp,mytemp,mdeeptemp	Killwaves sq_distance1,sq_distance2End				//*******************************************************************************************************************************Function func_vol_lac4(surfx_x,surfx_y,sizegrid,griddelta,lattice,deepness_matrix,position_x,position_y,position_deepness,inside_out)//calculates the volume	Wave surfx_x	Wave surfx_y	Variable sizegrid	Variable griddelta	Variable lattice	Wave deepness_matrix	Wave position_x	Wave position_y	Wave position_deepness	Wave inside_out	Variable i,j,index	Variable partial_weight1, partial_weight2, total_weight	Variable thevolume	Variable boundary_factor	Variable this_deep	boundary_factor=dimsize(position_x,0)/dimsize(surfx_x,0)//to not overestimate the weight from the boundary	deepness_matrix[][]=0	Duplicate/O surfx_x xsurfx_x	Duplicate/O surfx_y xsurfx_y	xsurfx_x[]=surfx_x[p]*griddelta-lattice/2	xsurfx_y[]=surfx_y[p]*griddelta-lattice/2	Print "Generating the deepness field"			i=0	Do		if(mod(i,10)==0)			print i,"/",sizegrid		Endif					j=0		Do			If(inside_out[i][j]!=0)				//calculation of the weight				Duplicate/O position_x sq_distance1				sq_distance1[]=(1/((position_x[p]-(i*griddelta-lattice/2))^2+(position_y[p]-(j*griddelta-lattice/2))^2))				Wavestats/Q sq_distance1				partial_weight1=V_avg*dimsize(sq_distance1,0)				Duplicate/O xsurfx_x sq_distance2				sq_distance2[]=(1/((xsurfx_x[p]-(i*griddelta-lattice/2))^2+(xsurfx_y[p]-(j*griddelta-lattice/2))^2))				Wavestats/Q sq_distance2				partial_weight2=V_avg*boundary_factor*dimsize(sq_distance2,0)//				partial_weight2=0				total_weight=partial_weight1+partial_weight2				//contributions				index=0				this_deep=0				Do					this_deep+=(sq_distance1[index])*position_deepness[index]/total_weight//					print "banane",(total_weight-sq_distance1[index])/total_weight					index+=1				While(index<dimsize(sq_distance1,0))				deepness_matrix[i][j]=this_deep											Endif			j+=1		While(j<sizegrid)		i+=1	While(i<sizegrid)//	Killwaves sq_distance1,sq_distance2	thevolume=0	i=0	Do 			Make/O/N=(sizegrid) thistempwave		thistempwave[]=deepness_matrix[i][p]		WaveStats/Q thistempwave		thevolume+=V_avg*sizegrid*griddelta^2		i+=1	While(i<sizegrid)	killwaves thistempwave	return thevolumeEnd		//*******************************************************************************************************************************Function boxfunc(m,x)	wave m; variable x	Variable value	value=m[0]+m[1]/((exp((x-m[2])/m[4])+1)*(exp(-(x-m[3])/m[4])+1))	return valueEnd//*******************************************************************************************************************************Function sym1FDplus1Lor(parwave,x) : fitfunc	wave parwave; variable x	Variable value	value=parwave[0]/(exp((x-parwave[1])/parwave[2])+1)+parwave[0]/(exp(-(x+parwave[1])/parwave[2])+1)+parwave[3]/((x-parwave[4])^2+parwave[5]^2)+parwave[3]/((x+parwave[4])^2+parwave[5]^2)	return valueEnd//*******************************************************************************************************************************Function sym1FDplus2Lor(parwave,x) : fitfunc	wave parwave; variable x	Variable value	Value=0	value=parwave[0]/(exp((x-parwave[1])/parwave[2])+1)+parwave[0]/(exp(-(x+parwave[1])/parwave[2])+1)+parwave[3]/((x-parwave[4])^2+parwave[5]^2)+parwave[3]/((x+parwave[4])^2+parwave[5]^2)+parwave[6]/((x-parwave[7])^2+parwave[8]^2)+parwave[6]/((x+parwave[7])^2+parwave[8]^2)	return valueEnd//*******************************************************************************************************************************Function sym1FDplus2asLor(parwave,x) : fitfunc  //only one lorenztian is asymmetric	wave parwave; variable x	Variable value	Value=0	value=parwave[0]/(exp((x-parwave[1])/parwave[2])+1)+parwave[0]/(exp(-(x+parwave[1])/parwave[2])+1)	value+=parwave[3]/((x-parwave[4])^2+parwave[5]^2)+parwave[3]/((x+parwave[4])^2+parwave[5]^2)	value+=parwave[6]*(parwave[8]+parwave[9]*ABS(x))/((x-parwave[7])^2+(parwave[8]+parwave[9]*ABS(x))^2)	value+=parwave[6]*(parwave[8]+parwave[9]*ABS(x))/((x+parwave[7])^2+(parwave[8]+parwave[9]*ABS(x))^2)	return valueEnd//*******************************************************************************************************************************Function OneasLor(parwave,x) : fitfunc  //only one lorenztian is asymmetric	wave parwave; variable x	Variable value	Value=0	value+=parwave[0]*(parwave[2]+parwave[3]*ABS(x))/((x-parwave[1])^2+(parwave[2]+parwave[3]*ABS(x))^2)	return valueEnd//*******************************************************************************************************************************Function fermigap(m,x)	wave m; variable x	Variable value	value=m[0]+m[1]/(exp((x-m[2])/m[4])+1) +m[1]/(exp(-(x-m[3])/m[4])+1)	return valueEnd//*******************************************************************************************************************************Function linear_bkgnd_plus2Lor(parwave,x) : fitfunc	wave parwave; variable x	Variable value	value=parwave[0]+x*parwave[1]+parwave[2]/((x-parwave[3])^2+parwave[4]^2)+parwave[5]/((x-parwave[6])^2+parwave[7]^2)	return valueEnd//*******************************************************************************************************************************Function linear_bkgnd_plus2LorsameW(parwave,x) : fitfunc	wave parwave; variable x	Variable value	value=parwave[0]+x*parwave[1]+parwave[2]/((x-parwave[3])^2+parwave[4]^2)+parwave[5]/((x-parwave[6])^2+parwave[4]^2)	return valueEnd//*******************************************************************************************************************************Proc remove60(sstart,eend)	Variable sstart	Variable eend	Pauseupdate	Silent 1	String thisname	Variable i	i=sstart	Do		thisname="data"+num2str(i)		$thisname[60][]=0.5*($thisname[59][q]+$thisname[61][q])		i+=1	While(i<eend+1)End//*******************************************************************************************************************************Proc temp6macro()	Pauseupdate;Silent 1	Variable i	Variable j,condition	i=0	Do		condition=1		j=0		Do			if(NTP1[j]==numberFSBKFA[i])				condition=0			Endif			j+=1		While(j<dimsize(NTP1,0))		if(condition==1)			Insertpoints dimsize(indexgapinner,0),1,indexgapinner			Insertpoints dimsize(anglegapinner,0),1,anglegapinner				indexgapinner[dimsize(indexgapinner,0)-1]=numberFSBKFA[i]			anglegapinner[dimsize(anglegapinner,0)-1]=angleFSBKFA[i]							Endif		i+=1	While(i<dimsize(angleFSBKFA,0))End//*******************************************************************************************************************************Proc temp7macro()	Pauseupdate;Silent 1	Variable i	Variable j,condition	i=0	Do		condition=1		j=0		Do			if(NTP3[j]==numberFSBKFA[i])				condition=0			Endif			j+=1		While(j<dimsize(NTP3,0))		if(condition==1)			Insertpoints dimsize(indexgapoutter,0),1,indexgapoutter			Insertpoints dimsize(anglegapoutter,0),1,anglegapoutter				indexgapoutter[dimsize(indexgapoutter,0)-1]=numberFSBKFA[i]			anglegapoutter[dimsize(anglegapoutter,0)-1]=angleFSBKFA[i]							Endif		i+=1	While(i<dimsize(angleFSBKFA,0))End//*******************************************************************************************************************************Proc temp8macro()	Pauseupdate;Silent 1	Variable i	Variable j,condition	i=0	Do		condition=1		j=0		Do			if(NTP3[j]==numberFSBKFA[i])				condition=0			Endif			j+=1		While(j<dimsize(NTP3,0))		if(condition==1)			Insertpoints dimsize(indexgapoutter,0),1,indexgapoutter			Insertpoints dimsize(anglegapoutter,0),1,anglegapoutter				indexgapoutter[dimsize(indexgapoutter,0)-1]=numberFSBKFA[i]			anglegapoutter[dimsize(anglegapoutter,0)-1]=angleFSBKFA[i]							Endif		i+=1	While(i<dimsize(angleFSBKFA,0))End//*******************************************************************************************************************************Proc temp9macro(matname)	String Matname	Prompt Matname,"Matrix name"	Pauseupdate;Silent 1	String thisedc	Variable i	Variable j	Dowindow/F xttem	Duplicate/O $matname ttemp;rescale_pi("ttemp",2,-16.825);sym_edc_matrix_far("ttemp");Duplicate/O ttempsym ttemp	Dowindow/F xttemp	EDC_pi("ttemp",7)		Duplicate/O ttemp tempname	i=0	Do		thisedc="Ettemp_7_"+num2str(i)		tempname[i][]=$thisedc[q]		i+=1	While(i<dimsize(ttemp,0))	derivmat("tempname",7,7,1)	Display;appendimage tempnameEnd//*******************************************************************************************************************************Proc plotfermi(temperature)	Variable temperature=20	Prompt temperature,"Temperature:"	PauseUpdate;Silent 1	Make/O/N=1000 fermiwave	Setscale/I x,-3,1,""fermiwave	fermiwave[]=1/(exp((dimoffset(fermiwave,0)+p*dimdelta(fermiwave,0))/temperature)+1)	Duplicate/O fermiwave gausswave	Setscale/I x,-5,5,""gausswave	gausswave[]=exp(-(dimoffset(gausswave,0)+p*dimdelta(gausswave,0))^2/(0.1^2))		Duplicate/O Fermiwave resultwave	Display fermiwave	Convolve gausswave, resultwave 	Appendtograph resultwaveEnd//*******************************************************************************************************************************Proc JAPS1(matname,Eslice_first,Eslice_last,kleft,kright,combMDC)	String matname	Variable Eslice_first=0	Variable Eslice_last=51	Variable kleft=-0.9408		Variable kright=-0.055127//	Variable kleft=0.06845//	Variable kright=0.4875	Variable combMDC=3	Prompt matname,"Enter the name of the matrix"	Prompt Eslice_first,"First Energy slice:"	Prompt Eslice_last,"Last Energy slice:"		Prompt kleft,"Momentum left:"	Prompt kright,"Momentum right:"	Prompt combMDC,"Number of MDC to combine (odd)"		Pauseupdate;Silent 1	String newname	String Energywavefit,pk1,pk2,pk1e,pk2e,w1,w2,w1e,w2e	Variable i,j	Variable MDC1,MDC2	Variable condition	newname=matname+num2str(Eslice_first)+"_"+num2str(Eslice_last)+"fit"	Make/O/N=(Eslice_last-Eslice_first+1,16) $newname	condition=0	i=Eslice_last	Do		IF(mod(i,10)==0)			Print i		Endif		Make/O/N=(dimsize($matname,0)) thiswave		Setscale/P x,dimoffset($matname,0),dimdelta($matname,0),""thiswave		MDC1=i-(combMDC-1)/2		MDC2=i+(combMDC-1)/2		IF(MDC1<0)			MDC1=0		Endif		If(MDC2>dimsize($matname,1)-1)			MDC2=dimsize($matname,1)-1		Endif		thiswave[]=0		j=MDC1		Do			thiswave[]+=$matname[p][j]			j+=1		While(j<MDC2+1)		thiswave[]/=combMDC//		Wavestats/Q/R=(kleft,kright) thiswave		IF(condition==0)			Make/O/N=8 parafit//			parafit[0]=0.01//			parafit[1]=0.01//			parafit[4]=0.05//			parafit[2]=0.5*(parafit[4])^2	//			parafit[3]=0.4392//			parafit[7]=0.05//			parafit[5]=0.36*(parafit[7])^2//			parafit[6]=0.52159			parafit[0]=0.01			parafit[1]=0.01			parafit[4]=0.05			parafit[2]=3*0.5*(parafit[4])^2				parafit[3]=-0.51856			parafit[7]=0.05			parafit[5]=3*0.2*(parafit[7])^2			parafit[6]=-0.42587			condition=1		Endif		FuncFit/H="00000000"/N/Q linear_bkgnd_plus2Lor parafit thiswave(kleft,kright) /D // /C=T_Constraints		j=0		Do			$newname[i][j]=parafit[j]			$newname[i][j+8]=W_sigma[j]			j+=1		While(j<dimsize(parafit,0))			i-=1	While(i>Eslice_first-1)	Energywavefit="E"+newname	Make/O/N=(Eslice_last-Eslice_first+1) $Energywavefit	$Energywavefit[]=dimoffset($matname,1)+(p-Eslice_first)*dimdelta($matname,1)	pk1="pk1"+newname	pk2="pk2"+newname	pk1e="pk1"+newname+"_err"	pk2e="pk2"+newname+"_err"		Make/O/N=(Eslice_last-Eslice_first+1) $pk1		Make/O/N=(Eslice_last-Eslice_first+1) $pk2	Make/O/N=(Eslice_last-Eslice_first+1) $pk1e		Make/O/N=(Eslice_last-Eslice_first+1) $pk2e	$pk1[]=$newname[p][3]	$pk1e[]=$newname[p][11]	$pk2[]=$newname[p][6]	$pk2e[]=$newname[p][14]	w1="w1"+newname	w2="w2"+newname	w1e="w1"+newname+"_err"	w2e="w2"+newname+"_err"		Make/O/N=(Eslice_last-Eslice_first+1) $w1		Make/O/N=(Eslice_last-Eslice_first+1) $w2	Make/O/N=(Eslice_last-Eslice_first+1) $w1e		Make/O/N=(Eslice_last-Eslice_first+1) $w2e	$w1[]=$newname[p][4]	$w1e[]=$newname[p][12]	$w2[]=$newname[p][7]	$w2e[]=$newname[p][15]	Display $pk1 vs $Energywavefit;Appendtograph $pk2 vs $Energywavefit		ModifyGraph rgb($pk2)=(0,0,65535)	ErrorBars $pk1 Y,wave=($pk1e,$pk1e)	ErrorBars $pk2 Y,wave=($pk2e,$pk2e)		Display $w1 vs $Energywavefit;Appendtograph $w2 vs $Energywavefit				ModifyGraph rgb($w2)=(0,0,65535)	ErrorBars $w1 Y,wave=($w1e,$w1e)	ErrorBars $w2 Y,wave=($w2e,$w2e)		killwaves thiswaveEnd//*******************************************************************************************************************************Proc JAPS2(matname,Eslice_first,Eslice_last,kleft,kright,combMDC)	String matname	Variable Eslice_first=0	Variable Eslice_last=51	Variable kleft=0.06845	Variable kright=0.4875	Variable combMDC=3	Prompt matname,"Enter the name of the matrix"	Prompt Eslice_first,"First Energy slice:"	Prompt Eslice_last,"Last Energy slice:"		Prompt kleft,"Momentum left:"	Prompt kright,"Momentum right:"	Prompt combMDC,"Number of MDC to combine (odd)"		Pauseupdate;Silent 1	String newname	String Energywavefit,pk1,pk2,pk1e,pk2e,w1,w2,w1e,w2e	Variable i,j	Variable MDC1,MDC2	Variable condition	newname=matname+"2_"+num2str(Eslice_first)+"_"+num2str(Eslice_last)+"fit"	Make/O/N=(Eslice_last-Eslice_first+1,14) $newname	condition=0	i=Eslice_last	Do		IF(mod(i,10)==0)			Print i		Endif		Make/O/N=(dimsize($matname,0)) thiswave		Setscale/P x,dimoffset($matname,0),dimdelta($matname,0),""thiswave		MDC1=i-(combMDC-1)/2		MDC2=i+(combMDC-1)/2		IF(MDC1<0)			MDC1=0		Endif		If(MDC2>dimsize($matname,1)-1)			MDC2=dimsize($matname,1)-1		Endif		thiswave[]=0		j=MDC1		Do			thiswave[]+=$matname[p][j]			j+=1		While(j<MDC2+1)		thiswave[]/=combMDC//		Wavestats/Q/R=(kleft,kright) thiswave		IF(condition==0)			Make/O/N=7 parafit			parafit[0]=0.01			parafit[1]=0.01			parafit[4]=0.05			parafit[2]=0.5*(parafit[4])^2				parafit[3]=0.4392			parafit[5]=0.36*(parafit[4])^2			parafit[6]=0.52159			condition=1		Endif		FuncFit/H="0000000"/N/Q linear_bkgnd_plus2Lor parafit thiswave(kleft,kright) /D // /C=T_Constraints		j=0		Do			$newname[i][j]=parafit[j]			$newname[i][j+7]=W_sigma[j]			j+=1		While(j<dimsize(parafit,0))			i-=1	While(i>Eslice_first-1)	Energywavefit="E"+newname	Make/O/N=(Eslice_last-Eslice_first+1) $Energywavefit	$Energywavefit[]=dimoffset($matname,1)+(p-Eslice_first)*dimdelta($matname,1)	pk1="pk1"+newname	pk2="pk2"+newname	pk1e="pk1"+newname+"_err"	pk2e="pk2"+newname+"_err"		Make/O/N=(Eslice_last-Eslice_first+1) $pk1	Make/O/N=(Eslice_last-Eslice_first+1) $pk2	Make/O/N=(Eslice_last-Eslice_first+1) $pk1e		Make/O/N=(Eslice_last-Eslice_first+1) $pk2e	$pk1[]=$newname[p][3]	$pk1e[]=$newname[p][10]	$pk2[]=$newname[p][6]	$pk2e[]=$newname[p][13]	w1="w1"+newname	w1e="w1"+newname+"_err"	Make/O/N=(Eslice_last-Eslice_first+1) $w1		Make/O/N=(Eslice_last-Eslice_first+1) $w1e		$w1[]=$newname[p][4]	$w1e[]=$newname[p][11]	Display $pk1 vs $Energywavefit;Appendtograph $pk2 vs $Energywavefit		ModifyGraph rgb($pk2)=(0,0,65535)	ErrorBars $pk1 Y,wave=($pk1e,$pk1e)	ErrorBars $pk2 Y,wave=($pk2e,$pk2e)		Display $w1 vs $Energywavefit	ErrorBars $w1 Y,wave=($w1e,$w1e)	killwaves thiswaveEnd//*******************************************************************************************************************************Proc MakeNK()	PauseUpdate;Silent 1	String thisname	Variable i,iini,iend	Variable j,jini,jend	Variable totalnum	iini=6	iend=19	jini=321	jend=360	Make/O/N=(dimsize(data5,0)) Nabove	Nabove[]=0	totalnum=0	i=iini	Do		thisname="data"+num2str(i)		j=jini		Do			Nabove[]+=$thisname[p][j]			totalnum+=1			j+=1		While(j<jend+1)		i+=1	While(i<iend+1)	Nabove[]/=totalnum	Display NaboveEnd//*******************************************************************************************************************************Proc combEDCsallcuts(thenumber)	Variable thenumber	Prompt thenumber,"Number of EDCs to combine"	PauseUpdate;Silent 1	String thiscut	Variable i	i=0	Do			thiscut="cut"+num2str(phiindex[i])		new_kres_pi(thiscut,thenumber,1)		i+=1	While(i<dimsize(phiindex,0))End//*******************************************************************************************************************************Proc combMDCsallcuts(thenumber)	Variable thenumber	Prompt thenumber,"Number of EDCs to combine"	PauseUpdate;Silent 1	String thiscut	Variable i	i=0	Do			thiscut="cut"+num2str(phiindex[i])		new_eres_pi(thiscut,thenumber,1)		i+=1	While(i<dimsize(phiindex,0))End//*******************************************************************************************************************************Proc Temp200()	PauseUpdate;Silent 1	String thisdata	Variable i,j,k	Make/O/N=(dimsize(data2,0)) sumwave	sumwave[]=0	k=0	i=2	Do			thisdata="data"+num2str(i)		j=130		Do			sumwave[]+=$thisdata[p][j]			j+=1			k+=1		While(j<dimsize($thisdata,1))		i+=1	While(i<dimsize(File_Name,0))	sumwave[]/=k	Display sumwaveEnd//*******************************************************************************************************************************Proc remove241(from,to)	Variable from	Variable to=-1	Prompt from,"From"	Prompt to,"To"	PauseUpdate;Silent 1	String thisdata	Variable i	IF(to==-1)		to=dimsize(file_name,0)-1	Endif	i=from	Do		thisdata="data"+num2str(i)		Duplicate/O/R=[0,241][*] $thisdata Jonmat		Duplicate/O Jonmat $thisdata		i+=1	While(i<to+1)	Killwaves JonmatEnd//*******************************************************************************************************************************Proc comballcuts(number)	Variable number	PauseUpdate;Silent 1	String thiscut	Variable i	i=0	Do		thiscut="cut"+num2str(phiindex[i])			new_kres_pi(thiscut,number,1)		i+=1	While(i<dimsize(phiindex,0))End//*******************************************************************************************************************************Proc comballdata(number)	Variable number	PauseUpdate;Silent 1	String thisdata	Variable i	i=0	Do		thisdata="data"+num2str(imageindex[i])			new_kres_pi(thisdata,number,1)		i+=1	While(i<dimsize(imageindex,0))End//*******************************************************************************************************************************Proc angle2kVcut(matname,thetaangle,phiangle,Fermilevel)	String matname	Variable thetaangle	Variable phiangle	Variable Fermilevel	Prompt matname,"Enter the name of the matrix"	Prompt thetaangle,"Enter the theta angle"	Prompt phiangle,"Enter the phiangle"	Prompt Fermilevel,"Enter the Fermi level"		PauseUpdate;Silent 1	String newname	Variable i,j	Variable kmin,kmax,ktest	Variable KEmin,KEmax,Amin,Amax	newname=matname+"_k"	KEmin=dimoffset($matname,1)	KEmax=dimoffset($matname,1)+(dimsize($matname,1)-1)*dimdelta($matname,1)	Amin=dimoffset($matname,0)	Amax=dimoffset($matname,0)+(dimsize($matname,0)-1)*dimdelta($matname,0)	//Find the borders	kmin=999999	kmax=-999999	ktest=0.51231*sqrt(KEmin)*(cos(phiangle*pi/180)*sin(dimoffset($matname,0)*pi/180)+sin(phiangle*pi/180)*cos(thetaangle*pi/180)*cos(dimoffset($matname,0)*pi/180))	IF(ktest<kmin)		kmin=ktest	Endif	IF(ktest>kmax)		kmax=ktest	Endif	ktest=0.51231*sqrt(KEmin)*(cos(phiangle*pi/180)*sin(Amax*pi/180)+sin(phiangle*pi/180)*cos(thetaangle*pi/180)*cos(Amax*pi/180))	IF(ktest<kmin)		kmin=ktest	Endif	IF(ktest>kmax)		kmax=ktest	Endif	ktest=0.51231*sqrt(KEmax)*(cos(phiangle*pi/180)*sin(Amax*pi/180)+sin(phiangle*pi/180)*cos(thetaangle*pi/180)*cos(Amax*pi/180))	IF(ktest<kmin)		kmin=ktest	Endif	IF(ktest>kmax)		kmax=ktest	Endif	ktest=0.51231*sqrt(KEmax)*(cos(phiangle*pi/180)*sin(dimoffset($matname,0)*pi/180)+sin(phiangle*pi/180)*cos(thetaangle*pi/180)*cos(dimoffset($matname,0)*pi/180))	IF(ktest<kmin)		kmin=ktest	Endif	IF(ktest>kmax)		kmax=ktest	Endif				Make/O/N=(dimsize($matname,0)*1.2,dimsize($matname,1)) $newname	Setscale/I x,kmin,kmax,""$newname	Setscale/P y,KEmin-Fermilevel,dimdelta($matname,1),""$newname	$newname[][]=NaN	Make/O/N=4 paraVy	Make/O/N=1 W_Root		paraVy[]=0	calcangle2kVcut($matname,$newname,paraVy,W_root,phiangle,thetaangle)	Display;appendimage $newnameEnd//*******************************************************************************************************************************Function func4angle2kVcut(paraVy,yy)	Wave paraVy	Variable yy	PauseUpdate;Silent 1	Return paraVy[0]*(cos(paraVy[1]*pi/180)*sin(yy*pi/180)+sin(paraVy[1]*pi/180)*cos(paraVy[2]*pi/180)*cos(yy*pi/180))-paraVy[3]End//*******************************************************************************************************************************Function calcangle2kVcut(matname,newname,paraVy,W_root,phiangle,thetaangle)	Wave matname	Wave newname	Wave paraVy	Wave W_root	Variable phiangle	Variable thetaangle	PauseUpdate;Silent 1	Variable i,j	paraVy[1]=phiangle	paraVy[2]=thetaangle		i=0	Do		IF(mod(i,100)==0)			print i		Endif		paraVy[0]=0.51231*sqrt(dimoffset(matname,1)+i*dimdelta(matname,1))		j=0		Do			paraVy[3]=dimoffset(newname,0)+j*dimdelta(newname,0)			Findroots/Q func4angle2kVcut, paraVy		//		Print W_Root[0],paraVy[0],paraVy[1],paraVy[2],paraVy[3],V_Root			newname[j][i]=Interp2D (matname,V_Root, dimoffset(matname,1)+i*dimdelta(matname,1))			j+=1		While(j<dimsize(newname,0))		i+=1		While(i<dimsize(newname,1))		End//*******************************************************************************************************************************Proc comp100_200()	PauseUpdate;Silent 1	String thisname1,thisname2	String thisedc1,thisedc2	String ininame1,ininame2	Variable i,j	i=148	DO		thisname1="cut"+num2str(i)		thisname2="cut"+num2str(i+100)		Dowindow/F xttemp		EDC_pi(thisname1,7)		Dowindow/F xttemp		EDC_pi(thisname2,7)		j=0		Do			thisedc1="E"+thisname1+"_7_"+num2str(j)			thisedc2="E"+thisname2+"_7_"+num2str(j)			Duplicate/O $thisedc1 tempwave			$thisedc1[]/=mean(tempwave,16.68,16.69)			Duplicate/O $thisedc2 tempwave			$thisedc2[]/=mean(tempwave,16.68,16.69)									j+=1		While(j<dimsize($thisname1,0))		Display		j=0		Do			thisedc1="E"+thisname1+"_7_"+num2str(j)			thisedc2="E"+thisname2+"_7_"+num2str(j)			if(j==0)				ininame1=thisedc1				ininame2=thisedc2				print ininame1,ininame2			Endif			if(mod(j,7)==0)				Setscale/P x,dimoffset($thisedc1,0)-16.8244,dimdelta($thisedc1,0),""$thisedc1				Setscale/P x,dimoffset($thisedc2,0)-16.8244,dimdelta($thisedc2,0),""$thisedc2								Appendtograph $thisedc1										Appendtograph $thisedc2				ModifyGraph rgb($thisedc1)=(0,0,65535)				Else					killwaves $thisedc1,$thisedc2			Endif			j+=1		While(j<dimsize($thisname1,0))		SetAxis bottom 16.77-16.8244,16.84-16.8244			SetAxis left -10,2		ModifyGraph tick=2,mirror=1		Label bottom "\\Z16\\F'arial'Binding energy (eV)"		Label left "\\Z16\\F'arial'Intesity (arb. units)"		ModifyGraph manTick(left)={0,2,0,0},manMinor(left)={3,0}		ModifyGraph manTick(bottom)={0,0.02,0,2},manMinor(bottom)={3,0}		ModifyGraph width=300,height=600		ModifyGraph zero(bottom)=9		constantoffset_n(-0.7,2)		TextBox/C/N=text0		TextBox/C/N=text0/F=0/B=1 "\\Z10\\s("+ininame1+") \\Z14 15K\r\\Z10\\s("+ininame2+") \\Z14 50K\r"		TextBox/C/N=text0/X=68/Y=1			TextBox/C/N=text1/F=0/S=1/B=1/M/A=MC "\\Z16Cut"+num2str(i)		TextBox/C/N=text1/X=0.00/Y=46.00		savegraph("15_50cut"+num2str(i),5)		i+=1	While(i<158)     //158End//*******************************************************************************************************************************Proc white2transparant(name)	String name	PauseUpdate;Silent 1	String namegreen,nameblue,namered	Variable i, j	namegreen="green_"+name	nameblue="blue_"+name	namered="red_"+name		i=0	Do		IF(mod(i,25)==0)			print i,dimsize($namegreen,0)		Endif		j=0		Do			if(($namegreen[i][j]==255)&&($nameblue[i][j]==255)&&($namered[i][j]==255))				$namegreen[i][j]=NaN				$nameblue[i][j]=NaN				$namered[i][j]=NaN			Endif			j+=1		While(j<dimsize($namegreen,1))		i+=1	While(i<dimsize($namegreen,0)))EndFunction Fermi_convolve_at_T_old(parawave,thiswave,thisenergy) : fitfunc	Wave parawave	Wave thiswave	Variable thisenergy	PauseUpdate;	Silent 1	Duplicate/O thiswave FDwave	Duplicate/O thiswave gausswave		Duplicate/O thiswave thisxwave	FDwave[]=parawave[0]*(1+parawave[1]*(dimoffset(FDWave,0)+p*dimdelta(FDWave,0)))/(1+exp(((dimoffset(FDWave,0)+p*dimdelta(FDWave,0))-parawave[2])/parawave[4])+1)	Gausswave[]=exp(-(dimoffset(FDWave,0)+p*dimdelta(FDWave,0))^2/parawave[3])	convolve Gausswave,FDwave	thisxwave[]=dimoffset(thisxwave,0)+p*dimdelta(thisxwave,0)	Return(Interp(thisenergy,thisxwave,FDwave))	Killwaves FDwave,gausswaveEndProc ReturnFermiEandRes(FTemp,thiswavename)	Variable FTemp1	String thiswavename	Prompt FTemp1,"Enter the temperature (in Kelvin)"	Prompt thiswavename,"Enter the name of the wave"	PauseUpdate	Silent 1	Variable xstart,xend	xstart=xcsr(A)	If(xcsr(B)<xcsr(A))		xstart=xcsr(B)		xend=xcsr(A)		Else			xend=xcsr(B)	Endif	Make/O/N=5 paraforFD	Duplicate/O $thiswavename thistemp	Smooth/E=3/B=5 5, thistemp	Differentiate thistemp	Smooth/E=3/B=5 5 thistemp	Wavestats/Q/R=(xstart,xend) thistemp	paraforFD[2]=V_minloc	paraforFD[0]=$thiswavename[x2pnt($thiswavename,xstart)]	paraforFD[1]=-0.1	paraforFD[3]=(xend-xstart)/4	paraforFD[4]=FTemp*0.025/300	FuncFit/H="00001"/N/Q Fermi_convolve_at_T ParaforFD $thiswavename(xstart,xend)/X={$thiswavename	Edit paraforFDEndFunction funcFitFDwithEffT(parawave,x) : fitfunc	Wave parawave	Variable x	PauseUpdate;	Silent 1	Return(parawave[0]*(1+parawave[1]*x)/(1+exp((x-parawave[2])/parawave[3])))EndProc FitFDwithEffT(wname,thistemperature)	String wname	Variable thistemperature	Prompt wname,"Name of the wave:"	Prompt thistemperature,"Temperature (Kelvin)"	Pauseupdate	Silent 1	String namepara	Variable xstart,xend	Variable res	namepara=wname+"_forFD"	xstart=xcsr(A)	If(xcsr(B)<xcsr(A))		xstart=xcsr(B)		xend=xcsr(A)		Else			xend=xcsr(B)	Endif	Duplicate/O $wname trywave	Make/O/N=4 $namepara	Duplicate/O $wname thistemp	Smooth/E=3/B=5 5, thistemp	Differentiate thistemp	Smooth/E=3/B=5 5, thistemp	Wavestats/Q/R=(xstart,xend) thistemp	print V_minloc	$namepara[2]=V_minloc	$namepara[0]=$Wname[x2pnt($Wname,xstart)]	$namepara[1]=-0.1	$namepara[3]=thistemperature*0.025/300	trywave[]=funcFitFDwithEffT($namepara,dimoffset(trywave,0)+p*dimdelta(trywave,0))	Display trywave	Duplicate/O/R=[] $wname tempwave	FuncFit/H="0000"/N/Q funcFitFDwithEffT $namepara $wname(xstart,xend) /D	trywave[]=funcFitFDwithEffT($namepara,dimoffset(trywave,0)+p*dimdelta(trywave,0))	edit $namepara	Res= sqrt(abs($namepara[3]))	print resEndProc fuck_ostie(number)	Variable number	Prompt number,"Enter the energy"	PauseUpdate;Silent 1	String name,newname	name=num2str(number)+"eV"	newname="hv"+name	Duplicate/O $name $newnameEndProc random_circles(doping,infected)	Variable doping=9	Variable infected	Prompt doping,"Enter the doping"	Prompt infected,"Enter which number is infected"	PauseUpdate;Silent 1	String thisx,thisy	Variable i,j	variable forx,fory	variable condition	Make/O/N=(200,200) matrix_random	matrix_random[][]=0	Display;appendimage matrix_random	ModifyImage matrix_random ctab= {*,*,RedWhiteBlue256,0}		calrandom_matrix(matrix_random,doping,infected)EndFunction calrandom_matrix(matrix_random,doping,infected)	Wave matrix_random	Variable doping	Variable infected	PauseUpdate;Silent 1	Variable i,j	Variable forx,fory	Variable condition	Variable ray	Duplicate/O matrix_random toadd	IF(infected!=0)		ray=2*infected	Endif	Make/O/N=(0,2) to_change	i=0	Do		IF(mod(dimsize(to_change,0),100)==0)			print dimsize(to_change,0)		Endif		toadd[][]=0		condition=0		forx=abs(Round(enoise(200)))		fory=abs(Round(enoise(200)))		j=0		Do			if(mod(forx,2)==0)				condition=1			Endif			if(mod(fory,2)==0)				condition=1			Endif							if((forx==to_change[j][0])&&(fory==to_change[j][1]))				condition=1			Endif			j+=1		While((j<dimsize(to_change,1))&&(condition==0))		If(condition==0)			Insertpoints/M=0 0,1,to_change			to_change[0][0]=forx			to_change[0][1]=fory			if(infected==0)				toadd[forx][fory]=1			Endif			if(infected!=0)				toadd[][]=exp(-(p-forx)^2/ray^2)*exp(-(q-fory)^2/ray^2)			Endif			matrix_random[][]+=toadd[p][q]		Endif		i+=1	While(dimsize(to_change,0)<doping*100)	i=0	Do		matrix_random[2*i][]=NaN		matrix_random[][2*i]=NaN				i+=1	While(i<100)	print dimsize(to_change,0)	killwaves to_change	EndProc thisguy()	PauseUpdate;Silent 1	Variable i	imageforslicer[][]=0	i=0	Do		imageforslicer[][]+=mat3d[p][q][62+i]		i+=1	While(i<7)	imageforslicer[][]/=7EndProc thisguy1()	PauseUpdate;Silent 1	string thisname	Variable i	i=0	Do		thisname="cone"+num2str(ABS(i))+"deg"		CutNaNedges(thisname)		wave2filenokill(thisname)		Setscale/P y,dimoffset($thisname,1)*1000,dimdelta($thisname,1)*1000,""$thisname				i+=5	While(i<136)EndProc thisguy2()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname//		CutNaNedges(thisname)//		wave2filenokill(thisname)				ModifyImage $thisname ctab= {0,0.0006819511764,ColdWarm,0}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,30		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc thisguy3()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"degVD"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"degVD"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname		CutNaNedges(thisname)		wave2filenokill(thisname)		Setscale/P y,dimoffset($thisname,1)*1000,dimdelta($thisname,1)*1000,""$thisname				ModifyImage $thisname ctab= {-3.311568207e-06,0,Terrain,1}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,30		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc thisguy4()	PauseUpdate;Silent 1	string thisname	String newname	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_25KCo"			newname=thisname+"VD"//			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_25KCo"				newname=thisname+"VD"								//				nameofwindow=thisname+"_graph"		Endif		derivmat(thisname,5,5,1)		Wave2filenokill(newname)		i+=5	While(i<136)EndProc thisguy5()	PauseUpdate;Silent 1	string thisname	String newname	Variable i	i=-40	Do		IF(i<0)			thisname="ln_cone_"+num2str(ABS(i))+"deg_150K"			newname=thisname+"HD"//			nameofwindow=thisname+"_graph"			Else				thisname="ln_cone"+num2str(ABS(i))+"deg_150K"				newname=thisname+"HD"								//				nameofwindow=thisname+"_graph"		Endif		derivmat(thisname,7,7,2)//		Wave2filenokill(newname)		i+=5	While(i<136)EndProc thisguy6()	PauseUpdate;Silent 1	string thisname	String newname	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_150K"			newname="ln_"+thisname//			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_150K"				newname="ln_"+thisname								//				nameofwindow=thisname+"_graph"		Endif		ln_mat_pi(thisname)		NaN0(newname)		i+=5	While(i<136)EndProc thisguy80()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_80K"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_80K"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname//		Setscale/P y,dimoffset($thisname,1)*1000,dimdelta($thisname,1)*1000,""$thisname//		CutNaNedges(thisname)//		wave2filenokill(thisname)				ModifyImage $thisname ctab= {0,0.0005293626455,ColdWarm,0}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,30		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc thisguy80VD()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_80KVD"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_80KVD"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname		CutNaNedges(thisname)		wave2filenokill(thisname)//		Setscale/P y,dimoffset($thisname,1)*1000,dimdelta($thisname,1)*1000,""$thisname				ModifyImage $thisname ctab= {-6.761347322e-07,0,Terrain,1}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,30		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc thisguy120()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_120K"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_120K"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname		Setscale/P y,dimoffset($thisname,1)*1000,dimdelta($thisname,1)*1000,""$thisname//		CutNaNedges(thisname)//		wave2filenokill(thisname)				ModifyImage $thisname ctab= {0,0.0004587574513,ColdWarm,0}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,30		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc thisguy120VD()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_120KVD"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_120KVD"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname		CutNaNedges(thisname)		wave2filenokill(thisname)//		Setscale/P y,dimoffset($thisname,1)*1000,dimdelta($thisname,1)*1000,""$thisname				ModifyImage $thisname ctab= {-3.690583981e-07,0,Terrain,1}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,55		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc thisguychange120()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_120K"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_120K"								nameofwindow=thisname+"_graph"		Endif		Dowindow/F $nameofwindow		SetAxis left -100,55				i+=5	While(i<136)EndProc thisguychange80()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_80K"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_80K"								nameofwindow=thisname+"_graph"		Endif		Dowindow/F $nameofwindow		SetAxis left -100,55				i+=5	While(i<136)EndProc thisguychange80VD()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_80KVD"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_80KVD"								nameofwindow=thisname+"_graph"		Endif		Dowindow/F $nameofwindow		SetAxis left -100,55				i+=5	While(i<136)EndProc thisguychange25()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg"								nameofwindow=thisname+"_graph"		Endif		Dowindow/F $nameofwindow		SetAxis left -100,55				i+=5	While(i<136)EndProc thisguychange25VD()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"degVD"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"degVD"								nameofwindow=thisname+"_graph"		Endif		Dowindow/F $nameofwindow		SetAxis left -100,55				i+=5	While(i<136)EndProc thisguy150()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_150K"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_150K"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname//		Setscale/P y,dimoffset($thisname,1)*1000,dimdelta($thisname,1)*1000,""$thisname//		CutNaNedges(thisname)		wave2filenokill(thisname)				ModifyImage $thisname ctab= {0,1.622159004,ColdWarm,0}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,55		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc thisguy150VD()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_150KVD"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_150KVD"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname		CutNaNedges(thisname)		wave2filenokill(thisname)//		Setscale/P y,dimoffset($thisname,1)/1000,dimdelta($thisname,1)/1000,""$thisname				ModifyImage $thisname ctab= {-0.001825779676,0,Terrain,1}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,55		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc thisguy25Co()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_25KCo"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_25KCo"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname		Setscale/P y,dimoffset($thisname,1)*1000,dimdelta($thisname,1)*1000,""$thisname//		CutNaNedges(thisname)		wave2filenokill(thisname)				ModifyImage $thisname ctab= {0,1.756803513,ColdWarm,0}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,55		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc thisguychange25Co()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_25KCo"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_25KCo"								nameofwindow=thisname+"_graph"		Endif		Dowindow/F $nameofwindow		SetAxis left -100,55				i+=5	While(i<136)EndProc thisguy25CoVD()	PauseUpdate;Silent 1	string thisname	String nameofwindow	Variable i	i=-40	Do		IF(i<0)			thisname="cone_"+num2str(ABS(i))+"deg_25KCoVD"			nameofwindow=thisname+"_graph"			Else				thisname="cone"+num2str(ABS(i))+"deg_25KCoVD"								nameofwindow=thisname+"_graph"		Endif		Display; appendimage $thisname//		CutNaNedges(thisname)		wave2filenokill(thisname)//		Setscale/P y,dimoffset($thisname,1)*1000,dimdelta($thisname,1)*1000,""$thisname				ModifyImage $thisname ctab= {-0.003002292244,0,Terrain,1}		ModifyGraph fSize=12,manTick(left)={0,40,0,0},manMinor(left)={4,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={4,0}		ModifyGraph noLabel=1//		Label left "\\Z18\\F'arial'E-E\\BF\\M\\Z18\\F'arial' (meV)"//		Label bottom "\\Z18\\F'arial'Momentum (\\F'symbol'p\\Z18\\F'arial'/a)"		SetAxis left -100,55		SetAxis bottom -0.25,0.25		ModifyGraph width=120,height=160		SetDrawEnv xcoord= bottom,ycoord= left,linefgc= (65535,65535,65535),dash= 3		DrawLine -0.25,0,0.25,0		TextBox/C/N=text0/B=1/F=0/A=MT/X=0/Y=0 "\\K(65535,0,0)\\Z18\\F'arial'"+num2str(i)+""		Dowindow/C $nameofwindow		i+=5	While(i<136)EndProc Ga2O3_1(number,maxi)	Variable number	Variable maxi	Prompt number,"Enter the data index"	Prompt maxi,"Maximum"	PauseUpdate;Silent 1	String thisname	variable i	thisname="bg4_"+num2str(number)	Duplicate/O EMDC_wave $thisname		i=0	Do		If($thisname[i]>maxi)			$thisname[i]=maxi		Endif		i+=1	While(i<dimsize($thisname,0))	Display $thisnameEndProc Ga2O3_2()	PauseUpdate;Silent 1	String thisname, thisdata	variable i	i=0	Do		thisname="hvs"+num2str(hvs[i])		thisdata="data"+num2str(indexs[i])		Duplicate/O $thisdata $thisname		wave2filenokill(thisname)			i+=1	While(i<dimsize(hvs,0))EndProc Ga2O3_3()	PauseUpdate;Silent 1	String thisname, newname	variable i	i=0	Do		thisname="data"+num2str(indexL[i])		newname="hvL"+num2str(hvL[i])		Duplicate/O $thisname $newname		phi4kz[i]=-(dimoffset($thisname,0)+sliceGL[p]*dimdelta($thisname,0))		i+=1	While(i<dimsize(hvL,0))EndProc Ga2O3_4(number)	Variable number	Prompt number,"Enter the photon energy"	PauseUpdate;Silent 1	String thisname, newname,namek,nameE	variable i,kmin,totalk	Variable kshift	thisname="hvL"+num2str(number)+"_k"	newname=thisname+"corr"	namek="corr"+num2str(number)+"k"	nameE="corr"+num2str(number)+"E"	insertpoints 0,2,$namek	insertpoints 0,2,$nameE	$namek[0]=0	$namek[1]=0	$nameE[0]=dimoffset($thisname,0)+(dimsize($thisname,0)-1)*dimdelta($thisname,0)	$nameE[1]=-2	kmin=dimoffset($thisname,0)-$namek[dimsize($namek,0)-1]	totalk=Round((dimoffset($thisname,0)+(dimsize($thisname,0)-1)*dimdelta($thisname,0)-kmin)/dimdelta($thisname,0))	Make/O/N=(totalk,dimsize($thisname,1)) $newname	Setscale/P x,kmin,dimdelta($thisname,0),""$newname	Setscale/P y,dimoffset($thisname,1),dimdelta($thisname,1),""$newname	i=0	Do		kshift=interp(dimoffset($thisname,1)+i*dimdelta($thisname,1),$nameE,$namek)		Make/O/N=(dimsize($thisname,0)) thiswave		Make/O/N=(dimsize($thisname,0)) thiswavex		thiswave[]=$thisname[p][i]		thiswavex[]=dimoffset($thisname,0)-kshift+p*dimdelta($thisname,0)		$newname[][i]=interp(dimoffset($newname,0)+p*dimdelta($newname,0),thiswavex,thiswave)		i+=1	While(i<dimsize($thisname,1))//	Display;appendimage $newname//	ModifyImage $newname ctab= {*,*,ColdWarm,0}//	wave2filenokill(thisname)	wave2filenokill(newname)EndProc Ga2O3_5()	PauseUpdate;Silent 1	String matname,newwave	Variable i	Display	i=0	Do		matname="hvL"+num2str(hvL[i])+"_kcorr"		newwave="hvL"+num2str(hvL[i])+"G"		comb_krange(matname,newwave,0,0.06)		appendtograph $newwave		i+=1	While(i<dimsize(photonE4kz,0))EndProc Ga2O3_6()	PauseUpdate;Silent 1	String thewave	Variable i	Display	i=1	Do		thewave="hvL"+num2str(hvL[i])+"G"		Wavestats/Q/R=(-6.4,1) $thewave		$thewave[]/=V_avg		i+=1	While(i<dimsize(photonE4kz,0))EndProc Ga2O3_7()	PauseUpdate;Silent 1	String thewave	Variable i	Make/O/N=(dimsize(photonE4kz,0)-1) nearEFweight	Setscale/I x,18,29,""nearEFweight	nearEFweight[]=0	Display nearEFweight	Dowindow/C EFweight	i=1	Do		thewave="hvL"+num2str(hvL[i])+"G"		Wavestats/Q/R=(-0.6,0.1) $thewave		nearEFweight[i-1]=V_avg		i+=1	While(i<dimsize(photonE4kz,0))EndProc Ga2O3_8()	PauseUpdate;Silent 1	String thewave,thisweight,thiswave,namewindow	Variable i,normBE	Variable j	i=2	Do		thisweight="nearEFweight"+num2str(hvL[i])		Make/O/N=(dimsize(hvL,0)-i) $thisweight		Setscale/I x,hvL[i],29,""$thisweight		$thisweight[]=0		namewindow="EFweight"+num2str(hvL[i])		Display		Dowindow/C $namewindow		j=i		Do			thewave="hvL"+num2str(hvL[j])+"G"			thiswave="hvL"+num2str(hvL[j])+"Gnorm"+num2str(hvL[i])			If(j==i)				normBE=dimoffset($thiswave,0)			Endif			Duplicate/O $thewave $thiswave			Wavestats/Q/R=(normBE,1) $thiswave			print dimoffset($thiswave,0)			$thiswave[]/=V_avg			appendtograph $thiswave			Wavestats/Q/R=(-0.6,0.1) $thiswave			$thisweight[j-i]=V_avg			j+=1		While(j<dimsize(hvL,0))		Dowindow/F EFweight		Appendtograph $thisweight		i+=1	While(i<dimsize(hvL,0)-4)EndProc Ga2O3_9()	PauseUpdate;Silent 1	String dataname,newname,newnamek,EDCatG	Variable i	Display	Dowindow/C EDCsatGsbk	Make/O/N=9 nearEFweightABS	Setscale/I x,21,29,""nearEFweightABS	nearEFweightABS[]=0	i=4	Do		dataname="data"+num2str(indexs[i])		newname="hvsbk"+num2str(photonE4kzs[i])		newnamek=newname+"_k"		EDCatG=newname+"EDCatG"		Duplicate/O $dataname $newname		CVT2EK_exact1cut(newname,1,EFvals4kzs[i],0,phi4kzs[i],1,0,0)		wave2filenokill(newname)		wave2filenokill(newnamek)				comb_krange(newnamek,EDCatG,0,0.012)		dowindow/F EDCsatGsbk		appendtograph $EDCatG		Wavestats/Q/R=(-0.6,0.1) $EDCatG		nearEFweightABS[i-4]=V_avg		i+=1	While(i<dimsize(photonE4kzs,0))	Display nearEFweightABS	Dowindow/C graph_nearEFweightABSEndProc Ga2O3_10()	PauseUpdate;Silent 1	String dataname,newname,oldname,EDCatG	Variable i	Display	Dowindow/C EDCsatGsame	i=4	Do		Oldname="hvsbk"+num2str(photonE4kzs[i])+"EDCatG"		newname="hvs_same"+num2str(photonE4kzs[i])+"EDCatG"		Duplicate/O $oldname $newname		Wavestats/Q/R=(-0.6,0.1) $oldname		$newname[]/=V_avg				wave2filenokill(newname)		dowindow/F EDCsatGsame		appendtograph $newname		i+=1	While(i<dimsize(photonE4kzs,0))EndProc Ga2O3_11()	PauseUpdate;Silent 1	String dataname,newname,oldname,EDCatG	Variable i	Display	Dowindow/C EDCsatGsame_offset	i=4	Do		newname="hvs_same"+num2str(photonE4kzs[i])+"EDCatG"			appendtograph $newname		i+=1	While(i<dimsize(photonE4kzs,0))EndProc Ga2O3_13()	PauseUpdate;Silent 1	String grname,dataname	Variable i	i=17	Do		dataname="hvs"+num2str(i)+"_k"		grname="Graph_"+dataname		Dowindow/F $grname		ModifyGraph width=130,height=200 		ModifyImage $dataname ctab= {*,*,PlanetEarth,0}		SetAxis left -0.8,0.2		SetAxis bottom -0.25,0.25		ModifyGraph manTick(left)={0,0.2,0,1},manMinor(left)={3,0}		ModifyGraph manTick(bottom)={0,0.2,0,1},manMinor(bottom)={3,0}		ModifyGraph noLabel=2		TextBox/C/N=text0 "\\K(65535,0,0)\\Z12 "+num2str(i)+" eV "		TextBox/C/N=text0/F=0/X=0.77/Y=1		Showtools/A		SetDrawEnv ycoord= left,linefgc= (65535,0,0),dash= 7//		Hidetools/A		i+=1	While(i<30)EndProc Ga2O3_14()	PauseUpdate;Silent 1	String grname,matname	Variable i	Variable jtop,jbot,j	Make/O/N=(9,8) para80_140	para80_140[][]=0	i=21	Do		matname="hvsbk"+num2str(i)+"_k"		Make/O/N=(dimsize($matname,0)) thiswave		Setscale/P x,dimoffset($matname,0),dimdelta($matname,0),""thiswave		thiswave[]=0		jtop=Round(-0.08-dimoffset($matname,1)/(dimdelta($matname,1)))		jbot=Round((-0.140-dimoffset($matname,1))/(dimdelta($matname,1)))		j=jbot		Do			thiswave[]+=$matname[p][j]			j+=1		While(j<jtop+1)		thiswave[]/=(jtop-jbot+1)		CurveFit/Q/NTHR=0/TBOX=0 gauss  thiswave(-0.3,0.4)		para80_140[i-21][0]=W_coef[0]		para80_140[i-21][1]=W_coef[1]		para80_140[i-21][2]=W_coef[2]		para80_140[i-21][3]=W_coef[3]		para80_140[i-21][4]=W_sigma[0]		para80_140[i-21][5]=W_sigma[1]		para80_140[i-21][6]=W_sigma[2]		para80_140[i-21][7]=W_sigma[3]		i+=1	While(i<30)	Make/O/N=(9) waveofwidth80_140	Setscale/I x,21,29,""waveofwidth80_140	Duplicate/O waveofwidth80_140,waveofwidth80_140_err	waveofwidth80_140[]=sqrt(ln(2))*para80_140[p][3]	waveofwidth80_140_err[]=sqrt(ln(2))*para80_140[p][7]		Display waveofwidth80_140	ErrorBars waveofwidth80_140 Y,wave=(waveofwidth80_140_err,waveofwidth80_140_err)	Make/O/N=(9) waveofH80_140	Setscale/I x,21,29,""waveofH80_140	Duplicate/O waveofH80_140,waveofH80_140_err		waveofH80_140[]=para80_140[p][1]		waveofH80_140_err[]=para80_140[p][5]			Display waveofH80_140		ErrorBars waveofH80_140 Y,wave=(waveofH80_140_err,waveofH80_140_err)	EndProc Ga2O3_15()	PauseUpdate;Silent 1	String grname,matname	Variable i	Variable jtop,jbot,j	i=23	Do		matname="hvsbk"+num2str(i)+"_k"		Make/O/N=(dimsize($matname,0)) thiswave		Setscale/P x,dimoffset($matname,0),dimdelta($matname,0),""thiswave		thiswave[]=0		jtop=Round(-dimoffset($matname,1)/(dimdelta($matname,1)))		jbot=Round((-0.06-dimoffset($matname,1))/(dimdelta($matname,1)))		j=jbot		Do			thiswave[]+=$matname[p][j]			j+=1		While(j<jtop+1)		thiswave[]/=(jtop-jbot+1)		i+=1	While(i<24)	Duplicate/O thiswave wave0_60_23eV	Make/O/N=(300) fit4wave0_60_23eV	Setscale/I x,-0.3,0.3,""fit4wave0_60_23eV	fit4wave0_60_23eV[]=para0_60[2][0]+para0_60[2][1]*exp(-((dimoffset(fit4wave0_60_23eV,0)+p*dimdelta(fit4wave0_60_23eV,0)-para0_60[2][2])/para0_60[2][3])^2    )	Display wave0_60_23eV,fit4wave0_60_23eVEndProc BMGmacro1()	PauseUpdate;Silent 1	string KEname,BEname	string thisname	Variable i,j	thisname="data"+num2str(BMGindex[0])	Make/O/N=(dimsize(BMGhv,0),dimsize($thisname,1)) BMGmat	Setscale/P x,BMGhv[0],BMGhv[1]-BMGhv[0],""BMGmat	Display	i=0	Do			thisname="data"+num2str(BMGindex[i])		KEname="KE_BMG"+num2str(BMGhv[i])		BEname="BE_BMG"+num2str(BMGhv[i])		Make/O/N=(dimsize($thisname,1)) $KEname		Setscale/P x,dimoffset($thisname,1),dimdelta($thisname,1),""$KEname		$KEname[]=0				j=0		Do			$KEname[]+=$thisname[j][p]			j+=1		While(j<dimsize($thisname,0))		$KEname[]/=dimsize($thisname,0)			Duplicate/O $KEname $BEname		Setscale/P x,dimoffset($KEname,0)-BMGEF[i],dimdelta($KEname,0),"" $BEname		appendtograph $BEname		BMGmat[i][]=$BEname[q]		i+=1	While(i<dimsize(BMGhv,0))	Display;appendimage BMGmat	Setscale/P y,dimoffset($BEname,0),dimdelta($BEname,0),""BMGmat	EndProc BMGmacro2()	PauseUpdate;Silent 1	string KEname	string thisname	Variable i	//Look for extrema	Display	i=0	Do			KEname="KE_BMG"+num2str(BMGhv[i])		appendtograph $KEname		i+=1	While(i<dimsize(BMGhv,0))EndProc supertemp()	PauseUpdate;Silent 1	string KEname	string thisname	Variable i	//Look for extrema	i=43	Do			KEname=hvcuts4kz[i]		thisname="data"+num2str(i)		Duplicate/O $thisname $KEname		i+=1	While(i<66)EndProc numb1()	PauseUpdate;Silent 1	string thisname,newname,newname2,newname3	Variable i	i=0	Do		thisname=hvcuts4kz[i]+"eV_k"		newname=hvcuts4kz[i]+"eV_k_ang"		newname2=hvcuts4kz[i]+"eV_k_pi_over_a"//		print thisname		Duplicate/O $thisname $newname		Duplicate/O $thisname $newname2		wave2file(newname2)		setscale/P x,dimoffset($thisname,0)*1.08,dimdelta($thisname,0)*1.08,""$newname		wave2filenokill(newname)		hvcuts4kz[i]=thisname				i+=1	While(i<dimsize(hvcuts4kz,0))EndProc r1()	PauseUpdate;Silent 1	Variable i	i=0	Do		IF(wave4back[i]>24)			wave4back[i]=24		Endif		i+=1	While(i<dimsize(wave4back,0))EndProc copynameshv346RRRL()	PauseUpdate;Silent 1	String thisname,newname	Variable i,j	i=0	Do		thisname="data"+num2str(38+i)		newname="hv"+num2str(photonE4kz[i])+"L"		Duplicate/O $thisname $newname		i+=1	While(i<dimsize(photonE4kz,0))					EndProc copynameshv346RRRS()	PauseUpdate;Silent 1	String thisname,newname	Variable i,j	i=0	Do		thisname="data"+num2str(94+i)		newname="hv"+num2str(photonE4kz[i])+"S"		Duplicate/O $thisname $newname		i+=1	While(i<dimsize(photonE4kz,0))					EndProc copynameshv()	PauseUpdate;Silent 1	String thisname,newname	Variable i,j	i=0	Do//		thisname="data"+num2str(38+i)//		newname="hv"+num2str(photonE4kz[i])		thisname="data"+num2str(46+2*i)		newname="hv"+num2str(photonE4kz[i])+"S"		Duplicate/O $thisname $newname		i+=1	While(i<dimsize(photonE4kz,0))					EndProc copynameshv1()	PauseUpdate;Silent 1	String thisname,newname	Variable i,j	i=0	Do//		thisname="data"+num2str(38+i)//		newname="hv"+num2str(photonE4kz[i])		thisname="data"+num2str(168+2*i)		newname="hv"+num2str(photonE4kz[i])+"S"		Duplicate/O $thisname $newname		i+=1	While(168+2*i<217)	i=217	j=25	Do		thisname="data"+num2str(i)			newname="hv"+num2str(photonE4kz[j])+"S"		Duplicate/O $thisname $newname		i+=1		j+=1	While(j<dimsize(photonE4kz,0))						EndProc correctionnameshv()	PauseUpdate;Silent 1	String thisname,newname	Variable i,j	i=184	j=50	Do//		thisname="data"+num2str(38+i)//		newname="hv"+num2str(photonE4kz[i])		thisname="data"+num2str(i)		newname="hv"+num2str(photonE4kz[j])+"S"		Duplicate/O $thisname $newname		i+=2		j+=1	While(i<197)					EndProc combine_hv()	PauseUpdate;Silent 1	String thisname,newname	Variable i,j	i=0	Do//		thisname="data"+num2str(38+i)//		newname="hv"+num2str(photonE4kz[i])		thisname="hv"+num2str(photonE4kz[i])+"S"		new_eres_pi(thisname,2,1)		i+=1	While(i<dimsize(photonE4kz,0))		EndProc combine_hv346RRRL()	PauseUpdate;Silent 1	String thisname,newname	Variable i,j	i=0	Do//		thisname="data"+num2str(38+i)//		newname="hv"+num2str(photonE4kz[i])		thisname="hv"+num2str(photonE4kz[i])+"L"		new_kres_pi(thisname,3,1)		i+=1	While(i<dimsize(photonE4kz,0))		EndProc combine_hv346RRRS()	PauseUpdate;Silent 1	String thisname,newname	Variable i,j	i=0	Do//		thisname="data"+num2str(38+i)//		newname="hv"+num2str(photonE4kz[i])		thisname="hv"+num2str(photonE4kz[i])+"S"		new_kres_pi(thisname,3,1)		i+=1	While(i<dimsize(photonE4kz,0))		EndProc limitmat3d(theexponent)	Variable theexponent	Prompt theexponent,"Enter the exponent for the highest value"	PauseUpdate;Silent 1	mat3d[][][]*=mat3d[p][q][r]*(abs(mat3d[p][q][r])<10^(theexponent))EndProc Au_100(datanumber,smoothf,slicecomb, thistemparature)	Variable datanumber	Variable smoothf=5	Variable slicecomb=7	Variable thistemparature	Prompt datanumber,"Data number"	Prompt smoothf,"Smooth factor"		Prompt slicecomb,"Slices combined"	Prompt thistemparature,"Temperature (K)"	PauseUpdate;Silent 1	String thisname,dthisname,thisgraph,newname,thisdata,thisgraph_I	String sliceL, sliceR,sliceH	String name_fitted,this_FPname,this_FPnamex,graph_profile	Variable midslice,Rindex,Lindex	Variable i	thisdata="Data"+num2str(datanumber)	thisname="DOS"+num2str(datanumber)	dthisname="d"+thisname	thisgraph="graph_"+thisname	thisgraph_I="graph_I_"+thisname	sliceL=thisdata+"_L"	sliceR=thisdata+"_R"		sliceH=thisdata+"_H"	this_FPname="Fermi_Profile_"+thisname	this_FPnamex="Fermi_Profilex_"+thisname		graph_profile="profile_"+thisname	midslice=dimsize($thisdata,0)/2-1	Lindex=Round(midslice-slicecomb/2)	Rindex=Lindex+slicecomb	name_fitted="fit_"+thisname	Display;appendimage $thisdata	ShowInfo	Cursor/I A $thisdata dimoffset($thisdata,0),dimoffset($thisdata,1)	Cursor/I B $thisdata dimoffset($thisdata,0)+(dimsize($thisdata,0)-1)*dimdelta($thisdata,0),dimoffset($thisdata,1)+(dimsize($thisdata,1)-1)*dimdelta($thisdata,1)	ModifyImage $thisdata ctab= {*,*,Terrain,0}	ModifyGraph width=300,height=300	Label left "\\Z18\\F'arial'Kenetic energy (eV)"	Label bottom "\\Z18\\F'arial'Angle (degrees)"	Dowindow/C $thisgraph_I		Make/O/N=2 $sliceL	Make/O/N=2 $sliceR	Make/O/N=2 $sliceH	$sliceH[0]=dimoffset($thisdata,1)	$sliceH[1]=dimoffset($thisdata,1)+(dimsize($thisdata,1)-1)*dimdelta($thisdata,1)	$sliceL[]=dimoffset($thisdata,0)+Lindex*dimdelta($thisdata,0)	$sliceR[]=dimoffset($thisdata,0)+Rindex*dimdelta($thisdata,0)	appendtograph $sliceH vs $sliceL	appendtograph $sliceH vs $sliceR	Make/O/N=(dimsize($thisdata,1)) $thisname	Setscale/P x, dimoffset($thisdata,1),dimdelta($thisdata,1),""$thisname	$thisname[]=0	i=Lindex	Do		$thisname[]+=$thisdata[i][p]		i+=1	While(i<=Rindex)	$thisname[]/=slicecomb	Wavestats/Q/R=[0,10] $thisname	$thisname[]/=V_avg		Duplicate/O $thisname $dthisname	Get_Fermi_Profile(thisdata,smoothf,smoothf,2,0)	Duplicate/O Fermi_profile $this_FPname	Duplicate/O Fermi_profile_x $this_FPnamex		appendtograph $this_FPname vs $this_FPnamex	Display $thisname,$dthisname	Label left "\\Z18\\F'arial'Intensity (arbitrary units)"	Label bottom "\\Z18\\F'arial'Kenetic energy (eV)"		ModifyGraph rgb($dthisname)=(0,0,65535)		Dowindow/C $thisgraph	ModifyGraph width=300,height=300	ModifyGraph tick=2,mirror=1	smooth/E=3/B=(smoothf) smoothf, $dthisname	Differentiate $dthisname	Wavestats/Q $dthisname	$dthisname[]/=V_min		ShowInfo	Cursor A $thisname dimoffset($thisname,0)	Cursor B $thisname dimoffset($thisname,0)+(dimsize($thisname,0)-1)*dimdelta($thisname,0)	findEres(thisname,thistemparature,100,1,0,0,1)	Duplicate/O thisFermi $name_fitted	Dowindow/F $thisgraph	ModifyGraph rgb($name_fitted)=(0,0,0)	Display $this_FPname vs $this_FPnamex	Dowindow/C $graph_profile	ModifyGraph width=300,height=300	ModifyGraph tick=2,mirror=1	Label left "\\Z18\\F'arial'Kenetic energy (eV)"	Label bottom "\\Z18\\F'arial'Angle (degrees)"		EndProc plotGa2O3hv()	PauseUpdate;Silent 1	String thisname	Variable i	Display	i=23	Do		thisname="hv"+num2str(i)+"NN"		appendtograph $thisname		i+=1	While(i<63)EndProc Ga2O3weightabove()	PauseUpdate;Silent 1	String thisname	Variable i	Make/O/N=(63-23) weightGa2O3above	i=23	Do		thisname="hv"+num2str(i)+"NN"		Wavestats/Q/R=[dimsize($thisname,0)-20,dimsize($thisname,0)-1] $thisname		weightGa2O3above[i-23]=V_avg		i+=1	While(i<63)	Display weightGa2O3aboveEndProc Ga2O3coorectone(number,method,points)	Variable number	Variable method	Variable points	Prompt number,"Enter hv"	Prompt method,"Method",popup "straight;lowest;line"	Prompt points,"Number of points"	PauseUpdate;Silent 1	String thisname,newname	thisname="hv"+num2str(number)+"NN"	newname="hv"+num2str(number)+"N"	Duplicate/O $thisname $newname	IF(method==1)		Wavestats/Q/R=[dimsize($thisname,0)-points,dimsize($thisname,0)-1] $thisname		$newname[]-=V_avg		$newname[]/=weightGa2O3above[number-23]	Endif	IF(method==2)		Wavestats/Q $thisname		$newname[]-=V_min		$newname[]/=weightGa2O3above[number-23]	Endif		Display $newnameEndProc Ga2O3Normall()	PauseUpdate;Silent 1	String thisname,newname	Variable i	Display	i=23	Do		thisname="hv"+num2str(i)+"NN_bkgndless"		newname="hv"+num2str(i)+"N"		Duplicate/O $thisname $newname		$newname[]/=weightGa2O3above[i-23]		appendtograph $newname		i+=1	While(i<63)EndProc Ga2O3adjustEF()	PauseUpdate;Silent 1	String thisname,newname,wave4matname	Variable i	Display	i=23	Do		thisname="hv"+num2str(i)+"N"		newname="hv"+num2str(i)+"N_EF"		wave4matname="hv"+num2str(i)+"N_EFtemp"		Duplicate/O $thisname $newname 		Setscale/P x,dimoffset($thisname,0)-EF4Ga2O3[i-23],dimdelta($thisname,0),""$newname 		appendtograph $newname 		IF(i==23) 			Duplicate/O $newname $wave4matname 			Else 				Duplicate/O $newname $wave4matname 				transform2equiv_waves("hv23N_EFtemp",wave4matname) 		Endif		i+=1	While(i<63)	Make/O/N=(63-23,dimsize(hv23N_EFtemp,0)) Ga2O3mat	Setscale/P x,23,1,""Ga2O3mat	Setscale/P y, dimoffset(hv23N_EFtemp,0),dimdelta(hv23N_EFtemp,0),""Ga2O3mat	i=23	Do		wave4matname="hv"+num2str(i)+"N_EFtemp"			Ga2O3mat[i-23][]=$wave4matname[q]		killwaves $wave4matname		i+=1	While(i<63)	Display;appendimage Ga2O3matEndProc Ga2O3backgrounddata18()	PauseUpdate;Silent 1	String thisname,newname,wave4matname	Variable i	Variable avgvalue	Duplicate/O data18 newdata18	i=0	Do		Make/O/N=(dimsize(data18,1)) thisEDC		thisEDC[]=data18[i][p]		Wavestats/Q/R=[dimsize(thisEDC,0)-20,dimsize(thisEDC,0)-1] thisEDC		avgvalue=V_avg		Duplicate/O Ldata18 thisavgEDC//		Duplicate/O AVG_EDCdata18 thisavgEDC		Wavestats/Q/R=[dimsize(thisavgEDC,0)-20,dimsize(thisavgEDC,0)-1] thisavgEDC				thisavgEDC[]/=(V_avg/avgvalue)		newdata18[i][]=(thisEDC[q]-thisavgEDC[q])/avgvalue		i+=1	While(i<dimsize(data18,0))End//**************************************Wenwen related****************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************//*******************************************************************************************************************************Proc HWL_makemat(forx,fory,forz,matxyzraw)	string forx,fory,forz,matxyzraw	Prompt forx,"Enter the wave in x"	Prompt fory,"Enter the wave in x"	Prompt forz,"Enter the wave in x"		PauseUpdate;Silent 1	variable size	Variable i	size=Round(sqrt(dimsize($forx,0)))	Make/O/N=(size,size) $matxyzraw	Setscale/I x,$forx[0],$forx[size-1],""$matxyzraw	Setscale/I y,$fory[0],$fory[dimsize($fory,0)],""$matxyzraw	$matxyzraw[][]=$forz[p+q*size]	Display;appendimage $matxyzraw		EndProc HWL_subbgnd(matname,matbgnd,matflat,wavebelow,waveabove)	String matname	String matbgnd	String 	matflat	String wavebelow	String waveabove	Prompt matname,"Input name"	Prompt matbgnd,"Background name"	Prompt matflat,"Output name"	Prompt wavebelow,"Background curve bottom"	Prompt waveabove,"Background curve top"		PauseUpdate;Silent 1	Variable i	variable size	size=dimsize($matname,0)		Duplicate/O $matname $matbgnd	$matbgnd[][]=0	$matbgnd[][]=((size-1-q)/(size-1))*$wavebelow[p]+(q/(size-1))*$waveabove[p]	Duplicate/O $matname $matflat	$matflat[][]=$matname[p][q]-$matbgnd[p][q]EndProc HWL_xyz(matname)	String matname	Prompt matname,"Input name"	PauseUpdate;Silent 1	string tosavex,tosavey,tosavez	Variable i,j	variable size	size=dimsize($matname,0)	tosavex=matname+"_x"	tosavey=matname+"_y"	tosavez=matname+"_z"		Make/O/N=(size*size) $tosavex	Make/O/N=(size*size) $tosavey	Make/O/N=(size*size) $tosavez	j=0	Do		i=0		Do					$tosavex[j*size+i]=dimdelta($matname,1)*i			$tosavey[j*size+i]=dimdelta($matname,1)*j			$tosavez[j*size+i]=$matname[i][j]			i+=1		while(i<size)		j+=1	While(j<size)	edit $tosavex,$tosavey,$tosavezEnd//*******************************************************************************************************************************Variable/G gauss_FWxVariable/G gauss_FWyVariable/G gauss_FCxVariable/G gauss_FCyvariable/G gauss_FHProc set_gauss_F()	PauseUpdate;Silent 1	String/G gauss_Fname		Variable/G gauss_FWx	Variable/G gauss_FWy	Variable/G gauss_FCx	Variable/G gauss_FCy	variable/G gauss_FH	Variable/G gauss_Foffset	gauss_Fname="No mat"	gauss_FWx=1	gauss_FWy=1	gauss_FCx=0	gauss_FCy=0	gauss_FH=-1	gauss_Foffset=1	EndProc fixgauss_Fatcsr()	PauseUpdate;Silent 1	Variable/G gauss_FCx	Variable/G gauss_FCy	gauss_FCx=xcsr(A)	gauss_FCy=vcsr(A)EndProc gauss_Fat_matin(matname)	String matname	Prompt matname,"Enter the name of the matrix"	PauseUpdate;Silent 1	String/G gauss_Fname		gauss_Fname=matname	Duplicate/O $matname gauss_Fmat EndProc gauss_Fupdate()	PauseUpdate;Silent 1	String/G gauss_Fname		Variable/G gauss_FWx	Variable/G gauss_FWy	Variable/G gauss_FCx	Variable/G gauss_FCy	variable/G gauss_FH	Variable/G gauss_Foffset	Duplicate/O $gauss_Fname gaussFilter	gaussFilter[][]= gauss_Foffset+gauss_FH*exp(-(dimoffset($gauss_Fname,0)+p*dimdelta($gauss_Fname,0)-gauss_FCx)^2/gauss_FWx^2)*exp(-(dimoffset($gauss_Fname,1)+q*dimdelta($gauss_Fname,1)-gauss_FCy)^2/gauss_FWy^2)	gauss_Fmat[][]=gaussFilter[p][q]*$gauss_Fname[p][q]EndProc gauss_Fdivide()	PauseUpdate;Silent 1	String/G gauss_Fname		Variable/G gauss_FWx	Variable/G gauss_FWy	Variable/G gauss_FCx	Variable/G gauss_FCy	variable/G gauss_FH	Variable/G gauss_Foffset	Duplicate/O $gauss_Fname gaussFilter	gaussFilter[][]= gauss_Foffset+gauss_FH*exp(-(dimoffset($gauss_Fname,0)+p*dimdelta($gauss_Fname,0)-gauss_FCx)^2/gauss_FWx^2)*exp(-(dimoffset($gauss_Fname,1)+q*dimdelta($gauss_Fname,1)-gauss_FCy)^2/gauss_FWy^2)	gauss_Fmat[][]=$gauss_Fname[p][q]/gaussFilter[p][q]EndFunction ButtonProc_gauss_Fat_matin(ctrlName) : ButtonControl	String ctrlName	Execute "gauss_Fat_matin()"EndFunction ButtonProc_fixgauss_Fatcsr(ctrlName) : ButtonControl	String ctrlName	Execute "fixgauss_Fatcsr()"End//*******************************************************************************************************************************Proc STM_shift(matfixed,matmoved,diffname)	String matfixed	String matmoved	String diffname	Prompt matfixed,"Matrix 1:"	Prompt matmoved,"Matrix 2:"	Prompt diffname,"Name for (1)-(2)"	PauseUpdate;Silent 1	String matfixed_shift,matmoved_shift	Variable shiftx,shifty	matfixed_shift=matfixed+"_shifted"	matmoved_shift=matmoved+"_shifted"	Duplicate/O $matmoved Corr_STMshift 		func_STM_shift($matfixed,$matmoved,Corr_STMshift)	Display;appendimage Corr_STMshift	ModifyImage Corr_STMshift ctab= {*,*,PlanetEarth,0}	Imagestats/Q Corr_STMshift	Print V_maxRowLoc,V_maxColLoc	If(V_maxRowLoc<dimsize(Corr_STMshift,0)/2)		shiftx=V_maxRowLoc*dimdelta($matfixed,0)		Else			shiftx=(V_maxRowLoc-dimsize(Corr_STMshift,0))*dimdelta($matfixed,0)	Endif	If(V_maxColLoc<dimsize(Corr_STMshift,1)/2)		shifty=V_maxColLoc*dimdelta($matfixed,1)		Else			shifty=(V_maxCOlLoc-dimsize(Corr_STMshift,1))*dimdelta($matfixed,1)	Endif	Duplicate/O $matfixed $matfixed_shift	Duplicate/O $matmoved $matmoved_shift	Display;appendimage $matmoved_shift 		Setscale/P	x,dimoffset($matmoved,0)-shiftx,dimdelta($matmoved,0),""$matmoved_shift	Setscale/P	y,dimoffset($matmoved,1)-shifty,dimdelta($matmoved,1),""$matmoved_shift	transform2equiv_mat(matfixed_shift,matmoved_shift)	CutNaNedges(matmoved_shift)	transform2equiv_mat(matmoved_shift,matfixed_shift)	Duplicate/O $matfixed_shift $diffname	$diffname[][]=$matfixed_shift[p][q]-$matmoved_shift[p][q]	Display;appendimage $diffname EndFunction func_STM_shift(matfixed,matmoved,Corr_STMshift)	Wave matfixed	Wave matmoved	Wave Corr_STMshift	PauseUpdate;Silent 1	MatrixOP/O Corr_STMshift=Correlate($matfixed,$matmoved,0)	End//*******************************************************************************************************************************